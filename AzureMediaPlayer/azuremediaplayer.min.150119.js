function _handleMultipleEvents(n,t,i,r){vjs.arr.forEach(i,function(i){n(t,i,r)})}function _logType(n,t){var i,u,r;i=Array.prototype.slice.call(t);u=function(){};r=window.console||{log:u,warn:u,error:u};n?i.unshift(n.toUpperCase()+":"):n="log";vjs.log.history.push(i);i.unshift("VIDEOJS:");r[n].apply?r[n].apply(r,i):r[n](i.join(" "))}function ObjectIron(n){var t;for(t=[],i=0,len=n.length;i<len;i+=1)n[i].isRoot?t.push("root"):t.push(n[i].name);var e=function(n,t){var i;if(n!==null&&t!==null)for(i in n)n.hasOwnProperty(i)&&(t.hasOwnProperty(i)||(t[i]=n[i]))},u=function(n,t,i){var o,s,r,u,f;if(n!==null&&n.length!==0)for(o=0,s=n.length;o<s;o+=1)r=n[o],t.hasOwnProperty(r.name)&&(i.hasOwnProperty(r.name)?r.merge&&(u=t[r.name],f=i[r.name],typeof u=="object"&&typeof f=="object"?e(u,f):i[r.name]=r.mergeFunction!=null?r.mergeFunction(u,f):u+f):i[r.name]=t[r.name])},r=function(n,t){var f=n,o,c,s,l,h,i,e;if(f.children!==null&&f.children.length!==0)for(o=0,c=f.children.length;o<c;o+=1)if(i=f.children[o],t.hasOwnProperty(i.name))if(i.isArray)for(h=t[i.name+"_asArray"],s=0,l=h.length;s<l;s+=1)e=h[s],u(f.properties,t,e),r(i,e);else e=t[i.name],u(f.properties,t,e),r(i,e)},f=function(i){var u,h,c,e,o,s,l;if(i===null||typeof i!="object")return i;for(u=0,h=t.length;u<h;u+=1)t[u]==="root"&&(o=n[u],s=i,r(o,s));for(e in i)if(i.hasOwnProperty(e)){if(c=t.indexOf(e),c!==-1)if(o=n[c],o.isArray)for(l=i[e+"_asArray"],u=0,h=l.length;u<h;u+=1)s=l[u],r(o,s);else s=i[e],r(o,s);f(i[e])}return i};return{run:f}}function X2JS(n,t,i){function h(n){var t=n.localName;return t==null&&(t=n.baseName),(t==null||t=="")&&(t=n.nodeName),t}function w(n){return n.prefix}function c(n){return typeof n=="string"?n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;"):n}function b(n){return n.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#x27;/g,"'").replace(/&#x2F;/g,"/")}function f(u){var l,it,o,g,v,c,s,rt,y,p,a,nt,k,ut,tt,d;if(u.nodeType==r.DOCUMENT_NODE){for(c=u.firstChild,l=0,it=u.childNodes.length;l<it;l+=1)if(u.childNodes[l].nodeType!==r.COMMENT_NODE){c=u.childNodes[l];break}return i?o=f(c):(o={},s=h(c),o[s]=f(c)),o}if(u.nodeType==r.ELEMENT_NODE){for(o={},o.__cnt=0,g=u.childNodes,v=0;v<g.length;v++)if(c=g.item(v),s=h(c),o.__cnt++,o[s]==null)o[s]=f(c),o[s+"_asArray"]=new Array(1),o[s+"_asArray"][0]=o[s];else{for(o[s]!=null&&(o[s]instanceof Array||(rt=o[s],o[s]=[],o[s][0]=rt,o[s+"_asArray"]=o[s])),y=0;o[s][y]!=null;)y++;o[s][y]=f(c)}for(p=0;p<u.attributes.length;p++){for(a=u.attributes.item(p),o.__cnt++,nt=a.value,k=0,ut=n.length;k<ut;k++)tt=n[k],tt.test.call(this,a.value)&&(nt=tt.converter.call(this,a.value));o[t+a.name]=nt}return d=w(u),d!=null&&d!=""&&(o.__cnt++,o.__prefix=d),o.__cnt==1&&o["#text"]!=null&&(o=o["#text"]),o["#text"]!=null&&(o.__text=o["#text"],e&&(o.__text=b(o.__text)),delete o["#text"],delete o["#text_asArray"]),o["#cdata-section"]!=null&&(o.__cdata=o["#cdata-section"],delete o["#cdata-section"],delete o["#cdata-section_asArray"]),(o.__text!=null||o.__cdata!=null)&&(o.toString=function(){return(this.__text!=null?this.__text:"")+(this.__cdata!=null?this.__cdata:"")}),o}return u.nodeType==r.TEXT_NODE||u.nodeType==r.CDATA_SECTION_NODE?u.nodeValue:u.nodeType==r.COMMENT_NODE?null:void 0}function u(n,t,i,r){var e="<"+(n!=null&&n.__prefix!=null?n.__prefix+":":"")+t,u,f,o;if(i!=null)for(u=0;u<i.length;u++)f=i[u],o=n[f],e+=" "+f.substr(1)+"='"+o+"'";return e+(r?"/>":">")}function o(n,t){return"<\/"+(n.__prefix!=null?n.__prefix+":":"")+t+">"}function k(n,t){return n.indexOf(t,n.length-t.length)!==-1}function l(n,t){return k(t.toString(),"_asArray")||t.toString().indexOf("_")==0||n[t]instanceof Function?!0:!1}function a(n){var t=0,i;if(n instanceof Object)for(i in n)l(n,i)||t++;return t}function v(n){var i=[],t;if(n instanceof Object)for(t in n)t.toString().indexOf("__")==-1&&t.toString().indexOf("_")==0&&i.push(t);return i}function d(n){var t="";return n.__cdata!=null&&(t+="<![CDATA["+n.__cdata+"]\]>"),n.__text!=null&&(t+=e?c(n.__text):n.__text),t}function y(n){var t="";return n instanceof Object?t+=d(n):n!=null&&(t+=e?c(n):n),t}function g(n,t,i){var f="",r;if(n.length==0)f+=u(n,t,i,!0);else for(r=0;r<n.length;r++)f+=u(n[r],t,v(n[r]),!1),f+=s(n[r]),f+=o(n[r],t);return f}function s(n){var i="",h=a(n),r,t,f,e;if(h>0)for(r in n)l(n,r)||(t=n[r],f=v(t),t==null||t==undefined?i+=u(t,r,f,!0):t instanceof Object?t instanceof Array?i+=g(t,r,f):(e=a(t),e>0||t.__text!=null||t.__cdata!=null?(i+=u(t,r,f,!1),i+=s(t),i+=o(t,r)):i+=u(t,r,f,!0)):(i+=u(t,r,f,!1),i+=y(t),i+=o(t,r)));return i+y(n)}(t===null||t===undefined)&&(t="_");(i===null||i===undefined)&&(i=!1);var p="1.0.11",e=!1,r={ELEMENT_NODE:1,TEXT_NODE:3,CDATA_SECTION_NODE:4,COMMENT_NODE:8,DOCUMENT_NODE:9};this.parseXmlString=function(n){var t,i;return window.DOMParser?(i=new window.DOMParser,t=i.parseFromString(n,"text/xml")):(n.indexOf("<?")==0&&(n=n.substr(n.indexOf("?>")+2)),t=new ActiveXObject("Microsoft.XMLDOM"),t.async="false",t.loadXML(n)),t};this.xml2json=function(n){return f(n)};this.xml_str2json=function(n){var t=this.parseXmlString(n);return this.xml2json(t)};this.json2xml_str=function(n){return s(n)};this.json2xml=function(n){var t=this.json2xml_str(n);return this.parseXmlString(t)};this.getVersion=function(){return p};this.escapeMode=function(n){e=n}}var vjs,videojs,hasOwnProp,errNum,cx,UTF8,BASE64,btoa,atob,__extends,AzureHtml5JS,amp,UrlRewriter;for(document.createElement("video"),document.createElement("audio"),document.createElement("track"),vjs=function(n,t,i){var r;if(typeof n=="string"){if(n.indexOf("#")===0&&(n=n.slice(1)),vjs.players[n])return vjs.players[n];r=vjs.el(n)}else r=n;if(!r||!r.nodeName)throw new TypeError("The element or ID supplied is not valid. (videojs)");return r.player||new vjs.Player(r,t,i)},videojs=window.videojs=vjs,vjs.CDN_VERSION="GENERATED_CDN_VSN",vjs.ACCESS_PROTOCOL="https:"==document.location.protocol?"https://":"http://",vjs.options={techOrder:["html5","flash"],html5:{},flash:{},width:300,height:150,defaultVolume:0,playbackRates:[],inactivityTimeout:2e3,children:{mediaLoader:{},posterImage:{},textTrackDisplay:{},loadingSpinner:{},bigPlayButton:{},controlBar:{},errorDisplay:{}},language:document.getElementsByTagName("html")[0].getAttribute("lang")||navigator.languages&&navigator.languages[0]||navigator.userLanguage||navigator.language||"en",languages:{},notSupportedMessage:"No compatible source was found for this video."},vjs.CDN_VERSION!=="GENERATED_CDN_VSN"&&(videojs.options.flash.swf=vjs.ACCESS_PROTOCOL+"vjs.zencdn.net/"+vjs.CDN_VERSION+"/video-js.swf"),vjs.addLanguage=function(n,t){return vjs.options.languages[n]=vjs.options.languages[n]!==undefined?vjs.util.mergeOptions(vjs.options.languages[n],t):t,vjs.options.languages},vjs.players={},typeof define=="function"&&define.amd?define([],function(){return videojs}):typeof exports=="object"&&typeof module=="object"&&(module.exports=videojs),vjs.CoreObject=vjs.CoreObject=function(){},vjs.CoreObject.extend=function(n){var r,t,i;n=n||{};r=n.init||n.init||this.prototype.init||this.prototype.init||function(){};t=function(){r.apply(this,arguments)};t.prototype=vjs.obj.create(this.prototype);t.prototype.constructor=t;t.extend=vjs.CoreObject.extend;t.create=vjs.CoreObject.create;for(i in n)n.hasOwnProperty(i)&&(t.prototype[i]=n[i]);return t},vjs.CoreObject.create=function(){var n=vjs.obj.create(this.prototype);return this.apply(n,arguments),n},vjs.on=function(n,t,i){if(vjs.obj.isArray(t))return _handleMultipleEvents(vjs.on,n,t,i);var r=vjs.getData(n);r.handlers||(r.handlers={});r.handlers[t]||(r.handlers[t]=[]);i.guid||(i.guid=vjs.guid++);r.handlers[t].push(i);r.dispatcher||(r.disabled=!1,r.dispatcher=function(t){var u,f,i,e;if(!r.disabled&&(t=vjs.fixEvent(t),u=r.handlers[t.type],u))for(f=u.slice(0),i=0,e=f.length;i<e;i++)if(t.isImmediatePropagationStopped())break;else f[i].call(n,t)});r.handlers[t].length==1&&(n.addEventListener?n.addEventListener(t,r.dispatcher):n.attachEvent&&n.attachEvent("on"+t,r.dispatcher))},vjs.off=function(n,t,i){var r,e,o,u,f;if(vjs.hasData(n)&&(r=vjs.getData(n),r.handlers)){if(vjs.obj.isArray(t))return _handleMultipleEvents(vjs.off,n,t,i);if(e=function(t){r.handlers[t]=[];vjs.cleanUpEvents(n,t)},!t){for(o in r.handlers)e(o);return}if(u=r.handlers[t],u){if(!i){e(t);return}if(i.guid)for(f=0;f<u.length;f++)u[f].guid===i.guid&&u.splice(f--,1);vjs.cleanUpEvents(n,t)}}},vjs.cleanUpEvents=function(n,t){var i=vjs.getData(n);i.handlers[t].length===0&&(delete i.handlers[t],n.removeEventListener?n.removeEventListener(t,i.dispatcher,!1):n.detachEvent&&n.detachEvent("on"+t,i.dispatcher));vjs.isEmpty(i.handlers)&&(delete i.handlers,delete i.dispatcher,delete i.disabled);vjs.isEmpty(i)&&vjs.removeData(n)},vjs.fixEvent=function(n){function f(){return!0}function e(){return!1}var t,u,i,r;if(!n||!n.isPropagationStopped){t=n||window.event;n={};for(u in t)u!=="layerX"&&u!=="layerY"&&u!=="keyLocation"&&(u=="returnValue"&&t.preventDefault||(n[u]=t[u]));n.target||(n.target=n.srcElement||document);n.relatedTarget=n.fromElement===n.target?n.toElement:n.fromElement;n.preventDefault=function(){t.preventDefault&&t.preventDefault();n.returnValue=!1;n.isDefaultPrevented=f;n.defaultPrevented=!0};n.isDefaultPrevented=e;n.defaultPrevented=!1;n.stopPropagation=function(){t.stopPropagation&&t.stopPropagation();n.cancelBubble=!0;n.isPropagationStopped=f};n.isPropagationStopped=e;n.stopImmediatePropagation=function(){t.stopImmediatePropagation&&t.stopImmediatePropagation();n.isImmediatePropagationStopped=f;n.stopPropagation()};n.isImmediatePropagationStopped=e;n.clientX!=null&&(i=document.documentElement,r=document.body,n.pageX=n.clientX+(i&&i.scrollLeft||r&&r.scrollLeft||0)-(i&&i.clientLeft||r&&r.clientLeft||0),n.pageY=n.clientY+(i&&i.scrollTop||r&&r.scrollTop||0)-(i&&i.clientTop||r&&r.clientTop||0));n.which=n.charCode||n.keyCode;n.button!=null&&(n.button=n.button&1?0:n.button&4?1:n.button&2?2:0)}return n},vjs.trigger=function(n,t){var u=vjs.hasData(n)?vjs.getData(n):{},i=n.parentNode||n.ownerDocument,r;return typeof t=="string"&&(t={type:t,target:n}),t=vjs.fixEvent(t),u.dispatcher&&u.dispatcher.call(n,t),i&&!t.isPropagationStopped()&&t.bubbles!==!1?vjs.trigger(i,t):i||t.defaultPrevented||(r=vjs.getData(t.target),t.target[t.type]&&(r.disabled=!0,typeof t.target[t.type]=="function"&&t.target[t.type](),r.disabled=!1)),!t.defaultPrevented},vjs.one=function(n,t,i){if(vjs.obj.isArray(t))return _handleMultipleEvents(vjs.one,n,t,i);var r=function(){vjs.off(n,t,r);i.apply(this,arguments)};r.guid=i.guid=i.guid||vjs.guid++;vjs.on(n,t,r)},hasOwnProp=Object.prototype.hasOwnProperty,vjs.createEl=function(n,t){var i;return n=n||"div",t=t||{},i=document.createElement(n),vjs.obj.each(t,function(n,t){n.indexOf("aria-")!==-1||n=="role"?i.setAttribute(n,t):i[n]=t}),i},vjs.capitalize=function(n){return n.charAt(0).toUpperCase()+n.slice(1)},vjs.obj={},vjs.obj.create=Object.create||function(n){function t(){}return t.prototype=n,new t},vjs.obj.each=function(n,t,i){for(var r in n)hasOwnProp.call(n,r)&&t.call(i||this,r,n[r])},vjs.obj.merge=function(n,t){if(!t)return n;for(var i in t)hasOwnProp.call(t,i)&&(n[i]=t[i]);return n},vjs.obj.deepMerge=function(n,t){var i,r,u;n=vjs.obj.copy(n);for(i in t)hasOwnProp.call(t,i)&&(r=n[i],u=t[i],n[i]=vjs.obj.isPlain(r)&&vjs.obj.isPlain(u)?vjs.obj.deepMerge(r,u):t[i]);return n},vjs.obj.copy=function(n){return vjs.obj.merge({},n)},vjs.obj.isPlain=function(n){return!!n&&typeof n=="object"&&n.toString()==="[object Object]"&&n.constructor===Object},vjs.obj.isArray=Array.isArray||function(n){return Object.prototype.toString.call(n)==="[object Array]"},vjs.isNaN=function(n){return n!==n},vjs.bind=function(n,t,i){t.guid||(t.guid=vjs.guid++);var r=function(){return t.apply(n,arguments)};return r.guid=i?i+"_"+t.guid:t.guid,r},vjs.cache={},vjs.guid=1,vjs.expando="vdata"+(new Date).getTime(),vjs.getData=function(n){var t=n[vjs.expando];return t||(t=n[vjs.expando]=vjs.guid++,vjs.cache[t]={}),vjs.cache[t]},vjs.hasData=function(n){var t=n[vjs.expando];return!(!t||vjs.isEmpty(vjs.cache[t]))},vjs.removeData=function(n){var t=n[vjs.expando];if(t){delete vjs.cache[t];try{delete n[vjs.expando]}catch(i){n.removeAttribute?n.removeAttribute(vjs.expando):n[vjs.expando]=null}}},vjs.isEmpty=function(n){for(var t in n)if(n[t]!==null)return!1;return!0},vjs.hasClass=function(n,t){return(" "+n.className+" ").indexOf(" "+t+" ")!==-1},vjs.addClass=function(n,t){vjs.hasClass(n,t)||(n.className=n.className===""?t:n.className+" "+t)},vjs.removeClass=function(n,t){var i,r;if(vjs.hasClass(n,t)){for(i=n.className.split(" "),r=i.length-1;r>=0;r--)i[r]===t&&i.splice(r,1);n.className=i.join(" ")}},vjs.TEST_VID=vjs.createEl("video"),vjs.USER_AGENT=navigator.userAgent,vjs.IS_IPHONE=/iPhone/i.test(vjs.USER_AGENT),vjs.IS_IPAD=/iPad/i.test(vjs.USER_AGENT),vjs.IS_IPOD=/iPod/i.test(vjs.USER_AGENT),vjs.IS_IOS=vjs.IS_IPHONE||vjs.IS_IPAD||vjs.IS_IPOD,vjs.IOS_VERSION=function(){var n=vjs.USER_AGENT.match(/OS (\d+)_/i);if(n&&n[1])return n[1]}(),vjs.IS_ANDROID=/Android/i.test(vjs.USER_AGENT),vjs.ANDROID_VERSION=function(){var n=vjs.USER_AGENT.match(/Android (\d+)(?:\.(\d+))?(?:\.(\d+))*/i),t,i;return n?(t=n[1]&&parseFloat(n[1]),i=n[2]&&parseFloat(n[2]),t&&i?parseFloat(n[1]+"."+n[2]):t?t:null):null}(),vjs.IS_OLD_ANDROID=vjs.IS_ANDROID&&/webkit/i.test(vjs.USER_AGENT)&&vjs.ANDROID_VERSION<2.3,vjs.IS_FIREFOX=/Firefox/i.test(vjs.USER_AGENT),vjs.IS_CHROME=/Chrome/i.test(vjs.USER_AGENT),vjs.TOUCH_ENABLED=!!("ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch),vjs.BACKGROUND_SIZE_SUPPORTED=("backgroundSize"in vjs.TEST_VID.style),vjs.setElementAttributes=function(n,t){vjs.obj.each(t,function(t,i){i===null||typeof i=="undefined"||i===!1?n.removeAttribute(t):n.setAttribute(t,i===!0?"":i)})},vjs.getElementAttributes=function(n){var f,e,i,r,u,t;if(f={},e=",autoplay,controls,loop,muted,default,",n&&n.attributes&&n.attributes.length>0)for(i=n.attributes,t=i.length-1;t>=0;t--)r=i[t].name,u=i[t].value,(typeof n[r]=="boolean"||e.indexOf(","+r+",")!==-1)&&(u=u!==null?!0:!1),f[r]=u;return f},vjs.getComputedDimension=function(n,t){var i="";return document.defaultView&&document.defaultView.getComputedStyle?i=document.defaultView.getComputedStyle(n,"").getPropertyValue(t):n.currentStyle&&(i=n["client"+t.substr(0,1).toUpperCase()+t.substr(1)]+"px"),i},vjs.insertFirst=function(n,t){t.firstChild?t.insertBefore(n,t.firstChild):t.appendChild(n)},vjs.browser={},vjs.el=function(n){return n.indexOf("#")===0&&(n=n.slice(1)),document.getElementById(n)},vjs.formatTime=function(n,t){t=t||n;var i=Math.floor(n%60),r=Math.floor(n/60%60),u=Math.floor(n/3600),f=Math.floor(t/60%60),e=Math.floor(t/3600);return(isNaN(n)||n===Infinity)&&(u=r=i="-"),u=u>0||e>0?u+":":"",r=((u||f>=10)&&r<10?"0"+r:r)+":",i=i<10?"0"+i:i,u+r+i},vjs.blockTextSelection=function(){document.body.focus();document.onselectstart=function(){return!1}},vjs.unblockTextSelection=function(){document.onselectstart=function(){return!0}},vjs.trim=function(n){return(n+"").replace(/^\s+|\s+$/g,"")},vjs.round=function(n,t){return t||(t=0),Math.round(n*Math.pow(10,t))/Math.pow(10,t)},vjs.createTimeRange=function(n,t){return{length:1,start:function(){return n},end:function(){return t}}},vjs.setLocalStorage=function(n,t){try{var r=window.localStorage||!1;if(!r)return;r[n]=t}catch(i){i.code==22||i.code==1014?vjs.log("LocalStorage Full (VideoJS)",i):i.code==18?vjs.log("LocalStorage not allowed (VideoJS)",i):vjs.log("LocalStorage Error (VideoJS)",i)}},vjs.getAbsoluteURL=function(n){return n.match(/^https?:\/\//)||(n=vjs.createEl("div",{innerHTML:'<a href="'+n+'">x<\/a>'}).firstChild.href),n},vjs.parseUrl=function(n){var t,i,f,u,e,r;for(u=["protocol","hostname","port","pathname","search","hash","host"],i=vjs.createEl("a",{href:n}),f=i.host===""&&i.protocol!=="file:",f&&(t=vjs.createEl("div"),t.innerHTML='<a href="'+n+'"><\/a>',i=t.firstChild,t.setAttribute("style","display:none; position:absolute;"),document.body.appendChild(t)),e={},r=0;r<u.length;r++)e[u[r]]=i[u[r]];return f&&document.body.removeChild(t),e},vjs.log=function(){_logType(null,arguments)},vjs.log.history=[],vjs.log.error=function(){_logType("error",arguments)},vjs.log.warn=function(){_logType("warn",arguments)},vjs.findPosition=function(n){var i,r,t,u,f,e,o,s,h;return(n.getBoundingClientRect&&n.parentNode&&(i=n.getBoundingClientRect()),!i)?{left:0,top:0}:(r=document.documentElement,t=document.body,u=r.clientLeft||t.clientLeft||0,f=window.pageXOffset||t.scrollLeft,e=i.left+f-u,o=r.clientTop||t.clientTop||0,s=window.pageYOffset||t.scrollTop,h=i.top+s-o,{left:vjs.round(e),top:vjs.round(h)})},vjs.arr={},vjs.arr.forEach=function(n,t,i){if(vjs.obj.isArray(n)&&t instanceof Function)for(var r=0,u=n.length;r<u;++r)t.call(i||vjs,n[r],r,n);return n},vjs.xhr=function(n,t){var u,i,f,e,h,c,o,s,r;typeof n=="string"&&(n={uri:n});videojs.util.mergeOptions({method:"GET",timeout:45e3},n);t=t||function(){};s=function(){window.clearTimeout(o);t(null,i,i.response||i.responseText)};r=function(n){window.clearTimeout(o);n&&typeof n!="string"||(n=new Error(n));t(n,i)};u=window.XMLHttpRequest;typeof u=="undefined"&&(u=function(){try{return new window.ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(n){}try{return new window.ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(t){}try{return new window.ActiveXObject("Msxml2.XMLHTTP")}catch(i){}throw new Error("This browser does not support XMLHttpRequest.");});i=new u;i.uri=n.uri;f=vjs.parseUrl(n.uri);e=window.location;c=f.protocol+f.host!==e.protocol+e.host;!c||!window.XDomainRequest||"withCredentials"in i?(h=f.protocol=="file:"||e.protocol=="file:",i.onreadystatechange=function(){if(i.readyState===4){if(i.timedout)return r("timeout");i.status===200||h&&i.status===0?s():r()}},n.timeout&&(o=window.setTimeout(function(){i.readyState!==4&&(i.timedout=!0,i.abort())},n.timeout))):(i=new window.XDomainRequest,i.onload=s,i.onerror=r,i.onprogress=function(){},i.ontimeout=function(){});try{i.open(n.method||"GET",n.uri,!0)}catch(l){return r(l)}n.withCredentials&&(i.withCredentials=!0);n.responseType&&(i.responseType=n.responseType);try{i.send()}catch(l){return r(l)}return i},vjs.util={},vjs.util.mergeOptions=function(n,t){var i,r,u;n=vjs.obj.copy(n);for(i in t)t.hasOwnProperty(i)&&(r=n[i],u=t[i],n[i]=vjs.obj.isPlain(r)&&vjs.obj.isPlain(u)?vjs.util.mergeOptions(r,u):t[i]);return n},vjs.Component=vjs.CoreObject.extend({init:function(n,t,i){this.player_=n;this.options_=vjs.obj.copy(this.options_);t=this.options(t);this.id_=t.id||t.el&&t.el.id;this.id_||(this.id_=(n.id&&n.id()||"no_player")+"_component_"+vjs.guid++);this.name_=t.name||null;this.el_=t.el||this.createEl();this.children_=[];this.childIndex_={};this.childNameIndex_={};this.initChildren();this.ready(i);t.reportTouchActivity!==!1&&this.enableTouchActivity()}}),vjs.Component.prototype.dispose=function(){if(this.trigger({type:"dispose",bubbles:!1}),this.children_)for(var n=this.children_.length-1;n>=0;n--)this.children_[n].dispose&&this.children_[n].dispose();this.children_=null;this.childIndex_=null;this.childNameIndex_=null;this.off();this.el_.parentNode&&this.el_.parentNode.removeChild(this.el_);vjs.removeData(this.el_);this.el_=null},vjs.Component.prototype.player_=!0,vjs.Component.prototype.player=function(){return this.player_},vjs.Component.prototype.options_,vjs.Component.prototype.options=function(n){return n===undefined?this.options_:this.options_=vjs.util.mergeOptions(this.options_,n)},vjs.Component.prototype.el_,vjs.Component.prototype.createEl=function(n,t){return vjs.createEl(n,t)},vjs.Component.prototype.localize=function(n){var i=this.player_.language(),t=this.player_.languages();return t&&t[i]&&t[i][n]?t[i][n]:n},vjs.Component.prototype.el=function(){return this.el_},vjs.Component.prototype.contentEl_,vjs.Component.prototype.contentEl=function(){return this.contentEl_||this.el_},vjs.Component.prototype.id_,vjs.Component.prototype.id=function(){return this.id_},vjs.Component.prototype.name_,vjs.Component.prototype.name=function(){return this.name_},vjs.Component.prototype.children_,vjs.Component.prototype.children=function(){return this.children_},vjs.Component.prototype.childIndex_,vjs.Component.prototype.getChildById=function(n){return this.childIndex_[n]},vjs.Component.prototype.childNameIndex_,vjs.Component.prototype.getChild=function(n){return this.childNameIndex_[n]},vjs.Component.prototype.addChild=function(n,t){var i,u,r;return typeof n=="string"?(r=n,t=t||{},u=t.componentClass||vjs.capitalize(r),t.name=r,i=new window.videojs[u](this.player_||this,t)):i=n,this.children_.push(i),typeof i.id=="function"&&(this.childIndex_[i.id()]=i),r=r||i.name&&i.name(),r&&(this.childNameIndex_[r]=i),typeof i.el=="function"&&i.el()&&this.contentEl().appendChild(i.el()),i},vjs.Component.prototype.removeChild=function(n){var i,t,r;if(typeof n=="string"&&(n=this.getChild(n)),n&&this.children_){for(i=!1,t=this.children_.length-1;t>=0;t--)if(this.children_[t]===n){i=!0;this.children_.splice(t,1);break}i&&(this.childIndex_[n.id]=null,this.childNameIndex_[n.name]=null,r=n.el(),r&&r.parentNode===this.contentEl()&&this.contentEl().removeChild(n.el()))}},vjs.Component.prototype.initChildren=function(){var i,r,n,t,f,e,o,u;if(i=this,r=i.options(),n=r.children,n)if(o=function(n,t){(r[n]!==undefined&&(t=r[n]),t!==!1)&&(i[n]=i.addChild(n,t))},vjs.obj.isArray(n))for(u=0;u<n.length;u++)t=n[u],typeof t=="string"?(f=t,e={}):(f=t.name,e=t),o(f,e);else vjs.obj.each(n,o)},vjs.Component.prototype.buildCSSClass=function(){return""},vjs.Component.prototype.on=function(n,t,i){var r,f,u,e,o,s;if(typeof n=="string"||vjs.obj.isArray(n))vjs.on(this.el_,n,vjs.bind(this,t));else{r=n;f=t;u=vjs.bind(this,i);s=this;e=function(){s.off(r,f,u)};e.guid=u.guid;this.on("dispose",e);if(o=function(){s.off("dispose",e)},o.guid=u.guid,n.nodeName){vjs.on(r,f,u);vjs.on(r,"dispose",o)}else if(typeof n.on=="function"){r.on(f,u);r.on("dispose",o)}}return this},vjs.Component.prototype.off=function(n,t,i){var u,f,r;return!n||typeof n=="string"||vjs.obj.isArray(n)?vjs.off(this.el_,n,t):(u=n,f=t,r=vjs.bind(this,i),this.off("dispose",r),n.nodeName?(vjs.off(u,f,r),vjs.off(u,"dispose",r)):(u.off(f,r),u.off("dispose",r))),this},vjs.Component.prototype.one=function(n,t,i){var u,f,e,o,r;if(typeof n=="string"||vjs.obj.isArray(n))vjs.one(this.el_,n,vjs.bind(this,t));else{u=n;f=t;e=vjs.bind(this,i);o=this;r=function(){o.off(u,f,r);e.apply(this,arguments)};r.guid=e.guid;this.on(u,f,r)}return this},vjs.Component.prototype.trigger=function(n){return vjs.trigger(this.el_,n),this},vjs.Component.prototype.isReady_,vjs.Component.prototype.isReadyOnInitFinish_=!0,vjs.Component.prototype.readyQueue_,vjs.Component.prototype.ready=function(n){return n&&(this.isReady_?n.call(this):(this.readyQueue_===undefined&&(this.readyQueue_=[]),this.readyQueue_.push(n))),this},vjs.Component.prototype.triggerReady=function(){var n,t,i;if(this.isReady_=!0,n=this.readyQueue_,n&&n.length>0){for(t=0,i=n.length;t<i;t++)n[t].call(this);this.readyQueue_=[];this.trigger("ready")}},vjs.Component.prototype.hasClass=function(n){return vjs.hasClass(this.el_,n)},vjs.Component.prototype.addClass=function(n){return vjs.addClass(this.el_,n),this},vjs.Component.prototype.removeClass=function(n){return vjs.removeClass(this.el_,n),this},vjs.Component.prototype.show=function(){return this.el_.style.display="block",this},vjs.Component.prototype.hide=function(){return this.el_.style.display="none",this},vjs.Component.prototype.lockShowing=function(){return this.addClass("vjs-lock-showing"),this},vjs.Component.prototype.unlockShowing=function(){return this.removeClass("vjs-lock-showing"),this},vjs.Component.prototype.disable=function(){this.hide();this.show=function(){}},vjs.Component.prototype.width=function(n,t){return this.dimension("width",n,t)},vjs.Component.prototype.height=function(n,t){return this.dimension("height",n,t)},vjs.Component.prototype.dimensions=function(n,t){return this.width(n,!0).height(t)},vjs.Component.prototype.dimension=function(n,t,i){if(t!==undefined)return(t===null||vjs.isNaN(t))&&(t=0),this.el_.style[n]=(""+t).indexOf("%")!==-1||(""+t).indexOf("px")!==-1?t:t==="auto"?"":t+"px",i||this.trigger("resize"),this;if(!this.el_)return 0;var r=this.el_.style[n],u=r.indexOf("px");return u!==-1?parseInt(r.slice(0,u),10):parseInt(this.el_["offset"+vjs.capitalize(n)],10)},vjs.Component.prototype.onResize,vjs.Component.prototype.emitTapEvents=function(){var i,n,e,t,r,u,f,o,s;i=0;n=null;s=22;this.on("touchstart",function(r){r.touches.length===1&&(n=r.touches[0],i=(new Date).getTime(),t=!0)});this.on("touchmove",function(i){i.touches.length>1?t=!1:n&&(u=i.touches[0].pageX-n.pageX,f=i.touches[0].pageY-n.pageY,o=Math.sqrt(u*u+f*f),o>s&&(t=!1))});r=function(){t=!1};this.on("touchleave",r);this.on("touchcancel",r);this.on("touchend",function(r){n=null;t===!0&&(e=(new Date).getTime()-i,e<250&&(r.preventDefault(),this.trigger("tap")))})},vjs.Component.prototype.enableTouchActivity=function(){var n,t,i;if(this.player().reportUserActivity){n=vjs.bind(this.player(),this.player().reportUserActivity);this.on("touchstart",function(){n();this.clearInterval(t);t=this.setInterval(n,250)});i=function(){n();this.clearInterval(t)};this.on("touchmove",n);this.on("touchend",i);this.on("touchcancel",i)}},vjs.Component.prototype.setTimeout=function(n,t){n=vjs.bind(this,n);var i=setTimeout(n,t),r=function(){this.clearTimeout(i)};r.guid="vjs-timeout-"+i;this.on("dispose",r);return i},vjs.Component.prototype.clearTimeout=function(n){clearTimeout(n);var t=function(){};return t.guid="vjs-timeout-"+n,this.off("dispose",t),n},vjs.Component.prototype.setInterval=function(n,t){n=vjs.bind(this,n);var i=setInterval(n,t),r=function(){this.clearInterval(i)};r.guid="vjs-interval-"+i;this.on("dispose",r);return i},vjs.Component.prototype.clearInterval=function(n){clearInterval(n);var t=function(){};return t.guid="vjs-interval-"+n,this.off("dispose",t),n},vjs.Button=vjs.Component.extend({init:function(n,t){vjs.Component.call(this,n,t);this.emitTapEvents();this.on("tap",this.onClick);this.on("click",this.onClick);this.on("focus",this.onFocus);this.on("blur",this.onBlur)}}),vjs.Button.prototype.createEl=function(n,t){var i;return t=vjs.obj.merge({className:this.buildCSSClass(),role:"button","aria-live":"polite",tabIndex:0},t),i=vjs.Component.prototype.createEl.call(this,n,t),t.innerHTML||(this.contentEl_=vjs.createEl("div",{className:"vjs-control-content"}),this.controlText_=vjs.createEl("span",{className:"vjs-control-text",innerHTML:this.localize(this.buttonText)||"Need Text"}),this.contentEl_.appendChild(this.controlText_),i.appendChild(this.contentEl_)),i},vjs.Button.prototype.buildCSSClass=function(){return"vjs-control "+vjs.Component.prototype.buildCSSClass.call(this)},vjs.Button.prototype.onClick=function(){},vjs.Button.prototype.onFocus=function(){vjs.on(document,"keydown",vjs.bind(this,this.onKeyPress))},vjs.Button.prototype.onKeyPress=function(n){(n.which==32||n.which==13)&&(n.preventDefault(),this.onClick())},vjs.Button.prototype.onBlur=function(){vjs.off(document,"keydown",vjs.bind(this,this.onKeyPress))},vjs.Slider=vjs.Component.extend({init:function(n,t){vjs.Component.call(this,n,t);this.bar=this.getChild(this.options_.barName);this.handle=this.getChild(this.options_.handleName);this.on("mousedown",this.onMouseDown);this.on("touchstart",this.onMouseDown);this.on("focus",this.onFocus);this.on("blur",this.onBlur);this.on("click",this.onClick);this.on(n,"controlsvisible",this.update);this.on(n,this.playerEvent,this.update)}}),vjs.Slider.prototype.createEl=function(n,t){return t=t||{},t.className=t.className+" vjs-slider",t=vjs.obj.merge({role:"slider","aria-valuenow":0,"aria-valuemin":0,"aria-valuemax":100,tabIndex:0},t),vjs.Component.prototype.createEl.call(this,n,t)},vjs.Slider.prototype.onMouseDown=function(n){n.preventDefault();vjs.blockTextSelection();this.addClass("vjs-sliding");this.on(document,"mousemove",this.onMouseMove);this.on(document,"mouseup",this.onMouseUp);this.on(document,"touchmove",this.onMouseMove);this.on(document,"touchend",this.onMouseUp);this.onMouseMove(n)},vjs.Slider.prototype.onMouseMove=function(){},vjs.Slider.prototype.onMouseUp=function(){vjs.unblockTextSelection();this.removeClass("vjs-sliding");this.off(document,"mousemove",this.onMouseMove);this.off(document,"mouseup",this.onMouseUp);this.off(document,"touchmove",this.onMouseMove);this.off(document,"touchend",this.onMouseUp);this.update()},vjs.Slider.prototype.update=function(){if(this.el_){var t,n=this.getPercent(),i=this.handle,r=this.bar;if(isNaN(n)&&(n=0),t=n,i){var o=this.el_,s=o.offsetWidth,u=i.el().offsetWidth,f=u?u/s:0,h=1-f,e=n*h;t=e+f/2;i.el().style.left=vjs.round(e*100,2)+"%"}r&&(r.el().style.width=vjs.round(t*100,2)+"%")}},vjs.Slider.prototype.calculateDistance=function(n){var e,o,r,u,f,t,i,c,l,s,h;return e=this.el_,o=vjs.findPosition(e),f=t=e.offsetWidth,i=this.handle,this.options().vertical?(u=o.top,l=n.changedTouches?n.changedTouches[0].pageY:n.pageY,i&&(s=i.el().offsetHeight,u=u+s/2,t=t-s),Math.max(0,Math.min(1,(u-l+t)/t))):(r=o.left,c=n.changedTouches?n.changedTouches[0].pageX:n.pageX,i&&(h=i.el().offsetWidth,r=r+h/2,f=f-h),Math.max(0,Math.min(1,(c-r)/f)))},vjs.Slider.prototype.onFocus=function(){this.on(document,"keydown",this.onKeyPress)},vjs.Slider.prototype.onKeyPress=function(n){n.which==37||n.which==40?(n.preventDefault(),this.stepBack()):(n.which==38||n.which==39)&&(n.preventDefault(),this.stepForward())},vjs.Slider.prototype.onBlur=function(){this.off(document,"keydown",this.onKeyPress)},vjs.Slider.prototype.onClick=function(n){n.stopImmediatePropagation();n.preventDefault()},vjs.SliderHandle=vjs.Component.extend(),vjs.SliderHandle.prototype.defaultValue=0,vjs.SliderHandle.prototype.createEl=function(n,t){return t=t||{},t.className=t.className+" vjs-slider-handle",t=vjs.obj.merge({innerHTML:'<span class="vjs-control-text">'+this.defaultValue+"<\/span>"},t),vjs.Component.prototype.createEl.call(this,"div",t)},vjs.Menu=vjs.Component.extend(),vjs.Menu.prototype.addItem=function(n){this.addChild(n);n.on("click",vjs.bind(this,function(){this.unlockShowing()}))},vjs.Menu.prototype.createEl=function(){var t=this.options().contentElType||"ul",n;this.contentEl_=vjs.createEl(t,{className:"vjs-menu-content"});n=vjs.Component.prototype.createEl.call(this,"div",{append:this.contentEl_,className:"vjs-menu"});n.appendChild(this.contentEl_);vjs.on(n,"click",function(n){n.preventDefault();n.stopImmediatePropagation()});return n},vjs.MenuItem=vjs.Button.extend({init:function(n,t){vjs.Button.call(this,n,t);this.selected(t.selected)}}),vjs.MenuItem.prototype.createEl=function(n,t){return vjs.Button.prototype.createEl.call(this,"li",vjs.obj.merge({className:"vjs-menu-item",innerHTML:this.localize(this.options_.label)},t))},vjs.MenuItem.prototype.onClick=function(){this.selected(!0)},vjs.MenuItem.prototype.selected=function(n){n?(this.addClass("vjs-selected"),this.el_.setAttribute("aria-selected",!0)):(this.removeClass("vjs-selected"),this.el_.setAttribute("aria-selected",!1))},vjs.MenuButton=vjs.Button.extend({init:function(n,t){vjs.Button.call(this,n,t);this.menu=this.createMenu();this.addChild(this.menu);this.items&&this.items.length===0&&this.hide();this.on("keydown",this.onKeyPress);this.el_.setAttribute("aria-haspopup",!0);this.el_.setAttribute("role","button")}}),vjs.MenuButton.prototype.buttonPressed_=!1,vjs.MenuButton.prototype.createMenu=function(){var t=new vjs.Menu(this.player_),n;if(this.options().title&&t.contentEl().appendChild(vjs.createEl("li",{className:"vjs-menu-title",innerHTML:vjs.capitalize(this.options().title),tabindex:-1})),this.items=this.createItems(),this.items)for(n=0;n<this.items.length;n++)t.addItem(this.items[n]);return t},vjs.MenuButton.prototype.createItems=function(){},vjs.MenuButton.prototype.buildCSSClass=function(){return this.className+" vjs-menu-button "+vjs.Button.prototype.buildCSSClass.call(this)},vjs.MenuButton.prototype.onFocus=function(){},vjs.MenuButton.prototype.onBlur=function(){},vjs.MenuButton.prototype.onClick=function(){this.one("mouseout",vjs.bind(this,function(){this.menu.unlockShowing();this.el_.blur()}));this.buttonPressed_?this.unpressButton():this.pressButton()},vjs.MenuButton.prototype.onKeyPress=function(n){n.preventDefault();n.which==32||n.which==13?this.buttonPressed_?this.unpressButton():this.pressButton():n.which==27&&this.buttonPressed_&&this.unpressButton()},vjs.MenuButton.prototype.pressButton=function(){this.buttonPressed_=!0;this.menu.lockShowing();this.el_.setAttribute("aria-pressed",!0);this.items&&this.items.length>0&&this.items[0].el().focus()},vjs.MenuButton.prototype.unpressButton=function(){this.buttonPressed_=!1;this.menu.unlockShowing();this.el_.setAttribute("aria-pressed",!1)},vjs.MediaError=function(n){typeof n=="number"?this.code=n:typeof n=="string"?this.message=n:typeof n=="object"&&vjs.obj.merge(this,n);this.message||(this.message=vjs.MediaError.defaultMessages[this.code]||"")},vjs.MediaError.prototype.code=0,vjs.MediaError.prototype.message="",vjs.MediaError.prototype.status=null,vjs.MediaError.errorTypes=["MEDIA_ERR_CUSTOM","MEDIA_ERR_ABORTED","MEDIA_ERR_NETWORK","MEDIA_ERR_DECODE","MEDIA_ERR_SRC_NOT_SUPPORTED","MEDIA_ERR_ENCRYPTED"],vjs.MediaError.defaultMessages={1:"You aborted the video playback",2:"A network error caused the video download to fail part-way.",3:"The video playback was aborted due to a corruption problem or because the video used features your browser did not support.",4:"The video could not be loaded, either because the server or network failed or because the format is not supported.",5:"The video is encrypted and we do not have the keys to decrypt it."},errNum=0;errNum<vjs.MediaError.errorTypes.length;errNum++)vjs.MediaError[vjs.MediaError.errorTypes[errNum]]=errNum,vjs.MediaError.prototype[vjs.MediaError.errorTypes[errNum]]=errNum;if(function(){var t,r,i,n;for(vjs.browser.fullscreenAPI,t=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],r=t[0],n=0;n<t.length;n++)if(t[n][1]in document){i=t[n];break}if(i)for(vjs.browser.fullscreenAPI={},n=0;n<i.length;n++)vjs.browser.fullscreenAPI[r[n]]=i[n]}(),vjs.Player=vjs.Component.extend({init:function(n,t,i){this.tag=n;n.id=n.id||"vjs_video_"+vjs.guid++;this.tagAttributes=n&&vjs.getElementAttributes(n);t=vjs.obj.merge(this.getTagSettings(n),t);t.autoplay===undefined&&(t.autoplay=!1);this.language_=t.language||vjs.options.language;this.languages_=t.languages||vjs.options.languages;this.cache_={};this.poster_=t.poster||"";this.controls_=!!t.controls;n.controls=!1;t.reportTouchActivity=!1;this.isAudio(this.tag.nodeName.toLowerCase()==="audio");vjs.Component.call(this,this,t,i);this.controls()?this.addClass("vjs-controls-enabled"):this.addClass("vjs-controls-disabled");this.isAudio()&&this.addClass("vjs-audio");vjs.players[this.id_]=this;t.plugins&&vjs.obj.each(t.plugins,function(n,t){this[n](t)},this);this.listenForUserActivity()}}),vjs.Player.prototype.language_,vjs.Player.prototype.language=function(n){return n===undefined?this.language_:(this.language_=n,this)},vjs.Player.prototype.languages_,vjs.Player.prototype.languages=function(){return this.languages_},vjs.Player.prototype.options_=vjs.options,vjs.Player.prototype.dispose=function(){this.trigger("dispose");this.off("dispose");vjs.players[this.id_]=null;this.tag&&this.tag.player&&(this.tag.player=null);this.el_&&this.el_.player&&(this.el_.player=null);this.tech&&this.tech.dispose();vjs.Component.prototype.dispose.call(this)},vjs.Player.prototype.getTagSettings=function(n){var i,e,r={sources:[],tracks:[]},o,u,s,f,h,t;if(i=vjs.getElementAttributes(n),e=i["data-setup"],e!==null&&vjs.obj.merge(i,vjs.JSON.parse(e||"{}")),vjs.obj.merge(r,i),n.hasChildNodes())for(o=n.childNodes,f=0,h=o.length;f<h;f++)u=o[f],s=u.nodeName.toLowerCase(),s==="source"?(t=vjs.getElementAttributes(u),t=vjs.obj.merge(t,vjs.JSON.parse(t["data-setup"]||"{}")),r.sources.push(t)):s==="track"&&r.tracks.push(vjs.getElementAttributes(u));return r},vjs.Player.prototype.createEl=function(){var t=this.el_=vjs.Component.prototype.createEl.call(this,"div"),n=this.tag,i,f,e,r,o,s,u;if(n.removeAttribute("width"),n.removeAttribute("height"),n.hasChildNodes()){for(f=n.childNodes,e=f.length,u=[];e--;)o=f[e],s=o.nodeName.toLowerCase(),s==="track"&&u.push(o);for(r=0;r<u.length;r++)n.removeChild(u[r])}i=vjs.getElementAttributes(n);vjs.obj.each(i,function(n){n=="class"?t.className=i[n]:t.setAttribute(n,i[n])});n.id+="_html5_api";n.className="vjs-tech";n.player=t.player=this;this.addClass("vjs-paused");this.width(this.options_.width,!0);this.height(this.options_.height,!0);n.initNetworkState_=n.networkState;n.parentNode&&n.parentNode.insertBefore(t,n);vjs.insertFirst(n,t);this.el_=t;this.on("loadstart",this.onLoadStart);this.on("waiting",this.onWaiting);this.on(["canplay","canplaythrough","playing","ended"],this.onWaitEnd);this.on("seeking",this.onSeeking);this.on("seeked",this.onSeeked);this.on("ended",this.onEnded);this.on("play",this.onPlay);this.on("firstplay",this.onFirstPlay);this.on("pause",this.onPause);this.on("progress",this.onProgress);this.on("durationchange",this.onDurationChange);this.on("fullscreenchange",this.onFullscreenChange);return t},vjs.Player.prototype.loadTech=function(n,t){this.tech&&this.unloadTech();n!=="Html5"&&this.tag&&(vjs.Html5.disposeMediaElement(this.tag),this.tag=null);this.techName=n;this.isReady_=!1;var r=function(){this.player_.triggerReady()},i=vjs.obj.merge({source:t,parentEl:this.el_},this.options_[n.toLowerCase()]);t&&(this.currentType_=t.type,t.src==this.cache_.src&&this.cache_.currentTime>0&&(i.startTime=this.cache_.currentTime),this.cache_.src=t.src);this.tech=new window.videojs[n](this,i);this.tech.ready(r)},vjs.Player.prototype.unloadTech=function(){this.isReady_=!1;this.tech.dispose();this.tech=!1},vjs.Player.prototype.onLoadStart=function(){if(this.error(null),this.paused()){this.hasStarted(!1);this.one("play",function(){this.hasStarted(!0)})}else this.trigger("firstplay")},vjs.Player.prototype.hasStarted_=!1,vjs.Player.prototype.hasStarted=function(n){return n!==undefined?(this.hasStarted_!==n&&(this.hasStarted_=n,n?(this.addClass("vjs-has-started"),this.trigger("firstplay")):this.removeClass("vjs-has-started")),this):this.hasStarted_},vjs.Player.prototype.onLoadedMetaData,vjs.Player.prototype.onLoadedData,vjs.Player.prototype.onLoadedAllData,vjs.Player.prototype.onPlay=function(){this.removeClass("vjs-paused");this.addClass("vjs-playing")},vjs.Player.prototype.onWaiting=function(){this.addClass("vjs-waiting")},vjs.Player.prototype.onWaitEnd=function(){this.removeClass("vjs-waiting")},vjs.Player.prototype.onSeeking=function(){this.addClass("vjs-seeking")},vjs.Player.prototype.onSeeked=function(){this.removeClass("vjs-seeking")},vjs.Player.prototype.onFirstPlay=function(){this.options_.starttime&&this.currentTime(this.options_.starttime);this.addClass("vjs-has-started")},vjs.Player.prototype.onPause=function(){this.removeClass("vjs-playing");this.addClass("vjs-paused")},vjs.Player.prototype.onTimeUpdate,vjs.Player.prototype.onProgress=function(){this.bufferedPercent()==1&&this.trigger("loadedalldata")},vjs.Player.prototype.onEnded=function(){this.options_.loop?(this.currentTime(0),this.play()):this.paused()||this.pause()},vjs.Player.prototype.onDurationChange=function(){var n=this.techGet("duration");n&&(n<0&&(n=Infinity),this.duration(n),n===Infinity?this.addClass("vjs-live"):this.removeClass("vjs-live"))},vjs.Player.prototype.onVolumeChange,vjs.Player.prototype.onFullscreenChange=function(){this.isFullscreen()?this.addClass("vjs-fullscreen"):this.removeClass("vjs-fullscreen")},vjs.Player.prototype.cache_,vjs.Player.prototype.getCache=function(){return this.cache_},vjs.Player.prototype.techCall=function(n,t){if(this.tech&&!this.tech.isReady_)this.tech.ready(function(){this[n](t)});else try{this.tech[n](t)}catch(i){vjs.log(i);throw i;}},vjs.Player.prototype.techGet=function(n){if(this.tech&&this.tech.isReady_)try{return this.tech[n]()}catch(t){this.tech[n]===undefined?vjs.log("Video.js: "+n+" method not defined for "+this.techName+" playback technology.",t):t.name=="TypeError"?(vjs.log("Video.js: "+n+" unavailable on "+this.techName+" playback technology element.",t),this.tech.isReady_=!1):vjs.log(t);throw t;}return},vjs.Player.prototype.play=function(){return this.techCall("play"),this},vjs.Player.prototype.pause=function(){return this.techCall("pause"),this},vjs.Player.prototype.paused=function(){return this.techGet("paused")===!1?!1:!0},vjs.Player.prototype.currentTime=function(n){return n!==undefined?(this.techCall("setCurrentTime",n),this):this.cache_.currentTime=this.techGet("currentTime")||0},vjs.Player.prototype.duration=function(n){return n!==undefined?(this.cache_.duration=parseFloat(n),this):(this.cache_.duration===undefined&&this.onDurationChange(),this.cache_.duration||0)},vjs.Player.prototype.remainingTime=function(){return this.duration()-this.currentTime()},vjs.Player.prototype.buffered=function(){var n=this.techGet("buffered");return n&&n.length||(n=vjs.createTimeRange(0,0)),n},vjs.Player.prototype.bufferedPercent=function(){var t=this.duration(),r=this.buffered(),u=0,f,i,n;if(!t)return 0;for(n=0;n<r.length;n++)f=r.start(n),i=r.end(n),i>t&&(i=t),u+=i-f;return u/t},vjs.Player.prototype.bufferedEnd=function(){var t=this.buffered(),i=this.duration(),n=t.end(t.length-1);return n>i&&(n=i),n},vjs.Player.prototype.volume=function(n){var t;return n!==undefined?(t=Math.max(0,Math.min(1,parseFloat(n))),this.cache_.volume=t,this.techCall("setVolume",t),vjs.setLocalStorage("volume",t),this):(t=parseFloat(this.techGet("volume")),isNaN(t)?1:t)},vjs.Player.prototype.muted=function(n){return n!==undefined?(this.techCall("setMuted",n),this):this.techGet("muted")||!1},vjs.Player.prototype.supportsFullScreen=function(){return this.techGet("supportsFullScreen")||!1},vjs.Player.prototype.isFullscreen_=!1,vjs.Player.prototype.isFullscreen=function(n){return n!==undefined?(this.isFullscreen_=!!n,this):this.isFullscreen_},vjs.Player.prototype.isFullScreen=function(n){return vjs.log.warn('player.isFullScreen() has been deprecated, use player.isFullscreen() with a lowercase "s")'),this.isFullscreen(n)},vjs.Player.prototype.requestFullscreen=function(){var n=vjs.browser.fullscreenAPI;if(this.isFullscreen(!0),n){vjs.on(document,n.fullscreenchange,vjs.bind(this,function(){this.isFullscreen(document[n.fullscreenElement]);this.isFullscreen()===!1&&vjs.off(document,n.fullscreenchange,arguments.callee);this.trigger("fullscreenchange")}));this.el_[n.requestFullscreen]()}else this.tech.supportsFullScreen()?this.techCall("enterFullScreen"):(this.enterFullWindow(),this.trigger("fullscreenchange"));return this},vjs.Player.prototype.requestFullScreen=function(){return vjs.log.warn('player.requestFullScreen() has been deprecated, use player.requestFullscreen() with a lowercase "s")'),this.requestFullscreen()},vjs.Player.prototype.exitFullscreen=function(){var n=vjs.browser.fullscreenAPI;return this.isFullscreen(!1),n?document[n.exitFullscreen]():this.tech.supportsFullScreen()?this.techCall("exitFullScreen"):(this.exitFullWindow(),this.trigger("fullscreenchange")),this},vjs.Player.prototype.cancelFullScreen=function(){return vjs.log.warn("player.cancelFullScreen() has been deprecated, use player.exitFullscreen()"),this.exitFullscreen()},vjs.Player.prototype.enterFullWindow=function(){this.isFullWindow=!0;this.docOrigOverflow=document.documentElement.style.overflow;vjs.on(document,"keydown",vjs.bind(this,this.fullWindowOnEscKey));document.documentElement.style.overflow="hidden";vjs.addClass(document.body,"vjs-full-window");this.trigger("enterFullWindow")},vjs.Player.prototype.fullWindowOnEscKey=function(n){n.keyCode===27&&(this.isFullscreen()===!0?this.exitFullscreen():this.exitFullWindow())},vjs.Player.prototype.exitFullWindow=function(){this.isFullWindow=!1;vjs.off(document,"keydown",this.fullWindowOnEscKey);document.documentElement.style.overflow=this.docOrigOverflow;vjs.removeClass(document.body,"vjs-full-window");this.trigger("exitFullWindow")},vjs.Player.prototype.selectSource=function(n){for(var i,r,u,e,o,t=0,f=this.options_.techOrder;t<f.length;t++){if(i=vjs.capitalize(f[t]),r=window.videojs[i],!r){vjs.log.error('The "'+i+'" tech is undefined. Skipped browser support check for that tech.');continue}if(r.isSupported())for(u=0,e=n;u<e.length;u++)if(o=e[u],r.canPlaySource(o))return{source:o,tech:i}}return!1},vjs.Player.prototype.src=function(n){return n===undefined?this.techGet("src"):(vjs.obj.isArray(n)?this.sourceList_(n):typeof n=="string"?this.src({src:n}):n instanceof Object&&(n.type&&!window.videojs[this.techName].canPlaySource(n)?this.sourceList_([n]):(this.cache_.src=n.src,this.currentType_=n.type||"",this.ready(function(){this.tech.setSource?this.techCall("setSource",n):this.techCall("src",n.src);this.options_.preload=="auto"&&this.load();this.options_.autoplay&&this.play()}))),this)},vjs.Player.prototype.sourceList_=function(n){var t=this.selectSource(n);t?t.tech===this.techName?this.src(t.source):this.loadTech(t.tech,t.source):(this.setTimeout(function(){this.error({code:4,message:this.localize(this.options().notSupportedMessage)})},0),this.triggerReady())},vjs.Player.prototype.load=function(){return this.techCall("load"),this},vjs.Player.prototype.currentSrc=function(){return this.techGet("currentSrc")||this.cache_.src||""},vjs.Player.prototype.currentType=function(){return this.currentType_||""},vjs.Player.prototype.preload=function(n){return n!==undefined?(this.techCall("setPreload",n),this.options_.preload=n,this):this.techGet("preload")},vjs.Player.prototype.autoplay=function(n){return n!==undefined?(this.techCall("setAutoplay",n),this.options_.autoplay=n,this):this.techGet("autoplay",n)},vjs.Player.prototype.loop=function(n){return n!==undefined?(this.techCall("setLoop",n),this.options_.loop=n,this):this.techGet("loop")},vjs.Player.prototype.poster_,vjs.Player.prototype.poster=function(n){return n===undefined?this.poster_:(n||(n=""),this.poster_=n,this.techCall("setPoster",n),this.trigger("posterchange"),this)},vjs.Player.prototype.controls_,vjs.Player.prototype.controls=function(n){return n!==undefined?(n=!!n,this.controls_!==n&&(this.controls_=n,n?(this.removeClass("vjs-controls-disabled"),this.addClass("vjs-controls-enabled"),this.trigger("controlsenabled")):(this.removeClass("vjs-controls-enabled"),this.addClass("vjs-controls-disabled"),this.trigger("controlsdisabled"))),this):this.controls_},vjs.Player.prototype.usingNativeControls_,vjs.Player.prototype.usingNativeControls=function(n){return n!==undefined?(n=!!n,this.usingNativeControls_!==n&&(this.usingNativeControls_=n,n?(this.addClass("vjs-using-native-controls"),this.trigger("usingnativecontrols")):(this.removeClass("vjs-using-native-controls"),this.trigger("usingcustomcontrols"))),this):this.usingNativeControls_},vjs.Player.prototype.error_=null,vjs.Player.prototype.error=function(n){return n===undefined?this.error_:n===null?(this.error_=n,this.removeClass("vjs-error"),this):(this.error_=n instanceof vjs.MediaError?n:new vjs.MediaError(n),this.trigger("error"),this.addClass("vjs-error"),vjs.log.error("(CODE:"+this.error_.code+" "+vjs.MediaError.errorTypes[this.error_.code]+")",this.error_.message,this.error_),this)},vjs.Player.prototype.ended=function(){return this.techGet("ended")},vjs.Player.prototype.seeking=function(){return this.techGet("seeking")},vjs.Player.prototype.userActivity_=!0,vjs.Player.prototype.reportUserActivity=function(){this.userActivity_=!0},vjs.Player.prototype.userActive_=!0,vjs.Player.prototype.userActive=function(n){if(n!==undefined){if(n=!!n,n!==this.userActive_)if(this.userActive_=n,n)this.userActivity_=!0,this.removeClass("vjs-user-inactive"),this.addClass("vjs-user-active"),this.trigger("useractive");else{if(this.userActivity_=!1,this.tech)this.tech.one("mousemove",function(n){n.stopPropagation();n.preventDefault()});this.removeClass("vjs-user-active");this.addClass("vjs-user-inactive");this.trigger("userinactive")}return this}return this.userActive_},vjs.Player.prototype.listenForUserActivity=function(){var n,i,r,t,u,s,f,e,o;n=vjs.bind(this,this.reportUserActivity);i=function(t){(t.screenX!=e||t.screenY!=o)&&(e=t.screenX,o=t.screenY,n())};r=function(){n();this.clearInterval(t);t=this.setInterval(n,250)};u=function(){n();this.clearInterval(t)};this.on("mousedown",r);this.on("mousemove",i);this.on("mouseup",u);this.on("keydown",n);this.on("keyup",n);s=this.setInterval(function(){if(this.userActivity_){this.userActivity_=!1;this.userActive(!0);this.clearTimeout(f);var n=this.options().inactivityTimeout;n>0&&(f=this.setTimeout(function(){this.userActivity_||this.userActive(!1)},n))}},250)},vjs.Player.prototype.playbackRate=function(n){return n!==undefined?(this.techCall("setPlaybackRate",n),this):this.tech&&this.tech.featuresPlaybackRate?this.techGet("playbackRate"):1},vjs.Player.prototype.isAudio_=!1,vjs.Player.prototype.isAudio=function(n){return n!==undefined?(this.isAudio_=!!n,this):this.isAudio_},vjs.ControlBar=vjs.Component.extend(),vjs.ControlBar.prototype.options_={loadEvent:"play",children:{playToggle:{},currentTimeDisplay:{},timeDivider:{},durationDisplay:{},remainingTimeDisplay:{},liveDisplay:{},progressControl:{},fullscreenToggle:{},volumeControl:{},muteToggle:{},playbackRateMenuButton:{}}},vjs.ControlBar.prototype.createEl=function(){return vjs.createEl("div",{className:"vjs-control-bar"})},vjs.LiveDisplay=vjs.Component.extend({init:function(n,t){vjs.Component.call(this,n,t)}}),vjs.LiveDisplay.prototype.createEl=function(){var n=vjs.Component.prototype.createEl.call(this,"div",{className:"vjs-live-controls vjs-control"});return this.contentEl_=vjs.createEl("div",{className:"vjs-live-display",innerHTML:'<span class="vjs-control-text">'+this.localize("Stream Type")+"<\/span>"+this.localize("LIVE"),"aria-live":"off"}),n.appendChild(this.contentEl_),n},vjs.PlayToggle=vjs.Button.extend({init:function(n,t){vjs.Button.call(this,n,t);this.on(n,"play",this.onPlay);this.on(n,"pause",this.onPause)}}),vjs.PlayToggle.prototype.buttonText="Play",vjs.PlayToggle.prototype.buildCSSClass=function(){return"vjs-play-control "+vjs.Button.prototype.buildCSSClass.call(this)},vjs.PlayToggle.prototype.onClick=function(){this.player_.paused()?this.player_.play():this.player_.pause()},vjs.PlayToggle.prototype.onPlay=function(){this.removeClass("vjs-paused");this.addClass("vjs-playing");this.el_.children[0].children[0].innerHTML=this.localize("Pause")},vjs.PlayToggle.prototype.onPause=function(){this.removeClass("vjs-playing");this.addClass("vjs-paused");this.el_.children[0].children[0].innerHTML=this.localize("Play")},vjs.CurrentTimeDisplay=vjs.Component.extend({init:function(n,t){vjs.Component.call(this,n,t);this.on(n,"timeupdate",this.updateContent)}}),vjs.CurrentTimeDisplay.prototype.createEl=function(){var n=vjs.Component.prototype.createEl.call(this,"div",{className:"vjs-current-time vjs-time-controls vjs-control"});return this.contentEl_=vjs.createEl("div",{className:"vjs-current-time-display",innerHTML:'<span class="vjs-control-text">Current Time <\/span>0:00',"aria-live":"off"}),n.appendChild(this.contentEl_),n},vjs.CurrentTimeDisplay.prototype.updateContent=function(){var n=this.player_.scrubbing?this.player_.getCache().currentTime:this.player_.currentTime();this.contentEl_.innerHTML='<span class="vjs-control-text">'+this.localize("Current Time")+"<\/span> "+vjs.formatTime(n,this.player_.duration())},vjs.DurationDisplay=vjs.Component.extend({init:function(n,t){vjs.Component.call(this,n,t);this.on(n,"timeupdate",this.updateContent)}}),vjs.DurationDisplay.prototype.createEl=function(){var n=vjs.Component.prototype.createEl.call(this,"div",{className:"vjs-duration vjs-time-controls vjs-control"});return this.contentEl_=vjs.createEl("div",{className:"vjs-duration-display",innerHTML:'<span class="vjs-control-text">'+this.localize("Duration Time")+"<\/span> 0:00","aria-live":"off"}),n.appendChild(this.contentEl_),n},vjs.DurationDisplay.prototype.updateContent=function(){var n=this.player_.duration();n&&(this.contentEl_.innerHTML='<span class="vjs-control-text">'+this.localize("Duration Time")+"<\/span> "+vjs.formatTime(n))},vjs.TimeDivider=vjs.Component.extend({init:function(n,t){vjs.Component.call(this,n,t)}}),vjs.TimeDivider.prototype.createEl=function(){return vjs.Component.prototype.createEl.call(this,"div",{className:"vjs-time-divider",innerHTML:"<div><span>/<\/span><\/div>"})},vjs.RemainingTimeDisplay=vjs.Component.extend({init:function(n,t){vjs.Component.call(this,n,t);this.on(n,"timeupdate",this.updateContent)}}),vjs.RemainingTimeDisplay.prototype.createEl=function(){var n=vjs.Component.prototype.createEl.call(this,"div",{className:"vjs-remaining-time vjs-time-controls vjs-control"});return this.contentEl_=vjs.createEl("div",{className:"vjs-remaining-time-display",innerHTML:'<span class="vjs-control-text">'+this.localize("Remaining Time")+"<\/span> -0:00","aria-live":"off"}),n.appendChild(this.contentEl_),n},vjs.RemainingTimeDisplay.prototype.updateContent=function(){this.player_.duration()&&(this.contentEl_.innerHTML='<span class="vjs-control-text">'+this.localize("Remaining Time")+"<\/span> -"+vjs.formatTime(this.player_.remainingTime()))},vjs.FullscreenToggle=vjs.Button.extend({init:function(n,t){vjs.Button.call(this,n,t)}}),vjs.FullscreenToggle.prototype.buttonText="Fullscreen",vjs.FullscreenToggle.prototype.buildCSSClass=function(){return"vjs-fullscreen-control "+vjs.Button.prototype.buildCSSClass.call(this)},vjs.FullscreenToggle.prototype.onClick=function(){this.player_.isFullscreen()?(this.player_.exitFullscreen(),this.controlText_.innerHTML=this.localize("Fullscreen")):(this.player_.requestFullscreen(),this.controlText_.innerHTML=this.localize("Non-Fullscreen"))},vjs.ProgressControl=vjs.Component.extend({init:function(n,t){vjs.Component.call(this,n,t)}}),vjs.ProgressControl.prototype.options_={children:{seekBar:{}}},vjs.ProgressControl.prototype.createEl=function(){return vjs.Component.prototype.createEl.call(this,"div",{className:"vjs-progress-control vjs-control"})},vjs.SeekBar=vjs.Slider.extend({init:function(n,t){vjs.Slider.call(this,n,t);this.on(n,"timeupdate",this.updateARIAAttributes);n.ready(vjs.bind(this,this.updateARIAAttributes))}}),vjs.SeekBar.prototype.options_={children:{loadProgressBar:{},playProgressBar:{},seekHandle:{}},barName:"playProgressBar",handleName:"seekHandle"},vjs.SeekBar.prototype.playerEvent="timeupdate",vjs.SeekBar.prototype.createEl=function(){return vjs.Slider.prototype.createEl.call(this,"div",{className:"vjs-progress-holder","aria-label":"video progress bar"})},vjs.SeekBar.prototype.updateARIAAttributes=function(){var n=this.player_.scrubbing?this.player_.getCache().currentTime:this.player_.currentTime();this.el_.setAttribute("aria-valuenow",vjs.round(this.getPercent()*100,2));this.el_.setAttribute("aria-valuetext",vjs.formatTime(n,this.player_.duration()))},vjs.SeekBar.prototype.getPercent=function(){return this.player_.currentTime()/this.player_.duration()},vjs.SeekBar.prototype.onMouseDown=function(n){this.player_.scrubbing=!0;this.videoWasPlaying=!this.player_.paused();this.player_.pause();vjs.Slider.prototype.onMouseDown.call(this,n)},vjs.SeekBar.prototype.onMouseMove=function(n){var t=this.calculateDistance(n)*this.player_.duration();t==this.player_.duration()&&(t=t-.1);this.player_.currentTime(t)},vjs.SeekBar.prototype.onMouseUp=function(n){vjs.Slider.prototype.onMouseUp.call(this,n);this.player_.scrubbing=!1;this.videoWasPlaying&&this.player_.play()},vjs.SeekBar.prototype.stepForward=function(){this.player_.currentTime(this.player_.currentTime()+5)},vjs.SeekBar.prototype.stepBack=function(){this.player_.currentTime(this.player_.currentTime()-5)},vjs.LoadProgressBar=vjs.Component.extend({init:function(n,t){vjs.Component.call(this,n,t);this.on(n,"progress",this.update)}}),vjs.LoadProgressBar.prototype.createEl=function(){return vjs.Component.prototype.createEl.call(this,"div",{className:"vjs-load-progress",innerHTML:'<span class="vjs-control-text"><span>'+this.localize("Loaded")+"<\/span>: 0%<\/span>"})},vjs.LoadProgressBar.prototype.update=function(){var n,r,o,t,i=this.player_.buffered(),s=this.player_.duration(),u=this.player_.bufferedEnd(),f=this.el_.children,e=function(n,t){var i=n/t||0;return i*100+"%"};for(this.el_.style.width=e(u,s),n=0;n<i.length;n++)r=i.start(n),o=i.end(n),t=f[n],t||(t=this.el_.appendChild(vjs.createEl())),t.style.left=e(r,u),t.style.width=e(o-r,u);for(n=f.length;n>i.length;n--)this.el_.removeChild(f[n-1])},vjs.PlayProgressBar=vjs.Component.extend({init:function(n,t){vjs.Component.call(this,n,t)}}),vjs.PlayProgressBar.prototype.createEl=function(){return vjs.Component.prototype.createEl.call(this,"div",{className:"vjs-play-progress",innerHTML:'<span class="vjs-control-text"><span>'+this.localize("Progress")+"<\/span>: 0%<\/span>"})},vjs.SeekHandle=vjs.SliderHandle.extend({init:function(n,t){vjs.SliderHandle.call(this,n,t);this.on(n,"timeupdate",this.updateContent)}}),vjs.SeekHandle.prototype.defaultValue="00:00",vjs.SeekHandle.prototype.createEl=function(){return vjs.SliderHandle.prototype.createEl.call(this,"div",{className:"vjs-seek-handle","aria-live":"off"})},vjs.SeekHandle.prototype.updateContent=function(){var n=this.player_.scrubbing?this.player_.getCache().currentTime:this.player_.currentTime();this.el_.innerHTML='<span class="vjs-control-text">'+vjs.formatTime(n,this.player_.duration())+"<\/span>"},vjs.VolumeControl=vjs.Component.extend({init:function(n,t){vjs.Component.call(this,n,t);n.tech&&n.tech.featuresVolumeControl===!1&&this.addClass("vjs-hidden");this.on(n,"loadstart",function(){n.tech.featuresVolumeControl===!1?this.addClass("vjs-hidden"):this.removeClass("vjs-hidden")})}}),vjs.VolumeControl.prototype.options_={children:{volumeBar:{}}},vjs.VolumeControl.prototype.createEl=function(){return vjs.Component.prototype.createEl.call(this,"div",{className:"vjs-volume-control vjs-control"})},vjs.VolumeBar=vjs.Slider.extend({init:function(n,t){vjs.Slider.call(this,n,t);this.on(n,"volumechange",this.updateARIAAttributes);n.ready(vjs.bind(this,this.updateARIAAttributes))}}),vjs.VolumeBar.prototype.updateARIAAttributes=function(){this.el_.setAttribute("aria-valuenow",vjs.round(this.player_.volume()*100,2));this.el_.setAttribute("aria-valuetext",vjs.round(this.player_.volume()*100,2)+"%")},vjs.VolumeBar.prototype.options_={children:{volumeLevel:{},volumeHandle:{}},barName:"volumeLevel",handleName:"volumeHandle"},vjs.VolumeBar.prototype.playerEvent="volumechange",vjs.VolumeBar.prototype.createEl=function(){return vjs.Slider.prototype.createEl.call(this,"div",{className:"vjs-volume-bar","aria-label":"volume level"})},vjs.VolumeBar.prototype.onMouseMove=function(n){this.player_.muted()&&this.player_.muted(!1);this.player_.volume(this.calculateDistance(n))},vjs.VolumeBar.prototype.getPercent=function(){return this.player_.muted()?0:this.player_.volume()},vjs.VolumeBar.prototype.stepForward=function(){this.player_.volume(this.player_.volume()+.1)},vjs.VolumeBar.prototype.stepBack=function(){this.player_.volume(this.player_.volume()-.1)},vjs.VolumeLevel=vjs.Component.extend({init:function(n,t){vjs.Component.call(this,n,t)}}),vjs.VolumeLevel.prototype.createEl=function(){return vjs.Component.prototype.createEl.call(this,"div",{className:"vjs-volume-level",innerHTML:'<span class="vjs-control-text"><\/span>'})},vjs.VolumeHandle=vjs.SliderHandle.extend(),vjs.VolumeHandle.prototype.defaultValue="00:00",vjs.VolumeHandle.prototype.createEl=function(){return vjs.SliderHandle.prototype.createEl.call(this,"div",{className:"vjs-volume-handle"})},vjs.MuteToggle=vjs.Button.extend({init:function(n,t){vjs.Button.call(this,n,t);this.on(n,"volumechange",this.update);n.tech&&n.tech.featuresVolumeControl===!1&&this.addClass("vjs-hidden");this.on(n,"loadstart",function(){n.tech.featuresVolumeControl===!1?this.addClass("vjs-hidden"):this.removeClass("vjs-hidden")})}}),vjs.MuteToggle.prototype.createEl=function(){return vjs.Button.prototype.createEl.call(this,"div",{className:"vjs-mute-control vjs-control",innerHTML:'<div><span class="vjs-control-text">'+this.localize("Mute")+"<\/span><\/div>"})},vjs.MuteToggle.prototype.onClick=function(){this.player_.muted(this.player_.muted()?!1:!0)},vjs.MuteToggle.prototype.update=function(){var i=this.player_.volume(),n=3,t;for(i===0||this.player_.muted()?n=0:i<.33?n=1:i<.67&&(n=2),this.player_.muted()?this.el_.children[0].children[0].innerHTML!=this.localize("Unmute")&&(this.el_.children[0].children[0].innerHTML=this.localize("Unmute")):this.el_.children[0].children[0].innerHTML!=this.localize("Mute")&&(this.el_.children[0].children[0].innerHTML=this.localize("Mute")),t=0;t<4;t++)vjs.removeClass(this.el_,"vjs-vol-"+t);vjs.addClass(this.el_,"vjs-vol-"+n)},vjs.VolumeMenuButton=vjs.MenuButton.extend({init:function(n,t){vjs.MenuButton.call(this,n,t);this.on(n,"volumechange",this.update);n.tech&&n.tech.featuresVolumeControl===!1&&this.addClass("vjs-hidden");this.on(n,"loadstart",function(){n.tech.featuresVolumeControl===!1?this.addClass("vjs-hidden"):this.removeClass("vjs-hidden")});this.addClass("vjs-menu-button")}}),vjs.VolumeMenuButton.prototype.createMenu=function(){var n=new vjs.Menu(this.player_,{contentElType:"div"}),t=new vjs.VolumeBar(this.player_,this.options_.volumeBar);t.on("focus",function(){n.lockShowing()});t.on("blur",function(){n.unlockShowing()});return n.addChild(t),n},vjs.VolumeMenuButton.prototype.onClick=function(){vjs.MuteToggle.prototype.onClick.call(this);vjs.MenuButton.prototype.onClick.call(this)},vjs.VolumeMenuButton.prototype.createEl=function(){return vjs.Button.prototype.createEl.call(this,"div",{className:"vjs-volume-menu-button vjs-menu-button vjs-control",innerHTML:'<div><span class="vjs-control-text">'+this.localize("Mute")+"<\/span><\/div>"})},vjs.VolumeMenuButton.prototype.update=vjs.MuteToggle.prototype.update,vjs.PlaybackRateMenuButton=vjs.MenuButton.extend({init:function(n,t){vjs.MenuButton.call(this,n,t);this.updateVisibility();this.updateLabel();this.on(n,"loadstart",this.updateVisibility);this.on(n,"ratechange",this.updateLabel)}}),vjs.PlaybackRateMenuButton.prototype.createEl=function(){var n=vjs.Component.prototype.createEl.call(this,"div",{className:"vjs-playback-rate vjs-menu-button vjs-control",innerHTML:'<div class="vjs-control-content"><span class="vjs-control-text">'+this.localize("Playback Rate")+"<\/span><\/div>"});return this.labelEl_=vjs.createEl("div",{className:"vjs-playback-rate-value",innerHTML:1}),n.appendChild(this.labelEl_),n},vjs.PlaybackRateMenuButton.prototype.createMenu=function(){var i=new vjs.Menu(this.player()),t=this.player().options().playbackRates,n;if(t)for(n=t.length-1;n>=0;n--)i.addChild(new vjs.PlaybackRateMenuItem(this.player(),{rate:t[n]+"x"}));return i},vjs.PlaybackRateMenuButton.prototype.updateARIAAttributes=function(){this.el().setAttribute("aria-valuenow",this.player().playbackRate())},vjs.PlaybackRateMenuButton.prototype.onClick=function(){for(var r=this.player().playbackRate(),n=this.player().options().playbackRates,i=n[0],t=0;t<n.length;t++)if(n[t]>r){i=n[t];break}this.player().playbackRate(i)},vjs.PlaybackRateMenuButton.prototype.playbackRateSupported=function(){return this.player().tech&&this.player().tech.featuresPlaybackRate&&this.player().options().playbackRates&&this.player().options().playbackRates.length>0},vjs.PlaybackRateMenuButton.prototype.updateVisibility=function(){this.playbackRateSupported()?this.removeClass("vjs-hidden"):this.addClass("vjs-hidden")},vjs.PlaybackRateMenuButton.prototype.updateLabel=function(){this.playbackRateSupported()&&(this.labelEl_.innerHTML=this.player().playbackRate()+"x")},vjs.PlaybackRateMenuItem=vjs.MenuItem.extend({contentElType:"button",init:function(n,t){var i=this.label=t.rate,r=this.rate=parseFloat(i,10);t.label=i;t.selected=r===1;vjs.MenuItem.call(this,n,t);this.on(n,"ratechange",this.update)}}),vjs.PlaybackRateMenuItem.prototype.onClick=function(){vjs.MenuItem.prototype.onClick.call(this);this.player().playbackRate(this.rate)},vjs.PlaybackRateMenuItem.prototype.update=function(){this.selected(this.player().playbackRate()==this.rate)},vjs.PosterImage=vjs.Button.extend({init:function(n,t){vjs.Button.call(this,n,t);this.update();n.on("posterchange",vjs.bind(this,this.update))}}),vjs.PosterImage.prototype.dispose=function(){this.player().off("posterchange",this.update);vjs.Button.prototype.dispose.call(this)},vjs.PosterImage.prototype.createEl=function(){var n=vjs.createEl("div",{className:"vjs-poster",tabIndex:-1});return vjs.BACKGROUND_SIZE_SUPPORTED||(this.fallbackImg_=vjs.createEl("img"),n.appendChild(this.fallbackImg_)),n},vjs.PosterImage.prototype.update=function(){var n=this.player().poster();this.setSrc(n);n?this.el_.style.display="":this.hide()},vjs.PosterImage.prototype.setSrc=function(n){var t;this.fallbackImg_?this.fallbackImg_.src=n:(t="",n&&(t='url("'+n+'")'),this.el_.style.backgroundImage=t)},vjs.PosterImage.prototype.onClick=function(){this.player_.play()},vjs.LoadingSpinner=vjs.Component.extend({init:function(n,t){vjs.Component.call(this,n,t)}}),vjs.LoadingSpinner.prototype.createEl=function(){return vjs.Component.prototype.createEl.call(this,"div",{className:"vjs-loading-spinner"})},vjs.BigPlayButton=vjs.Button.extend(),vjs.BigPlayButton.prototype.createEl=function(){return vjs.Button.prototype.createEl.call(this,"div",{className:"vjs-big-play-button",innerHTML:'<span aria-hidden="true"><\/span>',"aria-label":"play video"})},vjs.BigPlayButton.prototype.onClick=function(){this.player_.play()},vjs.ErrorDisplay=vjs.Component.extend({init:function(n,t){vjs.Component.call(this,n,t);this.update();this.on(n,"error",this.update)}}),vjs.ErrorDisplay.prototype.createEl=function(){var n=vjs.Component.prototype.createEl.call(this,"div",{className:"vjs-error-display"});return this.contentEl_=vjs.createEl("div"),n.appendChild(this.contentEl_),n},vjs.ErrorDisplay.prototype.update=function(){this.player().error()&&(this.contentEl_.innerHTML=this.localize(this.player().error().message))},vjs.MediaTechController=vjs.Component.extend({init:function(n,t,i){t=t||{};t.reportTouchActivity=!1;vjs.Component.call(this,n,t,i);this.featuresProgressEvents||this.manualProgressOn();this.featuresTimeupdateEvents||this.manualTimeUpdatesOn();this.initControlsListeners()}}),vjs.MediaTechController.prototype.initControlsListeners=function(){var n,t;n=this.player();t=function(){n.controls()&&!n.usingNativeControls()&&this.addControlsListeners()};this.ready(t);this.on(n,"controlsenabled",t);this.on(n,"controlsdisabled",this.removeControlsListeners);this.ready(function(){this.networkState&&this.networkState()>0&&this.player().trigger("loadstart")})},vjs.MediaTechController.prototype.addControlsListeners=function(){var n;this.on("mousedown",this.onClick);this.on("touchstart",function(){n=this.player_.userActive()});this.on("touchmove",function(){n&&this.player().reportUserActivity()});this.on("touchend",function(n){n.preventDefault()});this.emitTapEvents();this.on("tap",this.onTap)},vjs.MediaTechController.prototype.removeControlsListeners=function(){this.off("tap");this.off("touchstart");this.off("touchmove");this.off("touchleave");this.off("touchcancel");this.off("touchend");this.off("click");this.off("mousedown")},vjs.MediaTechController.prototype.onClick=function(n){n.button===0&&this.player().controls()&&(this.player().paused()?this.player().play():this.player().pause())},vjs.MediaTechController.prototype.onTap=function(){this.player().userActive(!this.player().userActive())},vjs.MediaTechController.prototype.manualProgressOn=function(){this.manualProgress=!0;this.trackProgress()},vjs.MediaTechController.prototype.manualProgressOff=function(){this.manualProgress=!1;this.stopTrackingProgress()},vjs.MediaTechController.prototype.trackProgress=function(){this.progressInterval=this.setInterval(function(){var n=this.player().bufferedPercent();this.bufferedPercent_!=n&&this.player().trigger("progress");this.bufferedPercent_=n;n===1&&this.stopTrackingProgress()},500)},vjs.MediaTechController.prototype.stopTrackingProgress=function(){this.clearInterval(this.progressInterval)},vjs.MediaTechController.prototype.manualTimeUpdatesOn=function(){var n=this.player_;this.manualTimeUpdates=!0;this.on(n,"play",this.trackCurrentTime);this.on(n,"pause",this.stopTrackingCurrentTime);this.one("timeupdate",function(){this.featuresTimeupdateEvents=!0;this.manualTimeUpdatesOff()})},vjs.MediaTechController.prototype.manualTimeUpdatesOff=function(){this.manualTimeUpdates=!1;this.stopTrackingCurrentTime();this.off(this.player_,"play",this.trackCurrentTime);this.off(this.player_,"pause",this.stopTrackingCurrentTime)},vjs.MediaTechController.prototype.trackCurrentTime=function(){this.currentTimeInterval&&this.stopTrackingCurrentTime();this.currentTimeInterval=this.setInterval(function(){this.player().trigger("timeupdate")},250)},vjs.MediaTechController.prototype.stopTrackingCurrentTime=function(){this.clearInterval(this.currentTimeInterval);this.player().trigger("timeupdate")},vjs.MediaTechController.prototype.dispose=function(){this.manualProgress&&this.manualProgressOff();this.manualTimeUpdates&&this.manualTimeUpdatesOff();vjs.Component.prototype.dispose.call(this)},vjs.MediaTechController.prototype.setCurrentTime=function(){this.manualTimeUpdates&&this.player().trigger("timeupdate")},vjs.MediaTechController.prototype.setPoster=function(){},vjs.MediaTechController.prototype.featuresVolumeControl=!0,vjs.MediaTechController.prototype.featuresFullscreenResize=!1,vjs.MediaTechController.prototype.featuresPlaybackRate=!1,vjs.MediaTechController.prototype.featuresProgressEvents=!1,vjs.MediaTechController.prototype.featuresTimeupdateEvents=!1,vjs.MediaTechController.withSourceHandlers=function(n){n.registerSourceHandler=function(t,i){var r=n.sourceHandlers;r||(r=n.sourceHandlers=[]);i===undefined&&(i=r.length);r.splice(i,0,t)};n.selectSourceHandler=function(t){for(var r=n.sourceHandlers||[],u,i=0;i<r.length;i++)if(u=r[i].canHandleSource(t),u)return r[i];return null};n.canPlaySource=function(t){var i=n.selectSourceHandler(t);return i?i.canHandleSource(t):""};n.prototype.setSource=function(t){var i=n.selectSourceHandler(t);this.disposeSourceHandler();this.off("dispose",this.disposeSourceHandler);this.currentSource_=t;this.sourceHandler_=i.handleSource(t,this);this.on("dispose",this.disposeSourceHandler);return this};n.prototype.disposeSourceHandler=function(){this.sourceHandler_&&this.sourceHandler_.dispose&&this.sourceHandler_.dispose()}},vjs.Html5=vjs.MediaTechController.extend({init:function(n,t,i){vjs.MediaTechController.call(this,n,t,i);this.setupTriggers();var r=t.source;r&&(this.el_.currentSrc!==r.src||n.tag&&n.tag.initNetworkState_===3)&&this.setSource(r);vjs.TOUCH_ENABLED&&n.options().nativeControlsForTouch===!0&&this.useNativeControls();n.ready(function(){this.tag&&this.options_.autoplay&&this.paused()&&(delete this.tag.poster,this.play())});this.triggerReady()}}),vjs.Html5.prototype.dispose=function(){vjs.Html5.disposeMediaElement(this.el_);vjs.MediaTechController.prototype.dispose.call(this)},vjs.Html5.prototype.createEl=function(){var t=this.player_,n=t.tag,e,u,i,r,f;for(n&&this.movingMediaElementInDOM!==!1?n.parentNode!==t.el()&&vjs.insertFirst(n,t.el()):(n?(e=n.cloneNode(!1),vjs.Html5.disposeMediaElement(n),n=e,t.tag=null):(n=vjs.createEl("video"),vjs.setElementAttributes(n,vjs.obj.merge(t.tagAttributes||{},{id:t.id()+"_html5_api","class":"vjs-tech"}))),n.player=t,vjs.insertFirst(n,t.el())),u=["autoplay","preload","loop","muted"],i=u.length-1;i>=0;i--)r=u[i],f={},typeof t.options_[r]!="undefined"&&(f[r]=t.options_[r]),vjs.setElementAttributes(n,f);return n},vjs.Html5.prototype.setupTriggers=function(){for(var n=vjs.Html5.Events.length-1;n>=0;n--)this.on(vjs.Html5.Events[n],this.eventHandler)},vjs.Html5.prototype.eventHandler=function(n){n.type=="error"&&this.error()?this.player().error(this.error().code):(n.bubbles=!1,this.player().trigger(n))},vjs.Html5.prototype.useNativeControls=function(){var t,n,i,r,u;t=this;n=this.player();t.setControls(n.controls());i=function(){t.setControls(!0)};r=function(){t.setControls(!1)};n.on("controlsenabled",i);n.on("controlsdisabled",r);u=function(){n.off("controlsenabled",i);n.off("controlsdisabled",r)};t.on("dispose",u);n.on("usingcustomcontrols",u);n.usingNativeControls(!0)},vjs.Html5.prototype.play=function(){this.el_.play()},vjs.Html5.prototype.pause=function(){this.el_.pause()},vjs.Html5.prototype.paused=function(){return this.el_.paused},vjs.Html5.prototype.currentTime=function(){return this.el_.currentTime},vjs.Html5.prototype.setCurrentTime=function(n){try{this.el_.currentTime=n}catch(t){vjs.log(t,"Video is not ready. (Video.js)")}},vjs.Html5.prototype.duration=function(){return this.el_.duration||0},vjs.Html5.prototype.buffered=function(){return this.el_.buffered},vjs.Html5.prototype.volume=function(){return this.el_.volume},vjs.Html5.prototype.setVolume=function(n){this.el_.volume=n},vjs.Html5.prototype.muted=function(){return this.el_.muted},vjs.Html5.prototype.setMuted=function(n){this.el_.muted=n},vjs.Html5.prototype.width=function(){return this.el_.offsetWidth},vjs.Html5.prototype.height=function(){return this.el_.offsetHeight},vjs.Html5.prototype.videoWidth=function(){return this.player().width()},vjs.Html5.prototype.videoHeight=function(){return this.player().height()},vjs.Html5.prototype.supportsFullScreen=function(){return typeof this.el_.webkitEnterFullScreen=="function"&&(/Android/.test(vjs.USER_AGENT)||!/Chrome|Mac OS X 10.5/.test(vjs.USER_AGENT))?!0:!1},vjs.Html5.prototype.enterFullScreen=function(){var n=this.el_;if("webkitDisplayingFullscreen"in n)this.one("webkitbeginfullscreen",function(){this.player_.isFullscreen(!0);this.one("webkitendfullscreen",function(){this.player_.isFullscreen(!1);this.player_.trigger("fullscreenchange")});this.player_.trigger("fullscreenchange")});n.paused&&n.networkState<=n.HAVE_METADATA?(this.el_.play(),this.setTimeout(function(){n.pause();n.webkitEnterFullScreen()},0)):n.webkitEnterFullScreen()},vjs.Html5.prototype.exitFullScreen=function(){this.el_.webkitExitFullScreen()},vjs.Html5.prototype.src=function(n){if(n===undefined)return this.el_.src;this.setSrc(n)},vjs.Html5.prototype.setSrc=function(n){this.el_.src=n},vjs.Html5.prototype.load=function(){this.el_.load()},vjs.Html5.prototype.currentSrc=function(){return this.el_.currentSrc},vjs.Html5.prototype.poster=function(){return this.el_.poster},vjs.Html5.prototype.setPoster=function(n){this.el_.poster=n},vjs.Html5.prototype.preload=function(){return this.el_.preload},vjs.Html5.prototype.setPreload=function(n){this.el_.preload=n},vjs.Html5.prototype.autoplay=function(){return this.el_.autoplay},vjs.Html5.prototype.setAutoplay=function(n){this.el_.autoplay=n},vjs.Html5.prototype.controls=function(){return this.el_.controls},vjs.Html5.prototype.setControls=function(n){this.el_.controls=!!n},vjs.Html5.prototype.loop=function(){return this.el_.loop},vjs.Html5.prototype.setLoop=function(n){this.el_.loop=n},vjs.Html5.prototype.error=function(){return this.el_.error},vjs.Html5.prototype.seeking=function(){return this.el_.seeking},vjs.Html5.prototype.ended=function(){return this.el_.ended},vjs.Html5.prototype.defaultMuted=function(){return this.el_.defaultMuted},vjs.Html5.prototype.playbackRate=function(){return this.el_.playbackRate},vjs.Html5.prototype.setPlaybackRate=function(n){this.el_.playbackRate=n},vjs.Html5.prototype.networkState=function(){return this.el_.networkState},vjs.Html5.isSupported=function(){try{vjs.TEST_VID.volume=.5}catch(n){return!1}return!!vjs.TEST_VID.canPlayType},vjs.MediaTechController.withSourceHandlers(vjs.Html5),vjs.Html5.nativeSourceHandler={},vjs.Html5.nativeSourceHandler.canHandleSource=function(n){function i(n){try{return!!vjs.TEST_VID.canPlayType(n)}catch(t){return""}}var t;return n.type?i(n.type):(t=n.src.match(/\.([^\/\?]+)(\?[^\/]+)?$/i)[1],i("video/"+t))},vjs.Html5.nativeSourceHandler.handleSource=function(n,t){t.setSrc(n.src)},vjs.Html5.nativeSourceHandler.dispose=function(){},vjs.Html5.registerSourceHandler(vjs.Html5.nativeSourceHandler),vjs.Html5.canControlVolume=function(){var n=vjs.TEST_VID.volume;return vjs.TEST_VID.volume=n/2+.1,n!==vjs.TEST_VID.volume},vjs.Html5.canControlPlaybackRate=function(){var n=vjs.TEST_VID.playbackRate;return vjs.TEST_VID.playbackRate=n/2+.1,n!==vjs.TEST_VID.playbackRate},vjs.Html5.prototype.featuresVolumeControl=vjs.Html5.canControlVolume(),vjs.Html5.prototype.featuresPlaybackRate=vjs.Html5.canControlPlaybackRate(),vjs.Html5.prototype.movingMediaElementInDOM=!vjs.IS_IOS,vjs.Html5.prototype.featuresFullscreenResize=!0,vjs.Html5.prototype.featuresProgressEvents=!0,function(){var n,t=/^application\/(?:x-|vnd\.apple\.)mpegurl/i,i=/^video\/mp4/i;vjs.Html5.patchCanPlayType=function(){vjs.ANDROID_VERSION>=4&&(n||(n=vjs.TEST_VID.constructor.prototype.canPlayType),vjs.TEST_VID.constructor.prototype.canPlayType=function(i){return i&&t.test(i)?"maybe":n.call(this,i)});vjs.IS_OLD_ANDROID&&(n||(n=vjs.TEST_VID.constructor.prototype.canPlayType),vjs.TEST_VID.constructor.prototype.canPlayType=function(t){return t&&i.test(t)?"maybe":n.call(this,t)})};vjs.Html5.unpatchCanPlayType=function(){var t=vjs.TEST_VID.constructor.prototype.canPlayType;return vjs.TEST_VID.constructor.prototype.canPlayType=n,n=null,t};vjs.Html5.patchCanPlayType()}(),vjs.Html5.Events="loadstart,suspend,abort,error,emptied,stalled,loadedmetadata,loadeddata,canplay,canplaythrough,playing,waiting,seeking,seeked,ended,durationchange,timeupdate,progress,play,pause,ratechange,volumechange".split(","),vjs.Html5.disposeMediaElement=function(n){if(n){for(n.player=null,n.parentNode&&n.parentNode.removeChild(n);n.hasChildNodes();)n.removeChild(n.firstChild);n.removeAttribute("src");typeof n.load=="function"&&function(){try{n.load()}catch(t){}}()}},vjs.Flash=vjs.MediaTechController.extend({init:function(n,t,i){vjs.MediaTechController.call(this,n,t,i);var u=t.source,o=t.parentEl,f=this.el_=vjs.createEl("div",{id:n.id()+"_temp_flash"}),e=n.id()+"_flash_api",r=n.options_,s=vjs.obj.merge({readyFunction:"videojs.Flash.onReady",eventProxyFunction:"videojs.Flash.onEvent",errorEventProxyFunction:"videojs.Flash.onError",autoplay:r.autoplay,preload:r.preload,loop:r.loop,muted:r.muted},t.flashVars),h=vjs.obj.merge({wmode:"opaque",bgcolor:"#000000"},t.params),c=vjs.obj.merge({id:e,name:e,"class":"vjs-tech"},t.attributes);u&&this.ready(function(){this.setSource(u)});vjs.insertFirst(f,o);t.startTime&&this.ready(function(){this.load();this.play();this.currentTime(t.startTime)});vjs.IS_FIREFOX&&this.ready(function(){this.on("mousemove",function(){this.player().trigger({type:"mousemove",bubbles:!1})})});n.on("stageclick",n.reportUserActivity);this.el_=vjs.Flash.embed(t.swf,f,s,h,c)}}),vjs.Flash.prototype.dispose=function(){vjs.MediaTechController.prototype.dispose.call(this)},vjs.Flash.prototype.play=function(){this.el_.vjs_play()},vjs.Flash.prototype.pause=function(){this.el_.vjs_pause()},vjs.Flash.prototype.src=function(n){return n===undefined?this.currentSrc():this.setSrc(n)},vjs.Flash.prototype.setSrc=function(n){if(n=vjs.getAbsoluteURL(n),this.el_.vjs_src(n),this.player_.autoplay()){var t=this;this.setTimeout(function(){t.play()},0)}},vjs.Flash.prototype.setCurrentTime=function(n){this.lastSeekTarget_=n;this.el_.vjs_setProperty("currentTime",n);vjs.MediaTechController.prototype.setCurrentTime.call(this)},vjs.Flash.prototype.currentTime=function(){return this.seeking()?this.lastSeekTarget_||0:this.el_.vjs_getProperty("currentTime")},vjs.Flash.prototype.currentSrc=function(){return this.currentSource_?this.currentSource_.src:this.el_.vjs_getProperty("currentSrc")},vjs.Flash.prototype.load=function(){this.el_.vjs_load()},vjs.Flash.prototype.poster=function(){this.el_.vjs_getProperty("poster")},vjs.Flash.prototype.setPoster=function(){},vjs.Flash.prototype.buffered=function(){return vjs.createTimeRange(0,this.el_.vjs_getProperty("buffered"))},vjs.Flash.prototype.supportsFullScreen=function(){return!1},vjs.Flash.prototype.enterFullScreen=function(){return!1},function(){function f(n){var t=n.charAt(0).toUpperCase()+n.slice(1);i["set"+t]=function(t){return this.el_.vjs_setProperty(n,t)}}function u(n){i[n]=function(){return this.el_.vjs_getProperty(n)}}for(var i=vjs.Flash.prototype,t="rtmpConnection,rtmpStream,preload,defaultPlaybackRate,playbackRate,autoplay,loop,mediaGroup,controller,controls,volume,muted,defaultMuted".split(","),r="error,networkState,readyState,seeking,initialTime,duration,startOffsetTime,paused,played,seekable,ended,videoTracks,audioTracks,videoWidth,videoHeight,textTracks".split(","),n=0;n<t.length;n++)u(t[n]),f(t[n]);for(n=0;n<r.length;n++)u(r[n])}(),vjs.Flash.isSupported=function(){return vjs.Flash.version()[0]>=10},vjs.MediaTechController.withSourceHandlers(vjs.Flash),vjs.Flash.nativeSourceHandler={},vjs.Flash.nativeSourceHandler.canHandleSource=function(n){var t;return n.type?(t=n.type.replace(/;.*/,"").toLowerCase(),t in vjs.Flash.formats)?"maybe":"":""},vjs.Flash.nativeSourceHandler.handleSource=function(n,t){t.setSrc(n.src)},vjs.Flash.nativeSourceHandler.dispose=function(){},vjs.Flash.registerSourceHandler(vjs.Flash.nativeSourceHandler),vjs.Flash.formats={"video/flv":"FLV","video/x-flv":"FLV","video/mp4":"MP4","video/m4v":"MP4"},vjs.Flash.onReady=function(n){var t,i;t=vjs.el(n);i=t&&t.parentNode&&t.parentNode.player;i&&(t.player=i,vjs.Flash.checkReady(i.tech))},vjs.Flash.checkReady=function(n){n.el()&&(n.el().vjs_getProperty?n.triggerReady():this.setTimeout(function(){vjs.Flash.checkReady(n)},50))},vjs.Flash.onEvent=function(n,t){var i=vjs.el(n).player;i.trigger(t)},vjs.Flash.onError=function(n,t){var i=vjs.el(n).player,r="FLASH: "+t;t=="srcnotfound"?i.error({code:4,message:r}):i.error(r)},vjs.Flash.version=function(){var n="0,0,0";try{n=new window.ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version").replace(/\D+/g,",").match(/^,?(.+),?$/)[1]}catch(t){try{navigator.mimeTypes["application/x-shockwave-flash"].enabledPlugin&&(n=(navigator.plugins["Shockwave Flash 2.0"]||navigator.plugins["Shockwave Flash"]).description.replace(/\D+/g,",").match(/^,?(.+),?$/)[1])}catch(i){}}return n.split(",")},vjs.Flash.embed=function(n,t,i,r,u){var o=vjs.Flash.getEmbedCode(n,i,r,u),f=vjs.createEl("div",{innerHTML:o}).childNodes[0],s=t.parentNode,e;return t.parentNode.replaceChild(f,t),e=s.childNodes[0],setTimeout(function(){e.style.display="block"},1e3),f},vjs.Flash.getEmbedCode=function(n,t,i,r){var u="",f="",e="";return t&&vjs.obj.each(t,function(n,t){u+=n+"="+t+"&amp;"}),i=vjs.obj.merge({movie:n,flashvars:u,allowScriptAccess:"always",allowNetworking:"all"},i),vjs.obj.each(i,function(n,t){f+='<param name="'+n+'" value="'+t+'" />'}),r=vjs.obj.merge({data:n,width:"100%",height:"100%"},r),vjs.obj.each(r,function(n,t){e+=n+'="'+t+'" '}),'<object type="application/x-shockwave-flash" '+e+">"+f+"<\/object>"},vjs.Flash.streamingFormats={"rtmp/mp4":"MP4","rtmp/flv":"FLV"},vjs.Flash.streamFromParts=function(n,t){return n+"&"+t},vjs.Flash.streamToParts=function(n){var i={connection:"",stream:""},t,r;return n?(t=n.indexOf("&"),t!==-1?r=t+1:(t=r=n.lastIndexOf("/")+1,t===0&&(t=r=n.length)),i.connection=n.substring(0,t),i.stream=n.substring(r,n.length),i):i},vjs.Flash.isStreamingType=function(n){return n in vjs.Flash.streamingFormats},vjs.Flash.RTMP_RE=/^rtmp[set]?:\/\//i,vjs.Flash.isStreamingSrc=function(n){return vjs.Flash.RTMP_RE.test(n)},vjs.Flash.rtmpSourceHandler={},vjs.Flash.rtmpSourceHandler.canHandleSource=function(n){return vjs.Flash.isStreamingType(n.type)||vjs.Flash.isStreamingSrc(n.src)?"maybe":""},vjs.Flash.rtmpSourceHandler.handleSource=function(n,t){var i=vjs.Flash.streamToParts(n.src);t.setRtmpConnection(i.connection);t.setRtmpStream(i.stream)},vjs.Flash.registerSourceHandler(vjs.Flash.rtmpSourceHandler),vjs.MediaLoader=vjs.Component.extend({init:function(n,t,i){var r,u,f,e;if(vjs.Component.call(this,n,t,i),n.options_.sources&&n.options_.sources.length!==0)n.src(n.options_.sources);else for(r=0,u=n.options_.techOrder;r<u.length;r++)if(f=vjs.capitalize(u[r]),e=window.videojs[f],e&&e.isSupported()){n.loadTech(f);break}}}),vjs.Player.prototype.textTracks_,vjs.Player.prototype.textTracks=function(){return this.textTracks_=this.textTracks_||[],this.textTracks_},vjs.Player.prototype.addTextTrack=function(n,t,i,r){var e=this.textTracks_=this.textTracks_||[],f,u;return r=r||{},r.kind=n,r.label=t,r.language=i,f=vjs.capitalize(n||"subtitles"),u=new window.videojs[f+"Track"](this,r),e.push(u),u.dflt()&&this.ready(function(){this.setTimeout(function(){u.player().showTextTrack(u.id())},0)}),u},vjs.Player.prototype.addTextTracks=function(n){for(var t,i=0;i<n.length;i++)t=n[i],this.addTextTrack(t.kind,t.label,t.language,t);return this},vjs.Player.prototype.showTextTrack=function(n,t){for(var e=this.textTracks_,r=0,o=e.length,i,u,f;r<o;r++)i=e[r],i.id()===n?(i.show(),u=i):t&&i.kind()==t&&i.mode()>0&&i.disable();return f=u?u.kind():t?t:!1,f&&this.trigger(f+"trackchange"),this},vjs.TextTrack=vjs.Component.extend({init:function(n,t){vjs.Component.call(this,n,t);this.id_=t.id||"vjs_"+t.kind+"_"+t.language+"_"+vjs.guid++;this.src_=t.src;this.dflt_=t["default"]||t.dflt;this.title_=t.title;this.language_=t.srclang;this.label_=t.label;this.cues_=[];this.activeCues_=[];this.readyState_=0;this.mode_=0;n.on("dispose",vjs.bind(this,this.deactivate,this.id_))}}),vjs.TextTrack.prototype.kind_,vjs.TextTrack.prototype.kind=function(){return this.kind_},vjs.TextTrack.prototype.src_,vjs.TextTrack.prototype.src=function(){return this.src_},vjs.TextTrack.prototype.dflt_,vjs.TextTrack.prototype.dflt=function(){return this.dflt_},vjs.TextTrack.prototype.title_,vjs.TextTrack.prototype.title=function(){return this.title_},vjs.TextTrack.prototype.language_,vjs.TextTrack.prototype.language=function(){return this.language_},vjs.TextTrack.prototype.label_,vjs.TextTrack.prototype.label=function(){return this.label_},vjs.TextTrack.prototype.cues_,vjs.TextTrack.prototype.cues=function(){return this.cues_},vjs.TextTrack.prototype.activeCues_,vjs.TextTrack.prototype.activeCues=function(){return this.activeCues_},vjs.TextTrack.prototype.readyState_,vjs.TextTrack.prototype.readyState=function(){return this.readyState_},vjs.TextTrack.prototype.mode_,vjs.TextTrack.prototype.mode=function(){return this.mode_},vjs.TextTrack.prototype.createEl=function(){return vjs.Component.prototype.createEl.call(this,"div",{className:"vjs-"+this.kind_+" vjs-text-track"})},vjs.TextTrack.prototype.show=function(){this.activate();this.mode_=2;vjs.Component.prototype.show.call(this)},vjs.TextTrack.prototype.hide=function(){this.activate();this.mode_=1;vjs.Component.prototype.hide.call(this)},vjs.TextTrack.prototype.disable=function(){this.mode_==2&&this.hide();this.deactivate();this.mode_=0},vjs.TextTrack.prototype.activate=function(){if(this.readyState_===0&&this.load(),this.mode_===0){this.player_.on("timeupdate",vjs.bind(this,this.update,this.id_));this.player_.on("ended",vjs.bind(this,this.reset,this.id_));(this.kind_==="captions"||this.kind_==="subtitles")&&this.player_.getChild("textTrackDisplay").addChild(this)}},vjs.TextTrack.prototype.deactivate=function(){this.player_.off("timeupdate",vjs.bind(this,this.update,this.id_));this.player_.off("ended",vjs.bind(this,this.reset,this.id_));this.reset();this.player_.getChild("textTrackDisplay").removeChild(this)},vjs.TextTrack.prototype.load=function(){this.readyState_===0&&(this.readyState_=1,vjs.xhr(this.src_,vjs.bind(this,function(n,t,i){if(n)return this.onError(n);this.parseCues(i)})))},vjs.TextTrack.prototype.onError=function(n){this.error=n;this.readyState_=3;this.trigger("error")},vjs.TextTrack.prototype.parseCues=function(n){for(var r,f,e,u=n.split("\n"),t="",o,i=1,s=u.length;i<s;i++)if(t=vjs.trim(u[i]),t){for(t.indexOf("-->")==-1?(o=t,t=vjs.trim(u[++i])):o=this.cues_.length,r={id:o,index:this.cues_.length},f=t.split(/[\t ]+/),r.startTime=this.parseCueTime(f[0]),r.endTime=this.parseCueTime(f[2]),e=[];u[++i]&&(t=vjs.trim(u[i]));)e.push(t);r.text=e.join("<br/>");this.cues_.push(r)}this.readyState_=2;this.trigger("loaded")},vjs.TextTrack.prototype.parseCueTime=function(n){var i=n.split(":"),r=0,f,e,u,t,o;return i.length==3?(f=i[0],e=i[1],u=i[2]):(f=0,e=i[0],u=i[1]),u=u.split(/\s+/),t=u.splice(0,1)[0],t=t.split(/\.|,/),o=parseFloat(t[1]),t=t[0],r+=parseFloat(f)*3600,r+=parseFloat(e)*60,r+=parseFloat(t),o&&(r+=o/1e3),r},vjs.TextTrack.prototype.update=function(){var c,i;if(this.cues_.length>0&&(c=this.player_.options().trackTimeOffset||0,i=this.player_.currentTime()+c,this.prevChange===undefined||i<this.prevChange||this.nextChange<=i)){var s=this.cues_,r=this.player_.duration(),u=0,f=!1,h=[],e,o,n,t;for(i>=this.nextChange||this.nextChange===undefined?t=this.firstActiveIndex!==undefined?this.firstActiveIndex:0:(f=!0,t=this.lastActiveIndex!==undefined?this.lastActiveIndex:s.length-1);;){if(n=s[t],n.endTime<=i)u=Math.max(u,n.endTime),n.active&&(n.active=!1);else if(i<n.startTime){if(r=Math.min(r,n.startTime),n.active&&(n.active=!1),!f)break}else f?(h.splice(0,0,n),o===undefined&&(o=t),e=t):(h.push(n),e===undefined&&(e=t),o=t),r=Math.min(r,n.endTime),u=Math.max(u,n.startTime),n.active=!0;if(f)if(t===0)break;else t--;else if(t===s.length-1)break;else t++}this.activeCues_=h;this.nextChange=r;this.prevChange=u;this.firstActiveIndex=e;this.lastActiveIndex=o;this.updateDisplay();this.trigger("cuechange")}},vjs.TextTrack.prototype.updateDisplay=function(){for(var t=this.activeCues_,i="",n=0,r=t.length;n<r;n++)i+='<span class="vjs-tt-cue">'+t[n].text+"<\/span>";this.el_.innerHTML=i},vjs.TextTrack.prototype.reset=function(){this.nextChange=0;this.prevChange=this.player_.duration();this.firstActiveIndex=0;this.lastActiveIndex=0},vjs.CaptionsTrack=vjs.TextTrack.extend(),vjs.CaptionsTrack.prototype.kind_="captions",vjs.SubtitlesTrack=vjs.TextTrack.extend(),vjs.SubtitlesTrack.prototype.kind_="subtitles",vjs.ChaptersTrack=vjs.TextTrack.extend(),vjs.ChaptersTrack.prototype.kind_="chapters",vjs.TextTrackDisplay=vjs.Component.extend({init:function(n,t,i){vjs.Component.call(this,n,t,i);n.options_.tracks&&n.options_.tracks.length>0&&this.player_.addTextTracks(n.options_.tracks)}}),vjs.TextTrackDisplay.prototype.createEl=function(){return vjs.Component.prototype.createEl.call(this,"div",{className:"vjs-text-track-display"})},vjs.TextTrackMenuItem=vjs.MenuItem.extend({init:function(n,t){var i=this.track=t.track;t.label=i.label();t.selected=i.dflt();vjs.MenuItem.call(this,n,t);this.on(n,i.kind()+"trackchange",this.update)}}),vjs.TextTrackMenuItem.prototype.onClick=function(){vjs.MenuItem.prototype.onClick.call(this);this.player_.showTextTrack(this.track.id_,this.track.kind())},vjs.TextTrackMenuItem.prototype.update=function(){this.selected(this.track.mode()==2)},vjs.OffTextTrackMenuItem=vjs.TextTrackMenuItem.extend({init:function(n,t){t.track={kind:function(){return t.kind},player:n,label:function(){return t.kind+" off"},dflt:function(){return!1},mode:function(){return!1}};vjs.TextTrackMenuItem.call(this,n,t);this.selected(!0)}}),vjs.OffTextTrackMenuItem.prototype.onClick=function(){vjs.TextTrackMenuItem.prototype.onClick.call(this);this.player_.showTextTrack(this.track.id_,this.track.kind())},vjs.OffTextTrackMenuItem.prototype.update=function(){for(var i=this.player_.textTracks(),n=0,u=i.length,t,r=!0;n<u;n++)t=i[n],t.kind()==this.track.kind()&&t.mode()==2&&(r=!1);this.selected(r)},vjs.TextTrackButton=vjs.MenuButton.extend({init:function(n,t){vjs.MenuButton.call(this,n,t);this.items.length<=1&&this.hide()}}),vjs.TextTrackButton.prototype.createItems=function(){var t=[],i,n;for(t.push(new vjs.OffTextTrackMenuItem(this.player_,{kind:this.kind_})),n=0;n<this.player_.textTracks().length;n++)i=this.player_.textTracks()[n],i.kind()===this.kind_&&t.push(new vjs.TextTrackMenuItem(this.player_,{track:i}));return t},vjs.CaptionsButton=vjs.TextTrackButton.extend({init:function(n,t,i){vjs.TextTrackButton.call(this,n,t,i);this.el_.setAttribute("aria-label","Captions Menu")}}),vjs.CaptionsButton.prototype.kind_="captions",vjs.CaptionsButton.prototype.buttonText="Captions",vjs.CaptionsButton.prototype.className="vjs-captions-button",vjs.SubtitlesButton=vjs.TextTrackButton.extend({init:function(n,t,i){vjs.TextTrackButton.call(this,n,t,i);this.el_.setAttribute("aria-label","Subtitles Menu")}}),vjs.SubtitlesButton.prototype.kind_="subtitles",vjs.SubtitlesButton.prototype.buttonText="Subtitles",vjs.SubtitlesButton.prototype.className="vjs-subtitles-button",vjs.ChaptersButton=vjs.TextTrackButton.extend({init:function(n,t,i){vjs.TextTrackButton.call(this,n,t,i);this.el_.setAttribute("aria-label","Chapters Menu")}}),vjs.ChaptersButton.prototype.kind_="chapters",vjs.ChaptersButton.prototype.buttonText="Chapters",vjs.ChaptersButton.prototype.className="vjs-chapters-button",vjs.ChaptersButton.prototype.createItems=function(){for(var i=[],n,t=0;t<this.player_.textTracks().length;t++)n=this.player_.textTracks()[t],n.kind()===this.kind_&&i.push(new vjs.TextTrackMenuItem(this.player_,{track:n}));return i},vjs.ChaptersButton.prototype.createMenu=function(){for(var o=this.player_.textTracks(),n=0,u=o.length,i,r,h=this.items=[],t,f,s,e;n<u;n++)if(i=o[n],i.kind()==this.kind_)if(i.readyState()===0){i.load();i.on("loaded",vjs.bind(this,this.createMenu))}else{r=i;break}if(t=this.menu,t===undefined&&(t=new vjs.Menu(this.player_),t.contentEl().appendChild(vjs.createEl("li",{className:"vjs-menu-title",innerHTML:vjs.capitalize(this.kind_),tabindex:-1}))),r){for(f=r.cues_,n=0,u=f.length;n<u;n++)s=f[n],e=new vjs.ChaptersTrackMenuItem(this.player_,{track:r,cue:s}),h.push(e),t.addChild(e);this.addChild(t)}return this.items.length>0&&this.show(),t},vjs.ChaptersTrackMenuItem=vjs.MenuItem.extend({init:function(n,t){var u=this.track=t.track,i=this.cue=t.cue,r=n.currentTime();t.label=i.text;t.selected=i.startTime<=r&&r<i.endTime;vjs.MenuItem.call(this,n,t);u.on("cuechange",vjs.bind(this,this.update))}}),vjs.ChaptersTrackMenuItem.prototype.onClick=function(){vjs.MenuItem.prototype.onClick.call(this);this.player_.currentTime(this.cue.startTime);this.update(this.cue.startTime)},vjs.ChaptersTrackMenuItem.prototype.update=function(){var n=this.cue,t=this.player_.currentTime();this.selected(n.startTime<=t&&t<n.endTime)},vjs.obj.merge(vjs.ControlBar.prototype.options_.children,{subtitlesButton:{},captionsButton:{},chaptersButton:{}}),vjs.JSON,typeof JSON!="undefined"&&typeof window.JSON.parse=="function"?vjs.JSON=window.JSON:(vjs.JSON={},cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,vjs.JSON.parse=function(n,t){function r(n,i){var f,e,u=n[i];if(u&&typeof u=="object")for(f in u)Object.prototype.hasOwnProperty.call(u,f)&&(e=r(u,f),e!==undefined?u[f]=e:delete u[f]);return t.call(n,i,u)}var i;if(n=String(n),cx.lastIndex=0,cx.test(n)&&(n=n.replace(cx,function(n){return"\\u"+("0000"+n.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(n.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return i=eval("("+n+")"),typeof t=="function"?r({"":i},""):i;throw new SyntaxError("JSON.parse(): invalid or malformed JSON data");}),vjs.autoSetup=function(){var e,t,o,n,i,u=document.getElementsByTagName("video"),f=document.getElementsByTagName("audio"),r=[];if(u&&u.length>0)for(n=0,i=u.length;n<i;n++)r.push(u[n]);if(f&&f.length>0)for(n=0,i=f.length;n<i;n++)r.push(f[n]);if(r&&r.length>0)for(n=0,i=r.length;n<i;n++)if(t=r[n],t&&t.getAttribute)t.player===undefined&&(e=t.getAttribute("data-setup"),e!==null&&(o=videojs(t)));else{vjs.autoSetupTimeout(1);break}else vjs.windowLoaded||vjs.autoSetupTimeout(1)},vjs.autoSetupTimeout=function(n){setTimeout(vjs.autoSetup,n)},document.readyState==="complete")vjs.windowLoaded=!0;else vjs.one(window,"load",function(){vjs.windowLoaded=!0});vjs.autoSetupTimeout(1);vjs.plugin=function(n,t){vjs.Player.prototype[n]=t},function(n){(function(t){"use strict";var s,h,u,f,e,o,i,r;(function(n){n[n.proceed=0]="proceed";n[n.endOfStream=1]="endOfStream";n[n.retry=2]="retry"})(t.RequestState||(t.RequestState={}));s=t.RequestState,function(n){n[n.arraybuffer=0]="arraybuffer";n[n.blob=1]="blob";n[n.document=2]="document";n[n.json=3]="json";n[n.text=4]="text"}(t.ResponseType||(t.ResponseType={}));h=t.ResponseType;u=function(){function t(t,i,r){this.videoTag=i;this.appConfig=r;this.emeManager=new n.KeySystem.EmeManager(i);this.eventMgr=new n.Events.Manager(t,!1);this.workflows=null;this.presentationUrl=null;this.presentationJson=null;this.commonPresentation=null;this.startPositionInSec=NaN;this.authenticationToken="";this.heuristicSettings=new n.Settings.Heuristics;this.httpRetryPolicySettings=new n.Settings.HttpRetryPolicy;this.httpDataRetrieverSettings=new n.Settings.HttpDataRetriever;this._disposed=!1}return t.prototype.dispose=function(){this._disposed||(this._disposed=!0,this.videoTag=null,this.appConfig=null,this.workflows&&this.workflows.forEach(function(n){n.dispose()}),this.workflows=null,this.presentationUrl=null,this.presentationJson=null,this.authenticationToken=null,this.emeManager&&(this.emeManager.dispose(),this.emeManager=null),this.eventMgr&&(this.eventMgr.dispose(),this.eventMgr=null),this.commonPresentation&&(this.commonPresentation.dispose(),this.commonPresentation=null),this.heuristicSettings=null)},Object.defineProperty(t.prototype,"disposed",{get:function(){return this._disposed},enumerable:!0,configurable:!0}),t.prototype.reset=function(){this.presentationUrl=null;this.presentationJson=null;this.startPositionInSec=NaN;this.authenticationToken="";this.commonPresentation&&(this.commonPresentation.dispose(),this.commonPresentation=null);this.emeManager&&this.emeManager.reset()},t.prototype.maxBufferInSec=function(){return this.appConfig&&this.appConfig.maxBufferInSec&&this.appConfig.maxBufferInSec!="0"?parseInt(this.appConfig.maxBufferInSec):this.heuristicSettings.buffer.maxBufferInSec},t.prototype.prerollBufferInSec=function(){return this.maxBufferInSec()*this.heuristicSettings.buffer.prerollPercent},t.prototype.lowBufferInSec=function(){return this.maxBufferInSec()*this.heuristicSettings.vodDowngradeBufferLevelPercent*this.heuristicSettings.buffer.lowBufferPercent},t.prototype.liveStartBufferInSec=function(){return this.maxBufferInSec()*(this.heuristicSettings.buffer.prerollPercent+this.heuristicSettings.buffer.livePlaybackOffsetPercent)},t.prototype.updatePresentation=function(n){this.commonPresentation?(this.commonPresentation.transferPresentationState(n),this.presentationJson=n.toJson(),n.dispose()):(this.commonPresentation=n,this.presentationJson=n.toJson())},t}();t.Session=u;f=function(){function n(n,t){this.workflowType=n;this.sessionContext=t;this.state=0;this.retryWaitTimeMSec=0;this.currentModuleId=null;this.requestedStream=null;this.urlsToRetrieve=[];this.selectedTrack=null;this.selectedSegment=null;this.heuristicData=null;this.externalFailure=null;this.failTracker=new r;this._disposed=!1}return n.prototype.dispose=function(){this._disposed||(this._disposed=!0,this.workflowType=null,this.sessionContext=null,this.state=null,this.currentModuleId=null,this.requestedStream=null,this.urlsToRetrieve.forEach(function(n,t,i){i[t].dispose()}),this.urlsToRetrieve=[],this.selectedTrack=null,this.selectedSegment=null,this.heuristicData&&(this.heuristicData.dispose(),this.heuristicData=null),this.externalFailure&&(this.externalFailure.dispose(),this.externalFailure=null),this.failTracker&&(this.failTracker.dispose(),this.failTracker=null))},n.prototype.reset=function(){this.state=0;this.retryWaitTimeMSec=0;this.currentModuleId=null;this.selectedTrack=null;this.selectedSegment=null;1===this.workflowType&&(this.urlsToRetrieve=[]);this.heuristicData&&this.heuristicData.reset();this.externalFailure=null},Object.defineProperty(n.prototype,"disposed",{get:function(){return this._disposed},enumerable:!0,configurable:!0}),n}();t.Request=f;e=function(){function n(n,t,i,r){typeof t=="undefined"&&(t=0);typeof i=="undefined"&&(i=0);typeof r=="undefined"&&(r=0);this.url=n;this.httpResponseCode=-1;this.httpResposeContentType="";this.mediaData=null;this.presentationData=null;this.presTimeInSec=i;this.durationInSec=r;this.responseType=t}return n.prototype.dispose=function(){this.url=null;this.httpResponseCode=null;this.httpResposeContentType="";this.mediaData=null;this.presentationData=null;this.presTimeInSec=null;this.durationInSec=null;this.responseType=null},n}();t.UrlRequest=e;o=function(){function n(n){var t=[];n.tracks.forEach(function(n){n.streamingInfo.selectable&&t.push(new i(n))});this.tracksData=t}return n.prototype.dispose=function(){this.tracksData.forEach(function(n,t,i){i[t].dispose()});this.tracksData=[]},n.prototype.reset=function(){this.tracksData.forEach(function(n,t,i){i[t].reset()})},n}();t.HeuristicData=o;i=function(){function n(n){this.trackInfo=n;this.selectable=!0;this.dataRetrieverEstimationInSec=null}return n.prototype.dispose=function(){this.trackInfo=null;this.selectable=null;this.dataRetrieverEstimationInSec=null},n.prototype.reset=function(){this.selectable=!0;this.dataRetrieverEstimationInSec=null},n}();t.TrackData=i;r=function(){function n(){this.lastFailure=null;this.lastTrack=null;this.totalRetried=0;this.tracksToTry=[];this.trackToTryIdx=0;this.sameRequestRetried=0;this.segmentsSkipped=0}return n.prototype.dispose=function(){this.lastFailure=null;this.lastTrack=null;this.tracksToTry=[]},n.prototype.resetForSegment=function(){this.sameRequestRetried=0;this.trackToTryIdx=0},n.prototype.log=function(n,t){this.lastFailure=n;this.lastTrack=t},n.prototype.isNone=function(){return null===this.lastFailure},n.prototype.isLastNetworkFail=function(){return this.lastFailure.code>=2164262089&&this.lastFailure.code<2164262143},n}();t.FailTracker=r})(n.Context||(n.Context={}));var t=n.Context}(AzureHtml5JS||(AzureHtml5JS={})),function(n){"use strict";function r(n,t){return new i(n,t)}var u,t,i;n.CreateAzureHtml5=r,function(n){n[n.internalErrStart=2164260864]="internalErrStart";n[n.internalErrDisposed=2164260864]="internalErrDisposed";n[n.internalErrSegmentNotFound=2164260865]="internalErrSegmentNotFound";n[n.internalErrEnd=2164261119]="internalErrEnd"}(n.ExtendedCode||(n.ExtendedCode={}));u=n.ExtendedCode;t=function(){function n(){}return n.exception="exception",n}();n.InternalEventName=t;i=function(){function i(t,i){this._sessionContext=new n.Context.Session(this,t,i);this._playerType=null;this._autoplay=!0;this._type="";this._error=null;this._dispose=!1;this._passThroughEventNames=[n.EventName.volumechange,n.EventName.ended,n.EventName.timeupdate,n.EventName.pause,n.EventName.play,n.EventName.playing,n.EventName.seeking,n.EventName.seeked,n.EventName.loadstart,n.EventName.loadeddata];this._conditionalEventNames=[n.EventName.waiting,n.EventName.canplaythrough,n.EventName.error];this._registerVideoTagEvents(!0);this._registerInternalEvents(!0)}return i.prototype.dispose=function(){this._dispose=!0;this._workflowCoordinator&&this._workflowCoordinator.dispose();this._sessionContext&&(this._registerVideoTagEvents(!1),this._registerInternalEvents(!1),this._sessionContext.dispose(),this._sessionContext=null);this._error=null},Object.defineProperty(i.prototype,"src",{get:function(){return this._workflowCoordinator?this._workflowCoordinator.src:this._sessionContext.videoTag.src},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"type",{get:function(){return this._type},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"currentTime",{get:function(){return this._workflowCoordinator?this._workflowCoordinator.currentTime:this._sessionContext.videoTag.currentTime},set:function(t){n.Log.verbose(7,"currentTime: "+t+" sec");this._workflowCoordinator?this._workflowCoordinator.currentTime=t:this._sessionContext.videoTag.currentTime=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"volume",{get:function(){return this._sessionContext.videoTag.volume},set:function(t){n.Log.verbose(7,"volume: "+t.toString);var i=t;NaN!==t&&undefined!==t&&null!==t&&(t<0?i=0:t>1&&(i=1),this._sessionContext.videoTag.volume=i)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"autoplay",{get:function(){return this._autoplay},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"paused",{get:function(){return this._sessionContext.videoTag.paused},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"seeking",{get:function(){return this._sessionContext.videoTag.seeking},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"ended",{get:function(){return this._sessionContext.videoTag.ended},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"height",{get:function(){return this._sessionContext.videoTag.height},set:function(n){this._sessionContext.videoTag.height=n},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"width",{get:function(){return this._sessionContext.videoTag.width},set:function(n){this._sessionContext.videoTag.width=n},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"videoHeight",{get:function(){return this._sessionContext.videoTag.videoHeight},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"videoWidth",{get:function(){return this._sessionContext.videoTag.videoWidth},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isFullScreen",{get:function(){var n=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;return n===this._sessionContext.videoTag?document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled:!1},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"duration",{get:function(){return this._workflowCoordinator?this._workflowCoordinator.duration:this._sessionContext.videoTag.duration},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"buffered",{get:function(){return this._workflowCoordinator?this._workflowCoordinator.buffered:this._sessionContext.videoTag.buffered},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"error",{get:function(){return this._workflowCoordinator&&this._workflowCoordinator.error?this._workflowCoordinator.error:this._error},enumerable:!0,configurable:!0}),i.prototype.canPlayType=function(t){return n.PlayerType.getByPresentationType(t,this._sessionContext.videoTag)?"maybe":""},i.prototype.setSrc=function(t,i){this._sessionContext.reset();this._reset(i);this._playerType=n.PlayerType.getByPresentationType(this._type,this._sessionContext.videoTag);this._playerType||(this._playerType=n.PlayerType.getByUrl(t,this._sessionContext.videoTag));n.Log.verbose(7,"src: "+t+" autoplay: "+this._autoplay+" type: "+(this._type&&this._type.length>0?this._type:"unknown")+" player: "+(null===this._playerType?"unknown":n.PlayerDetector.Type[this._playerType]));this._workflowCoordinator&&(this._workflowCoordinator.dispose(),this._workflowCoordinator=null);this._playerType===1?(this._sessionContext.videoTag.autoplay=this._autoplay,this._sessionContext.videoTag.src=t):this._playerType===3?(this._workflowCoordinator=n.Workflow.CreateCoordinator(this._sessionContext),this._sessionContext.videoTag.autoplay=!1,this._workflowCoordinator.autoplay=this._autoplay,this._workflowCoordinator.src=t):(n.Log.error(7,t+" not supported by AzureHtml5 Video Element"),this._handleError(new n.Failure.External(2164261634,t)))},i.prototype.play=function(){n.Log.verbose(7,"play");this._workflowCoordinator?this._workflowCoordinator.play():this._sessionContext.videoTag.play()},i.prototype.pause=function(){n.Log.verbose(7,"pause");this._workflowCoordinator?this._workflowCoordinator.pause():this._sessionContext.videoTag.pause()},i.prototype.requestFullscreen=function(){var i,t;(n.Log.verbose(7,"requestFullscreen"),i=!1,this.isFullScreen)||(t=this._sessionContext.videoTag,t.requestFullscreen?(i=!0,t.requestFullscreen()):t.msRequestFullscreen?(i=!0,t.msRequestFullscreen()):t.webkitRequestFullscreen?(i=!0,t.webkitRequestFullscreen()):t.mozRequestFullScreen&&(i=!0,t.mozRequestFullScreen()),i&&this._sessionContext.eventMgr.dispatchEvent(n.EventName.fullscreenchange))},i.prototype.exitFullscreen=function(){n.Log.verbose(7,"exitFullscreen");var t=!1;this.isFullScreen&&(document.exitFullscreen?(t=!0,document.exitFullscreen()):document.webkitExitFullscreen?(t=!0,document.webkitExitFullscreen()):document.mozCancelFullScreen?(t=!0,document.mozCancelFullScreen()):document.msExitFullscreen&&(t=!0,document.msExitFullscreen()),t&&this._sessionContext.eventMgr.dispatchEvent(n.EventName.fullscreenchange))},i.prototype.addEventListener=function(n,t,i){typeof i=="undefined"&&(i=null);this._sessionContext.eventMgr.addHandler(n,t,i)},i.prototype.removeEventListener=function(n,t){this._sessionContext.eventMgr.removeHandler(n,t)},i.prototype.addKeySystem=function(n){return this._sessionContext.emeManager.addKeySystem(n)},i.prototype._reset=function(n){function i(n){t._dispose||t._handleError(n)}var t=this;this._playerType=null;this._autoplay=!0;this._type="";this._error=null;n&&(this._type=n.type,"autoPlay"in n&&(this._autoplay=n.autoPlay),"authenticationToken"in n&&(this._sessionContext.authenticationToken=n.authenticationToken));this._sessionContext.emeManager.setup(i,this._sessionContext.authenticationToken)},i.prototype._registerVideoTagEvents=function(t){function u(t){i._dispose||(n.Log.verbose(7,"dispatching event: "+t.type),i._sessionContext.eventMgr.dispatchEvent(t.type))}function f(t){if(!i._dispose)if(n.EventName.error===t.type){if(i._sessionContext.videoTag.readyState===HTMLMediaElement.HAVE_NOTHING){n.Log.warning(7,"Ignoring video element error since state is HAVE_NOTHING "+n.Failure.mediaErrorToString(i._sessionContext.videoTag.error));return}var r=new n.Failure.External;r.translateMediaError(i._sessionContext.videoTag.error);i._handleError(r)}else i._workflowCoordinator||(n.Log.verbose(7,"dispatching event: "+t.type),i._sessionContext.eventMgr.dispatchEvent(t.type))}var r=this,i=this;this._passThroughEventNames.forEach(function(n){t?r._sessionContext.videoTag.addEventListener(n,u):r._sessionContext.videoTag.removeEventListener(n,u)});this._conditionalEventNames.forEach(function(n){t?r._sessionContext.videoTag.addEventListener(n,f):r._sessionContext.videoTag.removeEventListener(n,f)})},i.prototype._registerInternalEvents=function(i){function r(t){if(!u._dispose&&t.message){n.Log.error(7,"Throwing error "+t.message);throw new Error(t.message);}}var u=this;i?this._sessionContext.eventMgr.addHandler(t.exception,r,this):this._sessionContext.eventMgr.removeHandler(t.exception,r)},i.prototype._handleError=function(t){this._workflowCoordinator&&this._workflowCoordinator.error||(this._error=t,this._workflowCoordinator&&(n.Log.verbose(7,"Disposing WorkflowCoordinator b/c "+t.toString()),this._workflowCoordinator.dispose(),this._workflowCoordinator=null),n.Log.verbose(7,"dispatching event: "+n.EventName.error),this._sessionContext.eventMgr.dispatchEvent(n.EventName.error))},i}()}(AzureHtml5JS||(AzureHtml5JS={})),function(n){(function(n){"use strict";var e=function(){function n(){this.windowSizeHeuristicsEnabled=n._windowSizeHeuristicsEnabledDefault;this.preFetchDataEnabled=n._preFetchDataEnabledDefault;this.vodStableBufferLevelPercent=n._vodStableBufferLevelPercentDefault;this.vodDowngradeBufferLevelPercent=n._vodDowngradeBufferLevelPercentDefault;this.belowDowngradeBufferLevelDownloadTimeFactor=n._belowDowngradeBufferLevelDownloadTimeFactorDefault;this.bandwidth=null;this.stepRule=null;this.buffer=null;this.bandwidth=new t;this.stepRule=new i;this.buffer=new r}return n.prototype.reset=function(){this.windowSizeHeuristicsEnabled=n._windowSizeHeuristicsEnabledDefault;this.preFetchDataEnabled=n._preFetchDataEnabledDefault;this.vodStableBufferLevelPercent=n._vodStableBufferLevelPercentDefault;this.vodDowngradeBufferLevelPercent=n._vodDowngradeBufferLevelPercentDefault;this.belowDowngradeBufferLevelDownloadTimeFactor=n._belowDowngradeBufferLevelDownloadTimeFactorDefault;this.bandwidth.reset();this.stepRule.reset();this.buffer.reset()},n._windowSizeHeuristicsEnabledDefault=!0,n._preFetchDataEnabledDefault=!0,n._vodStableBufferLevelPercentDefault=.7,n._vodDowngradeBufferLevelPercentDefault=.15,n._belowDowngradeBufferLevelDownloadTimeFactorDefault=.75,n}(),t,i,r,u,f;n.Heuristics=e;t=function(){function n(){this.bandwidthUsabilityPercent=n._bandwidthUsabilityPercentDefault;this.bandwidthDataSizeThresholdInBytes=n._bandwidthDataSizeThresholdInBytesDefault;this.maxBandwidthHistoryCount=n._maxBandwidthHistoryCountDefault}return n.prototype.reset=function(){this.bandwidthUsabilityPercent=n._bandwidthUsabilityPercentDefault;this.bandwidthDataSizeThresholdInBytes=n._bandwidthDataSizeThresholdInBytesDefault;this.maxBandwidthHistoryCount=n._maxBandwidthHistoryCountDefault},n._bandwidthUsabilityPercentDefault=.85,n._bandwidthDataSizeThresholdInBytesDefault=1e4,n._maxBandwidthHistoryCountDefault=5,n}();n.Bandwidth=t;i=function(){function n(){this.minSegmentsBeforeDowngrade=n._minSegmentsBeforeDowngradeDefault;this.minSegmentsBeforeUpgrade=n._minSegmentsBeforeUpgradeDefault;this.maxStepDownInQuality=n._maxStepDownInQualityDefault;this.maxStepUpInQuality=n._maxStepUpInQualityDefault}return n.prototype.reset=function(){this.minSegmentsBeforeDowngrade=n._minSegmentsBeforeDowngradeDefault;this.minSegmentsBeforeUpgrade=n._minSegmentsBeforeUpgradeDefault;this.maxStepDownInQuality=n._maxStepDownInQualityDefault;this.maxStepUpInQuality=n._maxStepUpInQualityDefault},n._minSegmentsBeforeDowngradeDefault=0,n._minSegmentsBeforeUpgradeDefault=2,n._maxStepDownInQualityDefault=10,n._maxStepUpInQualityDefault=3,n}();n.StepRule=i;r=function(){function n(){this.maxBufferInSec=n._maxBufferInSecDefault;this.prerollPercent=n._prerollPercentDefault;this.livePlaybackOffsetPercent=n._livePlaybackOffsetPercentDefault;this.leftEdgeBackoffInSec=n._leftEdgeBackoffInSecDefault;this.lowBufferPercent=n._lowBufferPercentDefault}return n.prototype.reset=function(){this.maxBufferInSec=n._maxBufferInSecDefault;this.prerollPercent=n._prerollPercentDefault;this.lowBufferPercent=n._lowBufferPercentDefault;this.livePlaybackOffsetPercent=n._livePlaybackOffsetPercentDefault;this.leftEdgeBackoffInSec=n._leftEdgeBackoffInSecDefault},n._maxBufferInSecDefault=30,n._prerollPercentDefault=.25,n._lowBufferPercentDefault=.25,n._livePlaybackOffsetPercentDefault=.25,n._leftEdgeBackoffInSecDefault=4,n}();n.Buffer=r;u=function(){function n(){this.maxTotalRetries=n._maxTotalRetriesDefault;this.maxRetryPerSegment=n._maxRetryPerSegmentDefault;this.maxRetryPresentation=n._maxRetryPresentationDefault;this.maxSkipSegments=n._maxSkipSegmentsDefault;this.retryLowerBitrateOnly=!1;this.retryMediaInMSec=n._retryMediaInMSecDefault;this.retryPresentationInMSec=n._retryPresentationInMSecDefault}return n._maxTotalRetriesDefault=50,n._maxRetryPerSegmentDefault=10,n._maxRetryPresentationDefault=5,n._maxSkipSegmentsDefault=0,n._retryMediaInMSecDefault=2e3,n._retryPresentationInMSecDefault=500,n}();n.HttpRetryPolicy=u;f=function(){function n(){this.timeoutInMSec=n._timoutInMSecDefault}return n._timoutInMSecDefault=5e3,n}();n.HttpDataRetriever=f})(n.Settings||(n.Settings={}));var t=n.Settings}(AzureHtml5JS||(AzureHtml5JS={})),function(n){(function(t){"use strict";function i(){return new e}function r(n){var t=null;if(window.hasOwnProperty("MediaSource")||window.hasOwnProperty("WebKitMediaSource"))t=window.MediaSource||window.WebKitMediaSource;else return!1;return t&&t.isTypeSupported&&t.isTypeSupported(n)}t.CreateAdapter=i;t.supported=r;var u={closed:0,open:1,ended:2},f=function(){function n(n,t,i){this.bufferIndex=n;this.startTime=t;this.endTime=i}return n}(),e=function(){function i(){this._mediaSource=new MediaSource;this._adapterSourceBuffers=new o;this._disposed=!1;this._videoTag=null;this._buffered=null}return i.prototype.dispose=function(){this._disposed||(this._mediaSource=null,this._adapterSourceBuffers.dispose(),this._adapterSourceBuffers=null,this._videoTag&&(this._videoTag.src=null,this._videoTag=null),this._disposed=!0)},Object.defineProperty(i.prototype,"readyState",{get:function(){return this._disposed?0:u[this._mediaSource.readyState]},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"durationInSec",{get:function(){return this._disposed?NaN:this._mediaSource.duration},set:function(n){this._disposed||(this._mediaSource.duration=n)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"adapterBuffers",{get:function(){return this._disposed?null:this._adapterSourceBuffers.adapterBuffers},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"buffered",{get:function(){return this._buffered},enumerable:!0,configurable:!0}),i.prototype.setVideoElementSrcAsync=function(n){var t=this;return this._videoTag=n,new Promise(function(i,r){if(t._disposed){r("VideoElementAdapter already disposed");return}t._mediaSource.addEventListener("sourceopen",function(){if(t._disposed){r("VideoElementAdapter already disposed");return}i()});n.src=URL.createObjectURL(t._mediaSource)})},i.prototype.setStartTime=function(t){function u(){!r._disposed&&r._videoTag&&r._videoTag.currentTime===0&&(r._videoTag.readyState!==HTMLMediaElement.HAVE_NOTHING?(r._videoTag.currentTime=t,n.Log.verbose(3,"StartTime set: "+t)):(n.Log.verbose(3,"Video tag not ready, will retry to set StartTime to "+t),setTimeout(u,i._setCurrentTimeTimeoutInMSec)))}var r=this;u()},i.prototype.addAdapterBuffer=function(i,r){function o(){e._updateBuffered()}if(this._disposed)return null;var e=this,u,f=null;try{u=this._mediaSource.addSourceBuffer(i);f=new t.VideoElementAdapterBuffer(r,this._videoTag,u,o);this._adapterSourceBuffers.add(f,u);n.Log.verbose(3,"Adapter buffer added: "+i+" Adapter buffer total: "+this._adapterSourceBuffers.length)}catch(s){n.Log.error(3,"Failed to add SourceBuffer to MediaSource: "+s)}return f},i.prototype.removeAdapterBuffer=function(t){if(!this._disposed){var i;i=this._adapterSourceBuffers.find(t);-1!==i?(this._mediaSource.removeSourceBuffer(this._adapterSourceBuffers.sourceBuffers[i]),this._adapterSourceBuffers.remove(i),n.Log.verbose(3,"Adapter buffer removed, remaining: "+this._adapterSourceBuffers.length)):n.Log.error(3,"Failed to remove adapter buffer: instance not found")}},i.prototype.endOfStream=function(t){this._disposed||(t?this._mediaSource.endOfStream(t):this._mediaSource.endOfStream(),n.Log.verbose(3,"End of stream signaled"))},i.prototype._updateBuffered=function(){var t,f,u,o,i;if(!this._disposed){var s=this._adapterSourceBuffers.adapterBuffers,h=new n.Common.TimeRangeSet,r=this._findUniqueStartTimes();for(t=0;t<r.length;t++){var c=r[t].startTime,e=r[t].endTime,l=!0;for(f=0;f<s.length;f++)if(u=s[f].buffered,f!==r[t].bufferIndex){for(o=!1,i=0;i<u.length;i++)if(u.start(i)<=c&&c<=u.end(i)){o=!0;u.end(i)<e&&(e=u.end(i));break}if(!o){l=!1;break}}l&&(n.Log.verbose(3,"Intersecting buffer found ("+r[t].startTime+", "+e+")"),h.addRange(new n.Common.TimeRange(r[t].startTime,e)))}this._buffered=h}},i.prototype._findUniqueStartTimes=function(){for(var t,n,i=[],u=this._adapterSourceBuffers.adapterBuffers,r=0;r<u.length;r++)for(t=u[r].buffered,n=0;n<t.length;n++)-1===i.findIndexOf(function(i){return i.startTime===t.start(n)})&&i.push(new f(r,t.start(n),t.end(n)));return i.sort(function(n,t){return n.startTime-t.startTime}),i},i._setCurrentTimeTimeoutInMSec=500,i}(),o=function(){function n(){this.adapterBuffers=[];this.sourceBuffers=[]}return n.prototype.dispose=function(){for(var n=this.adapterBuffers.length-1;n>=0;n--)this.adapterBuffers[n].dispose(),this.adapterBuffers[n]=null;for(n=this.sourceBuffers.length-1;n>=0;n--)this.sourceBuffers[n]=null},Object.defineProperty(n.prototype,"length",{get:function(){if(this.sourceBuffers.length!==this.adapterBuffers.length)throw new Error("AdapterSourceBuffers in invalid state");return this.sourceBuffers.length},enumerable:!0,configurable:!0}),n.prototype.find=function(n){return this.adapterBuffers.indexOf(n)},n.prototype.add=function(n,t){this.adapterBuffers.push(n);this.sourceBuffers.push(t)},n.prototype.remove=function(n){n>=0&&n<this.sourceBuffers.length&&(this.sourceBuffers.splice(n,1),this.adapterBuffers.splice(n,1))},n}()})(n.VideoElementAdapter||(n.VideoElementAdapter={}));var t=n.VideoElementAdapter}(AzureHtml5JS||(AzureHtml5JS={})),function(n){(function(t){"use strict";var i=function(){function t(t,i,r,u){function o(){n.Log.verbose(3,"SourceBuffer 'update' event completed.");e()}function s(){n.Log.error(3,"SourceBuffer append failed with 'error' event.");e()}function e(){f._notifyBufferUpdated();f._tryInternalRemove();f._tryInternalAppend()}var f=this;this._pendingBufferRanges=new n.Common.TimeRangeSet;this._sourceBuffer=r;this._maxAdapterBufferInSec=t;this._videoTag=i;this._notifyBufferUpdated=u;this._pendingBuffer=[];this._pendingRemove=[];this._sourceBuffer.addEventListener("update",o);this._sourceBuffer.addEventListener("error",s)}return Object.defineProperty(t.prototype,"buffered",{get:function(){var t=new n.Common.TimeRangeSet,e,u,i,f,r;for(t.addRanges(this._sourceBuffer.buffered),u=t.length>0?t.end(t.length-1):NaN,i=0;i<this._pendingBufferRanges.length;i++)f=this._pendingBufferRanges.start(i),r=this._pendingBufferRanges.end(i),n.Common.diffTimes(f,u)===0?t.extendLast(r):(e=new n.Common.TimeRange(f,r),t.addRange(e)),u=r;return t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"presentationTimeOffsetInSec",{get:function(){return this._sourceBuffer.timestampOffset},set:function(n){this._sourceBuffer.timestampOffset=n},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"audioTracks",{get:function(){return this._sourceBuffer.audioTracks},enumerable:!0,configurable:!0}),t.prototype.getBufferedAheadOfCurrentTimeInSec=function(){var t=this.buffered,i=this._videoTag.currentTime,n;for(t.removeGaps(.3),n=0;n<t.length;n++)if(t.start(n)<=i&&i<=t.end(n))return t.end(n)-i;return-1},t.prototype.bufferFull=function(){return this.getBufferedAheadOfCurrentTimeInSec()>this._maxAdapterBufferInSec},t.prototype.dispose=function(){for(var n=this._pendingBuffer.length-1;n>=0;n--)this._pendingBuffer[n]=null;for(this._sourceBuffer=null,n=this._pendingRemove.length-1;n>=0;n--)this._pendingRemove[n]=null;this._pendingBufferRanges&&(this._pendingBufferRanges.dispose(),this._pendingBufferRanges=null)},t.prototype.append=function(t,i,r){for(var s,f,e,o,u=0;u<this._pendingBuffer.length;u++)if(i<this._pendingBuffer[u].presTimeInSec)break;if(u>0&&(f=this._pendingBuffer[u-1],o=n.Common.diffTimes(i,f.presTimeInSec+f.durationInSec),o>0))throw new Error("append ("+i+","+r+") failed, overlaps with ("+f.presTimeInSec+","+f.durationInSec+")");if(u<this._pendingBuffer.length&&(e=this._pendingBuffer[u],o=n.Common.diffTimes(e.presTimeInSec,i+r),o>0))throw new Error("append ("+i+","+r+") failed, overlaps with ("+e.presTimeInSec+","+e.durationInSec+")");s=new n.Common.SegmentData(t,i,r);this._pendingBuffer.splice(u,0,s);this._updatePendingRanges();n.Log.verbose(3,"Appending segment: "+i+" sec "+t.byteLength+" bytes");this._tryInternalAppend();this._notifyBufferUpdated()},t.prototype.remove=function(t,i){var r;r=new n.Common.TimeRange(t,i);this._pendingRemove.push(r);n.Log.verbose(3,"Added to remove pending list ["+t+","+i+")");this._tryInternalRemove()},t.prototype.flush=function(){var i=this._sourceBuffer.buffered,n,t,r;if(this._sourceBuffer.updating&&this._sourceBuffer.abort(),n=0,t=0,i.length>0&&(n=i.start(0)),this._pendingBuffer.length>0&&(n=Math.min(n,this._pendingBuffer[0].presTimeInSec)),this._pendingBuffer.length>0&&(r=this._pendingBuffer[this._pendingBuffer.length-1],t=r.presTimeInSec+r.durationInSec),i.length>0&&(t=Math.max(t,i.end(i.length-1))),t>n)this.remove(n,t);else if(0!==n||0!==t)throw new Error("flush failed, endTime ("+t+") not greater than startime ("+n+")");},t.prototype._tryInternalAppend=function(){if(this._pendingBuffer&&this._sourceBuffer&&0!==this._pendingBuffer.length&&!this._sourceBuffer.updating)try{this._sourceBuffer.appendBuffer(this._pendingBuffer[0].data);n.Log.verbose(3,"Appended segment to SourceBuffer: "+this._pendingBuffer[0].presTimeInSec+" sec "+this._pendingBuffer[0].data.byteLength+" bytes");this._pendingBuffer.splice(0,1);this._updatePendingRanges()}catch(t){switch(t.code){case DOMException.INVALID_STATE_ERR:case DOMException.QUOTA_EXCEEDED_ERR:n.Log.error(3,"Failed to append segment to SourceBuffer, will retry: "+t);break;default:n.Log.error(3,"Failed to append segment to SourceBuffer: "+t);throw t;}}},t.prototype._tryInternalRemove=function(){var t,i,f,r,e;if(this._pendingBuffer&&this._sourceBuffer&&this._pendingRemove)while(0!==this._pendingRemove.length&&!this._sourceBuffer.updating){for(t=this._pendingRemove[0],i=this._pendingBuffer.length-1;i>=0;i--)if(f=this._pendingBuffer[i],r=f.presTimeInSec,e=f.durationInSec,r>=t.startInSec&&r<t.endInSec)if(r+e<=t.endInSec)this._pendingBuffer.splice(i,1),this._updatePendingRanges(),this._notifyBufferUpdated(),n.Log.verbose(3,"Segment removed: "+t.startInSec);else throw new Error("Failed to remove pending segment, range ends mid-segment");try{this._sourceBuffer.remove(t.startInSec,t.endInSec);this._pendingRemove.splice(0,1);n.Log.verbose(3,"Removing range from SourceBuffer: ["+t.startInSec+","+t.endInSec+")")}catch(u){switch(u.code){case DOMException.INVALID_ACCESS_ERR:case DOMException.INVALID_STATE_ERR:n.Log.error(3,"Failed to remove segment from SourceBuffer, will retry: "+u);break;default:n.Log.error(3,"Failed to remove segment from SourceBuffer: "+u);throw u;}}}},t.prototype._updatePendingRanges=function(){var t=this,i,r=NaN;this._pendingBufferRanges&&(this._pendingBufferRanges.dispose(),this._pendingBufferRanges=null);this._pendingBufferRanges=new n.Common.TimeRangeSet;this._pendingBuffer.forEach(function(u){n.Common.diffTimes(u.presTimeInSec,r)===0?t._pendingBufferRanges.extendLast(u.endTimestampInSec):(i=new n.Common.TimeRange(u.presTimeInSec,u.endTimestampInSec),t._pendingBufferRanges.addRange(i));r=u.endTimestampInSec})},t}();t.VideoElementAdapterBuffer=i})(n.VideoElementAdapter||(n.VideoElementAdapter={}));var t=n.VideoElementAdapter}(AzureHtml5JS||(AzureHtml5JS={})),function(n){(function(t){"use strict";function i(n){return new r(n)}t.CreateCoordinator=i;var r=function(){function i(n){this._sessionContext=n;this._workflowSeq=t.CreateSequencer(this._sessionContext);this._mediaSource=null;this._pendingPresentation=new Date;this._disposed=!1;this._pendingPlay=!0;this._pendingTryMediaRequestCount=0;this._prerollMet=!1;this._error=null}return i.prototype.dispose=function(){this._disposed||(this._disposed=!0,this._sessionContext=null,this._pendingPresentation=null,this._mediaSource&&(this._mediaSource.dispose(),this._mediaSource=null),this._workflowSeq&&(this._workflowSeq.dispose(),this._workflowSeq=null))},Object.defineProperty(i.prototype,"src",{get:function(){return this._sessionContext.presentationUrl},set:function(t){function r(t){function u(){i._disposed||(r.periods[0].streams.forEach(function(r){if(r.streamingInfo.selected){if(r.streamingInfo.sourceBuffer=i._mediaSource.addAdapterBuffer(r.codec,t.sessionContext.maxBufferInSec()),null==r.streamingInfo.sourceBuffer)throw new Error("presentationWorkflowResolved: Failed to create source buffer for stream "+n.Presentation.StreamType[r.type]);r.streamingInfo.sourceBuffer.presentationTimeOffsetInSec=r.presentationTimeOffsetInSec}}),i._updateStartPosition(),i._updateDuration(),i._registerVideoTagEvents(),i._checkMediaWorkflow(),t.dispose())}function f(n){throw new Error(n);}if(!i._disposed){var r=null;if(n.Log.verbose(1,"presentationWorkflowResolved"),null===t.sessionContext.commonPresentation)throw new Error("presentationWorkflowResolved: unexpected null values");r=t.sessionContext.commonPresentation;i._sessionContext.emeManager.setCodec("video/mp4");i._mediaSource=n.VideoElementAdapter.CreateAdapter();i._mediaSource.setVideoElementSrcAsync(t.sessionContext.videoTag).then(u,f).catch(function(t){i._sessionContext.eventMgr.dispatchEvent(n.InternalEventName.exception,t)})}}function u(t){i._disposed||(n.Log.error(1,"presentationWorkflowRejected:  module: "+t.currentModuleId),t.externalFailure&&n.Failure.isExternalError(t.externalFailure.code)&&(i._error=new n.Failure.External(t.externalFailure.code,t.externalFailure.message),n.Log.error(1,"Dispatching error: "+i.error.toString()),t.sessionContext.eventMgr.dispatchEvent(n.EventName.error)),t.dispose())}n.Log.verbose(1,"src("+t+")");var i=this;this._sessionContext.presentationUrl=t;this._presentationWorkflowAsync(r,u)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"currentTime",{get:function(){var t=this._sessionContext.videoTag,n=0;return this._sessionContext.commonPresentation&&(n=this._fromPresentationTime(t.currentTime)),n},set:function(t){var r;n.Log.verbose(1,"currentTime("+t.toFixed(3)+")");var i=this._sessionContext,u=i.commonPresentation.periods[0].streams,f=!1,e=0,o=0;for(i.commonPresentation.isLive&&(e=i.liveStartBufferInSec(),o=i.heuristicSettings.buffer.leftEdgeBackoffInSec),t=Math.max(t,o),t=Math.min(t,this.duration-e),t=this._toPresentationTime(t),n.Log.verbose(1,"seeking from presentation time "+i.videoTag.currentTime.toFixed(3)+" to "+t.toFixed(3)),i.videoTag.currentTime=t,n.Common.diffTimes(i.videoTag.currentTime,t)&&n.Log.verbose(1,"set currentTime failed to update videoTag: requested="+t+", actual="+i.videoTag.currentTime),r=0;r<u.length;r++)u[r].streamingInfo.selected&&-1===u[r].streamingInfo.sourceBuffer.getBufferedAheadOfCurrentTimeInSec()&&(u[r].streamingInfo.pendingSeekPositionInSec=t,u[r].streamingInfo.sourceBuffer.flush(),f=!0,2===u[r].streamingInfo.workflowState&&(u[r].streamingInfo.workflowState=0));this._checkMediaWorkflow();f||this._buffersAbovePreroll()||this._endOfSelectedStreams()||(f=!0);f&&(i.videoTag.paused||(this._pendingPlay=!0,i.videoTag.pause()))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"autoplay",{set:function(t){n.Log.verbose(1,"autoplay("+t+")");this._pendingPlay=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"duration",{get:function(){var t=this._sessionContext,i=t.commonPresentation,r=Infinity,n;return i&&(n=i.playableWindow,r=n.endInSec-n.startInSec),Math.min(t.videoTag.duration,r)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"buffered",{get:function(){var t=null,i;return this._mediaSource&&(i=this._sessionContext.commonPresentation.playableWindow,t=new n.Common.TimeRangeSet,t.addRanges(this._mediaSource.buffered),t.rebase(i.startInSec)),t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"error",{get:function(){return this._error},enumerable:!0,configurable:!0}),i.prototype.play=function(){n.Log.verbose(1,"play()");this._buffersAbovePreroll()||this._endOfSelectedStreams()?this._startPlayback():this._pendingPlay=!0},i.prototype.pause=function(){n.Log.verbose(1,"pause()");this._pendingPlay&&(this._pendingPlay=!1);this._sessionContext.videoTag.pause()},i.prototype._presentationWorkflowAsync=function(t,i){function u(){r._disposed||(!r._sessionContext.commonPresentation||r._sessionContext.commonPresentation.isLive)&&r._workflowSeq.presentationRequestAsync().then(f,e).catch(function(t){r._sessionContext.eventMgr.dispatchEvent(n.InternalEventName.exception,t)})}function f(f){var e,o,s;if(r._disposed){i&&i(f);return}if(n.Log.verbose(1,"presentationRequestResolved"),e=f.sessionContext.commonPresentation,null===e)throw new Error("presentationRequestResolved: unexpected null values");r._updateDuration();o=new Date;e.isLive&&e.minimumUpdatePeriodInSec>0&&r._pendingPresentation<=o&&(s=Math.max(1e3,e.minimumUpdatePeriodInSec*1e3),r._pendingPresentation.setTime(o.getTime()+s),setTimeout(u,s));t&&(t(f),t=null)}function e(t){r._disposed||n.Log.error(1,"presentationRequestRejected:  module: "+t.currentModuleId);i&&i(t)}var r=this;setTimeout(u,0)},i.prototype._checkMediaWorkflow=function(){function u(){var c,h,s,o;if(!t._disposed){for(n.Log.verbose(1,"_doCheckMediaWorkflow"),c=[],t._pendingTryMediaRequestCount--,r.videoTag.paused||t._endOfSelectedStreams()||!t._buffersNearEmpty()?t._buffersAbovePreroll()&&(t._dispatchCanPlayThroughEvent(),t._pendingPlay&&t._startPlayback()):(r.eventMgr.dispatchEvent(n.EventName.waiting),t._pendingPlay=!0,r.videoTag.pause()),h=!1,s=0;s<r.commonPresentation.periods[0].streams.length;s++)o=r.commonPresentation.periods[0].streams[s],o.streamingInfo.selected&&0===o.streamingInfo.workflowState&&(t._isBufferAheadOtherStreams(o)||o.streamingInfo.sourceBuffer.bufferFull()||t._buffersAtLiveEdge(o)?h=!0:(n.Log.verbose(1,"starting media workflow "+n.Presentation.StreamType[o.type]),o.streamingInfo.workflowState=1,t._workflowSeq.mediaRequestAsync(o).then(f,e).catch(function(t){r.eventMgr.dispatchEvent(n.InternalEventName.exception,t)})));h&&0===t._pendingTryMediaRequestCount&&(n.Log.verbose(1,"_doCheckMediaWorkflow: schedule try again"),t._pendingTryMediaRequestCount++,setTimeout(u,i._mediaSegmentTimeoutInMSec))}}function f(i){var u,r,f;if(!t._disposed){for(u=i.requestedStream,u.streamingInfo.workflowState=0,1===i.state&&null===u.streamingInfo.pendingSeekPositionInSec&&(n.Log.verbose(1,"mediaRequestResolved: "+n.Presentation.StreamType[u.type]+" end of stream"),u.streamingInfo.workflowState=2,t._endOfSelectedStreams()&&(n.Log.verbose(1,"End of selected streams"),t._mediaSource.endOfStream(),t._dispatchCanPlayThroughEvent(),t._pendingPlay&&t._startPlayback())),r=0;r<i.urlsToRetrieve.length;r++){if(null===i.urlsToRetrieve[r].mediaData)throw new Error("mediaRequestResolved: data is null url: "+i.urlsToRetrieve[r].url);null===u.streamingInfo.pendingSeekPositionInSec?(f=i.urlsToRetrieve[r].presTimeInSec+i.urlsToRetrieve[r].durationInSec,n.Log.verbose(1,"mediaRequestResolved appending url: "+i.urlsToRetrieve[r].url+"("+i.urlsToRetrieve[r].httpResposeContentType+", "+i.urlsToRetrieve[r].mediaData.byteLength+" bytes, "+f+" secs)"),u.streamingInfo.sourceBuffer.append(i.urlsToRetrieve[r].mediaData,i.urlsToRetrieve[r].presTimeInSec,i.urlsToRetrieve[r].durationInSec)):n.Log.verbose(1,"mediaRequestResolved discarding, seek in progress url: "+i.urlsToRetrieve[r].url+"("+i.urlsToRetrieve[r].httpResposeContentType+", "+i.urlsToRetrieve[r].mediaData.byteLength+")")}t._checkMediaWorkflow();i.dispose()}}function e(i){function f(i){if(!t._disposed){if(n.Log.verbose(1,"refreshPresentationWorkflowResolved"),null===i.sessionContext.commonPresentation)throw new Error("refreshPresentationWorkflowResolved: unexpected null values");u.streamingInfo.workflowState=0;t._checkMediaWorkflow()}}function e(i){t._disposed||(n.Log.error(1,"refreshPresentationWorkflowRejected:  module: "+i.currentModuleId),i.externalFailure&&n.Failure.isExternalError(i.externalFailure.code)&&(t._error=new n.Failure.External(i.externalFailure.code,i.externalFailure.message),n.Log.error(1,"Dispatching error: "+t.error.toString()),i.sessionContext.eventMgr.dispatchEvent(n.EventName.error)),i.dispose())}if(!t._disposed){var u=i.requestedStream;if(n.Log.error(1,"mediaRequestRejected: "+n.Presentation.StreamType[i.requestedStream.type]+" module: "+i.currentModuleId),i.externalFailure){if((2164261891===i.externalFailure.code||2164260865===i.externalFailure.code)&&i.sessionContext.commonPresentation.isLive&&0===i.sessionContext.commonPresentation.minimumUpdatePeriodInSec){t._presentationWorkflowAsync(f,e);return}n.Failure.isExternalError(i.externalFailure.code)&&(t._error=new n.Failure.External(i.externalFailure.code,i.externalFailure.message),n.Log.error(1,"Dispatching error: "+t.error.toString()),r.eventMgr.dispatchEvent(n.EventName.error))}i.dispose()}}var t=this,r=t._sessionContext;this._pendingTryMediaRequestCount++;setTimeout(u,0)},i.prototype._updateStartPosition=function(){var t=this._sessionContext,n=t.commonPresentation,r=t.liveStartBufferInSec(),i=Infinity;n&&isNaN(t.startPositionInSec)&&(i=n.isLive?Math.max(n.playableWindow.startInSec,n.playableWindow.endInSec-r):n.playableWindow.startInSec,0!==i&&(this._mediaSource.setStartTime(i),t.startPositionInSec=i))},i.prototype._updateDuration=function(){var n=this._sessionContext.commonPresentation,t;n&&this._mediaSource&&(t=n.isLive?Infinity:n.durationInSec,this._mediaSource.durationInSec!==t&&(this._mediaSource.durationInSec=t))},i.prototype._toPresentationTime=function(n){var t=this._sessionContext.commonPresentation.playableWindow.startInSec;return n+t},i.prototype._fromPresentationTime=function(n){var t=this._sessionContext.commonPresentation.playableWindow.startInSec;return n-t},i.prototype._endOfSelectedStreams=function(){var t,n;if(!this._sessionContext.commonPresentation)return!1;for(t=this._sessionContext.commonPresentation.periods[0].streams,n=0;n<t.length;n++)if(t[n].streamingInfo.selected&&2!==t[n].streamingInfo.workflowState)return!1;return!0},i.prototype._buffersAbovePreroll=function(){var i=!0,r=this._sessionContext.videoTag,t,n;if(!this._sessionContext.commonPresentation)return!1;if(t=this._sessionContext.commonPresentation.periods[0].streams,r.readyState<r.HAVE_FUTURE_DATA)i=!1;else for(n=0;n<t.length;n++)if(t[n].streamingInfo.selected&&t[n].streamingInfo.sourceBuffer.getBufferedAheadOfCurrentTimeInSec()<this._sessionContext.prerollBufferInSec()){i=!1;break}return i},i.prototype._buffersNearEmpty=function(){for(var t=this._sessionContext.commonPresentation.periods[0].streams,n=0;n<t.length;n++)if(t[n].streamingInfo.selected&&t[n].streamingInfo.sourceBuffer.getBufferedAheadOfCurrentTimeInSec()<this._sessionContext.lowBufferInSec())return!0;return!1},i.prototype._isBufferAheadOtherStreams=function(n){for(var t,e=0,f=Infinity,o=null,u=this._sessionContext.commonPresentation.periods[0].streams,r=0;r<u.length;r++)u[r].streamingInfo.selected&&n.type!==2&&(e++,t=u[r].streamingInfo.sourceBuffer.buffered,t.length>0&&t.end(t.length-1)<f&&(f=t.end(t.length-1),o=u[r]));return(t=n.streamingInfo.sourceBuffer.buffered,1===e||o===n||t.length===0)?!1:t.end(t.length-1)-f>i._bufferTooFarAheadInSec},i.prototype._buffersAtLiveEdge=function(n){var t=this._sessionContext.commonPresentation,i,r,u;return n.streamingInfo.currentSegment?(i=n.streamingInfo.currentSegment.segmentInfo,r=i.presTimeInSec+i.durationInSec,u=t.playableWindow.endInSec,t.isLive&&t.minimumUpdatePeriodInSec===0&&u<=r):!1},i.prototype._startPlayback=function(){this._pendingPlay=!1;this._sessionContext.videoTag.play()},i.prototype._dispatchCanPlayThroughEvent=function(){this._prerollMet||(n.Log.verbose(7,"dispatching event: canplaythrough"),this._prerollMet=!0,this._sessionContext.eventMgr.dispatchEvent(n.EventName.canplaythrough))},i.prototype._registerVideoTagEvents=function(){function i(){n._disposed||n._pendingPlay&&n._buffersAbovePreroll()&&n._startPlayback()}var n=this,t=n._sessionContext.videoTag;t.addEventListener("canplaythrough",i)},i._mediaSegmentTimeoutInMSec=2e3,i._bufferTooFarAheadInSec=4,i}()})(n.Workflow||(n.Workflow={}));var t=n.Workflow}(AzureHtml5JS||(AzureHtml5JS={}));__extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r},function(n){(function(t){"use strict";function r(){return new f}function u(){return new e}t.CreatePresentation=r;t.CreateMedia=u;var i=function(){function t(t){this._eventManager=new n.Events.Manager;this._eventsOrdered=t;this._stepList=[]}return t.prototype.dispose=function(){this._eventManager.dispose();this._eventManager=null;this._eventsOrdered=null;this._stepList=null},t.prototype.addHandler=function(n,t,i){this._eventManager.addHandler(n,t,i)},t.prototype.createSteps=function(){var i=this,r=0,n,t;for(n in this._eventsOrdered)t=this._eventManager.getHandlers(this._eventsOrdered[n]),t.forEach(function(n){i._stepList[r++]=n})},Object.defineProperty(t.prototype,"stepList",{get:function(){return this._stepList},enumerable:!0,configurable:!0}),t}(),f=function(n){function t(){var t=[this.stepEvents.requestBegin,this.stepEvents.requestSend,this.stepEvents.dataRetrieved,this.stepEvents.requestEnd];n.call(this,t)}return __extends(t,n),Object.defineProperty(t.prototype,"stepEvents",{get:function(){return{requestBegin:"requestBegin",requestSend:"requestSend",dataRetrieved:"dataRetrieved",requestEnd:"requestEnd"}},enumerable:!0,configurable:!0}),t}(i),e=function(n){function t(){var t=[this.stepEvents.requestBegin,this.stepEvents.requestSend,this.stepEvents.dataRetrieved,this.stepEvents.requestEnd];n.call(this,t)}return __extends(t,n),Object.defineProperty(t.prototype,"stepEvents",{get:function(){return{requestBegin:"requestBegin",requestSend:"requestSend",dataRetrieved:"dataRetrieved",requestEnd:"requestEnd"}},enumerable:!0,configurable:!0}),t}(i)})(n.Workflow||(n.Workflow={}));var t=n.Workflow}(AzureHtml5JS||(AzureHtml5JS={})),function(n){(function(t){"use strict";function i(n){return new r(n)}t.CreateSequencer=i;var r=function(){function i(t){this._disposed=!1;this._sessionContext=t;this._orderedModules=[new n.DataRetriever.HttpRetryPolicy,new n.SegmentLocator.Dash,new n.Heuristics.InitialBandwidthDataUrlFormatter,new n.Heuristics.WindowSizeRule,new n.Heuristics.StepRule,new n.Heuristics.Engine,new n.UrlBuilder.DashUrlFormatter,new n.DataRetriever.HttpDataRetriever(t),new n.DashPresentation.Parser,new n.ContentProtection.PlayReady,new n.ContentProtection.AesHandler,new n.DashMediaSegment.Parser,new n.Presentation.InitialStreamSelector];this._createWorkflows(t)}return i.prototype.dispose=function(){this._disposed||(this._disposed=!0,this._orderedModules.forEach(function(n){n.dispose()}),this._orderedModules=null,this._sessionContext=null)},i.prototype.presentationRequestAsync=function(){var i=this,t=this;return new Promise(function(r,u){var f=new n.Context.Request(0,t._sessionContext);f.urlsToRetrieve.push(new n.Context.UrlRequest(t._sessionContext.presentationUrl,4));i._processSteps(f,r,u)})},i.prototype.mediaRequestAsync=function(t){var i=this;return new Promise(function(r,u){var f=new n.Context.Request(1,i._sessionContext);f.requestedStream=t;f.heuristicData=new n.Context.HeuristicData(t);i._processSteps(f,r,u)})},i.prototype._processSteps=function(t,i,r){function f(){if(e._disposed||t.disposed||t.sessionContext.disposed){r();return}if(u===t.sessionContext.workflows[t.workflowType].stepList.length){t.workflowType===1?n.Log.verbose(0,"Finished process steps for "+n.Presentation.StreamType[t.requestedStream.type]+" media workflow"):n.Log.verbose(0,"Finished process steps for presentation workflow");i(t);return}var f=t.sessionContext.workflows[t.workflowType].stepList[u],h=f.functionHandler.call(f.callerInstance,t);u++;h.then(o,s)}function o(){switch(t.state){case 0:setTimeout(f,0);break;case 2:u=0;setTimeout(f,t.retryWaitTimeMSec);t.reset();break;case 1:i(t);break;default:throw new Error("processSteps unexpected state"+t.state);}}function s(i){if(null===t.externalFailure){t.sessionContext.eventMgr.dispatchEvent(n.InternalEventName.exception,i);return}var u="stepRejected: "+t.externalFailure.toString();i&&(u+=i);n.Log.error(0,u);r(t)}var e=this,u;t.workflowType===1?n.Log.verbose(0,"Starting process steps for "+n.Presentation.StreamType[t.requestedStream.type]+" media workflow"):n.Log.verbose(0,"Starting process steps for presentation workflow");u=0;setTimeout(f,0)},i.prototype._createWorkflows=function(n){n.workflows=[t.CreatePresentation(),t.CreateMedia()];this._orderedModules.forEach(function(t){t.init(n)});this._sessionContext.workflows.forEach(function(n){n.createSteps()})},i}()})(n.Workflow||(n.Workflow={}));var t=n.Workflow}(AzureHtml5JS||(AzureHtml5JS={})),function(n){(function(t){"use strict";var i=function(){function t(){this.systemId=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.name="com.microsoft.playready";this._videoElement=null;this._errorHandler=null;this._session=null;this._active=!1;this._authenticationToken=""}return t.prototype.isSupported=function(t,i){return t.isEqual(this.systemId)?n.EmeUtil.isTypeSupported(this.name,i):!1},t.prototype.activate=function(n,t,i){this._videoElement=n;this._errorHandler=t;this._authenticationToken=i;this._active=!0},t.prototype.deactivate=function(){this._active&&(this._active=!1,this._session&&(n.EmeUtil.unlistenToKeyMessage(this._session,this._keyMessageHandler),n.EmeUtil.unlistenKeyError(this._session,this._keyErrorHandler),this._session.close(),this._session=null),this._videoElement=null,this._errorHandler=null,this._authenticationToken="")},t.prototype.initData=function(t,i){function e(n){f._keyMessageHandler(n)}function o(){f._keyErrorHandler()}var f=this,r,u;if(!this._session){if(r=n.EmeUtil.createMediaKeys(this.name),!r){n.Log.error(12,this.name+" createMediaKeys failed");u=new n.Failure.External(2164261376,this.name+" createMediaKeys failed");this._reportError(u);return}if(n.EmeUtil.setMediaKeys(this._videoElement,r),this._session=r.createSession(i,t),!this._session){n.Log.error(12,this.name+" createSession failed");u=new n.Failure.External(2164261376,this.name+" createSession failed");this._reportError(u);return}n.EmeUtil.listenToKeyMessage(this._session,e);n.EmeUtil.listenKeyError(this._session,o)}},t.prototype._keyMessageHandler=function(n){var t=this,i=new Uint16Array(n.message.buffer),r=String.fromCharCode.apply(null,i),u=n.destinationURL;this._getPlayReadyLicense(r,u).then(function(n){t._active&&t._session&&t._session.update(n)},function(n){t._active&&t._reportError(n)})},t.prototype._keyErrorHandler=function(){if(this._active&&this._session.error){var n=t._translateMediaKeyError(this._session.error);this._reportError(n)}},t.prototype._getPlayReadyLicense=function(t,i){var r=this;return new Promise(function(u,f){var a=null,h=[],v=new DOMParser,s=v.parseFromString(t,"application/xml"),c,o,l,e;if(s.getElementsByTagName("Challenge")[0])c=s.getElementsByTagName("Challenge")[0].childNodes[0].nodeValue,c&&(a=atob(c));else{n.Log.error(12,"Playready: Can not find Challenge in keyMessage");f(new n.Failure.External(2164261377,"No challenge"));return}if(o=s.getElementsByTagName("name"),l=s.getElementsByTagName("value"),o.length!=l.length){n.Log.error(12,"Playready update, invalid header name/value pair in keyMessage");f(new n.Failure.External(2164261377,"Invalid headers"));return}for(e=0;e<o.length;e++)h[e]={name:o[e].childNodes[0].nodeValue,value:l[e].childNodes[0].nodeValue};r._authenticationToken&&r._authenticationToken.length>0&&(h[o.length]={name:n.HttpUtil.authorizationHeader,value:r._authenticationToken});n.HttpUtil.httpRequest(i,"POST","arraybuffer",h,a).then(function(n){u(new Uint8Array(n))},function(t){var i=new n.Failure.External(2164261377,"0x"+n.Common.toHexString(t));f(i)})})},t.prototype._reportError=function(n){this._errorHandler&&this._errorHandler(n)},t._translateMediaKeyError=function(t){var i;switch(t.code){case MSMediaKeyError.MS_MEDIA_KEYERR_SERVICE:i=2164261378;break;case MSMediaKeyError.MS_MEDIA_KEYERR_HARDWARECHANGE:i=2164261379;break;case MSMediaKeyError.MS_MEDIA_KEYERR_OUTPUT:i=2164261380;break;case MSMediaKeyError.MS_MEDIA_KEYERR_DOMAIN:i=2164261381;break;case MSMediaKeyError.MS_MEDIA_KEYERR_UNKNOWN:i=2164261382;break;case MSMediaKeyError.MS_MEDIA_KEYERR_CLIENT:i=2164261383;break;default:i=2164261382}return new n.Failure.External(i,"0x"+n.Common.toHexString(t.systemCode))},t}();t.PlayReady=i})(n.KeySystem||(n.KeySystem={}));var t=n.KeySystem}(AzureHtml5JS||(AzureHtml5JS={})),function(n){(function(t){"use strict";var i=function(){function i(i){function f(n){u._needKeyHandler(n)}var u=this,r;this._videoElement=i;this._errorHandler=null;this.matchedKeySystem=null;this._codec=null;this._psshBoxes=[];this._keySystems={};this._authenticationToken="";this._disposed=!1;r=new t.PlayReady;this.addKeySystem(r);n.EmeUtil.listenToNeedKey(i,f)}return i.prototype.reset=function(){this.matchedKeySystem&&(this.matchedKeySystem.deactivate(),this.matchedKeySystem=null);this._psshBoxes=[];this._errorHandler=null;this._codec=null;this._authenticationToken=""},i.prototype.dispose=function(){this._disposed||(this._disposed=!0,this.matchedKeySystem&&(this.matchedKeySystem.deactivate(),this.matchedKeySystem=null),this._psshBoxes=[],this._keySystems={},this._videoElement=null,this._errorHandler=null,this._codec=null,this._authenticationToken=null)},i.prototype.setup=function(n,t){this._errorHandler=n;this._authenticationToken=t},i.prototype.setCodec=function(n){this._codec=n},i.prototype.addKeySystem=function(t){var i=n.Common.uint8ArrayToHexString(t.systemId);return i&&i.length>0?(this._keySystems[i]&&n.Log.warning(12,"Overwriting "+t.name),this._keySystems[i]=t,t):null},i.prototype.addPsshBoxes=function(n){var t=this;n.forEach(function(n){t._psshBoxes.push(n)})},i.prototype._needKeyHandler=function(t){var u,f,i,r,e,o;if(!this._disposed)if(t.initData&&(u=new DataView(t.initData.buffer),f=n.Mp4Util.GetPsshBoxes(u),this.addPsshBoxes(f)),i=this._findMatchedKeySystem(),i)for(r=0;r<this._psshBoxes.length;r++)this._psshBoxes[r].systemId.isEqual(i.systemId)&&(e=new Uint8Array(this._psshBoxes[r].serialize()),n.Log.verbose(12,"Sending initData to: "+i.name),i.initData(e,this._codec));else o=new n.Failure.External(2164261376,"no matching keySystem found"),this._errorHandler(o)},i.prototype._findMatchedKeySystem=function(){var t,i;if(!this.matchedKeySystem)for(t=0;t<this._psshBoxes.length;t++)if(i=n.Common.uint8ArrayToHexString(this._psshBoxes[t].systemId),this._keySystems[i]&&this._keySystems[i].isSupported(this._psshBoxes[t].systemId,this._codec)){this.matchedKeySystem=this._keySystems[i];this.matchedKeySystem.activate(this._videoElement,this._errorHandler,this._authenticationToken);n.Log.verbose(12,"Matched key system found: "+this.matchedKeySystem.name);break}return this.matchedKeySystem},i}();t.EmeManager=i})(n.KeySystem||(n.KeySystem={}));var t=n.KeySystem}(AzureHtml5JS||(AzureHtml5JS={})),function(n){"use strict";var t=function(){function n(){}return n.volumechange="volumechange",n.ended="ended",n.timeupdate="timeupdate",n.pause="pause",n.play="play",n.playing="playing",n.seeking="seeking",n.seeked="seeked",n.loadstart="loadstart",n.loadeddata="loadeddata",n.fullscreenchange="fullscreenchange",n.waiting="waiting",n.canplaythrough="canplaythrough",n.error="error",n}(),i;n.EventName=t,function(n){n[n.abortedErrStart=2164261120]="abortedErrStart";n[n.abortedErrUnknown=2164261120]="abortedErrUnknown";n[n.abortedErrNotImplemented=2164261121]="abortedErrNotImplemented";n[n.abortedErrEnd=2164261375]="abortedErrEnd";n[n.decodeErrStart=2164261376]="decodeErrStart";n[n.decryptErrKeySystemNotFound=2164261376]="decryptErrKeySystemNotFound";n[n.decryptErrKeyMessageFailed=2164261377]="decryptErrKeyMessageFailed";n[n.decryptErrKeyService=2164261378]="decryptErrKeyService";n[n.decryptErrKeyHardwareChange=2164261379]="decryptErrKeyHardwareChange";n[n.decryptErrKeyOutput=2164261380]="decryptErrKeyOutput";n[n.decryptErrKeyDomain=2164261381]="decryptErrKeyDomain";n[n.decryptErrKeyUnknown=2164261382]="decryptErrKeyUnknown";n[n.decryptErrKeyClient=2164261383]="decryptErrKeyClient";n[n.decryptErrKeyDownload=2164261384]="decryptErrKeyDownload";n[n.decryptErrNotSupported=2164261385]="decryptErrNotSupported";n[n.decryptErrKeyOperation=2164261386]="decryptErrKeyOperation";n[n.decryptErrCryptoOperation=2164261387]="decryptErrCryptoOperation";n[n.decodeErrEnd=2164261631]="decodeErrEnd";n[n.srcErrStart=2164261632]="srcErrStart";n[n.srcErrParsePresentation=2164261632]="srcErrParsePresentation";n[n.srcErrParseSegment=2164261633]="srcErrParseSegment";n[n.srcErrUnsupportedPresentation=2164261634]="srcErrUnsupportedPresentation";n[n.srcErrUnsupportedSegment=2164261635]="srcErrUnsupportedSegment";n[n.srcErrInvalidPresentation=2164261636]="srcErrInvalidPresentation";n[n.srcErrInvalidSegment=2164261637]="srcErrInvalidSegment";n[n.srcErrEnd=2164261887]="srcErrEnd";n[n.networkErrStart=2164261888]="networkErrStart";n[n.networkErrHttpBadUrlFormat=2164261888]="networkErrHttpBadUrlFormat";n[n.networkErrHttpUserAuthRequired=2164261889]="networkErrHttpUserAuthRequired";n[n.networkErrHttpUserForbidden=2164261890]="networkErrHttpUserForbidden";n[n.networkErrHttpUrlNotFound=2164261891]="networkErrHttpUrlNotFound";n[n.networkErrHttpPreconditionFailed=2164261892]="networkErrHttpPreconditionFailed";n[n.networkErrHttpInternalServerFailure=2164261893]="networkErrHttpInternalServerFailure";n[n.networkErrHttpBadGateway=2164261894]="networkErrHttpBadGateway";n[n.networkErrHttpServiceUnavailable=2164261895]="networkErrHttpServiceUnavailable";n[n.networkErrHttpGatewayTimeout=2164261896]="networkErrHttpGatewayTimeout";n[n.networkErrHttpUnknown=2164262088]="networkErrHttpUnknown";n[n.networkErrTimeout=2164262089]="networkErrTimeout";n[n.networkErrUnknown=2164262090]="networkErrUnknown";n[n.networkErrEnd=2164262143]="networkErrEnd"}(n.ExtendedCode||(n.ExtendedCode={}));i=n.ExtendedCode}(AzureHtml5JS||(AzureHtml5JS={})),function(n){(function(n){"use strict";var t,i;(function(n){n[n.video=0]="video";n[n.audio=1]="audio";n[n.text=2]="text"})(n.StreamType||(n.StreamType={}));t=n.StreamType,function(n){n[n.playReadySpecificData=0]="playReadySpecificData";n[n.seaEncryptionSystemId=1]="seaEncryptionSystemId";n[n.seaKeyUri=2]="seaKeyUri";n[n.seaIV=3]="seaIV"}(n.ContentProtectionDataType||(n.ContentProtectionDataType={}));i=n.ContentProtectionDataType})(n.Presentation||(n.Presentation={}));var t=n.Presentation}(AzureHtml5JS||(AzureHtml5JS={})),function(n){(function(n){"use strict";(function(n){n[n.closed=0]="closed";n[n.open=1]="open";n[n.ended=2]="ended"})(n.ReadyState||(n.ReadyState={}));var t=n.ReadyState})(n.VideoElementAdapter||(n.VideoElementAdapter={}));var t=n.VideoElementAdapter}(AzureHtml5JS||(AzureHtml5JS={})),function(n){(function(n){"use strict";(function(n){n[n.presentation=0]="presentation";n[n.media=1]="media";n[n.max=2]="max"})(n.Type||(n.Type={}));var t=n.Type})(n.Workflow||(n.Workflow={}));var t=n.Workflow}(AzureHtml5JS||(AzureHtml5JS={}));Dash=function(){"use strict";return{modules:{},dependencies:{},vo:{},di:{}}}();Dash.dependencies.DashParser=function(){"use strict";var u=31536e3,f=2592e3,e=86400,o=3600,n=60,s=60,t=1e3,i=/^P(([\d.]*)Y)?(([\d.]*)M)?(([\d.]*)D)?T?(([\d.]*)H)?(([\d.]*)M)?(([\d.]*)S)?/,r=/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2})(?::([0-9]*)(\.[0-9]*)?)?(?:([+-])([0-9]{2})([0-9]{2}))?/,h=/^[-+]?[0-9]+[.]?[0-9]*([eE][-+]?[0-9]+)?$/,c=[{type:"duration",test:function(n){return i.test(n)},converter:function(t){var r=i.exec(t);return parseFloat(r[2]||0)*u+parseFloat(r[4]||0)*f+parseFloat(r[6]||0)*e+parseFloat(r[8]||0)*o+parseFloat(r[10]||0)*n+parseFloat(r[12]||0)}},{type:"datetime",test:function(n){return r.test(n)},converter:function(i){var u=r.exec(i),f,e;return f=Date.UTC(parseInt(u[1],10),parseInt(u[2],10)-1,parseInt(u[3],10),parseInt(u[4],10),parseInt(u[5],10),u[6]&&parseInt(u[6],10)||0,u[7]&&parseFloat(u[7])*t||0),u[9]&&u[10]&&(e=parseInt(u[9],10)*s+parseInt(u[10],10),f+=(u[8]==="+"?-1:1)*e*n*t),new Date(f)}},{type:"numeric",test:function(n){return h.test(n)},converter:function(n){return parseFloat(n)}}],l=function(){var n,t,i,r;return r=[{name:"profiles",merge:!1},{name:"width",merge:!1},{name:"height",merge:!1},{name:"sar",merge:!1},{name:"frameRate",merge:!1},{name:"audioSamplingRate",merge:!1},{name:"mimeType",merge:!1},{name:"segmentProfiles",merge:!1},{name:"codecs",merge:!1},{name:"maximumSAPPeriod",merge:!1},{name:"startsWithSap",merge:!1},{name:"maxPlayoutRate",merge:!1},{name:"codingDependency",merge:!1},{name:"scanType",merge:!1},{name:"FramePacking",merge:!0},{name:"AudioChannelConfiguration",merge:!0},{name:"ContentProtection",merge:!0}],n={},n.name="AdaptationSet",n.isRoot=!1,n.isArray=!0,n.parent=null,n.children=[],n.properties=r,t={},t.name="Representation",t.isRoot=!1,t.isArray=!0,t.parent=n,t.children=[],t.properties=r,n.children.push(t),i={},i.name="SubRepresentation",i.isRoot=!1,i.isArray=!0,i.parent=t,i.children=[],i.properties=r,t.children.push(i),n},a=function(){var n,t,i,r;return r=[{name:"SegmentBase",merge:!0},{name:"SegmentTemplate",merge:!0},{name:"SegmentList",merge:!0}],n={},n.name="Period",n.isRoot=!1,n.isArray=!0,n.parent=null,n.children=[],n.properties=r,t={},t.name="AdaptationSet",t.isRoot=!1,t.isArray=!0,t.parent=n,t.children=[],t.properties=r,n.children.push(t),i={},i.name="Representation",i.isRoot=!1,i.isArray=!0,i.parent=t,i.children=[],i.properties=r,t.children.push(i),n},v=function(){var i,n,t,r,u;return u=[{name:"BaseURL",merge:!0,mergeFunction:function(n,t){return t.indexOf("http://")===0?t:n+t}}],i={},i.name="mpd",i.isRoot=!0,i.isArray=!0,i.parent=null,i.children=[],i.properties=u,n={},n.name="Period",n.isRoot=!1,n.isArray=!0,n.parent=null,n.children=[],n.properties=u,i.children.push(n),t={},t.name="AdaptationSet",t.isRoot=!1,t.isArray=!0,t.parent=n,t.children=[],t.properties=u,n.children.push(t),r={},r.name="Representation",r.isRoot=!1,r.isArray=!0,r.parent=t,r.children=[],r.properties=u,t.children.push(r),i},y=function(){var n=[];return n.push(l()),n.push(a()),n.push(v()),n},p=function(n,t){var i,e=new X2JS(c,"",!0),o=new ObjectIron(y()),f=new Date,r=null,u=null;try{i=e.xml_str2json(n);r=new Date;i.hasOwnProperty("BaseURL")?(i.BaseURL=i.BaseURL_asArray[0],i.BaseURL.toString().indexOf("http")!==0&&(i.BaseURL=t+i.BaseURL)):i.BaseURL=t;o.run(i);u=new Date;this.debug.log("Parsing complete: ( xml2json: "+(r.getTime()-f.getTime())+"ms, objectiron: "+(u.getTime()-r.getTime())+"ms, total: "+(u.getTime()-f.getTime())/1e3+"s)")}catch(s){return this.errHandler.manifestError("parsing the manifest failed","parse",n),null}return i};return{debug:undefined,errHandler:undefined,parse:p}};Dash.dependencies.DashParser.prototype={constructor:Dash.dependencies.DashParser};!function(){var n,t,r,i;!function(){var u={},f={};n=function(n,t,i){u[n]={deps:t,callback:i}};i=r=t=function(n){function l(t){var i;if("."!==t.charAt(0))return t;for(var f=t.split("/"),r=n.split("/").slice(0,-1),u=0,e=f.length;e>u;u++)if(i=f[u],".."===i)r.pop();else{if("."===i)continue;r.push(i)}return r.join("/")}var c;if(i._eak_seen=u,f[n])return f[n];if(f[n]={},!u[n])throw new Error("Could not find module "+n);for(var s,h=u[n],e=h.deps,a=h.callback,o=[],r=0,v=e.length;v>r;r++)"exports"===e[r]?o.push(s={}):o.push(t(l(e[r])));return c=a.apply(this,o),f[n]=s||c}}();n("promise/all",["./utils","exports"],function(n,t){"use strict";function i(n){var t=this;if(!r(n))throw new TypeError("You must pass an array to all.");return new t(function(t,i){function h(n){return function(t){e(n,t)}}function e(n,i){o[n]=i;0==--s&&t(o)}var f,o=[],s=n.length,r;for(0===s&&t([]),r=0;r<n.length;r++)f=n[r],f&&u(f.then)?f.then(h(r),i):e(r,f)})}var r=n.isArray,u=n.isFunction;t.all=i});n("promise/asap",["exports"],function(n){"use strict";function e(){return function(){process.nextTick(i)}}function o(){var n=0,r=new f(i),t=document.createTextNode("");return r.observe(t,{characterData:!0}),function(){t.data=n=++n%2}}function s(){return function(){c.setTimeout(i,1)}}function i(){for(var n=0;n<t.length;n++){var i=t[n],r=i[0],u=i[1];r(u)}t=[]}function h(n,i){var u=t.push([n,i]);1===u&&r()}var r,u="undefined"!=typeof window?window:{},f=u.MutationObserver||u.WebKitMutationObserver,c="undefined"!=typeof global?global:void 0===this?window:this,t=[];r="undefined"!=typeof process&&"[object process]"==={}.toString.call(process)?e():f?o():s();n.asap=h});n("promise/config",["exports"],function(n){"use strict";function i(n,i){return 2!==arguments.length?t[n]:(t[n]=i,void 0)}var t={instrument:!1};n.config=t;n.configure=i});n("promise/polyfill",["./promise","./utils","exports"],function(n,t,i){"use strict";function r(){var n,t;n="undefined"!=typeof global?global:"undefined"!=typeof window&&window.document?window:self;t="Promise"in n&&"resolve"in n.Promise&&"reject"in n.Promise&&"all"in n.Promise&&"race"in n.Promise&&function(){var t;return new n.Promise(function(n){t=n}),f(t)}();t||(n.Promise=u)}var u=n.Promise,f=t.isFunction;i.polyfill=r});n("promise/promise",["./config","./utils","./all","./race","./resolve","./reject","./asap","exports"],function(n,t,i,r,u,f,e,o){"use strict";function s(n){if(!v(n))throw new TypeError("You must pass a resolver function as the first argument to the promise constructor");if(!(this instanceof s))throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");this._subscribers=[];nt(n,this)}function nt(n,t){function r(n){c(t,n)}function i(n){h(t,n)}try{n(r,i)}catch(u){i(u)}}function w(n,t,i,r){var u,e,f,o,s=v(i);if(s)try{u=i(r);f=!0}catch(l){o=!0;e=l}else u=r,f=!0;k(t,u)||(s&&f?c(t,u):o?h(t,e):n===y?c(t,u):n===p&&h(t,u))}function tt(n,t,i,r){var u=n._subscribers,f=u.length;u[f]=t;u[f+y]=i;u[f+p]=r}function b(n,t){for(var u,f,r=n._subscribers,e=n._detail,i=0;i<r.length;i+=3)u=r[i],f=r[i+t],w(t,u,f,e);n._subscribers=null}function k(n,t){var i,r=null;try{if(n===t)throw new TypeError("A promises callback cannot return that same promise.");if(ut(t)&&(r=t.then,v(r)))return r.call(t,function(r){return i?!0:(i=!0,t!==r?c(n,r):a(n,r),void 0)},function(t){return i?!0:(i=!0,h(n,t),void 0)}),!0}catch(u){return i?!0:(h(n,u),!0)}return!1}function c(n,t){n===t?a(n,t):k(n,t)||a(n,t)}function a(n,t){n._state===d&&(n._state=g,n._detail=t,l.async(it,n))}function h(n,t){n._state===d&&(n._state=g,n._detail=t,l.async(rt,n))}function it(n){b(n,n._state=y)}function rt(n){b(n,n._state=p)}var l=n.config,ut=(n.configure,t.objectOrFunction),v=t.isFunction,ft=(t.now,i.all),et=r.race,ot=u.resolve,st=f.reject,ht=e.asap;l.async=ht;var d=void 0,g=0,y=1,p=2;s.prototype={constructor:s,_state:void 0,_detail:void 0,_subscribers:void 0,then:function(n,t){var i=this,r=new this.constructor(function(){}),u;return this._state?(u=arguments,l.async(function(){w(i._state,r,u[i._state-1],i._detail)})):tt(this,r,n,t),r},"catch":function(n){return this.then(null,n)}};s.all=ft;s.race=et;s.resolve=ot;s.reject=st;o.Promise=s});n("promise/race",["./utils","exports"],function(n,t){"use strict";function i(n){var t=this;if(!r(n))throw new TypeError("You must pass an array to race.");return new t(function(t,i){for(var r,u=0;u<n.length;u++)r=n[u],r&&"function"==typeof r.then?r.then(t,i):t(r)})}var r=n.isArray;t.race=i});n("promise/reject",["exports"],function(n){"use strict";function t(n){var t=this;return new t(function(t,i){i(n)})}n.reject=t});n("promise/resolve",["exports"],function(n){"use strict";function t(n){if(n&&"object"==typeof n&&n.constructor===this)return n;var t=this;return new t(function(t){t(n)})}n.resolve=t});n("promise/utils",["exports"],function(n){"use strict";function i(n){return t(n)||"object"==typeof n&&null!==n}function t(n){return"function"==typeof n}function r(n){return"[object Array]"===Object.prototype.toString.call(n)}var u=Date.now||function(){return(new Date).getTime()};n.objectOrFunction=i;n.isFunction=t;n.isArray=r;n.now=u});t("promise/polyfill").polyfill()}();UTF8={};UTF8.encode=function(n){for(var t,i=[],r=0;r<n.length;++r)t=n.charCodeAt(r),t<128?i.push(t):t<2048?(i.push(192|t>>6),i.push(128|63&t)):t<65536?(i.push(224|t>>12),i.push(128|63&t>>6),i.push(128|63&t)):(i.push(240|t>>18),i.push(128|63&t>>12),i.push(128|63&t>>6),i.push(128|63&t));return i};UTF8.decode=function(n){for(var r=[],i=0,t;i<n.length;)t=n[i++],t<128||(t<224?t=(31&t)<<6|63&n[i++]:t<240?(t=(15&t)<<12,t|=(63&n[i++])<<6,t|=63&n[i++]):(t=(7&t)<<18,t|=(63&n[i++])<<12,t|=(63&n[i++])<<6,t|=63&n[i++])),r.push(String.fromCharCode(t));return r.join("")};BASE64={},function(n){var u=function(t){for(var u=0,i=[],f=0|t.length/3,r;0<f--;)r=(t[u]<<16)+(t[u+1]<<8)+t[u+2],u+=3,i.push(n.charAt(63&r>>18)),i.push(n.charAt(63&r>>12)),i.push(n.charAt(63&r>>6)),i.push(n.charAt(63&r));return 2==t.length-u?(r=(t[u]<<16)+(t[u+1]<<8),i.push(n.charAt(63&r>>18)),i.push(n.charAt(63&r>>12)),i.push(n.charAt(63&r>>6)),i.push("=")):1==t.length-u&&(r=t[u]<<16,i.push(n.charAt(63&r>>18)),i.push(n.charAt(63&r>>12)),i.push("==")),i.join("")},t=function(){for(var i=[],t=0;t<n.length;++t)i[n.charCodeAt(t)]=t;return i["=".charCodeAt(0)]=0,i}(),r=function(n){for(var r=0,i=[],f=0|n.length/4,u;0<f--;)u=(t[n.charCodeAt(r)]<<18)+(t[n.charCodeAt(r+1)]<<12)+(t[n.charCodeAt(r+2)]<<6)+t[n.charCodeAt(r+3)],i.push(255&u>>16),i.push(255&u>>8),i.push(255&u),r+=4;return i&&("="==n.charAt(r-2)?(i.pop(),i.pop()):"="==n.charAt(r-1)&&i.pop()),i},i={};i.encode=function(n){for(var i=[],t=0;t<n.length;++t)i.push(n.charCodeAt(t));return i};i.decode=function(){for(var n=0;n<s.length;++n)a[n]=String.fromCharCode(a[n]);return a.join("")};BASE64.decodeArray=function(n){var t=r(n);return new Uint8Array(t)};BASE64.encodeASCII=function(n){var t=i.encode(n);return u(t)};BASE64.decodeASCII=function(n){var t=r(n);return i.decode(t)};BASE64.encode=function(n){var t=UTF8.encode(n);return u(t)};BASE64.decode=function(n){var t=r(n);return UTF8.decode(t)}}("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/");undefined===btoa&&(btoa=BASE64.encode);undefined===atob&&(atob=BASE64.decode),function(n,t){typeof define=="function"&&define.amd?define([],t):n.forge=t()}(this,function(){var i,t,n;return function(r){function e(n,t){return nt.call(n,t)}function c(n,t){var o,s,u,e,h,y,c,w,i,l,p,r=t&&t.split("/"),a=f.map,v=a&&a["*"]||{};if(n&&n.charAt(0)===".")if(t){for(r=r.slice(0,r.length-1),n=n.split("/"),h=n.length-1,f.nodeIdCompat&&b.test(n[h])&&(n[h]=n[h].replace(b,"")),n=r.concat(n),i=0;i<n.length;i+=1)if(p=n[i],p===".")n.splice(i,1),i-=1;else if(p===".."){if(i===1&&(n[2]===".."||n[0]===".."))break;i>0&&(n.splice(i-1,2),i-=2)}n=n.join("/")}else n.indexOf("./")===0&&(n=n.substring(2));if((r||v)&&a){for(o=n.split("/"),i=o.length;i>0;i-=1){if(s=o.slice(0,i).join("/"),r)for(l=r.length;l>0;l-=1)if(u=a[r.slice(0,l).join("/")],u&&(u=u[s],u)){e=u;y=i;break}if(e)break;!c&&v&&v[s]&&(c=v[s],w=i)}!e&&c&&(e=c,y=w);e&&(o.splice(0,y,e),n=o.join("/"))}return n}function p(n,t){return function(){return o.apply(r,tt.call(arguments,0).concat([n,t]))}}function k(n){return function(t){return c(t,n)}}function d(n){return function(t){u[n]=t}}function l(n){if(e(h,n)){var t=h[n];delete h[n];y[n]=!0;a.apply(r,t)}if(!e(u,n)&&!e(y,n))throw new Error("No "+n);return u[n]}function w(n){var i,t=n?n.indexOf("!"):-1;return t>-1&&(i=n.substring(0,t),n=n.substring(t+1,n.length)),[i,n]}function g(n){return function(){return f&&f.config&&f.config[n]||{}}}var a,o,v,s,u={},h={},f={},y={},nt=Object.prototype.hasOwnProperty,tt=[].slice,b=/\.js$/;v=function(n,t){var r,u=w(n),i=u[0];return n=u[1],i&&(i=c(i,t),r=l(i)),i?n=r&&r.normalize?r.normalize(n,k(t)):c(n,t):(n=c(n,t),u=w(n),i=u[0],n=u[1],i&&(r=l(i))),{f:i?i+"!"+n:n,n:n,pr:i,p:r}};s={require:function(n){return p(n)},exports:function(n){var t=u[n];return typeof t!="undefined"?t:u[n]={}},module:function(n){return{id:n,uri:"",exports:u[n],config:g(n)}}};a=function(n,t,i,f){var w,o,k,b,c,a=[],g=typeof i,nt;if(f=f||n,g==="undefined"||g==="function"){for(t=!t.length&&i.length?["require","exports","module"]:t,c=0;c<t.length;c+=1)if(b=v(t[c],f),o=b.f,o==="require")a[c]=s.require(n);else if(o==="exports")a[c]=s.exports(n),nt=!0;else if(o==="module")w=a[c]=s.module(n);else if(e(u,o)||e(h,o)||e(y,o))a[c]=l(o);else{if(!b.p)throw new Error(n+" missing "+o);b.p.load(b.n,p(f,!0),d(o),{});a[c]=u[o]}k=i?i.apply(u[n],a):undefined;n&&(w&&w.exports!==r&&w.exports!==u[n]?u[n]=w.exports:k===r&&nt||(u[n]=k))}else n&&(u[n]=i)};i=t=o=function(n,t,i,u,e){if(typeof n=="string")return s[n]?s[n](t):l(v(n,t).f);if(!n.splice){if(f=n,f.deps&&o(f.deps,f.callback),!t)return;t.splice?(n=t,t=i,i=null):n=r}return t=t||function(){},typeof i=="function"&&(i=u,u=e),u?a(r,n,t,i):setTimeout(function(){a(r,n,t,i)},4),o};o.config=function(n){return o(n)};i._defined=u;n=function(n,t,i){t.splice||(i=t,t=[]);e(u,n)||e(h,n)||(h[n]=[n,t,i])};n.amd={jQuery:!0}}(),n("node_modules/almond/almond",function(){}),function(){function u(n){function o(n){var i,r;if(this.data="",this.read=0,typeof n=="string")this.data=n;else if(t.isArrayBuffer(n)||t.isArrayBufferView(n)){i=new Uint8Array(n);try{this.data=String.fromCharCode.apply(null,i)}catch(u){for(r=0;r<i.length;++r)this.putByte(i[r])}}else(n instanceof o||typeof n=="object"&&typeof n.data=="string"&&typeof n.read=="number")&&(this.data=n.data,this.read=n.read);this._constructedStringLength=0}function l(n,i){i=i||{};this.read=i.readOffset||0;this.growSize=i.growSize||1024;var r=t.isArrayBuffer(n),u=t.isArrayBufferView(n);if(r||u){this.data=r?new DataView(n):new DataView(n.buffer,n.byteOffset,n.byteLength);this.write="writeOffset"in i?i.writeOffset:this.data.byteLength;return}this.data=new DataView(new ArrayBuffer(0));this.write=0;n!==null&&n!==undefined&&this.putBytes(n);"writeOffset"in i&&(this.write=i.writeOffset)}var t=n.util=n.util||{},i,c,r,u,f;typeof process=="undefined"||!process.nextTick?typeof setImmediate=="function"?(t.setImmediate=setImmediate,t.nextTick=function(n){return setImmediate(n)}):(t.setImmediate=function(n){setTimeout(n,0)},t.nextTick=t.setImmediate):(t.nextTick=process.nextTick,t.setImmediate=typeof setImmediate=="function"?setImmediate:t.nextTick);t.isArray=Array.isArray||function(n){return Object.prototype.toString.call(n)==="[object Array]"};t.isArrayBuffer=function(n){return typeof ArrayBuffer!="undefined"&&n instanceof ArrayBuffer};i=[];typeof DataView!="undefined"&&i.push(DataView);typeof Int8Array!="undefined"&&i.push(Int8Array);typeof Uint8Array!="undefined"&&i.push(Uint8Array);typeof Uint8ClampedArray!="undefined"&&i.push(Uint8ClampedArray);typeof Int16Array!="undefined"&&i.push(Int16Array);typeof Uint16Array!="undefined"&&i.push(Uint16Array);typeof Int32Array!="undefined"&&i.push(Int32Array);typeof Uint32Array!="undefined"&&i.push(Uint32Array);typeof Float32Array!="undefined"&&i.push(Float32Array);typeof Float64Array!="undefined"&&i.push(Float64Array);t.isArrayBufferView=function(n){for(var t=0;t<i.length;++t)if(n instanceof i[t])return!0;return!1};t.ByteBuffer=o;t.ByteStringBuffer=o;c=4096;t.ByteStringBuffer.prototype._optimizeConstructedString=function(n){this._constructedStringLength+=n;this._constructedStringLength>c&&(this.data.substr(0,1),this._constructedStringLength=0)};t.ByteStringBuffer.prototype.length=function(){return this.data.length-this.read};t.ByteStringBuffer.prototype.isEmpty=function(){return this.length()<=0};t.ByteStringBuffer.prototype.putByte=function(n){return this.putBytes(String.fromCharCode(n))};t.ByteStringBuffer.prototype.fillWithByte=function(n,t){n=String.fromCharCode(n);for(var i=this.data;t>0;)t&1&&(i+=n),t>>>=1,t>0&&(n+=n);return this.data=i,this._optimizeConstructedString(t),this};t.ByteStringBuffer.prototype.putBytes=function(n){return this.data+=n,this._optimizeConstructedString(n.length),this};t.ByteStringBuffer.prototype.putString=function(n){return this.putBytes(t.encodeUtf8(n))};t.ByteStringBuffer.prototype.putInt16=function(n){return this.putBytes(String.fromCharCode(n>>8&255)+String.fromCharCode(n&255))};t.ByteStringBuffer.prototype.putInt24=function(n){return this.putBytes(String.fromCharCode(n>>16&255)+String.fromCharCode(n>>8&255)+String.fromCharCode(n&255))};t.ByteStringBuffer.prototype.putInt32=function(n){return this.putBytes(String.fromCharCode(n>>24&255)+String.fromCharCode(n>>16&255)+String.fromCharCode(n>>8&255)+String.fromCharCode(n&255))};t.ByteStringBuffer.prototype.putInt16Le=function(n){return this.putBytes(String.fromCharCode(n&255)+String.fromCharCode(n>>8&255))};t.ByteStringBuffer.prototype.putInt24Le=function(n){return this.putBytes(String.fromCharCode(n&255)+String.fromCharCode(n>>8&255)+String.fromCharCode(n>>16&255))};t.ByteStringBuffer.prototype.putInt32Le=function(n){return this.putBytes(String.fromCharCode(n&255)+String.fromCharCode(n>>8&255)+String.fromCharCode(n>>16&255)+String.fromCharCode(n>>24&255))};t.ByteStringBuffer.prototype.putInt=function(n,t){var i="";do t-=8,i+=String.fromCharCode(n>>t&255);while(t>0);return this.putBytes(i)};t.ByteStringBuffer.prototype.putSignedInt=function(n,t){return n<0&&(n+=2<<t-1),this.putInt(n,t)};t.ByteStringBuffer.prototype.putBuffer=function(n){return this.putBytes(n.getBytes())};t.ByteStringBuffer.prototype.getByte=function(){return this.data.charCodeAt(this.read++)};t.ByteStringBuffer.prototype.getInt16=function(){var n=this.data.charCodeAt(this.read)<<8^this.data.charCodeAt(this.read+1);return this.read+=2,n};t.ByteStringBuffer.prototype.getInt24=function(){var n=this.data.charCodeAt(this.read)<<16^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2);return this.read+=3,n};t.ByteStringBuffer.prototype.getInt32=function(){var n=this.data.charCodeAt(this.read)<<24^this.data.charCodeAt(this.read+1)<<16^this.data.charCodeAt(this.read+2)<<8^this.data.charCodeAt(this.read+3);return this.read+=4,n};t.ByteStringBuffer.prototype.getInt16Le=function(){var n=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8;return this.read+=2,n};t.ByteStringBuffer.prototype.getInt24Le=function(){var n=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2)<<16;return this.read+=3,n};t.ByteStringBuffer.prototype.getInt32Le=function(){var n=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2)<<16^this.data.charCodeAt(this.read+3)<<24;return this.read+=4,n};t.ByteStringBuffer.prototype.getInt=function(n){var t=0;do t=(t<<8)+this.data.charCodeAt(this.read++),n-=8;while(n>0);return t};t.ByteStringBuffer.prototype.getSignedInt=function(n){var t=this.getInt(n),i=2<<n-2;return t>=i&&(t-=i<<1),t};t.ByteStringBuffer.prototype.getBytes=function(n){var t;return n?(n=Math.min(this.length(),n),t=this.data.slice(this.read,this.read+n),this.read+=n):n===0?t="":(t=this.read===0?this.data:this.data.slice(this.read),this.clear()),t};t.ByteStringBuffer.prototype.bytes=function(n){return typeof n=="undefined"?this.data.slice(this.read):this.data.slice(this.read,this.read+n)};t.ByteStringBuffer.prototype.at=function(n){return this.data.charCodeAt(this.read+n)};t.ByteStringBuffer.prototype.setAt=function(n,t){return this.data=this.data.substr(0,this.read+n)+String.fromCharCode(t)+this.data.substr(this.read+n+1),this};t.ByteStringBuffer.prototype.last=function(){return this.data.charCodeAt(this.data.length-1)};t.ByteStringBuffer.prototype.copy=function(){var n=t.createBuffer(this.data);return n.read=this.read,n};t.ByteStringBuffer.prototype.compact=function(){return this.read>0&&(this.data=this.data.slice(this.read),this.read=0),this};t.ByteStringBuffer.prototype.clear=function(){return this.data="",this.read=0,this};t.ByteStringBuffer.prototype.truncate=function(n){var t=Math.max(0,this.length()-n);return this.data=this.data.substr(this.read,t),this.read=0,this};t.ByteStringBuffer.prototype.toHex=function(){for(var i,n="",t=this.read;t<this.data.length;++t)i=this.data.charCodeAt(t),i<16&&(n+="0"),n+=i.toString(16);return n};t.ByteStringBuffer.prototype.toString=function(){return t.decodeUtf8(this.bytes())};t.DataBuffer=l;t.DataBuffer.prototype.length=function(){return this.write-this.read};t.DataBuffer.prototype.isEmpty=function(){return this.length()<=0};t.DataBuffer.prototype.accommodate=function(n,t){if(this.length()>=n)return this;t=Math.max(t||this.growSize,n);var r=new Uint8Array(this.data.buffer,this.data.byteOffset,this.data.byteLength),i=new Uint8Array(this.length()+t);return i.set(r),this.data=new DataView(i.buffer),this};t.DataBuffer.prototype.putByte=function(n){return this.accommodate(1),this.data.setUint8(this.write++,n),this};t.DataBuffer.prototype.fillWithByte=function(n,t){this.accommodate(t);for(var i=0;i<t;++i)this.data.setUint8(n);return this};t.DataBuffer.prototype.putBytes=function(n,i){var e,r,f,u;if(t.isArrayBufferView(n))return r=new Uint8Array(n.buffer,n.byteOffset,n.byteLength),e=r.byteLength-r.byteOffset,this.accommodate(e),f=new Uint8Array(this.data.buffer,this.write),f.set(r),this.write+=e,this;if(t.isArrayBuffer(n))return r=new Uint8Array(n),this.accommodate(r.byteLength),f=new Uint8Array(this.data.buffer),f.set(r,this.write),this.write+=r.byteLength,this;if(n instanceof t.DataBuffer||typeof n=="object"&&typeof n.read=="number"&&typeof n.write=="number"&&t.isArrayBufferView(n.data))return r=new Uint8Array(n.data.byteLength,n.read,n.length()),this.accommodate(r.byteLength),f=new Uint8Array(n.data.byteLength,this.write),f.set(r),this.write+=r.byteLength,this;if(n instanceof t.ByteStringBuffer&&(n=n.data,i="binary"),i=i||"binary",typeof n=="string"){if(i==="hex")return this.accommodate(Math.ceil(n.length/2)),u=new Uint8Array(this.data.buffer,this.write),this.write+=t.binary.hex.decode(n,u,this.write),this;if(i==="base64")return this.accommodate(Math.ceil(n.length/4)*3),u=new Uint8Array(this.data.buffer,this.write),this.write+=t.binary.base64.decode(n,u,this.write),this;if(i==="utf8"&&(n=t.encodeUtf8(n),i="binary"),i==="binary"||i==="raw")return this.accommodate(n.length),u=new Uint8Array(this.data.buffer,this.write),this.write+=t.binary.raw.decode(u),this;if(i==="utf16")return this.accommodate(n.length*2),u=new Uint16Array(this.data.buffer,this.write),this.write+=t.text.utf16.encode(u),this;throw new Error("Invalid encoding: "+i);}throw Error("Invalid parameter: "+n);};t.DataBuffer.prototype.putBuffer=function(n){return this.putBytes(n),n.clear(),this};t.DataBuffer.prototype.putString=function(n){return this.putBytes(n,"utf16")};t.DataBuffer.prototype.putInt16=function(n){return this.accommodate(2),this.data.setInt16(this.write,n),this.write+=2,this};t.DataBuffer.prototype.putInt24=function(n){return this.accommodate(3),this.data.setInt16(this.write,n>>8&65535),this.data.setInt8(this.write,n>>16&255),this.write+=3,this};t.DataBuffer.prototype.putInt32=function(n){return this.accommodate(4),this.data.setInt32(this.write,n),this.write+=4,this};t.DataBuffer.prototype.putInt16Le=function(n){return this.accommodate(2),this.data.setInt16(this.write,n,!0),this.write+=2,this};t.DataBuffer.prototype.putInt24Le=function(n){return this.accommodate(3),this.data.setInt8(this.write,n>>16&255),this.data.setInt16(this.write,n>>8&65535,!0),this.write+=3,this};t.DataBuffer.prototype.putInt32Le=function(n){return this.accommodate(4),this.data.setInt32(this.write,n,!0),this.write+=4,this};t.DataBuffer.prototype.putInt=function(n,t){this.accommodate(t/8);do t-=8,this.data.setInt8(this.write++,n>>t&255);while(t>0);return this};t.DataBuffer.prototype.putSignedInt=function(n,t){return this.accommodate(t/8),n<0&&(n+=2<<t-1),this.putInt(n,t)};t.DataBuffer.prototype.getByte=function(){return this.data.getInt8(this.read++)};t.DataBuffer.prototype.getInt16=function(){var n=this.data.getInt16(this.read);return this.read+=2,n};t.DataBuffer.prototype.getInt24=function(){var n=this.data.getInt16(this.read)<<8^this.data.getInt8(this.read+2);return this.read+=3,n};t.DataBuffer.prototype.getInt32=function(){var n=this.data.getInt32(this.read);return this.read+=4,n};t.DataBuffer.prototype.getInt16Le=function(){var n=this.data.getInt16(this.read,!0);return this.read+=2,n};t.DataBuffer.prototype.getInt24Le=function(){var n=this.data.getInt8(this.read)^this.data.getInt16(this.read+1,!0)<<8;return this.read+=3,n};t.DataBuffer.prototype.getInt32Le=function(){var n=this.data.getInt32(this.read,!0);return this.read+=4,n};t.DataBuffer.prototype.getInt=function(n){var t=0;do t=(t<<8)+this.data.getInt8(this.read++),n-=8;while(n>0);return t};t.DataBuffer.prototype.getSignedInt=function(n){var t=this.getInt(n),i=2<<n-2;return t>=i&&(t-=i<<1),t};t.DataBuffer.prototype.getBytes=function(n){var t;return n?(n=Math.min(this.length(),n),t=this.data.slice(this.read,this.read+n),this.read+=n):n===0?t="":(t=this.read===0?this.data:this.data.slice(this.read),this.clear()),t};t.DataBuffer.prototype.bytes=function(n){return typeof n=="undefined"?this.data.slice(this.read):this.data.slice(this.read,this.read+n)};t.DataBuffer.prototype.at=function(n){return this.data.getUint8(this.read+n)};t.DataBuffer.prototype.setAt=function(n,t){return this.data.setUint8(n,t),this};t.DataBuffer.prototype.last=function(){return this.data.getUint8(this.write-1)};t.DataBuffer.prototype.copy=function(){return new t.DataBuffer(this)};t.DataBuffer.prototype.compact=function(){if(this.read>0){var n=new Uint8Array(this.data.buffer,this.read),t=new Uint8Array(n.byteLength);t.set(n);this.data=new DataView(t);this.write-=this.read;this.read=0}return this};t.DataBuffer.prototype.clear=function(){return this.data=new DataView(new ArrayBuffer(0)),this.read=this.write=0,this};t.DataBuffer.prototype.truncate=function(n){return this.write=Math.max(0,this.length()-n),this.read=Math.min(this.read,this.write),this};t.DataBuffer.prototype.toHex=function(){for(var i,n="",t=this.read;t<this.data.byteLength;++t)i=this.data.getUint8(t),i<16&&(n+="0"),n+=i.toString(16);return n};t.DataBuffer.prototype.toString=function(n){var i=new Uint8Array(this.data,this.read,this.length());if(n=n||"utf8",n==="binary"||n==="raw")return t.binary.raw.encode(i);if(n==="hex")return t.binary.hex.encode(i);if(n==="base64")return t.binary.base64.encode(i);if(n==="utf8")return t.text.utf8.decode(i);if(n==="utf16")return t.text.utf16.decode(i);throw new Error("Invalid encoding: "+n);};t.createBuffer=function(n,i){return i=i||"raw",n!==undefined&&i==="utf8"&&(n=t.encodeUtf8(n)),new t.ByteBuffer(n)};t.fillString=function(n,t){for(var i="";t>0;)t&1&&(i+=n),t>>>=1,t>0&&(n+=n);return i};t.xorBytes=function(n,t,i){for(var u="",o="",r="",f=0,e=0;i>0;--i,++f)o=n.charCodeAt(f)^t.charCodeAt(f),e>=10&&(u+=r,r="",e=0),r+=String.fromCharCode(o),++e;return u+=r,u};t.hexToBytes=function(n){var i="",t=0;for(n.length&!0&&(t=1,i+=String.fromCharCode(parseInt(n[0],16)));t<n.length;t+=2)i+=String.fromCharCode(parseInt(n.substr(t,2),16));return i};t.bytesToHex=function(n){return t.createBuffer(n).toHex()};t.int32ToBytes=function(n){return String.fromCharCode(n>>24&255)+String.fromCharCode(n>>16&255)+String.fromCharCode(n>>8&255)+String.fromCharCode(n&255)};r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";u=[62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,64,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51];t.encode64=function(n,t){for(var i="",o="",s,u,f,e=0;e<n.length;)s=n.charCodeAt(e++),u=n.charCodeAt(e++),f=n.charCodeAt(e++),i+=r.charAt(s>>2),i+=r.charAt((s&3)<<4|u>>4),isNaN(u)?i+="==":(i+=r.charAt((u&15)<<2|f>>6),i+=isNaN(f)?"=":r.charAt(f&63)),t&&i.length>t&&(o+=i.substr(0,t)+"\r\n",i=i.substr(t));return o+=i,o};t.decode64=function(n){n=n.replace(/[^A-Za-z0-9\+\/\=]/g,"");for(var i="",o,f,r,e,t=0;t<n.length;)o=u[n.charCodeAt(t++)-43],f=u[n.charCodeAt(t++)-43],r=u[n.charCodeAt(t++)-43],e=u[n.charCodeAt(t++)-43],i+=String.fromCharCode(o<<2|f>>4),r!==64&&(i+=String.fromCharCode((f&15)<<4|r>>2),e!==64&&(i+=String.fromCharCode((r&3)<<6|e)));return i};t.encodeUtf8=function(n){return unescape(encodeURIComponent(n))};t.decodeUtf8=function(n){return decodeURIComponent(escape(n))};t.binary={raw:{},hex:{},base64:{}};t.binary.raw.encode=function(n){return String.fromCharCode.apply(null,n)};t.binary.raw.decode=function(n,t,i){var r=t,f,u;for(r||(r=new Uint8Array(n.length)),i=i||0,f=i,u=0;u<n.length;++u)r[f++]=n.charCodeAt(u);return t?f-i:r};t.binary.hex.encode=t.bytesToHex;t.binary.hex.decode=function(n,t,i){var r=t,u,f;for(r||(r=new Uint8Array(Math.ceil(n.length/2))),i=i||0,u=0,f=i,n.length&1&&(u=1,r[f++]=parseInt(n[0],16));u<n.length;u+=2)r[f++]=parseInt(n.substr(u,2),16);return t?f-i:r};t.binary.base64.encode=function(n,t){for(var i="",o="",s,u,f,e=0;e<n.byteLength;)s=n[e++],u=n[e++],f=n[e++],i+=r.charAt(s>>2),i+=r.charAt((s&3)<<4|u>>4),isNaN(u)?i+="==":(i+=r.charAt((u&15)<<2|f>>6),i+=isNaN(f)?"=":r.charAt(f&63)),t&&i.length>t&&(o+=i.substr(0,t)+"\r\n",i=i.substr(t));return o+=i,o};t.binary.base64.decode=function(n,t,i){var r=t,c,s,o,h,f,e;for(r||(r=new Uint8Array(Math.ceil(n.length/4)*3)),n=n.replace(/[^A-Za-z0-9\+\/\=]/g,""),i=i||0,f=0,e=i;f<n.length;)c=u[n.charCodeAt(f++)-43],s=u[n.charCodeAt(f++)-43],o=u[n.charCodeAt(f++)-43],h=u[n.charCodeAt(f++)-43],r[e++]=c<<2|s>>4,o!==64&&(r[e++]=(s&15)<<4|o>>2,h!==64&&(r[e++]=(o&3)<<6|h));return t?e-i:r};t.text={utf8:{},utf16:{}};t.text.utf8.encode=function(n,i,r){var u,e,f;for(n=t.encodeUtf8(n),u=i,u||(u=new Uint8Array(n.length)),r=r||0,e=r,f=0;f<n.length;++f)u[e++]=n.charCodeAt(f);return i?e-r:u};t.text.utf8.decode=function(n){return t.decodeUtf8(String.fromCharCode.apply(null,n))};t.text.utf16.encode=function(n,t,i){var r=t,e,f,o,u;for(r||(r=new Uint8Array(n.length)),e=new Uint16Array(r),i=i||0,f=i,o=i,u=0;u<n.length;++u)e[o++]=n.charCodeAt(u),f+=2;return t?f-i:r};t.text.utf16.decode=function(n){return String.fromCharCode.apply(null,new Uint16Array(n))};t.deflate=function(n,i,r){if(i=t.decode64(n.deflate(t.encode64(i)).rval),r){var u=2,f=i.charCodeAt(1);f&32&&(u=6);i=i.substring(u,i.length-4)}return i};t.inflate=function(n,i){var r=n.inflate(t.encode64(i)).rval;return r===null?null:t.decode64(r)};var s=function(n,i,r){var u,f;if(!n)throw new Error("WebStorage not available.");if(r===null?u=n.removeItem(i):(r=t.encode64(JSON.stringify(r)),u=n.setItem(i,r)),typeof u!="undefined"&&u.rval!==!0){f=new Error(u.error.message);throw f.id=u.error.id,f.name=u.error.name,f;}},h=function(n,i){var r,u;if(!n)throw new Error("WebStorage not available.");if(r=n.getItem(i),n.init)if(r.rval===null){if(r.error){u=new Error(r.error.message);throw u.id=r.error.id,u.name=r.error.name,u;}r=null}else r=r.rval;return r!==null&&(r=JSON.parse(t.decode64(r))),r},a=function(n,t,i,r){var u=h(n,t);u===null&&(u={});u[i]=r;s(n,t,u)},v=function(n,t,i){var r=h(n,t);return r!==null&&(r=i in r?r[i]:null),r},y=function(n,t,i){var r=h(n,t),u,f;if(r!==null&&i in r){delete r[i];u=!0;for(f in r){u=!1;break}u&&(r=null);s(n,t,r)}},p=function(n,t){s(n,t,null)},e=function(n,t,i){var f=null,r,u,e,o;typeof i=="undefined"&&(i=["web","flash"]);u=!1;e=null;for(o in i){r=i[o];try{if(r==="flash"||r==="both"){if(t[0]===null)throw new Error("Flash local storage not available.");f=n.apply(this,t);u=r==="flash"}(r==="web"||r==="both")&&(t[0]=localStorage,f=n.apply(this,t),u=!0)}catch(s){e=s}if(u)break}if(!u)throw e;return f};t.setItem=function(n,t,i,r,u){e(a,arguments,u)};t.getItem=function(n,t,i,r){return e(v,arguments,r)};t.removeItem=function(n,t,i,r){e(y,arguments,r)};t.clearItems=function(n,t,i){e(p,arguments,i)};t.parseUrl=function(n){var r=/^(https?):\/\/([^:&^\/]*):?(\d*)(.*)$/g,i,t;return r.lastIndex=0,i=r.exec(n),t=i===null?null:{full:n,scheme:i[1],host:i[2],port:i[3],path:i[4]},t&&(t.fullHost=t.host,t.port?t.port!==80&&t.scheme==="http"?t.fullHost+=":"+t.port:t.port!==443&&t.scheme==="https"&&(t.fullHost+=":"+t.port):t.scheme==="http"?t.port=80:t.scheme==="https"&&(t.port=443),t.full=t.scheme+"://"+t.fullHost),t};f=null;t.getQueryVariables=function(n){var i=function(n){for(var f,i,e,u={},r=n.split("&"),t=0;t<r.length;t++)f=r[t].indexOf("="),f>0?(i=r[t].substring(0,f),e=r[t].substring(f+1)):(i=r[t],e=null),i in u||(u[i]=[]),!(i in Object.prototype)&&e!==null&&u[i].push(unescape(e));return u},t;return typeof n=="undefined"?(f===null&&(f=typeof window=="undefined"?{}:i(window.location.search.substring(1))),t=f):t=i(n),t};t.parseFragment=function(n){var u=n,r="",f=n.indexOf("?"),i,e;return f>0&&(u=n.substring(0,f),r=n.substring(f+1)),i=u.split("/"),i.length>0&&i[0]===""&&i.shift(),e=r===""?{}:t.getQueryVariables(r),{pathString:u,queryString:r,path:i,query:e}};t.makeRequest=function(n){var i=t.parseFragment(n),r={path:i.pathString,query:i.queryString,getPath:function(n){return typeof n=="undefined"?i.path:i.path[n]},getQuery:function(n,t){var r;return typeof n=="undefined"?r=i.query:(r=i.query[n],r&&typeof t!="undefined"&&(r=r[t])),r},getQueryLast:function(n,t){var u,i=r.getQuery(n);return u=i?i[i.length-1]:t,u}};return r};t.makeLink=function(n,t,i){n=jQuery.isArray(n)?n.join("/"):n;var r=jQuery.param(t||{});return i=i||"",n+(r.length>0?"?"+r:"")+(i.length>0?"#"+i:"")};t.setPath=function(n,t,i){var u,e,r,f;if(typeof n=="object"&&n!==null)for(u=0,e=t.length;u<e;)r=t[u++],u==e?n[r]=i:(f=r in n,(!f||f&&typeof n[r]!="object"||f&&n[r]===null)&&(n[r]={}),n=n[r])};t.getPath=function(n,t,i){for(var f=0,e=t.length,r=!0,u;r&&f<e&&typeof n=="object"&&n!==null;)u=t[f++],r=u in n,r&&(n=n[u]);return r?n:i};t.deletePath=function(n,t){var r,u,i;if(typeof n=="object"&&n!==null)for(r=0,u=t.length;r<u;)if(i=t[r++],r==u)delete n[i];else{if(!(i in n&&typeof n[i]=="object"&&n[i]!==null))break;n=n[i]}};t.isEmpty=function(n){for(var t in n)if(n.hasOwnProperty(t))return!1;return!0};t.format=function(n){for(var i=/%./g,e,r,o=0,t=[],u=0,f;e=i.exec(n);){r=n.substring(u,i.lastIndex-2);r.length>0&&t.push(r);u=i.lastIndex;f=e[0][1];switch(f){case"s":case"o":o<arguments.length?t.push(arguments[o+++1]):t.push("<?>");break;case"%":t.push("%");break;default:t.push("<%"+f+"?>")}}return t.push(n.substring(u)),t.join("")};t.formatNumber=function(n,t,i,r){var f=n,e=isNaN(t=Math.abs(t))?2:t,h=i===undefined?",":i,s=r===undefined?".":r,c=f<0?"-":"",u=parseInt(f=Math.abs(+f||0).toFixed(e),10)+"",o=u.length>3?u.length%3:0;return c+(o?u.substr(0,o)+s:"")+u.substr(o).replace(/(\d{3})(?=\d)/g,"$1"+s)+(e?h+Math.abs(f-u).toFixed(e).slice(2):"")};t.formatSize=function(n){return n=n>=1073741824?t.formatNumber(n/1073741824,2,".","")+" GiB":n>=1048576?t.formatNumber(n/1048576,2,".","")+" MiB":n>=1024?t.formatNumber(n/1024,0)+" KiB":t.formatNumber(n,0)+" bytes",n};t.bytesFromIP=function(n){return n.indexOf(".")!==-1?t.bytesFromIPv4(n):n.indexOf(":")!==-1?t.bytesFromIPv6(n):null};t.bytesFromIPv4=function(n){var r,i,u;if(n=n.split("."),n.length!==4)return null;for(r=t.createBuffer(),i=0;i<n.length;++i){if(u=parseInt(n[i],10),isNaN(u))return null;r.putByte(u)}return r.getBytes()};t.bytesFromIPv6=function(n){var e=0,u,r,i,f;for(n=n.split(":").filter(function(n){return n.length===0&&++e,!0}),u=(8-n.length+e)*2,r=t.createBuffer(),i=0;i<8;++i){if(!n[i]||n[i].length===0){r.fillWithByte(0,u);u=0;continue}f=t.hexToBytes(n[i]);f.length<2&&r.putByte(0);r.putBytes(f)}return r.getBytes()};t.bytesToIP=function(n){return n.length===4?t.bytesToIPv4(n):n.length===16?t.bytesToIPv6(n):null};t.bytesToIPv4=function(n){var i,t;if(n.length!==4)return null;for(i=[],t=0;t<n.length;++t)i.push(n.charCodeAt(t));return i.join(".")};t.bytesToIPv6=function(n){var o,u,e,s,r;if(n.length!==16)return null;var f=[],i=[],h=0;for(o=0;o<n.length;o+=2){for(u=t.bytesToHex(n[o]+n[o+1]);u[0]==="0"&&u!=="0";)u=u.substr(1);u==="0"&&(e=i[i.length-1],s=f.length,!e||s!==e.end+1?i.push({start:s,end:s}):(e.end=s,e.end-e.start>i[h].end-i[h].start&&(h=i.length-1)));f.push(u)}return i.length>0&&(r=i[h],r.end-r.start>0&&(f.splice(r.start,r.end-r.start+1,""),r.start===0&&f.unshift(""),r.end===7&&f.push(""))),f.join(":")};t.estimateCores=function(n,i){function r(n,o,s){if(o===0){var h=Math.floor(n.reduce(function(n,t){return n+t},0)/n.length);return t.cores=Math.max(1,h),URL.revokeObjectURL(u),i(null,t.cores)}f(s,function(t,i){n.push(e(s,i));r(n,o-1,s)})}function f(n,t){for(var e,r=[],f=[],i=0;i<n;++i)e=new Worker(u),e.addEventListener("message",function(i){if(f.push(i.data),f.length===n){for(var u=0;u<n;++u)r[u].terminate();t(null,f)}}),r.push(e);for(i=0;i<n;++i)r[i].postMessage(i)}function e(n,t){for(var u,o,i,f,e=[],r=0;r<n;++r)for(u=t[r],o=e[r]=[],i=0;i<n;++i)r!==i&&(f=t[i],(u.st>f.st&&u.st<f.et||f.st>u.st&&f.st<u.et)&&o.push(i));return e.reduce(function(n,t){return Math.max(n,t.length)},0)}if(typeof n=="function"&&(i=n,n={}),n=n||{},"cores"in t&&!n.update)return i(null,t.cores);if(typeof navigator!="undefined"&&"hardwareConcurrency"in navigator&&navigator.hardwareConcurrency>0)return t.cores=navigator.hardwareConcurrency,i(null,t.cores);if(typeof Worker=="undefined")return t.cores=1,i(null,t.cores);if(typeof Blob=="undefined")return t.cores=2,i(null,t.cores);var u=URL.createObjectURL(new Blob(["(",function(){self.addEventListener("message",function(){for(var n=Date.now(),t=n+4;Date.now()<t;);self.postMessage({st:n,et:t})})}.toString(),")()"],{type:"application/javascript"}));r([],5,16)}}var i="util",f,e,o,r;if(typeof n!="function"){if(typeof module!="object"||!module.exports)return typeof forge=="undefined"&&(forge={}),u(forge);f=!0;n=function(n,i){i(t,module)}}o=function(n,t){t.exports=function(t){var f=e.map(function(t){return n(t)}).concat(u),r;if(t=t||{},t.defined=t.defined||{},t.defined[i])return t[i];for(t.defined[i]=!0,r=0;r<f.length;++r)f[r](t);return t[i]}};r=n;n=function(t,i){return e=typeof t=="string"?i.slice(2):t.slice(2),f?(delete n,r.apply(null,Array.prototype.slice.call(arguments,0))):(n=r,n.apply(null,Array.prototype.slice.call(arguments,0)))};n("js/util",["require","module"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function u(n){n.cipher=n.cipher||{};n.cipher.algorithms=n.cipher.algorithms||{};n.cipher.createCipher=function(t,i){var r=t;if(typeof r=="string"&&(r=n.cipher.getAlgorithm(r),r&&(r=r())),!r)throw new Error("Unsupported algorithm: "+t);return new n.cipher.BlockCipher({algorithm:r,key:i,decrypt:!1})};n.cipher.createDecipher=function(t,i){var r=t;if(typeof r=="string"&&(r=n.cipher.getAlgorithm(r),r&&(r=r())),!r)throw new Error("Unsupported algorithm: "+t);return new n.cipher.BlockCipher({algorithm:r,key:i,decrypt:!0})};n.cipher.registerAlgorithm=function(t,i){t=t.toUpperCase();n.cipher.algorithms[t]=i};n.cipher.getAlgorithm=function(t){return t=t.toUpperCase(),t in n.cipher.algorithms?n.cipher.algorithms[t]:null};var t=n.cipher.BlockCipher=function(n){this.algorithm=n.algorithm;this.mode=this.algorithm.mode;this.blockSize=this.mode.blockSize;this._finish=!1;this._input=null;this.output=null;this._op=n.decrypt?this.mode.decrypt:this.mode.encrypt;this._decrypt=n.decrypt;this.algorithm.initialize(n)};t.prototype.start=function(t){var i,r;t=t||{};i={};for(r in t)i[r]=t[r];i.decrypt=this._decrypt;this._finish=!1;this._input=n.util.createBuffer();this.output=t.output||n.util.createBuffer();this.mode.start(i)};t.prototype.update=function(n){for(this._finish||this._input.putBuffer(n);this._input.length()>=this.blockSize||this._input.length()>0&&this._finish;)this._op.call(this.mode,this._input,this.output);this._input.compact()};t.prototype.finish=function(n){n&&this.mode.name==="CBC"&&(this.mode.pad=function(t){return n(this.blockSize,t,!1)},this.mode.unpad=function(t){return n(this.blockSize,t,!0)});var t={};return t.decrypt=this._decrypt,t.overflow=this._input.length()%this.blockSize,!this._decrypt&&this.mode.pad&&!this.mode.pad(this._input,t)?!1:(this._finish=!0,this.update(),this._decrypt&&this.mode.unpad&&!this.mode.unpad(this.output,t)?!1:this.mode.afterFinish&&!this.mode.afterFinish(this.output,t)?!1:!0)}}var i="cipher",f,e,o,r;if(typeof n!="function"){if(typeof module!="object"||!module.exports)return typeof forge=="undefined"&&(forge={}),u(forge);f=!0;n=function(n,i){i(t,module)}}o=function(n,t){t.exports=function(t){var f=e.map(function(t){return n(t)}).concat(u),r;if(t=t||{},t.defined=t.defined||{},t.defined[i])return t[i];for(t.defined[i]=!0,r=0;r<f.length;++r)f[r](t);return t[i]}};r=n;n=function(t,i){return e=typeof t=="string"?i.slice(2):t.slice(2),f?(delete n,r.apply(null,Array.prototype.slice.call(arguments,0))):(n=r,n.apply(null,Array.prototype.slice.call(arguments,0)))};n("js/cipher",["require","module","./util"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function u(n){function i(t){var r,i;if(typeof t=="string"&&(t=n.util.createBuffer(t)),n.util.isArray(t)&&t.length>4)for(r=t,t=n.util.createBuffer(),i=0;i<t.length;++i)t.putByte(r[i]);return n.util.isArray(t)||(t=[t.getInt32(),t.getInt32(),t.getInt32(),t.getInt32()]),t}function r(n){n[n.length-1]=n[n.length-1]+1&4294967295}function u(n){return[n/4294967296|0,n&4294967295]}n.cipher=n.cipher||{};var t=n.cipher.modes=n.cipher.modes||{};t.ecb=function(n){n=n||{};this.name="ECB";this.cipher=n.cipher;this.blockSize=n.blockSize||16;this._blocks=this.blockSize/4;this._inBlock=new Array(this._blocks);this._outBlock=new Array(this._blocks)};t.ecb.prototype.start=function(){};t.ecb.prototype.encrypt=function(n,t){for(var i=0;i<this._blocks;++i)this._inBlock[i]=n.getInt32();for(this.cipher.encrypt(this._inBlock,this._outBlock),i=0;i<this._blocks;++i)t.putInt32(this._outBlock[i])};t.ecb.prototype.decrypt=function(n,t){for(var i=0;i<this._blocks;++i)this._inBlock[i]=n.getInt32();for(this.cipher.decrypt(this._inBlock,this._outBlock),i=0;i<this._blocks;++i)t.putInt32(this._outBlock[i])};t.ecb.prototype.pad=function(n){var t=n.length()===this.blockSize?this.blockSize:this.blockSize-n.length();return n.fillWithByte(t,t),!0};t.ecb.prototype.unpad=function(n,t){if(t.overflow>0)return!1;var r=n.length(),i=n.at(r-1);return i>this.blockSize<<2?!1:(n.truncate(i),!0)};t.cbc=function(n){n=n||{};this.name="CBC";this.cipher=n.cipher;this.blockSize=n.blockSize||16;this._blocks=this.blockSize/4;this._inBlock=new Array(this._blocks);this._outBlock=new Array(this._blocks)};t.cbc.prototype.start=function(n){if(n.iv===null){if(!this._prev)throw new Error("Invalid IV parameter.");this._iv=this._prev.slice(0)}else{if(!("iv"in n))throw new Error("Invalid IV parameter.");this._iv=i(n.iv);this._prev=this._iv.slice(0)}};t.cbc.prototype.encrypt=function(n,t){for(var i=0;i<this._blocks;++i)this._inBlock[i]=this._prev[i]^n.getInt32();for(this.cipher.encrypt(this._inBlock,this._outBlock),i=0;i<this._blocks;++i)t.putInt32(this._outBlock[i]);this._prev=this._outBlock};t.cbc.prototype.decrypt=function(n,t){for(var i=0;i<this._blocks;++i)this._inBlock[i]=n.getInt32();for(this.cipher.decrypt(this._inBlock,this._outBlock),i=0;i<this._blocks;++i)t.putInt32(this._prev[i]^this._outBlock[i]);this._prev=this._inBlock.slice(0)};t.cbc.prototype.pad=function(n){var t=n.length()===this.blockSize?this.blockSize:this.blockSize-n.length();return n.fillWithByte(t,t),!0};t.cbc.prototype.unpad=function(n,t){if(t.overflow>0)return!1;var r=n.length(),i=n.at(r-1);return i>this.blockSize<<2?!1:(n.truncate(i),!0)};t.cfb=function(n){n=n||{};this.name="CFB";this.cipher=n.cipher;this.blockSize=n.blockSize||16;this._blocks=this.blockSize/4;this._inBlock=null;this._outBlock=new Array(this._blocks)};t.cfb.prototype.start=function(n){if(!("iv"in n))throw new Error("Invalid IV parameter.");this._iv=i(n.iv);this._inBlock=this._iv.slice(0)};t.cfb.prototype.encrypt=function(n,t){this.cipher.encrypt(this._inBlock,this._outBlock);for(var i=0;i<this._blocks;++i)this._inBlock[i]=n.getInt32()^this._outBlock[i],t.putInt32(this._inBlock[i])};t.cfb.prototype.decrypt=function(n,t){this.cipher.encrypt(this._inBlock,this._outBlock);for(var i=0;i<this._blocks;++i)this._inBlock[i]=n.getInt32(),t.putInt32(this._inBlock[i]^this._outBlock[i])};t.cfb.prototype.afterFinish=function(n,t){return t.overflow>0&&n.truncate(this.blockSize-t.overflow),!0};t.ofb=function(n){n=n||{};this.name="OFB";this.cipher=n.cipher;this.blockSize=n.blockSize||16;this._blocks=this.blockSize/4;this._inBlock=null;this._outBlock=new Array(this._blocks)};t.ofb.prototype.start=function(n){if(!("iv"in n))throw new Error("Invalid IV parameter.");this._iv=i(n.iv);this._inBlock=this._iv.slice(0)};t.ofb.prototype.encrypt=function(n,t){this.cipher.encrypt(this._inBlock,this._outBlock);for(var i=0;i<this._blocks;++i)t.putInt32(n.getInt32()^this._outBlock[i]),this._inBlock[i]=this._outBlock[i]};t.ofb.prototype.decrypt=t.ofb.prototype.encrypt;t.ofb.prototype.afterFinish=function(n,t){return t.overflow>0&&n.truncate(this.blockSize-t.overflow),!0};t.ctr=function(n){n=n||{};this.name="CTR";this.cipher=n.cipher;this.blockSize=n.blockSize||16;this._blocks=this.blockSize/4;this._inBlock=null;this._outBlock=new Array(this._blocks)};t.ctr.prototype.start=function(n){if(!("iv"in n))throw new Error("Invalid IV parameter.");this._iv=i(n.iv);this._inBlock=this._iv.slice(0)};t.ctr.prototype.encrypt=function(n,t){this.cipher.encrypt(this._inBlock,this._outBlock);r(this._inBlock);for(var i=0;i<this._blocks;++i)t.putInt32(n.getInt32()^this._outBlock[i])};t.ctr.prototype.decrypt=t.ctr.prototype.encrypt;t.ctr.prototype.afterFinish=function(n,t){return t.overflow>0&&n.truncate(this.blockSize-t.overflow),!0};t.gcm=function(n){n=n||{};this.name="GCM";this.cipher=n.cipher;this.blockSize=n.blockSize||16;this._blocks=this.blockSize/4;this._inBlock=new Array(this._blocks);this._outBlock=new Array(this._blocks);this._R=3774873600};t.gcm.prototype.start=function(t){var f,i,e,o;if(!("iv"in t))throw new Error("Invalid IV parameter.");if(f=n.util.createBuffer(t.iv),this._cipherLength=0,i="additionalData"in t?n.util.createBuffer(t.additionalData):n.util.createBuffer(),this._tagLength="tagLength"in t?t.tagLength:128,this._tag=null,t.decrypt&&(this._tag=n.util.createBuffer(t.tag).getBytes(),this._tag.length!==this._tagLength/8))throw new Error("Authentication tag does not match tag length.");if(this._hashBlock=new Array(this._blocks),this.tag=null,this._hashSubkey=new Array(this._blocks),this.cipher.encrypt([0,0,0,0],this._hashSubkey),this.componentBits=4,this._m=this.generateHashTable(this._hashSubkey,this.componentBits),e=f.length(),e===12)this._j0=[f.getInt32(),f.getInt32(),f.getInt32(),1];else{for(this._j0=[0,0,0,0];f.length()>0;)this._j0=this.ghash(this._hashSubkey,this._j0,[f.getInt32(),f.getInt32(),f.getInt32(),f.getInt32()]);this._j0=this.ghash(this._hashSubkey,this._j0,[0,0].concat(u(e*8)))}for(this._inBlock=this._j0.slice(0),r(this._inBlock),i=n.util.createBuffer(i),this._aDataLength=u(i.length()*8),o=i.length()%this.blockSize,o&&i.fillWithByte(0,this.blockSize-o),this._s=[0,0,0,0];i.length()>0;)this._s=this.ghash(this._hashSubkey,this._s,[i.getInt32(),i.getInt32(),i.getInt32(),i.getInt32()])};t.gcm.prototype.encrypt=function(t,i){var e,o,u,f;for(this.cipher.encrypt(this._inBlock,this._outBlock),r(this._inBlock),e=t.length(),f=0;f<this._blocks;++f)this._outBlock[f]^=t.getInt32();for(e<this.blockSize?(o=e%this.blockSize,this._cipherLength+=o,u=n.util.createBuffer(),u.putInt32(this._outBlock[0]),u.putInt32(this._outBlock[1]),u.putInt32(this._outBlock[2]),u.putInt32(this._outBlock[3]),u.truncate(this.blockSize-o),this._outBlock[0]=u.getInt32(),this._outBlock[1]=u.getInt32(),this._outBlock[2]=u.getInt32(),this._outBlock[3]=u.getInt32()):this._cipherLength+=this.blockSize,f=0;f<this._blocks;++f)i.putInt32(this._outBlock[f]);this._s=this.ghash(this._hashSubkey,this._s,this._outBlock)};t.gcm.prototype.decrypt=function(n,t){var u,i;for(this.cipher.encrypt(this._inBlock,this._outBlock),r(this._inBlock),u=n.length(),this._hashBlock[0]=n.getInt32(),this._hashBlock[1]=n.getInt32(),this._hashBlock[2]=n.getInt32(),this._hashBlock[3]=n.getInt32(),this._s=this.ghash(this._hashSubkey,this._s,this._hashBlock),i=0;i<this._blocks;++i)t.putInt32(this._outBlock[i]^this._hashBlock[i]);this._cipherLength+=u<this.blockSize?u%this.blockSize:this.blockSize};t.gcm.prototype.afterFinish=function(t,i){var e=!0,o,f,r;for(i.overflow&&t.truncate(this.blockSize-i.overflow),this.tag=n.util.createBuffer(),o=this._aDataLength.concat(u(this._cipherLength*8)),this._s=this.ghash(this._hashSubkey,this._s,o),f=[],this.cipher.encrypt(this._j0,f),r=0;r<this._blocks;++r)this.tag.putInt32(this._s[r]^f[r]);return this.tag.truncate(this.tag.length()%(this._tagLength/8)),i.decrypt&&this.tag.bytes()!==this._tag&&(e=!1),e};t.gcm.prototype.multiply=function(n,t){for(var f,r=[0,0,0,0],i=t.slice(0),u=0;u<128;++u)f=n[u/32|0]&1<<31-u%32,f&&(r[0]^=i[0],r[1]^=i[1],r[2]^=i[2],r[3]^=i[3]),this.pow(i,i);return r};t.gcm.prototype.pow=function(n,t){for(var r=n[3]&1,i=3;i>0;--i)t[i]=n[i]>>>1|(n[i-1]&1)<<31;t[0]=n[0]>>>1;r&&(t[0]^=this._R)};t.gcm.prototype.tableMultiply=function(n){for(var t=[0,0,0,0],i=0;i<32;++i){var u=i/8|0,f=n[u]>>>(7-i%8)*4&15,r=this._m[i][f];t[0]^=r[0];t[1]^=r[1];t[2]^=r[2];t[3]^=r[3]}return t};t.gcm.prototype.ghash=function(n,t,i){return t[0]^=i[0],t[1]^=i[1],t[2]^=i[2],t[3]^=i[3],this.tableMultiply(t)};t.gcm.prototype.generateHashTable=function(n,t){for(var u=8/t,r=4*u,f=16*u,e=new Array(f),i=0;i<f;++i){var o=[0,0,0,0],s=i/r|0,h=(r-1-i%r)*t;o[s]=1<<t-1<<h;e[i]=this.generateSubHashTable(this.multiply(o,n),t)}return e};t.gcm.prototype.generateSubHashTable=function(n,t){var h=1<<t,u=h>>>1,r=new Array(h),i,f,e,o,s;for(r[u]=n.slice(0),i=u>>>1;i>0;)this.pow(r[2*i],r[i]=[]),i>>=1;for(i=2;i<u;){for(f=1;f<i;++f)e=r[i],o=r[f],r[i+f]=[e[0]^o[0],e[1]^o[1],e[2]^o[2],e[3]^o[3]];i*=2}for(r[0]=[0,0,0,0],i=u+1;i<h;++i)s=r[i^u],r[i]=[n[0]^s[0],n[1]^s[1],n[2]^s[2],n[3]^s[3]];return r}}var i="cipherModes",f,e,o,r;if(typeof n!="function"){if(typeof module!="object"||!module.exports)return typeof forge=="undefined"&&(forge={}),u(forge);f=!0;n=function(n,i){i(t,module)}}o=function(n,t){t.exports=function(t){var f=e.map(function(t){return n(t)}).concat(u),r;if(t=t||{},t.defined=t.defined||{},t.defined[i])return t[i];for(t.defined[i]=!0,r=0;r<f.length;++r)f[r](t);return t[i]}};r=n;n=function(t,i){return e=typeof t=="string"?i.slice(2):t.slice(2),f?(delete n,r.apply(null,Array.prototype.slice.call(arguments,0))):(n=r,n.apply(null,Array.prototype.slice.call(arguments,0)))};n("js/cipherModes",["require","module","./util"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function u(n){function f(t,i){var r=function(){return new n.aes.Algorithm(t,i)};n.cipher.registerAlgorithm(t,r)}function c(){var u,f,o,c,w,l,e,b,v,y,n,p;for(s=!0,a=[0,1,2,4,8,16,32,64,128,27,54],u=new Array(256),n=0;n<128;++n)u[n]=n<<1,u[n+128]=n+128<<1^283;for(t=new Array(256),h=new Array(256),r=new Array(4),i=new Array(4),n=0;n<4;++n)r[n]=new Array(256),i[n]=new Array(256);for(f=0,o=0,n=0;n<256;++n){for(e=o^o<<1^o<<2^o<<3^o<<4,e=e>>8^e&255^99,t[f]=e,h[e]=f,b=u[e],c=u[f],w=u[c],l=u[w],v=b<<24^e<<16^e<<8^e^b,y=(c^w^l)<<24^(f^l)<<16^(f^w^l)<<8^f^c^l,p=0;p<4;++p)r[p][f]=v,i[p][e]=y,v=v<<24|v>>>8,y=y<<24|y>>>8;f===0?f=o=1:(f=c^u[u[u[c^l]]],o^=u[u[o]])}}function l(n,r){for(var s,y,e=n.slice(0),o,p=1,h=e.length,w=h+6+1,l=u*w,f=h;f<l;++f)o=e[f-1],f%h==0?(o=t[o>>>16&255]<<24^t[o>>>8&255]<<16^t[o&255]<<8^t[o>>>24]^a[p]<<24,p++):h>6&&f%h==4&&(o=t[o>>>24]<<24^t[o>>>16&255]<<16^t[o>>>8&255]<<8^t[o&255]),e[f]=e[f-h]^o;if(r){var v,b=i[0],k=i[1],d=i[2],g=i[3],c=e.slice(0);for(l=e.length,f=0,s=l-u;f<l;f+=u,s-=u)if(f===0||f===l-u)c[f]=e[s],c[f+1]=e[s+3],c[f+2]=e[s+2],c[f+3]=e[s+1];else for(y=0;y<u;++y)v=e[s+y],c[f+(3&-y)]=b[t[v>>>24]]^k[t[v>>>16&255]]^d[t[v>>>8&255]]^g[t[v&255]];e=c}return e}function o(n,u,f,e){var tt=n.length/4-1,y,p,w,b,o,s,c,l,a,d,g,nt,v,k;for(e?(y=i[0],p=i[1],w=i[2],b=i[3],o=h):(y=r[0],p=r[1],w=r[2],b=r[3],o=t),s=u[0]^n[0],c=u[e?3:1]^n[1],l=u[2]^n[2],a=u[e?1:3]^n[3],v=3,k=1;k<tt;++k)d=y[s>>>24]^p[c>>>16&255]^w[l>>>8&255]^b[a&255]^n[++v],g=y[c>>>24]^p[l>>>16&255]^w[a>>>8&255]^b[s&255]^n[++v],nt=y[l>>>24]^p[a>>>16&255]^w[s>>>8&255]^b[c&255]^n[++v],a=y[a>>>24]^p[s>>>16&255]^w[c>>>8&255]^b[l&255]^n[++v],s=d,c=g,l=nt;f[0]=o[s>>>24]<<24^o[c>>>16&255]<<16^o[l>>>8&255]<<8^o[a&255]^n[++v];f[e?3:1]=o[c>>>24]<<24^o[l>>>16&255]<<16^o[a>>>8&255]<<8^o[s&255]^n[++v];f[2]=o[l>>>24]<<24^o[a>>>16&255]<<16^o[s>>>8&255]<<8^o[c&255]^n[++v];f[e?1:3]=o[a>>>24]<<24^o[s>>>16&255]<<16^o[c>>>8&255]<<8^o[l&255]^n[++v]}function e(t){var u,r,i,f;return t=t||{},u=(t.mode||"CBC").toUpperCase(),r="AES-"+u,i=t.decrypt?n.cipher.createDecipher(r,t.key):n.cipher.createCipher(r,t.key),f=i.start,i.start=function(t,r){var u=null;r instanceof n.util.ByteBuffer&&(u=r,r={});r=r||{};r.output=u;r.iv=t;f.call(i,r)},i}n.aes=n.aes||{};n.aes.startEncrypting=function(n,t,i,r){var u=e({key:n,output:i,decrypt:!1,mode:r});return u.start(t),u};n.aes.createEncryptionCipher=function(n,t){return e({key:n,output:null,decrypt:!1,mode:t})};n.aes.startDecrypting=function(n,t,i,r){var u=e({key:n,output:i,decrypt:!0,mode:r});return u.start(t),u};n.aes.createDecryptionCipher=function(n,t){return e({key:n,output:null,decrypt:!0,mode:t})};n.aes.Algorithm=function(n,t){s||c();var i=this;i.name=n;i.mode=new t({blockSize:16,cipher:{encrypt:function(n,t){return o(i._w,n,t,!1)},decrypt:function(n,t){return o(i._w,n,t,!0)}}});i._init=!1};n.aes.Algorithm.prototype.initialize=function(t){var i,u,f,r,e,o;if(!this._init){if(i=t.key,typeof i!="string"||i.length!==16&&i.length!==24&&i.length!==32){if(n.util.isArray(i)&&(i.length===16||i.length===24||i.length===32))for(u=i,i=n.util.createBuffer(),r=0;r<u.length;++r)i.putByte(u[r])}else i=n.util.createBuffer(i);if(!n.util.isArray(i)&&(u=i,i=[],f=u.length(),f===16||f===24||f===32))for(f>>>=2,r=0;r<f;++r)i.push(u.getInt32());if(!n.util.isArray(i)||i.length!==4&&i.length!==6&&i.length!==8)throw new Error("Invalid key parameter.");e=this.mode.name;o=["CFB","OFB","CTR","GCM"].indexOf(e)!==-1;this._w=l(i,t.decrypt&&!o);this._init=!0}};n.aes._expandKey=function(n,t){return s||c(),l(n,t)};n.aes._updateBlock=o;f("AES-CBC",n.cipher.modes.cbc);f("AES-CFB",n.cipher.modes.cfb);f("AES-OFB",n.cipher.modes.ofb);f("AES-CTR",n.cipher.modes.ctr);f("AES-GCM",n.cipher.modes.gcm);var s=!1,u=4,t,h,a,r,i}var i="aes",f,e,o,r;if(typeof n!="function"){if(typeof module!="object"||!module.exports)return typeof forge=="undefined"&&(forge={}),u(forge);f=!0;n=function(n,i){i(t,module)}}o=function(n,t){t.exports=function(t){var f=e.map(function(t){return n(t)}).concat(u),r;if(t=t||{},t.defined=t.defined||{},t.defined[i])return t[i];for(t.defined[i]=!0,r=0;r<f.length;++r)f[r](t);return t[i]}};r=n;n=function(t,i){return e=typeof t=="string"?i.slice(2):t.slice(2),f?(delete n,r.apply(null,Array.prototype.slice.call(arguments,0))):(n=r,n.apply(null,Array.prototype.slice.call(arguments,0)))};n("js/aes",["require","module","./cipher","./cipherModes","./util"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function u(n){n.pki=n.pki||{};var t=n.pki.oids=n.oids=n.oids||{};t["1.2.840.113549.1.1.1"]="rsaEncryption";t.rsaEncryption="1.2.840.113549.1.1.1";t["1.2.840.113549.1.1.4"]="md5WithRSAEncryption";t.md5WithRSAEncryption="1.2.840.113549.1.1.4";t["1.2.840.113549.1.1.5"]="sha1WithRSAEncryption";t.sha1WithRSAEncryption="1.2.840.113549.1.1.5";t["1.2.840.113549.1.1.7"]="RSAES-OAEP";t["RSAES-OAEP"]="1.2.840.113549.1.1.7";t["1.2.840.113549.1.1.8"]="mgf1";t.mgf1="1.2.840.113549.1.1.8";t["1.2.840.113549.1.1.9"]="pSpecified";t.pSpecified="1.2.840.113549.1.1.9";t["1.2.840.113549.1.1.10"]="RSASSA-PSS";t["RSASSA-PSS"]="1.2.840.113549.1.1.10";t["1.2.840.113549.1.1.11"]="sha256WithRSAEncryption";t.sha256WithRSAEncryption="1.2.840.113549.1.1.11";t["1.2.840.113549.1.1.12"]="sha384WithRSAEncryption";t.sha384WithRSAEncryption="1.2.840.113549.1.1.12";t["1.2.840.113549.1.1.13"]="sha512WithRSAEncryption";t.sha512WithRSAEncryption="1.2.840.113549.1.1.13";t["1.3.14.3.2.7"]="desCBC";t.desCBC="1.3.14.3.2.7";t["1.3.14.3.2.26"]="sha1";t.sha1="1.3.14.3.2.26";t["2.16.840.1.101.3.4.2.1"]="sha256";t.sha256="2.16.840.1.101.3.4.2.1";t["2.16.840.1.101.3.4.2.2"]="sha384";t.sha384="2.16.840.1.101.3.4.2.2";t["2.16.840.1.101.3.4.2.3"]="sha512";t.sha512="2.16.840.1.101.3.4.2.3";t["1.2.840.113549.2.5"]="md5";t.md5="1.2.840.113549.2.5";t["1.2.840.113549.1.7.1"]="data";t.data="1.2.840.113549.1.7.1";t["1.2.840.113549.1.7.2"]="signedData";t.signedData="1.2.840.113549.1.7.2";t["1.2.840.113549.1.7.3"]="envelopedData";t.envelopedData="1.2.840.113549.1.7.3";t["1.2.840.113549.1.7.4"]="signedAndEnvelopedData";t.signedAndEnvelopedData="1.2.840.113549.1.7.4";t["1.2.840.113549.1.7.5"]="digestedData";t.digestedData="1.2.840.113549.1.7.5";t["1.2.840.113549.1.7.6"]="encryptedData";t.encryptedData="1.2.840.113549.1.7.6";t["1.2.840.113549.1.9.1"]="emailAddress";t.emailAddress="1.2.840.113549.1.9.1";t["1.2.840.113549.1.9.2"]="unstructuredName";t.unstructuredName="1.2.840.113549.1.9.2";t["1.2.840.113549.1.9.3"]="contentType";t.contentType="1.2.840.113549.1.9.3";t["1.2.840.113549.1.9.4"]="messageDigest";t.messageDigest="1.2.840.113549.1.9.4";t["1.2.840.113549.1.9.5"]="signingTime";t.signingTime="1.2.840.113549.1.9.5";t["1.2.840.113549.1.9.6"]="counterSignature";t.counterSignature="1.2.840.113549.1.9.6";t["1.2.840.113549.1.9.7"]="challengePassword";t.challengePassword="1.2.840.113549.1.9.7";t["1.2.840.113549.1.9.8"]="unstructuredAddress";t.unstructuredAddress="1.2.840.113549.1.9.8";t["1.2.840.113549.1.9.14"]="extensionRequest";t.extensionRequest="1.2.840.113549.1.9.14";t["1.2.840.113549.1.9.20"]="friendlyName";t.friendlyName="1.2.840.113549.1.9.20";t["1.2.840.113549.1.9.21"]="localKeyId";t.localKeyId="1.2.840.113549.1.9.21";t["1.2.840.113549.1.9.22.1"]="x509Certificate";t.x509Certificate="1.2.840.113549.1.9.22.1";t["1.2.840.113549.1.12.10.1.1"]="keyBag";t.keyBag="1.2.840.113549.1.12.10.1.1";t["1.2.840.113549.1.12.10.1.2"]="pkcs8ShroudedKeyBag";t.pkcs8ShroudedKeyBag="1.2.840.113549.1.12.10.1.2";t["1.2.840.113549.1.12.10.1.3"]="certBag";t.certBag="1.2.840.113549.1.12.10.1.3";t["1.2.840.113549.1.12.10.1.4"]="crlBag";t.crlBag="1.2.840.113549.1.12.10.1.4";t["1.2.840.113549.1.12.10.1.5"]="secretBag";t.secretBag="1.2.840.113549.1.12.10.1.5";t["1.2.840.113549.1.12.10.1.6"]="safeContentsBag";t.safeContentsBag="1.2.840.113549.1.12.10.1.6";t["1.2.840.113549.1.5.13"]="pkcs5PBES2";t.pkcs5PBES2="1.2.840.113549.1.5.13";t["1.2.840.113549.1.5.12"]="pkcs5PBKDF2";t.pkcs5PBKDF2="1.2.840.113549.1.5.12";t["1.2.840.113549.1.12.1.1"]="pbeWithSHAAnd128BitRC4";t.pbeWithSHAAnd128BitRC4="1.2.840.113549.1.12.1.1";t["1.2.840.113549.1.12.1.2"]="pbeWithSHAAnd40BitRC4";t.pbeWithSHAAnd40BitRC4="1.2.840.113549.1.12.1.2";t["1.2.840.113549.1.12.1.3"]="pbeWithSHAAnd3-KeyTripleDES-CBC";t["pbeWithSHAAnd3-KeyTripleDES-CBC"]="1.2.840.113549.1.12.1.3";t["1.2.840.113549.1.12.1.4"]="pbeWithSHAAnd2-KeyTripleDES-CBC";t["pbeWithSHAAnd2-KeyTripleDES-CBC"]="1.2.840.113549.1.12.1.4";t["1.2.840.113549.1.12.1.5"]="pbeWithSHAAnd128BitRC2-CBC";t["pbeWithSHAAnd128BitRC2-CBC"]="1.2.840.113549.1.12.1.5";t["1.2.840.113549.1.12.1.6"]="pbewithSHAAnd40BitRC2-CBC";t["pbewithSHAAnd40BitRC2-CBC"]="1.2.840.113549.1.12.1.6";t["1.2.840.113549.3.7"]="des-EDE3-CBC";t["des-EDE3-CBC"]="1.2.840.113549.3.7";t["2.16.840.1.101.3.4.1.2"]="aes128-CBC";t["aes128-CBC"]="2.16.840.1.101.3.4.1.2";t["2.16.840.1.101.3.4.1.22"]="aes192-CBC";t["aes192-CBC"]="2.16.840.1.101.3.4.1.22";t["2.16.840.1.101.3.4.1.42"]="aes256-CBC";t["aes256-CBC"]="2.16.840.1.101.3.4.1.42";t["2.5.4.3"]="commonName";t.commonName="2.5.4.3";t["2.5.4.5"]="serialName";t.serialName="2.5.4.5";t["2.5.4.6"]="countryName";t.countryName="2.5.4.6";t["2.5.4.7"]="localityName";t.localityName="2.5.4.7";t["2.5.4.8"]="stateOrProvinceName";t.stateOrProvinceName="2.5.4.8";t["2.5.4.10"]="organizationName";t.organizationName="2.5.4.10";t["2.5.4.11"]="organizationalUnitName";t.organizationalUnitName="2.5.4.11";t["2.16.840.1.113730.1.1"]="nsCertType";t.nsCertType="2.16.840.1.113730.1.1";t["2.5.29.1"]="authorityKeyIdentifier";t["2.5.29.2"]="keyAttributes";t["2.5.29.3"]="certificatePolicies";t["2.5.29.4"]="keyUsageRestriction";t["2.5.29.5"]="policyMapping";t["2.5.29.6"]="subtreesConstraint";t["2.5.29.7"]="subjectAltName";t["2.5.29.8"]="issuerAltName";t["2.5.29.9"]="subjectDirectoryAttributes";t["2.5.29.10"]="basicConstraints";t["2.5.29.11"]="nameConstraints";t["2.5.29.12"]="policyConstraints";t["2.5.29.13"]="basicConstraints";t["2.5.29.14"]="subjectKeyIdentifier";t.subjectKeyIdentifier="2.5.29.14";t["2.5.29.15"]="keyUsage";t.keyUsage="2.5.29.15";t["2.5.29.16"]="privateKeyUsagePeriod";t["2.5.29.17"]="subjectAltName";t.subjectAltName="2.5.29.17";t["2.5.29.18"]="issuerAltName";t.issuerAltName="2.5.29.18";t["2.5.29.19"]="basicConstraints";t.basicConstraints="2.5.29.19";t["2.5.29.20"]="cRLNumber";t["2.5.29.21"]="cRLReason";t["2.5.29.22"]="expirationDate";t["2.5.29.23"]="instructionCode";t["2.5.29.24"]="invalidityDate";t["2.5.29.25"]="cRLDistributionPoints";t["2.5.29.26"]="issuingDistributionPoint";t["2.5.29.27"]="deltaCRLIndicator";t["2.5.29.28"]="issuingDistributionPoint";t["2.5.29.29"]="certificateIssuer";t["2.5.29.30"]="nameConstraints";t["2.5.29.31"]="cRLDistributionPoints";t["2.5.29.32"]="certificatePolicies";t["2.5.29.33"]="policyMappings";t["2.5.29.34"]="policyConstraints";t["2.5.29.35"]="authorityKeyIdentifier";t["2.5.29.36"]="policyConstraints";t["2.5.29.37"]="extKeyUsage";t.extKeyUsage="2.5.29.37";t["2.5.29.46"]="freshestCRL";t["2.5.29.54"]="inhibitAnyPolicy";t["1.3.6.1.5.5.7.3.1"]="serverAuth";t.serverAuth="1.3.6.1.5.5.7.3.1";t["1.3.6.1.5.5.7.3.2"]="clientAuth";t.clientAuth="1.3.6.1.5.5.7.3.2";t["1.3.6.1.5.5.7.3.3"]="codeSigning";t.codeSigning="1.3.6.1.5.5.7.3.3";t["1.3.6.1.5.5.7.3.4"]="emailProtection";t.emailProtection="1.3.6.1.5.5.7.3.4";t["1.3.6.1.5.5.7.3.8"]="timeStamping";t.timeStamping="1.3.6.1.5.5.7.3.8"}var i="oids",f,e,o,r;if(typeof n!="function"){if(typeof module!="object"||!module.exports)return typeof forge=="undefined"&&(forge={}),u(forge);f=!0;n=function(n,i){i(t,module)}}o=function(n,t){t.exports=function(t){var f=e.map(function(t){return n(t)}).concat(u),r;if(t=t||{},t.defined=t.defined||{},t.defined[i])return t[i];for(t.defined[i]=!0,r=0;r<f.length;++r)f[r](t);return t[i]}};r=n;n=function(t,i){return e=typeof t=="string"?i.slice(2):t.slice(2),f?(delete n,r.apply(null,Array.prototype.slice.call(arguments,0))):(n=r,n.apply(null,Array.prototype.slice.call(arguments,0)))};n("js/oids",["require","module"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function u(n){var t=n.asn1=n.asn1||{},i,r;t.Class={UNIVERSAL:0,APPLICATION:64,CONTEXT_SPECIFIC:128,PRIVATE:192};t.Type={NONE:0,BOOLEAN:1,INTEGER:2,BITSTRING:3,OCTETSTRING:4,NULL:5,OID:6,ODESC:7,EXTERNAL:8,REAL:9,ENUMERATED:10,EMBEDDED:11,UTF8:12,ROID:13,SEQUENCE:16,SET:17,PRINTABLESTRING:19,IA5STRING:22,UTCTIME:23,GENERALIZEDTIME:24,BMPSTRING:30};t.create=function(t,i,r,u){var e,f;if(n.util.isArray(u)){for(e=[],f=0;f<u.length;++f)u[f]!==undefined&&e.push(u[f]);u=e}return{tagClass:t,type:i,constructed:r,composed:r||n.util.isArray(u),value:u}};i=function(n){var t=n.getByte(),i,r;return t===128?undefined:(r=t&128,i=r?n.getInt((t&127)<<3):t,i)};t.fromDer=function(r,u){var o,e,a,h,c,b,v,k,y,p;if(u===undefined&&(u=!0),typeof r=="string"&&(r=n.util.createBuffer(r)),r.length()<2){o=new Error("Too few bytes to parse DER.");throw o.bytes=r.length(),o;}var s=r.getByte(),w=s&192,l=s&31,f=i(r);if(r.length()<f){if(u){o=new Error("Too few bytes to read ASN.1 value.");throw o.detail=r.length()+" < "+f,o;}f=r.length()}if(a=(s&32)==32,h=a,!h&&w===t.Class.UNIVERSAL&&l===t.Type.BITSTRING&&f>1){if(c=r.read,b=r.getByte(),b===0&&(s=r.getByte(),v=s&192,v===t.Class.UNIVERSAL||v===t.Class.CONTEXT_SPECIFIC))try{k=i(r);h=k===f-(r.read-c);h&&(++c,--f)}catch(d){}r.read=c}if(h)if(e=[],f===undefined)for(;;){if(r.bytes(2)===String.fromCharCode(0,0)){r.getBytes(2);break}e.push(t.fromDer(r,u))}else for(y=r.length();f>0;)e.push(t.fromDer(r,u)),f-=y-r.length(),y=r.length();else{if(f===undefined){if(u)throw new Error("Non-constructed ASN.1 object of indefinite length.");f=r.length()}if(l===t.Type.BMPSTRING)for(e="",p=0;p<f;p+=2)e+=String.fromCharCode(r.getInt16());else e=r.getBytes(f)}return t.create(w,l,a,e)};t.toDer=function(i){var f=n.util.createBuffer(),s=i.tagClass|i.type,u=n.util.createBuffer(),o,e,r;if(i.composed)for(i.constructed?s|=32:u.putByte(0),r=0;r<i.value.length;++r)i.value[r]!==undefined&&u.putBuffer(t.toDer(i.value[r]));else if(i.type===t.Type.BMPSTRING)for(r=0;r<i.value.length;++r)u.putInt16(i.value.charCodeAt(r));else u.putBytes(i.value);if(f.putByte(s),u.length()<=127)f.putByte(u.length()&127);else{o=u.length();e="";do e+=String.fromCharCode(o&255),o>>>=8;while(o>0);for(f.putByte(e.length|128),r=e.length-1;r>=0;--r)f.putByte(e.charCodeAt(r))}return f.putBuffer(u),f};t.oidToDer=function(t){var i=t.split("."),o=n.util.createBuffer(),s,r,u,h,f,e;for(o.putByte(40*parseInt(i[0],10)+parseInt(i[1],10)),f=2;f<i.length;++f){s=!0;r=[];u=parseInt(i[f],10);do h=u&127,u>>>=7,s||(h|=128),r.push(h),s=!1;while(u>0);for(e=r.length-1;e>=0;--e)o.putByte(r[e])}return o};t.derToOid=function(t){var u,i,r;for(typeof t=="string"&&(t=n.util.createBuffer(t)),i=t.getByte(),u=Math.floor(i/40)+"."+i%40,r=0;t.length()>0;)i=t.getByte(),r<<=7,i&128?r+=i&127:(u+="."+(r+i),r=0);return u};t.utcTimeToDate=function(n){var t=new Date,u=parseInt(n.substr(0,2),10),i,r;u=u>=50?1900+u:2e3+u;var o=parseInt(n.substr(2,2),10)-1,s=parseInt(n.substr(4,2),10),h=parseInt(n.substr(6,2),10),c=parseInt(n.substr(8,2),10),e=0;if(n.length>11&&(i=n.charAt(10),r=10,i!=="+"&&i!=="-"&&(e=parseInt(n.substr(10,2),10),r+=2)),t.setUTCFullYear(u,o,s),t.setUTCHours(h,c,e,0),r&&(i=n.charAt(r),i==="+"||i==="-")){var l=parseInt(n.substr(r+1,2),10),a=parseInt(n.substr(r+4,2),10),f=l*60+a;f*=6e4;i==="+"?t.setTime(+t-f):t.setTime(+t+f)}return t};t.generalizedTimeToDate=function(n){var t=new Date,o=parseInt(n.substr(0,4),10),s=parseInt(n.substr(4,2),10)-1,h=parseInt(n.substr(6,2),10),c=parseInt(n.substr(8,2),10),l=parseInt(n.substr(10,2),10),a=parseInt(n.substr(12,2),10),f=0,i=0,e=!1,r,u,v,y;return n.charAt(n.length-1)==="Z"&&(e=!0),r=n.length-5,u=n.charAt(r),(u==="+"||u==="-")&&(v=parseInt(n.substr(r+1,2),10),y=parseInt(n.substr(r+4,2),10),i=v*60+y,i*=6e4,u==="+"&&(i*=-1),e=!0),n.charAt(14)==="."&&(f=parseFloat(n.substr(14),10)*1e3),e?(t.setUTCFullYear(o,s,h),t.setUTCHours(c,l,a,f),t.setTime(+t+i)):(t.setFullYear(o,s,h),t.setHours(c,l,a,f)),t};t.dateToUtcTime=function(n){var r="",t=[],i;for(t.push((""+n.getUTCFullYear()).substr(2)),t.push(""+(n.getUTCMonth()+1)),t.push(""+n.getUTCDate()),t.push(""+n.getUTCHours()),t.push(""+n.getUTCMinutes()),t.push(""+n.getUTCSeconds()),i=0;i<t.length;++i)t[i].length<2&&(r+="0"),r+=t[i];return r+="Z",r};t.integerToDer=function(t){var i=n.util.createBuffer(),r;if(t>=-128&&t<128)return i.putSignedInt(t,8);if(t>=-32768&&t<32768)return i.putSignedInt(t,16);if(t>=-8388608&&t<8388608)return i.putSignedInt(t,24);if(t>=-2147483648&&t<2147483648)return i.putSignedInt(t,32);r=new Error("Integer too large; max is 32-bits.");throw r.integer=t,r;};t.derToInteger=function(t){typeof t=="string"&&(t=n.util.createBuffer(t));var i=t.length()*8;if(i>32)throw new Error("Integer too large; max is 32-bits.");return t.getSignedInt(i)};t.validate=function(i,r,u,f){var e=!1,s,o;if(i.tagClass!==r.tagClass&&typeof r.tagClass!="undefined"||i.type!==r.type&&typeof r.type!="undefined")f&&(i.tagClass!==r.tagClass&&f.push("["+r.name+'] Expected tag class "'+r.tagClass+'", got "'+i.tagClass+'"'),i.type!==r.type&&f.push("["+r.name+'] Expected type "'+r.type+'", got "'+i.type+'"'));else if(i.constructed===r.constructed||typeof r.constructed=="undefined"){if(e=!0,r.value&&n.util.isArray(r.value))for(s=0,o=0;e&&o<r.value.length;++o)e=r.value[o].optional||!1,i.value[s]&&(e=t.validate(i.value[s],r.value[o],u,f),e?++s:r.value[o].optional&&(e=!0)),!e&&f&&f.push("["+r.name+'] Tag class "'+r.tagClass+'", type "'+r.type+'" expected value length "'+r.value.length+'", got "'+i.value.length+'"');e&&u&&(r.capture&&(u[r.capture]=i.value),r.captureAsn1&&(u[r.captureAsn1]=i))}else f&&f.push("["+r.name+'] Expected constructed "'+r.constructed+'", got "'+i.constructed+'"');return e};r=/[^\\u0000-\\u00ff]/;t.prettyPrint=function(i,u,f){var e="",s,l,h,o,c;for(u=u||0,f=f||2,u>0&&(e+="\n"),s="",o=0;o<u*f;++o)s+=" ";e+=s+"Tag: ";switch(i.tagClass){case t.Class.UNIVERSAL:e+="Universal:";break;case t.Class.APPLICATION:e+="Application:";break;case t.Class.CONTEXT_SPECIFIC:e+="Context-Specific:";break;case t.Class.PRIVATE:e+="Private:"}if(i.tagClass===t.Class.UNIVERSAL){e+=i.type;switch(i.type){case t.Type.NONE:e+=" (None)";break;case t.Type.BOOLEAN:e+=" (Boolean)";break;case t.Type.BITSTRING:e+=" (Bit string)";break;case t.Type.INTEGER:e+=" (Integer)";break;case t.Type.OCTETSTRING:e+=" (Octet string)";break;case t.Type.NULL:e+=" (Null)";break;case t.Type.OID:e+=" (Object Identifier)";break;case t.Type.ODESC:e+=" (Object Descriptor)";break;case t.Type.EXTERNAL:e+=" (External or Instance of)";break;case t.Type.REAL:e+=" (Real)";break;case t.Type.ENUMERATED:e+=" (Enumerated)";break;case t.Type.EMBEDDED:e+=" (Embedded PDV)";break;case t.Type.UTF8:e+=" (UTF8)";break;case t.Type.ROID:e+=" (Relative Object Identifier)";break;case t.Type.SEQUENCE:e+=" (Sequence)";break;case t.Type.SET:e+=" (Set)";break;case t.Type.PRINTABLESTRING:e+=" (Printable String)";break;case t.Type.IA5String:e+=" (IA5String (ASCII))";break;case t.Type.UTCTIME:e+=" (UTC time)";break;case t.Type.GENERALIZEDTIME:e+=" (Generalized time)";break;case t.Type.BMPSTRING:e+=" (BMP String)"}}else e+=i.type;if(e+="\n",e+=s+"Constructed: "+i.constructed+"\n",i.composed){for(l=0,h="",o=0;o<i.value.length;++o)i.value[o]!==undefined&&(l+=1,h+=t.prettyPrint(i.value[o],u+1,f),o+1<i.value.length&&(h+=","));e+=s+"Sub values: "+l+h}else if(e+=s+"Value: ",i.type===t.Type.OID&&(c=t.derToOid(i.value),e+=c,n.pki&&n.pki.oids&&c in n.pki.oids&&(e+=" ("+n.pki.oids[c]+") ")),i.type===t.Type.INTEGER)try{e+=t.derToInteger(i.value)}catch(a){e+="0x"+n.util.bytesToHex(i.value)}else i.type===t.Type.OCTETSTRING?(r.test(i.value)||(e+="("+i.value+") "),e+="0x"+n.util.bytesToHex(i.value)):e+=i.type===t.Type.UTF8?n.util.decodeUtf8(i.value):i.type===t.Type.PRINTABLESTRING||i.type===t.Type.IA5String?i.value:r.test(i.value)?"0x"+n.util.bytesToHex(i.value):i.value.length===0?"[null]":i.value;return e}}var i="asn1",f,e,o,r;if(typeof n!="function"){if(typeof module!="object"||!module.exports)return typeof forge=="undefined"&&(forge={}),u(forge);f=!0;n=function(n,i){i(t,module)}}o=function(n,t){t.exports=function(t){var f=e.map(function(t){return n(t)}).concat(u),r;if(t=t||{},t.defined=t.defined||{},t.defined[i])return t[i];for(t.defined[i]=!0,r=0;r<f.length;++r)f[r](t);return t[i]}};r=n;n=function(t,i){return e=typeof t=="string"?i.slice(2):t.slice(2),f?(delete n,r.apply(null,Array.prototype.slice.call(arguments,0))):(n=r,n.apply(null,Array.prototype.slice.call(arguments,0)))};n("js/asn1",["require","module","./util","./oids"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function u(n){function s(){u=String.fromCharCode(128);u+=n.util.fillString(String.fromCharCode(0),64);r=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,1,6,11,0,5,10,15,4,9,14,3,8,13,2,7,12,5,8,11,14,1,4,7,10,13,0,3,6,9,12,15,2,0,7,14,5,12,3,10,1,8,15,6,13,4,11,2,9];i=[7,12,17,22,7,12,17,22,7,12,17,22,7,12,17,22,5,9,14,20,5,9,14,20,5,9,14,20,5,9,14,20,4,11,16,23,4,11,16,23,4,11,16,23,4,11,16,23,6,10,15,21,6,10,15,21,6,10,15,21,6,10,15,21];t=new Array(64);for(var f=0;f<64;++f)t[f]=Math.floor(Math.abs(Math.sin(f+1))*4294967296);o=!0}function f(n,u,f){for(var c,a,h,o,s,v,l,e,y=f.length();y>=64;){for(a=n.h0,h=n.h1,o=n.h2,s=n.h3,e=0;e<16;++e)u[e]=f.getInt32Le(),v=s^h&(o^s),c=a+v+t[e]+u[e],l=i[e],a=s,s=o,o=h,h+=c<<l|c>>>32-l;for(;e<32;++e)v=o^s&(h^o),c=a+v+t[e]+u[r[e]],l=i[e],a=s,s=o,o=h,h+=c<<l|c>>>32-l;for(;e<48;++e)v=h^o^s,c=a+v+t[e]+u[r[e]],l=i[e],a=s,s=o,o=h,h+=c<<l|c>>>32-l;for(;e<64;++e)v=o^(h|~s),c=a+v+t[e]+u[r[e]],l=i[e],a=s,s=o,o=h,h+=c<<l|c>>>32-l;n.h0=n.h0+a|0;n.h1=n.h1+h|0;n.h2=n.h2+o|0;n.h3=n.h3+s|0;y-=64}}var e=n.md5=n.md5||{};n.md=n.md||{};n.md.algorithms=n.md.algorithms||{};n.md.md5=n.md.algorithms.md5=e;e.create=function(){o||s();var r=null,i=n.util.createBuffer(),e=new Array(16),t={algorithm:"md5",blockLength:64,digestLength:16,messageLength:0,messageLength64:[0,0]};return t.start=function(){return t.messageLength=0,t.messageLength64=[0,0],i=n.util.createBuffer(),r={h0:1732584193,h1:4023233417,h2:2562383102,h3:271733878},t},t.start(),t.update=function(u,o){return o==="utf8"&&(u=n.util.encodeUtf8(u)),t.messageLength+=u.length,t.messageLength64[0]+=u.length/4294967296>>>0,t.messageLength64[1]+=u.length>>>0,i.putBytes(u),f(r,e,i),(i.read>2048||i.length()===0)&&i.compact(),t},t.digest=function(){var h=n.util.createBuffer(),o,s;return h.putBytes(i.bytes()),h.putBytes(u.substr(0,64-(t.messageLength64[1]+8&63))),h.putInt32Le(t.messageLength64[1]<<3),h.putInt32Le(t.messageLength64[0]<<3|t.messageLength64[0]>>>28),o={h0:r.h0,h1:r.h1,h2:r.h2,h3:r.h3},f(o,e,h),s=n.util.createBuffer(),s.putInt32Le(o.h0),s.putInt32Le(o.h1),s.putInt32Le(o.h2),s.putInt32Le(o.h3),s},t};var u=null,r=null,i=null,t=null,o=!1}var i="md5",f,e,o,r;if(typeof n!="function"){if(typeof module!="object"||!module.exports)return typeof forge=="undefined"&&(forge={}),u(forge);f=!0;n=function(n,i){i(t,module)}}o=function(n,t){t.exports=function(t){var f=e.map(function(t){return n(t)}).concat(u),r;if(t=t||{},t.defined=t.defined||{},t.defined[i])return t[i];for(t.defined[i]=!0,r=0;r<f.length;++r)f[r](t);return t[i]}};r=n;n=function(t,i){return e=typeof t=="string"?i.slice(2):t.slice(2),f?(delete n,r.apply(null,Array.prototype.slice.call(arguments,0))):(n=r,n.apply(null,Array.prototype.slice.call(arguments,0)))};n("js/md5",["require","module","./util"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function u(n){function f(){t=String.fromCharCode(128);t+=n.util.fillString(String.fromCharCode(0),64);i=!0}function r(n,t,i){for(var r,e,f,s,o,h,c,u,l=i.length();l>=64;){for(e=n.h0,f=n.h1,s=n.h2,o=n.h3,h=n.h4,u=0;u<16;++u)r=i.getInt32(),t[u]=r,c=o^f&(s^o),r=(e<<5|e>>>27)+c+h+1518500249+r,h=o,o=s,s=f<<30|f>>>2,f=e,e=r;for(;u<20;++u)r=t[u-3]^t[u-8]^t[u-14]^t[u-16],r=r<<1|r>>>31,t[u]=r,c=o^f&(s^o),r=(e<<5|e>>>27)+c+h+1518500249+r,h=o,o=s,s=f<<30|f>>>2,f=e,e=r;for(;u<32;++u)r=t[u-3]^t[u-8]^t[u-14]^t[u-16],r=r<<1|r>>>31,t[u]=r,c=f^s^o,r=(e<<5|e>>>27)+c+h+1859775393+r,h=o,o=s,s=f<<30|f>>>2,f=e,e=r;for(;u<40;++u)r=t[u-6]^t[u-16]^t[u-28]^t[u-32],r=r<<2|r>>>30,t[u]=r,c=f^s^o,r=(e<<5|e>>>27)+c+h+1859775393+r,h=o,o=s,s=f<<30|f>>>2,f=e,e=r;for(;u<60;++u)r=t[u-6]^t[u-16]^t[u-28]^t[u-32],r=r<<2|r>>>30,t[u]=r,c=f&s|o&(f^s),r=(e<<5|e>>>27)+c+h+2400959708+r,h=o,o=s,s=f<<30|f>>>2,f=e,e=r;for(;u<80;++u)r=t[u-6]^t[u-16]^t[u-28]^t[u-32],r=r<<2|r>>>30,t[u]=r,c=f^s^o,r=(e<<5|e>>>27)+c+h+3395469782+r,h=o,o=s,s=f<<30|f>>>2,f=e,e=r;n.h0=n.h0+e|0;n.h1=n.h1+f|0;n.h2=n.h2+s|0;n.h3=n.h3+o|0;n.h4=n.h4+h|0;l-=64}}var u=n.sha1=n.sha1||{},t,i;n.md=n.md||{};n.md.algorithms=n.md.algorithms||{};n.md.sha1=n.md.algorithms.sha1=u;u.create=function(){i||f();var e=null,o=n.util.createBuffer(),s=new Array(80),u={algorithm:"sha1",blockLength:64,digestLength:20,messageLength:0,messageLength64:[0,0]};return u.start=function(){return u.messageLength=0,u.messageLength64=[0,0],o=n.util.createBuffer(),e={h0:1732584193,h1:4023233417,h2:2562383102,h3:271733878,h4:3285377520},u},u.start(),u.update=function(t,i){return i==="utf8"&&(t=n.util.encodeUtf8(t)),u.messageLength+=t.length,u.messageLength64[0]+=t.length/4294967296>>>0,u.messageLength64[1]+=t.length>>>0,o.putBytes(t),r(e,s,o),(o.read>2048||o.length()===0)&&o.compact(),u},u.digest=function(){var h=n.util.createBuffer(),i,f;return h.putBytes(o.bytes()),h.putBytes(t.substr(0,64-(u.messageLength64[1]+8&63))),h.putInt32(u.messageLength64[0]<<3|u.messageLength64[0]>>>28),h.putInt32(u.messageLength64[1]<<3),i={h0:e.h0,h1:e.h1,h2:e.h2,h3:e.h3,h4:e.h4},r(i,s,h),f=n.util.createBuffer(),f.putInt32(i.h0),f.putInt32(i.h1),f.putInt32(i.h2),f.putInt32(i.h3),f.putInt32(i.h4),f},u};t=null;i=!1}var i="sha1",f,e,o,r;if(typeof n!="function"){if(typeof module!="object"||!module.exports)return typeof forge=="undefined"&&(forge={}),u(forge);f=!0;n=function(n,i){i(t,module)}}o=function(n,t){t.exports=function(t){var f=e.map(function(t){return n(t)}).concat(u),r;if(t=t||{},t.defined=t.defined||{},t.defined[i])return t[i];for(t.defined[i]=!0,r=0;r<f.length;++r)f[r](t);return t[i]}};r=n;n=function(t,i){return e=typeof t=="string"?i.slice(2):t.slice(2),f?(delete n,r.apply(null,Array.prototype.slice.call(arguments,0))):(n=r,n.apply(null,Array.prototype.slice.call(arguments,0)))};n("js/sha1",["require","module","./util"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function u(n){function e(){t=String.fromCharCode(128);t+=n.util.fillString(String.fromCharCode(0),64);f=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];u=!0}function i(n,t,i){for(var e,s,p,w,b,k,r,u,h,l,v,o,a,c,y,d=i.length();d>=64;){for(r=0;r<16;++r)t[r]=i.getInt32();for(;r<64;++r)e=t[r-2],e=(e>>>17|e<<15)^(e>>>19|e<<13)^e>>>10,s=t[r-15],s=(s>>>7|s<<25)^(s>>>18|s<<14)^s>>>3,t[r]=e+t[r-7]+s+t[r-16]|0;for(u=n.h0,h=n.h1,l=n.h2,v=n.h3,o=n.h4,a=n.h5,c=n.h6,y=n.h7,r=0;r<64;++r)w=(o>>>6|o<<26)^(o>>>11|o<<21)^(o>>>25|o<<7),b=c^o&(a^c),p=(u>>>2|u<<30)^(u>>>13|u<<19)^(u>>>22|u<<10),k=u&h|l&(u^h),e=y+w+b+f[r]+t[r],s=p+k,y=c,c=a,a=o,o=v+e|0,v=l,l=h,h=u,u=e+s|0;n.h0=n.h0+u|0;n.h1=n.h1+h|0;n.h2=n.h2+l|0;n.h3=n.h3+v|0;n.h4=n.h4+o|0;n.h5=n.h5+a|0;n.h6=n.h6+c|0;n.h7=n.h7+y|0;d-=64}}var r=n.sha256=n.sha256||{};n.md=n.md||{};n.md.algorithms=n.md.algorithms||{};n.md.sha256=n.md.algorithms.sha256=r;r.create=function(){u||e();var f=null,o=n.util.createBuffer(),s=new Array(64),r={algorithm:"sha256",blockLength:64,digestLength:32,messageLength:0,messageLength64:[0,0]};return r.start=function(){return r.messageLength=0,r.messageLength64=[0,0],o=n.util.createBuffer(),f={h0:1779033703,h1:3144134277,h2:1013904242,h3:2773480762,h4:1359893119,h5:2600822924,h6:528734635,h7:1541459225},r},r.start(),r.update=function(t,u){return u==="utf8"&&(t=n.util.encodeUtf8(t)),r.messageLength+=t.length,r.messageLength64[0]+=t.length/4294967296>>>0,r.messageLength64[1]+=t.length>>>0,o.putBytes(t),i(f,s,o),(o.read>2048||o.length()===0)&&o.compact(),r},r.digest=function(){var h=n.util.createBuffer(),u,e;return h.putBytes(o.bytes()),h.putBytes(t.substr(0,64-(r.messageLength64[1]+8&63))),h.putInt32(r.messageLength64[0]<<3|r.messageLength64[0]>>>28),h.putInt32(r.messageLength64[1]<<3),u={h0:f.h0,h1:f.h1,h2:f.h2,h3:f.h3,h4:f.h4,h5:f.h5,h6:f.h6,h7:f.h7},i(u,s,h),e=n.util.createBuffer(),e.putInt32(u.h0),e.putInt32(u.h1),e.putInt32(u.h2),e.putInt32(u.h3),e.putInt32(u.h4),e.putInt32(u.h5),e.putInt32(u.h6),e.putInt32(u.h7),e},r};var t=null,u=!1,f=null}var i="sha256",f,e,o,r;if(typeof n!="function"){if(typeof module!="object"||!module.exports)return typeof forge=="undefined"&&(forge={}),u(forge);f=!0;n=function(n,i){i(t,module)}}o=function(n,t){t.exports=function(t){var f=e.map(function(t){return n(t)}).concat(u),r;if(t=t||{},t.defined=t.defined||{},t.defined[i])return t[i];for(t.defined[i]=!0,r=0;r<f.length;++r)f[r](t);return t[i]}};r=n;n=function(t,i){return e=typeof t=="string"?i.slice(2):t.slice(2),f?(delete n,r.apply(null,Array.prototype.slice.call(arguments,0))):(n=r,n.apply(null,Array.prototype.slice.call(arguments,0)))};n("js/sha256",["require","module","./util"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function u(n){function s(){u=String.fromCharCode(128);u+=n.util.fillString(String.fromCharCode(0),128);f=[[1116352408,3609767458],[1899447441,602891725],[3049323471,3964484399],[3921009573,2173295548],[961987163,4081628472],[1508970993,3053834265],[2453635748,2937671579],[2870763221,3664609560],[3624381080,2734883394],[310598401,1164996542],[607225278,1323610764],[1426881987,3590304994],[1925078388,4068182383],[2162078206,991336113],[2614888103,633803317],[3248222580,3479774868],[3835390401,2666613458],[4022224774,944711139],[264347078,2341262773],[604807628,2007800933],[770255983,1495990901],[1249150122,1856431235],[1555081692,3175218132],[1996064986,2198950837],[2554220882,3999719339],[2821834349,766784016],[2952996808,2566594879],[3210313671,3203337956],[3336571891,1034457026],[3584528711,2466948901],[113926993,3758326383],[338241895,168717936],[666307205,1188179964],[773529912,1546045734],[1294757372,1522805485],[1396182291,2643833823],[1695183700,2343527390],[1986661051,1014477480],[2177026350,1206759142],[2456956037,344077627],[2730485921,1290863460],[2820302411,3158454273],[3259730800,3505952657],[3345764771,106217008],[3516065817,3606008344],[3600352804,1432725776],[4094571909,1467031594],[275423344,851169720],[430227734,3100823752],[506948616,1363258195],[659060556,3750685593],[883997877,3785050280],[958139571,3318307427],[1322822218,3812723403],[1537002063,2003034995],[1747873779,3602036899],[1955562222,1575990012],[2024104815,1125592928],[2227730452,2716904306],[2361852424,442776044],[2428436474,593698344],[2756734187,3733110249],[3204031479,2999351573],[3329325298,3815920427],[3391569614,3928383900],[3515267271,566280711],[3940187606,3454069534],[4118630271,4000239992],[116418474,1914138554],[174292421,2731055270],[289380356,3203993006],[460393269,320620315],[685471733,587496836],[852142971,1086792851],[1017036298,365543100],[1126000580,2618297676],[1288033470,3409855158],[1501505948,4234509866],[1607167915,987167468],[1816402316,1246189591]];t={};t["SHA-512"]=[[1779033703,4089235720],[3144134277,2227873595],[1013904242,4271175723],[2773480762,1595750129],[1359893119,2917565137],[2600822924,725511199],[528734635,4215389547],[1541459225,327033209]];t["SHA-384"]=[[3418070365,3238371032],[1654270250,914150663],[2438529370,812702999],[355462360,4144912697],[1731405415,4290775857],[2394180231,1750603025],[3675008525,1694076839],[1203062813,3204075428]];t["SHA-512/256"]=[[573645204,4230739756],[2673172387,3360449730],[596883563,1867755857],[2520282905,1497426621],[2519219938,2827943907],[3193839141,1401305490],[721525244,746961066],[246885852,2177182882]];t["SHA-512/224"]=[[2352822216,424955298],[1944164710,2312950998],[502970286,855612546],[1738396948,1479516111],[258812777,2077511080],[2011393907,79989058],[1067287976,1780299464],[286451373,2446758561]];o=!0}function e(n,t,i){for(var p,w,nt,tt,ct,lt,at,vt,yt,pt,wt,bt,o,s,l,a,b,k,it,rt,h,c,d,g,v,y,ut,ft,u,e,r,et,ot,st,ht,kt=i.length();kt>=128;){for(u=0;u<16;++u)t[u][0]=i.getInt32()>>>0,t[u][1]=i.getInt32()>>>0;for(;u<80;++u)et=t[u-2],e=et[0],r=et[1],p=((e>>>19|r<<13)^(r>>>29|e<<3)^e>>>6)>>>0,w=((e<<13|r>>>19)^(r<<3|e>>>29)^(e<<26|r>>>6))>>>0,st=t[u-15],e=st[0],r=st[1],nt=((e>>>1|r<<31)^(e>>>8|r<<24)^e>>>7)>>>0,tt=((e<<31|r>>>1)^(e<<24|r>>>8)^(e<<25|r>>>7))>>>0,ot=t[u-7],ht=t[u-16],r=w+ot[1]+tt+ht[1],t[u][0]=p+ot[0]+nt+ht[0]+(r/4294967296>>>0)>>>0,t[u][1]=r>>>0;for(o=n[0][0],s=n[0][1],l=n[1][0],a=n[1][1],b=n[2][0],k=n[2][1],it=n[3][0],rt=n[3][1],h=n[4][0],c=n[4][1],d=n[5][0],g=n[5][1],v=n[6][0],y=n[6][1],ut=n[7][0],ft=n[7][1],u=0;u<80;++u)at=((h>>>14|c<<18)^(h>>>18|c<<14)^(c>>>9|h<<23))>>>0,vt=((h<<18|c>>>14)^(h<<14|c>>>18)^(c<<23|h>>>9))>>>0,yt=(v^h&(d^v))>>>0,pt=(y^c&(g^y))>>>0,ct=((o>>>28|s<<4)^(s>>>2|o<<30)^(s>>>7|o<<25))>>>0,lt=((o<<4|s>>>28)^(s<<30|o>>>2)^(s<<25|o>>>7))>>>0,wt=(o&l|b&(o^l))>>>0,bt=(s&a|k&(s^a))>>>0,r=ft+vt+pt+f[u][1]+t[u][1],p=ut+at+yt+f[u][0]+t[u][0]+(r/4294967296>>>0)>>>0,w=r>>>0,r=lt+bt,nt=ct+wt+(r/4294967296>>>0)>>>0,tt=r>>>0,ut=v,ft=y,v=d,y=g,d=h,g=c,r=rt+w,h=it+p+(r/4294967296>>>0)>>>0,c=r>>>0,it=b,rt=k,b=l,k=a,l=o,a=s,r=w+tt,o=p+nt+(r/4294967296>>>0)>>>0,s=r>>>0;r=n[0][1]+s;n[0][0]=n[0][0]+o+(r/4294967296>>>0)>>>0;n[0][1]=r>>>0;r=n[1][1]+a;n[1][0]=n[1][0]+l+(r/4294967296>>>0)>>>0;n[1][1]=r>>>0;r=n[2][1]+k;n[2][0]=n[2][0]+b+(r/4294967296>>>0)>>>0;n[2][1]=r>>>0;r=n[3][1]+rt;n[3][0]=n[3][0]+it+(r/4294967296>>>0)>>>0;n[3][1]=r>>>0;r=n[4][1]+c;n[4][0]=n[4][0]+h+(r/4294967296>>>0)>>>0;n[4][1]=r>>>0;r=n[5][1]+g;n[5][0]=n[5][0]+d+(r/4294967296>>>0)>>>0;n[5][1]=r>>>0;r=n[6][1]+y;n[6][0]=n[6][0]+v+(r/4294967296>>>0)>>>0;n[6][1]=r>>>0;r=n[7][1]+ft;n[7][0]=n[7][0]+ut+(r/4294967296>>>0)>>>0;n[7][1]=r>>>0;kt-=128}}var i=n.sha512=n.sha512||{},r;n.md=n.md||{};n.md.algorithms=n.md.algorithms||{};n.md.sha512=n.md.algorithms.sha512=i;r=n.sha384=n.sha512.sha384=n.sha512.sha384||{};r.create=function(){return i.create("SHA-384")};n.md.sha384=n.md.algorithms.sha384=r;n.sha512.sha256=n.sha512.sha256||{create:function(){return i.create("SHA-512/256")}};n.md["sha512/256"]=n.md.algorithms["sha512/256"]=n.sha512.sha256;n.sha512.sha224=n.sha512.sha224||{create:function(){return i.create("SHA-512/224")}};n.md["sha512/224"]=n.md.algorithms["sha512/224"]=n.sha512.sha224;i.create=function(i){var c,r;if(o||s(),typeof i=="undefined"&&(i="SHA-512"),i in t){var l=t[i],h=null,f=n.util.createBuffer(),a=new Array(80);for(c=0;c<80;++c)a[c]=new Array(2);return r={algorithm:i.replace("-","").toLowerCase(),blockLength:128,digestLength:64,messageLength:0,messageLength128:[0,0,0,0]},r.start=function(){r.messageLength=0;r.messageLength128=[0,0,0,0];f=n.util.createBuffer();h=new Array(l.length);for(var t=0;t<l.length;++t)h[t]=l[t].slice(0);return r},r.start(),r.update=function(t,i){var u,o;for(i==="utf8"&&(t=n.util.encodeUtf8(t)),r.messageLength+=t.length,u=t.length,u=[u/4294967296>>>0,u>>>0],o=3;o>=0;--o)r.messageLength128[o]+=u[1],u[1]=u[0]+(r.messageLength128[o]/4294967296>>>0),r.messageLength128[o]=r.messageLength128[o]>>>0,u[0]=u[1]/4294967296>>>0;return f.putBytes(t),e(h,a,f),(f.read>2048||f.length()===0)&&f.compact(),r},r.digest=function(){var s=n.util.createBuffer(),c,o,l,v,t;for(s.putBytes(f.bytes()),s.putBytes(u.substr(0,128-(r.messageLength128[3]+16&127))),c=[],t=0;t<3;++t)c[t]=r.messageLength128[t]<<3|r.messageLength128[t-1]>>>28;for(c[3]=r.messageLength128[3]<<3,s.putInt32(c[0]),s.putInt32(c[1]),s.putInt32(c[2]),s.putInt32(c[3]),o=new Array(h.length),t=0;t<h.length;++t)o[t]=h[t].slice(0);for(e(o,a,s),l=n.util.createBuffer(),v=i==="SHA-512"?o.length:i==="SHA-384"?o.length-2:o.length-4,t=0;t<v;++t)l.putInt32(o[t][0]),(t!==v-1||i!=="SHA-512/224")&&l.putInt32(o[t][1]);return l},r}throw new Error("Invalid SHA-512 algorithm: "+i);};var u=null,o=!1,f=null,t=null}var i="sha512",f,e,o,r;if(typeof n!="function"){if(typeof module!="object"||!module.exports)return typeof forge=="undefined"&&(forge={}),u(forge);f=!0;n=function(n,i){i(t,module)}}o=function(n,t){t.exports=function(t){var f=e.map(function(t){return n(t)}).concat(u),r;if(t=t||{},t.defined=t.defined||{},t.defined[i])return t[i];for(t.defined[i]=!0,r=0;r<f.length;++r)f[r](t);return t[i]}};r=n;n=function(t,i){return e=typeof t=="string"?i.slice(2):t.slice(2),f?(delete n,r.apply(null,Array.prototype.slice.call(arguments,0))):(n=r,n.apply(null,Array.prototype.slice.call(arguments,0)))};n("js/sha512",["require","module","./util"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function u(n){n.md=n.md||{};n.md.algorithms={md5:n.md5,sha1:n.sha1,sha256:n.sha256};n.md.md5=n.md5;n.md.sha1=n.sha1;n.md.sha256=n.sha256}var i="md",f,e,o,r;if(typeof n!="function"){if(typeof module!="object"||!module.exports)return typeof forge=="undefined"&&(forge={}),u(forge);f=!0;n=function(n,i){i(t,module)}}o=function(n,t){t.exports=function(t){var f=e.map(function(t){return n(t)}).concat(u),r;if(t=t||{},t.defined=t.defined||{},t.defined[i])return t[i];for(t.defined[i]=!0,r=0;r<f.length;++r)f[r](t);return t[i]}};r=n;n=function(t,i){return e=typeof t=="string"?i.slice(2):t.slice(2),f?(delete n,r.apply(null,Array.prototype.slice.call(arguments,0))):(n=r,n.apply(null,Array.prototype.slice.call(arguments,0)))};n("js/md",["require","module","./md5","./sha1","./sha256","./sha512"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function u(n){var t=n.hmac=n.hmac||{};t.create=function(){var f=null,t=null,i=null,r=null,u={};return u.start=function(u,e){var h,s,o;if(u!==null)if(typeof u=="string"){if(u=u.toLowerCase(),!(u in n.md.algorithms))throw new Error('Unknown hash algorithm "'+u+'"');t=n.md.algorithms[u].create()}else t=u;if(e===null)e=f;else{if(typeof e=="string")e=n.util.createBuffer(e);else if(n.util.isArray(e))for(s=e,e=n.util.createBuffer(),o=0;o<s.length;++o)e.putByte(s[o]);for(h=e.length(),h>t.blockLength&&(t.start(),t.update(e.bytes()),e=t.digest()),i=n.util.createBuffer(),r=n.util.createBuffer(),h=e.length(),o=0;o<h;++o)s=e.at(o),i.putByte(54^s),r.putByte(92^s);if(h<t.blockLength)for(s=t.blockLength-h,o=0;o<s;++o)i.putByte(54),r.putByte(92);f=e;i=i.bytes();r=r.bytes()}t.start();t.update(i)},u.update=function(n){t.update(n)},u.getMac=function(){var n=t.digest().bytes();return t.start(),t.update(r),t.update(n),t.digest()},u.digest=u.getMac,u}}var i="hmac",f,e,o,r;if(typeof n!="function"){if(typeof module!="object"||!module.exports)return typeof forge=="undefined"&&(forge={}),u(forge);f=!0;n=function(n,i){i(t,module)}}o=function(n,t){t.exports=function(t){var f=e.map(function(t){return n(t)}).concat(u),r;if(t=t||{},t.defined=t.defined||{},t.defined[i])return t[i];for(t.defined[i]=!0,r=0;r<f.length;++r)f[r](t);return t[i]}};r=n;n=function(t,i){return e=typeof t=="string"?i.slice(2):t.slice(2),f?(delete n,r.apply(null,Array.prototype.slice.call(arguments,0))):(n=r,n.apply(null,Array.prototype.slice.call(arguments,0)))};n("js/hmac",["require","module","./md","./util"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function u(n){function t(n){for(var u,r,f,t=n.name+": ",e=[],o=function(n,t){return" "+t},i=0;i<n.values.length;++i)e.push(n.values[i].replace(/^(\S+\r\n)/,o));for(t+=e.join(",")+"\r\n",u=0,r=-1,i=0;i<t.length;++i,++u)u>65&&r!==-1?(f=t[r],f===","?(++r,t=t.substr(0,r)+"\r\n "+t.substr(r)):t=t.substr(0,r)+"\r\n"+f+t.substr(r+1),u=i-r-1,r=-1,++i):(t[i]===" "||t[i]==="\t"||t[i]===",")&&(r=i);return t}function r(n){return n.replace(/^\s+/,"")}var i=n.pem=n.pem||{};i.encode=function(i,r){var u,f,e;if(r=r||{},u="-----BEGIN "+i.type+"-----\r\n",i.procType&&(f={name:"Proc-Type",values:[String(i.procType.version),i.procType.type]},u+=t(f)),i.contentDomain&&(f={name:"Content-Domain",values:[i.contentDomain]},u+=t(f)),i.dekInfo&&(f={name:"DEK-Info",values:[i.dekInfo.algorithm]},i.dekInfo.parameters&&f.values.push(i.dekInfo.parameters),u+=t(f)),i.headers)for(e=0;e<i.headers.length;++e)u+=t(i.headers[e]);return i.procType&&(u+="\r\n"),u+=n.util.encode64(i.body,r.maxline||64)+"\r\n",u+="-----END "+i.type+"-----\r\n",u};i.decode=function(t){for(var l=[],y=/\s*-----BEGIN ([A-Z0-9- ]+)-----\r?\n?([\x21-\x7e\s]+?(?:\r?\n\r?\n))?([:A-Za-z0-9+\/=\s]+?)-----END \1-----/g,i,u,s,o,a,h,v,f,e,c;;){if(i=y.exec(t),!i)break;if(u={type:i[1],procType:null,contentDomain:null,dekInfo:null,headers:[],body:n.util.decode64(i[3])},l.push(u),i[2]){for(s=i[2].split(/\r?\n/),o=0;i&&o<s.length;){for(a=s[o].replace(/\s+$/,""),h=o+1;h<s.length;++h){if(v=s[h],!/\s/.test(v[0]))break;a+=v;o=h}if(i=a.match(/([\x21-\x7e]+):\s*([\x21-\x7e\s^:]+)/),i){for(f={name:i[1],values:[]},e=i[2].split(","),c=0;c<e.length;++c)f.values.push(r(e[c]));if(u.procType)if(u.contentDomain||f.name!=="Content-Domain")if(u.dekInfo||f.name!=="DEK-Info")u.headers.push(f);else{if(f.values.length===0)throw new Error('Invalid PEM formatted message. The "DEK-Info" header must have at least one subfield.');u.dekInfo={algorithm:e[0],parameters:e[1]||null}}else u.contentDomain=e[0]||"";else{if(f.name!=="Proc-Type")throw new Error('Invalid PEM formatted message. The first encapsulated header must be "Proc-Type".');if(f.values.length!==2)throw new Error('Invalid PEM formatted message. The "Proc-Type" header must have two subfields.');u.procType={version:e[0],type:e[1]}}}++o}if(u.procType==="ENCRYPTED"&&!u.dekInfo)throw new Error('Invalid PEM formatted message. The "DEK-Info" header must be present if "Proc-Type" is "ENCRYPTED".');}}if(l.length===0)throw new Error("Invalid PEM formatted message.");return l}}var i="pem",f,e,o,r;if(typeof n!="function"){if(typeof module!="object"||!module.exports)return typeof forge=="undefined"&&(forge={}),u(forge);f=!0;n=function(n,i){i(t,module)}}o=function(n,t){t.exports=function(t){var f=e.map(function(t){return n(t)}).concat(u),r;if(t=t||{},t.defined=t.defined||{},t.defined[i])return t[i];for(t.defined[i]=!0,r=0;r<f.length;++r)f[r](t);return t[i]}};r=n;n=function(t,i){return e=typeof t=="string"?i.slice(2):t.slice(2),f?(delete n,r.apply(null,Array.prototype.slice.call(arguments,0))):(n=r,n.apply(null,Array.prototype.slice.call(arguments,0)))};n("js/pem",["require","module","./util"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function u(n){function t(t,i){var r=function(){return new n.des.Algorithm(t,i)};n.cipher.registerAlgorithm(t,r)}function u(n){for(var i,t,u,e,o,l=[0,4,536870912,536870916,65536,65540,536936448,536936452,512,516,536871424,536871428,66048,66052,536936960,536936964],a=[0,1,1048576,1048577,67108864,67108865,68157440,68157441,256,257,1048832,1048833,67109120,67109121,68157696,68157697],v=[0,8,2048,2056,16777216,16777224,16779264,16779272,0,8,2048,2056,16777216,16777224,16779264,16779272],y=[0,2097152,134217728,136314880,8192,2105344,134225920,136323072,131072,2228224,134348800,136445952,139264,2236416,134356992,136454144],p=[0,262144,16,262160,0,262144,16,262160,4096,266240,4112,266256,4096,266240,4112,266256],w=[0,1024,32,1056,0,1024,32,1056,33554432,33555456,33554464,33555488,33554432,33555456,33554464,33555488],b=[0,268435456,524288,268959744,2,268435458,524290,268959746,0,268435456,524288,268959744,2,268435458,524290,268959746],k=[0,65536,2048,67584,536870912,536936448,536872960,536938496,131072,196608,133120,198656,537001984,537067520,537004032,537069568],d=[0,262144,0,262144,2,262146,2,262146,33554432,33816576,33554432,33816576,33554434,33816578,33554434,33816578],g=[0,268435456,8,268435464,0,268435456,8,268435464,1024,268436480,1032,268436488,1024,268436480,1032,268436488],nt=[0,32,0,32,1048576,1048608,1048576,1048608,8192,8224,8192,8224,1056768,1056800,1056768,1056800],tt=[0,16777216,512,16777728,2097152,18874368,2097664,18874880,67108864,83886080,67109376,83886592,69206016,85983232,69206528,85983744],it=[0,4096,134217728,134221824,524288,528384,134742016,134746112,16,4112,134217744,134221840,524304,528400,134742032,134746128],rt=[0,4,256,260,0,4,256,260,1,5,257,261,1,5,257,261],ut=n.length()>8?3:1,f=[],s=[0,0,1,1,1,1,1,1,0,1,1,1,1,1,1,0],h=0,r,c=0;c<ut;c++)for(i=n.getInt32(),t=n.getInt32(),r=(i>>>4^t)&252645135,t^=r,i^=r<<4,r=(t>>>-16^i)&65535,i^=r,t^=r<<-16,r=(i>>>2^t)&858993459,t^=r,i^=r<<2,r=(t>>>-16^i)&65535,i^=r,t^=r<<-16,r=(i>>>1^t)&1431655765,t^=r,i^=r<<1,r=(t>>>8^i)&16711935,i^=r,t^=r<<8,r=(i>>>1^t)&1431655765,t^=r,i^=r<<1,r=i<<8|t>>>20&240,i=t<<24|t<<8&16711680|t>>>8&65280|t>>>24&240,t=r,u=0;u<s.length;++u)s[u]?(i=i<<2|i>>>26,t=t<<2|t>>>26):(i=i<<1|i>>>27,t=t<<1|t>>>27),i&=-15,t&=-15,e=l[i>>>28]|a[i>>>24&15]|v[i>>>20&15]|y[i>>>16&15]|p[i>>>12&15]|w[i>>>8&15]|b[i>>>4&15],o=k[t>>>28]|d[t>>>24&15]|g[t>>>20&15]|nt[t>>>16&15]|tt[t>>>12&15]|it[t>>>8&15]|rt[t>>>4&15],r=(o>>>16^e)&65535,f[h++]=e^r,f[h++]=o^r<<16;return f}function r(n,t,i,r){var g=n.length===32?3:9,d,v,y,u,p,nt,tt,w,b,k;for(d=g===3?r?[30,-2,-2]:[0,32,2]:r?[94,62,-2,32,64,2,30,-2,-2]:[0,32,2,62,30,-2,64,96,2],y=t[0],u=t[1],v=(y>>>4^u)&252645135,u^=v,y^=v<<4,v=(y>>>16^u)&65535,u^=v,y^=v<<16,v=(u>>>2^y)&858993459,y^=v,u^=v<<2,v=(u>>>8^y)&16711935,y^=v,u^=v<<8,v=(y>>>1^u)&1431655765,u^=v,y^=v<<1,y=y<<1|y>>>31,u=u<<1|u>>>31,p=0;p<g;p+=3){for(nt=d[p+1],tt=d[p+2],w=d[p];w!=nt;w+=tt)b=u^n[w],k=(u>>>4|u<<28)^n[w+1],v=y,y=u,u=v^(e[b>>>24&63]|s[b>>>16&63]|c[b>>>8&63]|a[b&63]|f[k>>>24&63]|o[k>>>16&63]|h[k>>>8&63]|l[k&63]);v=y;y=u;u=v}y=y>>>1|y<<31;u=u>>>1|u<<31;v=(y>>>1^u)&1431655765;u^=v;y^=v<<1;v=(u>>>8^y)&16711935;y^=v;u^=v<<8;v=(u>>>2^y)&858993459;y^=v;u^=v<<2;v=(y>>>16^u)&65535;u^=v;y^=v<<16;v=(y>>>4^u)&252645135;u^=v;y^=v<<4;i[0]=y;i[1]=u}function i(t){var u,r,i,f;return t=t||{},u=(t.mode||"CBC").toUpperCase(),r="DES-"+u,i=t.decrypt?n.cipher.createDecipher(r,t.key):n.cipher.createCipher(r,t.key),f=i.start,i.start=function(t,r){var u=null;r instanceof n.util.ByteBuffer&&(u=r,r={});r=r||{};r.output=u;r.iv=t;f.call(i,r)},i}n.des=n.des||{};n.des.startEncrypting=function(n,t,r,u){var f=i({key:n,output:r,decrypt:!1,mode:u||(t===null?"ECB":"CBC")});return f.start(t),f};n.des.createEncryptionCipher=function(n,t){return i({key:n,output:null,decrypt:!1,mode:t})};n.des.startDecrypting=function(n,t,r,u){var f=i({key:n,output:r,decrypt:!0,mode:u||(t===null?"ECB":"CBC")});return f.start(t),f};n.des.createDecryptionCipher=function(n,t){return i({key:n,output:null,decrypt:!0,mode:t})};n.des.Algorithm=function(n,t){var i=this;i.name=n;i.mode=new t({blockSize:8,cipher:{encrypt:function(n,t){return r(i._keys,n,t,!1)},decrypt:function(n,t){return r(i._keys,n,t,!0)}}});i._init=!1};n.des.Algorithm.prototype.initialize=function(t){if(!this._init){var i=n.util.createBuffer(t.key);if(this.name.indexOf("3DES")===0&&i.length()!==24)throw new Error("Invalid Triple-DES key size: "+i.length()*8);this._keys=u(i);this._init=!0}};t("DES-ECB",n.cipher.modes.ecb);t("DES-CBC",n.cipher.modes.cbc);t("DES-CFB",n.cipher.modes.cfb);t("DES-OFB",n.cipher.modes.ofb);t("DES-CTR",n.cipher.modes.ctr);t("3DES-ECB",n.cipher.modes.ecb);t("3DES-CBC",n.cipher.modes.cbc);t("3DES-CFB",n.cipher.modes.cfb);t("3DES-OFB",n.cipher.modes.ofb);t("3DES-CTR",n.cipher.modes.ctr);var f=[16843776,0,65536,16843780,16842756,66564,4,65536,1024,16843776,16843780,1024,16778244,16842756,16777216,4,1028,16778240,16778240,66560,66560,16842752,16842752,16778244,65540,16777220,16777220,65540,0,1028,66564,16777216,65536,16843780,4,16842752,16843776,16777216,16777216,1024,16842756,65536,66560,16777220,1024,4,16778244,66564,16843780,65540,16842752,16778244,16777220,1028,66564,16843776,1028,16778240,16778240,0,65540,66560,0,16842756],e=[-2146402272,-2147450880,32768,1081376,1048576,32,-2146435040,-2147450848,-2147483616,-2146402272,-2146402304,-2147483648,-2147450880,1048576,32,-2146435040,1081344,1048608,-2147450848,0,-2147483648,32768,1081376,-2146435072,1048608,-2147483616,0,1081344,32800,-2146402304,-2146435072,32800,0,1081376,-2146435040,1048576,-2147450848,-2146435072,-2146402304,32768,-2146435072,-2147450880,32,-2146402272,1081376,32,32768,-2147483648,32800,-2146402304,1048576,-2147483616,1048608,-2147450848,-2147483616,1048608,1081344,0,-2147450880,32800,-2147483648,-2146435040,-2146402272,1081344],o=[520,134349312,0,134348808,134218240,0,131592,134218240,131080,134217736,134217736,131072,134349320,131080,134348800,520,134217728,8,134349312,512,131584,134348800,134348808,131592,134218248,131584,131072,134218248,8,134349320,512,134217728,134349312,134217728,131080,520,131072,134349312,134218240,0,512,131080,134349320,134218240,134217736,512,0,134348808,134218248,131072,134217728,134349320,8,131592,131584,134217736,134348800,134218248,520,134348800,131592,8,134348808,131584],s=[8396801,8321,8321,128,8396928,8388737,8388609,8193,0,8396800,8396800,8396929,129,0,8388736,8388609,1,8192,8388608,8396801,128,8388608,8193,8320,8388737,1,8320,8388736,8192,8396928,8396929,129,8388736,8388609,8396800,8396929,129,0,0,8396800,8320,8388736,8388737,1,8396801,8321,8321,128,8396929,129,1,8192,8388609,8193,8396928,8388737,8193,8320,8388608,8396801,128,8388608,8192,8396928],h=[256,34078976,34078720,1107296512,524288,256,1073741824,34078720,1074266368,524288,33554688,1074266368,1107296512,1107820544,524544,1073741824,33554432,1074266112,1074266112,0,1073742080,1107820800,1107820800,33554688,1107820544,1073742080,0,1107296256,34078976,33554432,1107296256,524544,524288,1107296512,256,33554432,1073741824,34078720,1107296512,1074266368,33554688,1073741824,1107820544,34078976,1074266368,256,33554432,1107820544,1107820800,524544,1107296256,1107820800,34078720,0,1074266112,1107296256,524544,33554688,1073742080,524288,0,1074266112,34078976,1073742080],c=[536870928,541065216,16384,541081616,541065216,16,541081616,4194304,536887296,4210704,4194304,536870928,4194320,536887296,536870912,16400,0,4194320,536887312,16384,4210688,536887312,16,541065232,541065232,0,4210704,541081600,16400,4210688,541081600,536870912,536887296,16,541065232,4210688,541081616,4194304,16400,536870928,4194304,536887296,536870912,16400,536870928,541081616,4210688,541065216,4210704,541081600,0,541065232,16,16384,541065216,4210704,16384,4194320,536887312,0,541081600,536870912,4194320,536887312],l=[2097152,69206018,67110914,0,2048,67110914,2099202,69208064,69208066,2097152,0,67108866,2,67108864,69206018,2050,67110912,2099202,2097154,67110912,67108866,69206016,69208064,2097154,69206016,2048,2050,69208066,2099200,2,67108864,2099200,67108864,2099200,2097152,67110914,67110914,69206018,69206018,2,2097154,67108864,67110912,2097152,69208064,2050,2099202,69208064,2050,67108866,69208066,69206016,2099200,0,2,69208066,0,2099202,69206016,2048,67108866,67110912,2048,2097154],a=[268439616,4096,262144,268701760,268435456,268439616,64,268435456,262208,268697600,268701760,266240,268701696,266304,4096,64,268697600,268435520,268439552,4160,266240,262208,268697664,268701696,4160,0,0,268697664,268435520,268439552,266304,262144,266304,262144,268701696,4096,64,268697664,4096,266304,268439552,64,268435520,268697600,268697664,268435456,262144,268439616,0,268701760,262208,268435520,268697600,268439552,268439616,0,268701760,266240,266240,4160,4160,262208,268435456,268701696]}var i="des",f,e,o,r;if(typeof n!="function"){if(typeof module!="object"||!module.exports)return typeof forge=="undefined"&&(forge={}),u(forge);f=!0;n=function(n,i){i(t,module)}}o=function(n,t){t.exports=function(t){var f=e.map(function(t){return n(t)}).concat(u),r;if(t=t||{},t.defined=t.defined||{},t.defined[i])return t[i];for(t.defined[i]=!0,r=0;r<f.length;++r)f[r](t);return t[i]}};r=n;n=function(t,i){return e=typeof t=="string"?i.slice(2):t.slice(2),f?(delete n,r.apply(null,Array.prototype.slice.call(arguments,0))):(n=r,n.apply(null,Array.prototype.slice.call(arguments,0)))};n("js/des",["require","module","./cipher","./cipherModes","./util"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function u(n){var t=n.pkcs5=n.pkcs5||{};n.pbkdf2=t.pbkdf2=function(t,i,r,u,f,e){function b(){if(h>y)return e(null,p);o.start(null,null);o.update(i);o.update(n.util.int32ToBytes(h));s=a=o.digest().getBytes();v=2;k()}function k(){if(v<=r)return o.start(null,null),o.update(a),l=o.digest().getBytes(),s=n.util.xorBytes(s,l,c),a=l,++v,n.util.setImmediate(k);p+=h<y?s:s.substr(0,d);++h;b()}var c,w,p,s,l,a,h,v;if(typeof f=="function"&&(e=f,f=null),(typeof f=="undefined"||f===null)&&(f=n.md.sha1.create()),c=f.digestLength,u>4294967295*c){if(w=new Error("Derived key is too long."),e)return e(w);throw w;}var y=Math.ceil(u/c),d=u-(y-1)*c,o=n.hmac.create();if(o.start(f,t),p="",!e){for(h=1;h<=y;++h){for(o.start(null,null),o.update(i),o.update(n.util.int32ToBytes(h)),s=a=o.digest().getBytes(),v=2;v<=r;++v)o.start(null,null),o.update(a),l=o.digest().getBytes(),s=n.util.xorBytes(s,l,c),a=l;p+=h<y?s:s.substr(0,d)}return p}h=1;b()}}var i="pbkdf2",f,e,o,r;if(typeof n!="function"){if(typeof module!="object"||!module.exports)return typeof forge=="undefined"&&(forge={}),u(forge);f=!0;n=function(n,i){i(t,module)}}o=function(n,t){t.exports=function(t){var f=e.map(function(t){return n(t)}).concat(u),r;if(t=t||{},t.defined=t.defined||{},t.defined[i])return t[i];for(t.defined[i]=!0,r=0;r<f.length;++r)f[r](t);return t[i]}};r=n;n=function(t,i){return e=typeof t=="string"?i.slice(2):t.slice(2),f?(delete n,r.apply(null,Array.prototype.slice.call(arguments,0))):(n=r,n.apply(null,Array.prototype.slice.call(arguments,0)))};n("js/pbkdf2",["require","module","./hmac","./md","./util"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function u(n){var u=typeof process!="undefined"&&process.versions&&process.versions.node,i=null,r;n.disableNativeCode||!u||process.versions["node-webkit"]||(i=t("crypto"));r=n.prng=n.prng||{};r.create=function(t){function s(n){if(r.pools[0].messageLength>=32)return u(),n();var t=32-r.pools[0].messageLength<<5;r.seedFile(t,function(t,i){if(t)return n(t);r.collect(i);u();n()})}function h(){if(r.pools[0].messageLength>=32)return u();var n=32-r.pools[0].messageLength<<5;r.collect(r.seedFileSync(n));u()}function u(){var n=r.plugin.md.create(),t,i,u,f;for(n.update(r.pools[0].digest().getBytes()),r.pools[0].start(),t=1,i=1;i<32;++i)t=t===31?2147483648:t<<2,t%r.reseeds==0&&(n.update(r.pools[i].digest().getBytes()),r.pools[i].start());u=n.digest().getBytes();n.start();n.update(u);f=n.digest().getBytes();r.key=r.plugin.formatKey(u);r.seed=r.plugin.formatSeed(f);r.reseeds=r.reseeds===4294967295?0:r.reseeds+1;r.generated=0}function e(t){var s=null,e,i,l,o,h,u,c,f,r;if(typeof window!="undefined"&&(e=window.crypto||window.msCrypto,e&&e.getRandomValues&&(s=function(n){return e.getRandomValues(n)})),i=n.util.createBuffer(),s)while(i.length()<t){l=Math.max(1,Math.min(t-i.length(),65536)/4);o=new Uint32Array(Math.floor(l));try{for(s(o),r=0;r<o.length;++r)i.putInt32(o[r])}catch(a){if(!(typeof QuotaExceededError!="undefined"&&a instanceof QuotaExceededError))throw a;}}if(i.length()<t)for(f=Math.floor(Math.random()*65536);i.length()<t;)for(u=16807*(f&65535),h=16807*(f>>16),u+=(h&32767)<<16,u+=h>>15,u=(u&2147483647)+(u>>31),f=u&4294967295,r=0;r<3;++r)c=f>>>(r<<3),c^=Math.floor(Math.random()*256),i.putByte(String.fromCharCode(c&255));return i.getBytes(t)}for(var r={plugin:t,key:null,seed:null,time:null,reseeds:0,generated:0},c=t.md,o=new Array(32),f=0;f<32;++f)o[f]=c.create();return r.pools=o,r.pool=0,r.generate=function(t,i){function u(l){if(l)return i(l);if(e.length()>=t)return i(null,e.getBytes(t));if(r.generated>1048575&&(r.key=null),r.key===null)return n.util.nextTick(function(){s(u)});var a=f(r.key,r.seed);r.generated+=a.length;e.putBytes(a);r.key=h(f(r.key,o(r.seed)));r.seed=c(f(r.key,r.seed));n.util.setImmediate(u)}if(!i)return r.generateSync(t);var f=r.plugin.cipher,o=r.plugin.increment,h=r.plugin.formatKey,c=r.plugin.formatSeed,e=n.util.createBuffer();r.key=null;u()},r.generateSync=function(t){var u=r.plugin.cipher,e=r.plugin.increment,o=r.plugin.formatKey,s=r.plugin.formatSeed,i,f;for(r.key=null,i=n.util.createBuffer();i.length()<t;)r.generated>1048575&&(r.key=null),r.key===null&&h(),f=u(r.key,r.seed),r.generated+=f.length,i.putBytes(f),r.key=o(u(r.key,e(r.seed))),r.seed=s(u(r.key,r.seed));return i.getBytes(t)},i?(r.seedFile=function(n,t){i.randomBytes(n,function(n,i){if(n)return t(n);t(null,i.toString())})},r.seedFileSync=function(n){return i.randomBytes(n).toString()}):(r.seedFile=function(n,t){try{t(null,e(n))}catch(i){t(i)}},r.seedFileSync=e),r.collect=function(n){for(var i=n.length,t=0;t<i;++t)r.pools[r.pool].update(n.substr(t,1)),r.pool=r.pool===31?0:r.pool+1},r.collectInt=function(n,t){for(var u="",i=0;i<t;i+=8)u+=String.fromCharCode(n>>i&255);r.collect(u)},r.registerWorker=function(n){if(n===self)r.seedFile=function(n,t){function i(n){var r=n.data;r.forge&&r.forge.prng&&(self.removeEventListener("message",i),t(r.forge.prng.err,r.forge.prng.bytes))}self.addEventListener("message",i);self.postMessage({forge:{prng:{needed:n}}})};else{var t=function(t){var i=t.data;i.forge&&i.forge.prng&&r.seedFile(i.forge.prng.needed,function(t,i){n.postMessage({forge:{prng:{err:t,bytes:i}}})})};n.addEventListener("message",t)}},r}}var i="prng",f,e,o,r;if(typeof n!="function"){if(typeof module!="object"||!module.exports)return typeof forge=="undefined"&&(forge={}),u(forge);f=!0;n=function(n,i){i(t,module)}}o=function(n,t){t.exports=function(t){var f=e.map(function(t){return n(t)}).concat(u),r;if(t=t||{},t.defined=t.defined||{},t.defined[i])return t[i];for(t.defined[i]=!0,r=0;r<f.length;++r)f[r](t);return t[i]}};r=n;n=function(t,i){return e=typeof t=="string"?i.slice(2):t.slice(2),f?(delete n,r.apply(null,Array.prototype.slice.call(arguments,0))):(n=r,n.apply(null,Array.prototype.slice.call(arguments,0)))};n("js/prng",["require","module","./md","./util"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function u(n){n.random&&n.random.getBytes||function(t){function h(){var t=n.prng.create(r);return t.getBytes=function(n,i){return t.generate(n,i)},t.getBytesSync=function(n){return t.generate(n)},t}var r={},f=new Array(4),e=n.util.createBuffer(),o,s,u;r.formatKey=function(t){var i=n.util.createBuffer(t);return t=new Array(4),t[0]=i.getInt32(),t[1]=i.getInt32(),t[2]=i.getInt32(),t[3]=i.getInt32(),n.aes._expandKey(t,!1)};r.formatSeed=function(t){var i=n.util.createBuffer(t);return t=new Array(4),t[0]=i.getInt32(),t[1]=i.getInt32(),t[2]=i.getInt32(),t[3]=i.getInt32(),t};r.cipher=function(t,i){return n.aes._updateBlock(t,i,f,!1),e.putInt32(f[0]),e.putInt32(f[1]),e.putInt32(f[2]),e.putInt32(f[3]),e.getBytes()};r.increment=function(n){return++n[3],n};r.md=n.md.sha256;var i=h(),l=typeof process!="undefined"&&process.versions&&process.versions.node,c=null;if(typeof window!="undefined"&&(o=window.crypto||window.msCrypto,o&&o.getRandomValues&&(c=function(n){return o.getRandomValues(n)})),n.disableNativeCode||!l&&!c){if(typeof window=="undefined"||window.document===undefined,i.collectInt(+new Date,32),typeof navigator!="undefined"){s="";for(u in navigator)try{typeof navigator[u]=="string"&&(s+=navigator[u])}catch(a){}i.collect(s);s=null}t&&(t().mousemove(function(n){i.collectInt(n.clientX,16);i.collectInt(n.clientY,16)}),t().keypress(function(n){i.collectInt(n.charCode,8)}))}if(n.random)for(u in i)n.random[u]=i[u];else n.random=i;n.random.createInstance=h}(typeof jQuery!="undefined"?jQuery:null)}var i="random",f,e,o,r;if(typeof n!="function"){if(typeof module!="object"||!module.exports)return typeof forge=="undefined"&&(forge={}),u(forge);f=!0;n=function(n,i){i(t,module)}}o=function(n,t){t.exports=function(t){var f=e.map(function(t){return n(t)}).concat(u),r;if(t=t||{},t.defined=t.defined||{},t.defined[i])return t[i];for(t.defined[i]=!0,r=0;r<f.length;++r)f[r](t);return t[i]}};r=n;n=function(t,i){return e=typeof t=="string"?i.slice(2):t.slice(2),f?(delete n,r.apply(null,Array.prototype.slice.call(arguments,0))):(n=r,n.apply(null,Array.prototype.slice.call(arguments,0)))};n("js/random",["require","module","./aes","./md","./prng","./util"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function u(n){var t=[217,120,249,196,25,221,181,237,40,233,253,121,74,160,216,157,198,126,55,131,43,118,83,142,98,76,100,136,68,139,251,162,23,154,89,245,135,179,79,19,97,69,109,141,9,129,125,50,189,143,64,235,134,183,123,11,240,149,33,34,92,107,78,130,84,214,101,147,206,96,178,28,115,86,192,20,167,140,241,220,18,117,202,31,59,190,228,209,66,61,212,48,163,60,182,38,111,191,14,218,70,105,7,87,39,242,29,155,188,148,67,3,248,17,199,246,144,239,62,231,6,195,213,47,200,102,30,215,8,232,234,222,128,82,238,247,132,170,114,172,53,77,106,42,150,26,210,113,90,21,73,116,75,159,208,94,4,24,164,236,194,224,65,110,15,81,203,204,36,145,175,80,161,244,112,57,153,124,58,133,35,184,180,122,252,2,54,91,37,85,151,49,45,93,250,152,227,138,146,174,5,223,41,16,103,108,186,201,211,0,230,207,225,158,168,44,99,22,1,63,88,226,137,169,13,56,52,27,171,51,255,176,187,72,12,95,185,177,205,46,197,243,219,71,229,165,156,119,10,166,32,104,254,127,193,173],r=[1,2,3,5],u=function(n,t){return n<<t&65535|(n&65535)>>16-t},f=function(n,t){return(n&65535)>>t|n<<16-t&65535},i;n.rc2=n.rc2||{};n.rc2.expandKey=function(i,r){typeof i=="string"&&(i=n.util.createBuffer(i));r=r||128;for(var f=i,o=i.length(),s=r,e=Math.ceil(s/8),h=255>>(s&7),u=o;u<128;u++)f.putByte(t[f.at(u-1)+f.at(u-o)&255]);for(f.setAt(128-e,t[f.at(128-e)&h]),u=127-e;u>=0;u--)f.setAt(u,t[f.at(u+1)^f.at(u+e)]);return f};i=function(t,i,e){var w=!1,s=null,h=null,c=null,l,p,o,a,v=[],b,y;for(t=n.rc2.expandKey(t,i),o=0;o<64;o++)v.push(t.getInt16Le());return e?(l=function(n){for(o=0;o<4;o++)n[o]+=v[a]+(n[(o+3)%4]&n[(o+2)%4])+(~n[(o+3)%4]&n[(o+1)%4]),n[o]=u(n[o],r[o]),a++},p=function(n){for(o=0;o<4;o++)n[o]+=v[n[(o+3)%4]&63]}):(l=function(n){for(o=3;o>=0;o--)n[o]=f(n[o],r[o]),n[o]-=v[a]+(n[(o+3)%4]&n[(o+2)%4])+(~n[(o+3)%4]&n[(o+1)%4]),a--},p=function(n){for(o=3;o>=0;o--)n[o]-=v[n[(o+3)%4]&63]}),b=function(n){var t=[],r,i,u;for(o=0;o<4;o++)r=s.getInt16Le(),c!==null&&(e?r^=c.getInt16Le():c.putInt16Le(r)),t.push(r&65535);for(a=e?0:63,i=0;i<n.length;i++)for(u=0;u<n[i][0];u++)n[i][1](t);for(o=0;o<4;o++)c!==null&&(e?c.putInt16Le(t[o]):t[o]^=c.getInt16Le()),h.putInt16Le(t[o])},y=null,y={start:function(t,i){t&&typeof t=="string"&&(t=n.util.createBuffer(t));w=!1;s=n.util.createBuffer();h=i||new n.util.createBuffer;c=t;y.output=h},update:function(n){for(w||s.putBuffer(n);s.length()>=8;)b([[5,l],[1,p],[6,l],[1,p],[5,l]])},finish:function(n){var t=!0,i,r,u;return e&&(n?t=n(8,s,!e):(i=s.length()===8?8:8-s.length(),s.fillWithByte(i,i))),t&&(w=!0,y.update()),e||(t=s.length()===0,t&&(n?t=n(8,h,!e):(r=h.length(),u=h.at(r-1),u>r?t=!1:h.truncate(u)))),t}},y};n.rc2.startEncrypting=function(t,i,r){var u=n.rc2.createEncryptionCipher(t,128);return u.start(i,r),u};n.rc2.createEncryptionCipher=function(n,t){return i(n,t,!0)};n.rc2.startDecrypting=function(t,i,r){var u=n.rc2.createDecryptionCipher(t,128);return u.start(i,r),u};n.rc2.createDecryptionCipher=function(n,t){return i(n,t,!1)}}var i="rc2",f,e,o,r;if(typeof n!="function"){if(typeof module!="object"||!module.exports)return typeof forge=="undefined"&&(forge={}),u(forge);f=!0;n=function(n,i){i(t,module)}}o=function(n,t){t.exports=function(t){var f=e.map(function(t){return n(t)}).concat(u),r;if(t=t||{},t.defined=t.defined||{},t.defined[i])return t[i];for(t.defined[i]=!0,r=0;r<f.length;++r)f[r](t);return t[i]}};r=n;n=function(t,i){return e=typeof t=="string"?i.slice(2):t.slice(2),f?(delete n,r.apply(null,Array.prototype.slice.call(arguments,0))):(n=r,n.apply(null,Array.prototype.slice.call(arguments,0)))};n("js/rc2",["require","module","./util"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function u(n){function t(n,t,i){this.data=[];n!=null&&("number"==typeof n?this.fromNumber(n,t,i):t==null&&"string"!=typeof n?this.fromString(n,256):this.fromString(n,t))}function i(){return new t(null)}function ut(n,t,i,r,u,f){while(--f>=0){var e=t*this.data[n++]+i.data[r]+u;u=Math.floor(e/67108864);i.data[r++]=e&67108863}return u}function ft(n,t,i,r,u,f){for(var o=t&32767,s=t>>15;--f>=0;){var e=this.data[n]&32767,h=this.data[n++]>>15,c=s*e+h*o;e=o*e+((c&32767)<<15)+i.data[r]+(u&1073741823);u=(e>>>30)+(c>>>15)+s*h+(u>>>30);i.data[r++]=e&1073741823}return u}function w(n,t,i,r,u,f){for(var o=t&16383,s=t>>14;--f>=0;){var e=this.data[n]&16383,h=this.data[n++]>>14,c=s*e+h*o;e=o*e+((c&16383)<<14)+i.data[r]+u;u=(e>>28)+(c>>14)+s*h;i.data[r++]=e&268435455}return u}function b(n){return it.charAt(n)}function k(n,t){var i=a[n.charCodeAt(t)];return i==null?-1:i}function et(n){for(var t=this.t-1;t>=0;--t)n.data[t]=this.data[t];n.t=this.t;n.s=this.s}function ot(n){this.t=1;this.s=n<0?-1:0;n>0?this.data[0]=n:n<-1?this.data[0]=n+this.DV:this.t=0}function e(n){var t=i();return t.fromInt(n),t}function st(n,i){var u,f;if(i==16)u=4;else if(i==8)u=3;else if(i==256)u=8;else if(i==2)u=1;else if(i==32)u=5;else{if(i!=4){this.fromRadix(n,i);return}u=2}this.t=0;this.s=0;for(var e=n.length,o=!1,r=0;--e>=0;){if(f=u==8?n[e]&255:k(n,e),f<0){n.charAt(e)=="-"&&(o=!0);continue}o=!1;r==0?this.data[this.t++]=f:r+u>this.DB?(this.data[this.t-1]|=(f&(1<<this.DB-r)-1)<<r,this.data[this.t++]=f>>this.DB-r):this.data[this.t-1]|=f<<r;r+=u;r>=this.DB&&(r-=this.DB)}u==8&&(n[0]&128)!=0&&(this.s=-1,r>0&&(this.data[this.t-1]|=(1<<this.DB-r)-1<<r));this.clamp();o&&t.ZERO.subTo(this,this)}function ht(){for(var n=this.s&this.DM;this.t>0&&this.data[this.t-1]==n;)--this.t}function ct(n){var t;if(this.s<0)return"-"+this.negate().toString(n);if(n==16)t=4;else if(n==8)t=3;else if(n==2)t=1;else if(n==32)t=5;else{if(n!=4)return this.toRadix(n);t=2}var o=(1<<t)-1,u,f=!1,e="",r=this.t,i=this.DB-r*this.DB%t;if(r-->0)for(i<this.DB&&(u=this.data[r]>>i)>0&&(f=!0,e=b(u));r>=0;)i<t?(u=(this.data[r]&(1<<i)-1)<<t-i,u|=this.data[--r]>>(i+=this.DB-t)):(u=this.data[r]>>(i-=t)&o,i<=0&&(i+=this.DB,--r)),u>0&&(f=!0),f&&(e+=b(u));return f?e:"0"}function lt(){var n=i();return t.ZERO.subTo(this,n),n}function at(){return this.s<0?this.negate():this}function vt(n){var t=this.s-n.s,i;if(t!=0)return t;if(i=this.t,t=i-n.t,t!=0)return this.s<0?-t:t;while(--i>=0)if((t=this.data[i]-n.data[i])!=0)return t;return 0}function v(n){var i=1,t;return(t=n>>>16)!=0&&(n=t,i+=16),(t=n>>8)!=0&&(n=t,i+=8),(t=n>>4)!=0&&(n=t,i+=4),(t=n>>2)!=0&&(n=t,i+=2),(t=n>>1)!=0&&(n=t,i+=1),i}function yt(){return this.t<=0?0:this.DB*(this.t-1)+v(this.data[this.t-1]^this.s&this.DM)}function pt(n,t){for(var i=this.t-1;i>=0;--i)t.data[i+n]=this.data[i];for(i=n-1;i>=0;--i)t.data[i]=0;t.t=this.t+n;t.s=this.s}function wt(n,t){for(var i=n;i<this.t;++i)t.data[i-n]=this.data[i];t.t=Math.max(this.t-n,0);t.s=this.s}function bt(n,t){for(var u=n%this.DB,e=this.DB-u,o=(1<<e)-1,r=Math.floor(n/this.DB),f=this.s<<u&this.DM,i=this.t-1;i>=0;--i)t.data[i+r+1]=this.data[i]>>e|f,f=(this.data[i]&o)<<u;for(i=r-1;i>=0;--i)t.data[i]=0;t.data[r]=f;t.t=this.t+r+1;t.s=this.s;t.clamp()}function kt(n,t){var i,r;if(t.s=this.s,i=Math.floor(n/this.DB),i>=this.t){t.t=0;return}var u=n%this.DB,f=this.DB-u,e=(1<<u)-1;for(t.data[0]=this.data[i]>>u,r=i+1;r<this.t;++r)t.data[r-i-1]|=(this.data[r]&e)<<f,t.data[r-i]=this.data[r]>>u;u>0&&(t.data[this.t-i-1]|=(this.s&e)<<f);t.t=this.t-i;t.clamp()}function dt(n,t){for(var r=0,i=0,u=Math.min(n.t,this.t);r<u;)i+=this.data[r]-n.data[r],t.data[r++]=i&this.DM,i>>=this.DB;if(n.t<this.t){for(i-=n.s;r<this.t;)i+=this.data[r],t.data[r++]=i&this.DM,i>>=this.DB;i+=this.s}else{for(i+=this.s;r<n.t;)i-=n.data[r],t.data[r++]=i&this.DM,i>>=this.DB;i-=n.s}t.s=i<0?-1:0;i<-1?t.data[r++]=this.DV+i:i>0&&(t.data[r++]=i);t.t=r;t.clamp()}function gt(n,i){var u=this.abs(),f=n.abs(),r=u.t;for(i.t=r+f.t;--r>=0;)i.data[r]=0;for(r=0;r<f.t;++r)i.data[r+u.t]=u.am(0,f.data[r],i,r,0,u.t);i.s=0;i.clamp();this.s!=n.s&&t.ZERO.subTo(i,i)}function ni(n){for(var i=this.abs(),t=n.t=2*i.t,r;--t>=0;)n.data[t]=0;for(t=0;t<i.t-1;++t)r=i.am(t,i.data[t],n,2*t,0,1),(n.data[t+i.t]+=i.am(t+1,2*i.data[t],n,2*t+1,r,i.t-t-1))>=i.DV&&(n.data[t+i.t]-=i.DV,n.data[t+i.t+1]=1);n.t>0&&(n.data[n.t-1]+=i.am(t,i.data[t],n,2*t,0,1));n.s=0;n.clamp()}function ti(n,r,u){var s=n.abs(),l,e,a,p;if(!(s.t<=0)){if(l=this.abs(),l.t<s.t){r!=null&&r.fromInt(0);u!=null&&this.copyTo(u);return}u==null&&(u=i());var f=i(),w=this.s,k=n.s,c=this.DB-v(s.data[s.t-1]);if(c>0?(s.lShiftTo(c,f),l.lShiftTo(c,u)):(s.copyTo(f),l.copyTo(u)),e=f.t,a=f.data[e-1],a!=0){var b=a*(1<<this.F1)+(e>1?f.data[e-2]>>this.F2:0),d=this.FV/b,g=(1<<this.F1)/b,nt=1<<this.F2,h=u.t,y=h-e,o=r==null?i():r;for(f.dlShiftTo(y,o),u.compareTo(o)>=0&&(u.data[u.t++]=1,u.subTo(o,u)),t.ONE.dlShiftTo(e,o),o.subTo(f,f);f.t<e;)f.data[f.t++]=0;while(--y>=0)if(p=u.data[--h]==a?this.DM:Math.floor(u.data[h]*d+(u.data[h-1]+nt)*g),(u.data[h]+=f.am(0,p,u,y,0,e))<p)for(f.dlShiftTo(y,o),u.subTo(o,u);u.data[h]<--p;)u.subTo(o,u);r!=null&&(u.drShiftTo(e,r),w!=k&&t.ZERO.subTo(r,r));u.t=e;u.clamp();c>0&&u.rShiftTo(c,u);w<0&&t.ZERO.subTo(u,u)}}}function ii(n){var r=i();return this.abs().divRemTo(n,null,r),this.s<0&&r.compareTo(t.ZERO)>0&&n.subTo(r,r),r}function o(n){this.m=n}function ri(n){return n.s<0||n.compareTo(this.m)>=0?n.mod(this.m):n}function ui(n){return n}function fi(n){n.divRemTo(this.m,null,n)}function ei(n,t,i){n.multiplyTo(t,i);this.reduce(i)}function oi(n,t){n.squareTo(t);this.reduce(t)}function si(){var t,n;return this.t<1?0:(t=this.data[0],(t&1)==0)?0:(n=t&3,n=n*(2-(t&15)*n)&15,n=n*(2-(t&255)*n)&255,n=n*(2-((t&65535)*n&65535))&65535,n=n*(2-t*n%this.DV)%this.DV,n>0?this.DV-n:-n)}function s(n){this.m=n;this.mp=n.invDigit();this.mpl=this.mp&32767;this.mph=this.mp>>15;this.um=(1<<n.DB-15)-1;this.mt2=2*n.t}function hi(n){var r=i();return n.abs().dlShiftTo(this.m.t,r),r.divRemTo(this.m,null,r),n.s<0&&r.compareTo(t.ZERO)>0&&this.m.subTo(r,r),r}function ci(n){var t=i();return n.copyTo(t),this.reduce(t),t}function li(n){for(var i,t,r;n.t<=this.mt2;)n.data[n.t++]=0;for(i=0;i<this.m.t;++i)for(t=n.data[i]&32767,r=t*this.mpl+((t*this.mph+(n.data[i]>>15)*this.mpl&this.um)<<15)&n.DM,t=i+this.m.t,n.data[t]+=this.m.am(0,r,n,i,0,this.m.t);n.data[t]>=n.DV;)n.data[t]-=n.DV,n.data[++t]++;n.clamp();n.drShiftTo(this.m.t,n);n.compareTo(this.m)>=0&&n.subTo(this.m,n)}function ai(n,t){n.squareTo(t);this.reduce(t)}function vi(n,t,i){n.multiplyTo(t,i);this.reduce(i)}function yi(){return(this.t>0?this.data[0]&1:this.s)==0}function pi(n,r){var s;if(n>4294967295||n<1)return t.ONE;var u=i(),f=i(),e=r.convert(this),o=v(n)-1;for(e.copyTo(u);--o>=0;)r.sqrTo(u,f),(n&1<<o)>0?r.mulTo(f,e,u):(s=u,u=f,f=s);return r.revert(u)}function wi(n,t){var i;return i=n<256||t.isEven()?new o(t):new s(t),this.exp(n,i)}function bi(){var n=i();return this.copyTo(n),n}function ki(){if(this.s<0){if(this.t==1)return this.data[0]-this.DV;if(this.t==0)return-1}else{if(this.t==1)return this.data[0];if(this.t==0)return 0}return(this.data[1]&(1<<32-this.DB)-1)<<this.DB|this.data[0]}function di(){return this.t==0?this.s:this.data[0]<<24>>24}function gi(){return this.t==0?this.s:this.data[0]<<16>>16}function nr(n){return Math.floor(Math.LN2*this.DB/Math.log(n))}function tr(){return this.s<0?-1:this.t<=0||this.t==1&&this.data[0]<=0?0:1}function ir(n){if(n==null&&(n=10),this.signum()==0||n<2||n>36)return"0";var s=this.chunkSize(n),f=Math.pow(n,s),o=e(f),t=i(),r=i(),u="";for(this.divRemTo(o,t,r);t.signum()>0;)u=(f+r.intValue()).toString(n).substr(1)+u,t.divRemTo(o,t,r);return r.intValue().toString(n)+u}function rr(n,i){var u,e;this.fromInt(0);i==null&&(i=10);var o=this.chunkSize(i),h=Math.pow(i,o),s=!1,f=0,r=0;for(u=0;u<n.length;++u){if(e=k(n,u),e<0){n.charAt(u)=="-"&&this.signum()==0&&(s=!0);continue}r=i*r+e;++f>=o&&(this.dMultiply(h),this.dAddOffset(r,0),f=0,r=0)}f>0&&(this.dMultiply(Math.pow(i,f)),this.dAddOffset(r,0));s&&t.ZERO.subTo(this,this)}function ur(n,i,r){if("number"==typeof i)if(n<2)this.fromInt(1);else for(this.fromNumber(n,r),this.testBit(n-1)||this.bitwiseTo(t.ONE.shiftLeft(n-1),p,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(i);)this.dAddOffset(2,0),this.bitLength()>n&&this.subTo(t.ONE.shiftLeft(n-1),this);else{var u=[],f=n&7;u.length=(n>>3)+1;i.nextBytes(u);f>0?u[0]&=(1<<f)-1:u[0]=0;this.fromString(u,256)}}function fr(){var i=this.t,u=[],n,t,r;if(u[0]=this.s,n=this.DB-i*this.DB%8,r=0,i-->0)for(n<this.DB&&(t=this.data[i]>>n)!=(this.s&this.DM)>>n&&(u[r++]=t|this.s<<this.DB-n);i>=0;)n<8?(t=(this.data[i]&(1<<n)-1)<<8-n,t|=this.data[--i]>>(n+=this.DB-8)):(t=this.data[i]>>(n-=8)&255,n<=0&&(n+=this.DB,--i)),(t&128)!=0&&(t|=-256),r==0&&(this.s&128)!=(t&128)&&++r,(r>0||t!=this.s)&&(u[r++]=t);return u}function er(n){return this.compareTo(n)==0}function or(n){return this.compareTo(n)<0?this:n}function sr(n){return this.compareTo(n)>0?this:n}function hr(n,t,i){for(var u,f=Math.min(n.t,this.t),r=0;r<f;++r)i.data[r]=t(this.data[r],n.data[r]);if(n.t<this.t){for(u=n.s&this.DM,r=f;r<this.t;++r)i.data[r]=t(this.data[r],u);i.t=this.t}else{for(u=this.s&this.DM,r=f;r<n.t;++r)i.data[r]=t(u,n.data[r]);i.t=n.t}i.s=t(this.s,n.s);i.clamp()}function cr(n,t){return n&t}function lr(n){var t=i();return this.bitwiseTo(n,cr,t),t}function p(n,t){return n|t}function ar(n){var t=i();return this.bitwiseTo(n,p,t),t}function d(n,t){return n^t}function vr(n){var t=i();return this.bitwiseTo(n,d,t),t}function g(n,t){return n&~t}function yr(n){var t=i();return this.bitwiseTo(n,g,t),t}function pr(){for(var n=i(),t=0;t<this.t;++t)n.data[t]=this.DM&~this.data[t];return n.t=this.t,n.s=~this.s,n}function wr(n){var t=i();return n<0?this.rShiftTo(-n,t):this.lShiftTo(n,t),t}function br(n){var t=i();return n<0?this.lShiftTo(-n,t):this.rShiftTo(n,t),t}function kr(n){if(n==0)return-1;var t=0;return(n&65535)==0&&(n>>=16,t+=16),(n&255)==0&&(n>>=8,t+=8),(n&15)==0&&(n>>=4,t+=4),(n&3)==0&&(n>>=2,t+=2),(n&1)==0&&++t,t}function dr(){for(var n=0;n<this.t;++n)if(this.data[n]!=0)return n*this.DB+kr(this.data[n]);return this.s<0?this.t*this.DB:-1}function gr(n){for(var t=0;n!=0;)n&=n-1,++t;return t}function nu(){for(var t=0,i=this.s&this.DM,n=0;n<this.t;++n)t+=gr(this.data[n]^i);return t}function tu(n){var t=Math.floor(n/this.DB);return t>=this.t?this.s!=0:(this.data[t]&1<<n%this.DB)!=0}function iu(n,i){var r=t.ONE.shiftLeft(n);return this.bitwiseTo(r,i,r),r}function ru(n){return this.changeBit(n,p)}function uu(n){return this.changeBit(n,g)}function fu(n){return this.changeBit(n,d)}function eu(n,t){for(var r=0,i=0,u=Math.min(n.t,this.t);r<u;)i+=this.data[r]+n.data[r],t.data[r++]=i&this.DM,i>>=this.DB;if(n.t<this.t){for(i+=n.s;r<this.t;)i+=this.data[r],t.data[r++]=i&this.DM,i>>=this.DB;i+=this.s}else{for(i+=this.s;r<n.t;)i+=n.data[r],t.data[r++]=i&this.DM,i>>=this.DB;i+=n.s}t.s=i<0?-1:0;i>0?t.data[r++]=i:i<-1&&(t.data[r++]=this.DV+i);t.t=r;t.clamp()}function ou(n){var t=i();return this.addTo(n,t),t}function su(n){var t=i();return this.subTo(n,t),t}function hu(n){var t=i();return this.multiplyTo(n,t),t}function cu(n){var t=i();return this.divRemTo(n,t,null),t}function lu(n){var t=i();return this.divRemTo(n,null,t),t}function au(n){var t=i(),r=i();return this.divRemTo(n,t,r),[t,r]}function vu(n){this.data[this.t]=this.am(0,n-1,this,0,0,this.t);++this.t;this.clamp()}function yu(n,t){if(n!=0){while(this.t<=t)this.data[this.t++]=0;for(this.data[t]+=n;this.data[t]>=this.DV;)this.data[t]-=this.DV,++t>=this.t&&(this.data[this.t++]=0),++this.data[t]}}function l(){}function nt(n){return n}function pu(n,t,i){n.multiplyTo(t,i)}function wu(n,t){n.squareTo(t)}function bu(n){return this.exp(n,new l)}function ku(n,t,i){var r=Math.min(this.t+n.t,t),u;for(i.s=0,i.t=r;r>0;)i.data[--r]=0;for(u=i.t-this.t;r<u;++r)i.data[r+this.t]=this.am(0,n.data[r],i,r,0,this.t);for(u=Math.min(n.t,t);r<u;++r)this.am(0,n.data[r],i,r,0,t-r);i.clamp()}function du(n,t,i){--t;var r=i.t=this.t+n.t-t;for(i.s=0;--r>=0;)i.data[r]=0;for(r=Math.max(t-this.t,0);r<n.t;++r)i.data[this.t+r-t]=this.am(t-r,n.data[r],i,0,0,this.t+r-t);i.clamp();i.drShiftTo(1,i)}function h(n){this.r2=i();this.q3=i();t.ONE.dlShiftTo(2*n.t,this.r2);this.mu=this.r2.divide(n);this.m=n}function gu(n){if(n.s<0||n.t>2*this.m.t)return n.mod(this.m);if(n.compareTo(this.m)<0)return n;var t=i();return n.copyTo(t),this.reduce(t),t}function nf(n){return n}function tf(n){for(n.drShiftTo(this.m.t-1,this.r2),n.t>this.m.t+1&&(n.t=this.m.t+1,n.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);n.compareTo(this.r2)<0;)n.dAddOffset(1,this.m.t+1);for(n.subTo(this.r2,n);n.compareTo(this.m)>=0;)n.subTo(this.m,n)}function rf(n,t){n.squareTo(t);this.reduce(t)}function uf(n,t,i){n.multiplyTo(t,i);this.reduce(i)}function ff(n,t){var r=n.bitLength(),w,u=e(1),c,d;if(r<=0)return u;w=r<18?1:r<48?3:r<144?4:r<768?5:6;c=r<8?new o(t):t.isEven()?new h(t):new s(t);var y=[],f=3,b=w-1,g=(1<<w)-1;if(y[1]=c.convert(this),w>1)for(d=i(),c.sqrTo(y[1],d);f<=g;)y[f]=i(),c.mulTo(d,y[f-2],y[f]),f+=2;var l=n.t-1,p,nt=!0,a=i(),k;for(r=v(n.data[l])-1;l>=0;){for(r>=b?p=n.data[l]>>r-b&g:(p=(n.data[l]&(1<<r+1)-1)<<b-r,l>0&&(p|=n.data[l-1]>>this.DB+r-b)),f=w;(p&1)==0;)p>>=1,--f;if((r-=f)<0&&(r+=this.DB,--l),nt)y[p].copyTo(u),nt=!1;else{while(f>1)c.sqrTo(u,a),c.sqrTo(a,u),f-=2;f>0?c.sqrTo(u,a):(k=u,u=a,a=k);c.mulTo(a,y[p],u)}while(l>=0&&(n.data[l]&1<<r)==0)c.sqrTo(u,a),k=u,u=a,a=k,--r<0&&(r=this.DB-1,--l)}return c.revert(u)}function ef(n){var i=this.s<0?this.negate():this.clone(),t=n.s<0?n.negate():n.clone(),f,u,r;if(i.compareTo(t)<0&&(f=i,i=t,t=f),u=i.getLowestSetBit(),r=t.getLowestSetBit(),r<0)return i;for(u<r&&(r=u),r>0&&(i.rShiftTo(r,i),t.rShiftTo(r,t));i.signum()>0;)(u=i.getLowestSetBit())>0&&i.rShiftTo(u,i),(u=t.getLowestSetBit())>0&&t.rShiftTo(u,t),i.compareTo(t)>=0?(i.subTo(t,i),i.rShiftTo(1,i)):(t.subTo(i,t),t.rShiftTo(1,t));return r>0&&t.lShiftTo(r,t),t}function of(n){var r,t,i;if(n<=0)return 0;if(r=this.DV%n,t=this.s<0?n-1:0,this.t>0)if(r==0)t=this.data[0]%n;else for(i=this.t-1;i>=0;--i)t=(r*t+this.data[i])%n;return t}function sf(n){var h=n.isEven();if(this.isEven()&&h||n.signum()==0)return t.ZERO;for(var u=n.clone(),f=this.clone(),o=e(1),r=e(0),s=e(0),i=e(1);u.signum()!=0;){while(u.isEven())u.rShiftTo(1,u),h?(o.isEven()&&r.isEven()||(o.addTo(this,o),r.subTo(n,r)),o.rShiftTo(1,o)):r.isEven()||r.subTo(n,r),r.rShiftTo(1,r);while(f.isEven())f.rShiftTo(1,f),h?(s.isEven()&&i.isEven()||(s.addTo(this,s),i.subTo(n,i)),s.rShiftTo(1,s)):i.isEven()||i.subTo(n,i),i.rShiftTo(1,i);u.compareTo(f)>=0?(u.subTo(f,u),h&&o.subTo(s,o),r.subTo(i,r)):(f.subTo(u,f),h&&s.subTo(o,s),i.subTo(r,i))}return f.compareTo(t.ONE)!=0?t.ZERO:i.compareTo(n)>=0?i.subtract(n):i.signum()<0?(i.addTo(n,i),i.signum()<0?i.add(n):i):i}function hf(n){var t,i=this.abs(),r,f;if(i.t==1&&i.data[0]<=u[u.length-1]){for(t=0;t<u.length;++t)if(i.data[0]==u[t])return!0;return!1}if(i.isEven())return!1;for(t=1;t<u.length;){for(r=u[t],f=t+1;f<u.length&&r<rt;)r*=u[f++];for(r=i.modInt(r);t<f;)if(r%u[t++]==0)return!1}return i.millerRabin(n)}function cf(n){var r=this.subtract(t.ONE),f=r.getLowestSetBit(),o,s,u,e,i,h;if(f<=0)return!1;for(o=r.shiftRight(f),s=lf(),e=0;e<n;++e){do u=new t(this.bitLength(),s);while(u.compareTo(t.ONE)<=0||u.compareTo(r)>=0);if(i=u.modPow(o,this),i.compareTo(t.ONE)!=0&&i.compareTo(r)!=0){for(h=1;h++<f&&i.compareTo(r)!=0;)if(i=i.modPowInt(2,this),i.compareTo(t.ONE)==0)return!1;if(i.compareTo(r)!=0)return!1}}return!0}function lf(){return{nextBytes:function(n){for(var t=0;t<n.length;++t)n[t]=Math.floor(Math.random()*255)}}}var f,tt=(0xdeadbeefcafe&16777215)==15715070,y,it,a,c,r,u,rt;for(typeof navigator=="undefined"?(t.prototype.am=w,f=28):tt&&navigator.appName=="Microsoft Internet Explorer"?(t.prototype.am=ft,f=30):tt&&navigator.appName!="Netscape"?(t.prototype.am=ut,f=26):(t.prototype.am=w,f=28),t.prototype.DB=f,t.prototype.DM=(1<<f)-1,t.prototype.DV=1<<f,y=52,t.prototype.FV=Math.pow(2,y),t.prototype.F1=y-f,t.prototype.F2=2*f-y,it="0123456789abcdefghijklmnopqrstuvwxyz",a=[],c="0".charCodeAt(0),r=0;r<=9;++r)a[c++]=r;for(c="a".charCodeAt(0),r=10;r<36;++r)a[c++]=r;for(c="A".charCodeAt(0),r=10;r<36;++r)a[c++]=r;o.prototype.convert=ri;o.prototype.revert=ui;o.prototype.reduce=fi;o.prototype.mulTo=ei;o.prototype.sqrTo=oi;s.prototype.convert=hi;s.prototype.revert=ci;s.prototype.reduce=li;s.prototype.mulTo=vi;s.prototype.sqrTo=ai;t.prototype.copyTo=et;t.prototype.fromInt=ot;t.prototype.fromString=st;t.prototype.clamp=ht;t.prototype.dlShiftTo=pt;t.prototype.drShiftTo=wt;t.prototype.lShiftTo=bt;t.prototype.rShiftTo=kt;t.prototype.subTo=dt;t.prototype.multiplyTo=gt;t.prototype.squareTo=ni;t.prototype.divRemTo=ti;t.prototype.invDigit=si;t.prototype.isEven=yi;t.prototype.exp=pi;t.prototype.toString=ct;t.prototype.negate=lt;t.prototype.abs=at;t.prototype.compareTo=vt;t.prototype.bitLength=yt;t.prototype.mod=ii;t.prototype.modPowInt=wi;t.ZERO=e(0);t.ONE=e(1);l.prototype.convert=nt;l.prototype.revert=nt;l.prototype.mulTo=pu;l.prototype.sqrTo=wu;h.prototype.convert=gu;h.prototype.revert=nf;h.prototype.reduce=tf;h.prototype.mulTo=uf;h.prototype.sqrTo=rf;u=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509];rt=67108864/u[u.length-1];t.prototype.chunkSize=nr;t.prototype.toRadix=ir;t.prototype.fromRadix=rr;t.prototype.fromNumber=ur;t.prototype.bitwiseTo=hr;t.prototype.changeBit=iu;t.prototype.addTo=eu;t.prototype.dMultiply=vu;t.prototype.dAddOffset=yu;t.prototype.multiplyLowerTo=ku;t.prototype.multiplyUpperTo=du;t.prototype.modInt=of;t.prototype.millerRabin=cf;t.prototype.clone=bi;t.prototype.intValue=ki;t.prototype.byteValue=di;t.prototype.shortValue=gi;t.prototype.signum=tr;t.prototype.toByteArray=fr;t.prototype.equals=er;t.prototype.min=or;t.prototype.max=sr;t.prototype.and=lr;t.prototype.or=ar;t.prototype.xor=vr;t.prototype.andNot=yr;t.prototype.not=pr;t.prototype.shiftLeft=wr;t.prototype.shiftRight=br;t.prototype.getLowestSetBit=dr;t.prototype.bitCount=nu;t.prototype.testBit=tu;t.prototype.setBit=ru;t.prototype.clearBit=uu;t.prototype.flipBit=fu;t.prototype.add=ou;t.prototype.subtract=su;t.prototype.multiply=hu;t.prototype.divide=cu;t.prototype.remainder=lu;t.prototype.divideAndRemainder=au;t.prototype.modPow=ff;t.prototype.modInverse=sf;t.prototype.pow=bu;t.prototype.gcd=ef;t.prototype.isProbablePrime=hf;n.jsbn=n.jsbn||{};n.jsbn.BigInteger=t}var i="jsbn",f,e,o,r;if(typeof n!="function"){if(typeof module!="object"||!module.exports)return typeof forge=="undefined"&&(forge={}),u(forge);f=!0;n=function(n,i){i(t,module)}}o=function(n,t){t.exports=function(t){var f=e.map(function(t){return n(t)}).concat(u),r;if(t=t||{},t.defined=t.defined||{},t.defined[i])return t[i];for(t.defined[i]=!0,r=0;r<f.length;++r)f[r](t);return t[i]}};r=n;n=function(t,i){return e=typeof t=="string"?i.slice(2):t.slice(2),f?(delete n,r.apply(null,Array.prototype.slice.call(arguments,0))):(n=r,n.apply(null,Array.prototype.slice.call(arguments,0)))};n("js/jsbn",["require","module"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function u(n){function t(t,i,r){var f,e,u,o;for(r||(r=n.md.sha1.create()),f="",e=Math.ceil(i/r.digestLength),u=0;u<e;++u)o=String.fromCharCode(u>>24&255,u>>16&255,u>>8&255,u&255),r.start(),r.update(t+o),f+=r.digest().getBytes();return f.substring(0,i)}var i=n.pkcs1=n.pkcs1||{};i.encode_rsa_oaep=function(i,r,u){var s,e,f,h,l,c,a,v,o;if(typeof u=="string"?(s=u,e=arguments[3]||undefined,f=arguments[4]||undefined):u&&(s=u.label||undefined,e=u.seed||undefined,f=u.md||undefined,u.mgf1&&u.mgf1.md&&(h=u.mgf1.md)),f?f.start():f=n.md.sha1.create(),h||(h=f),l=Math.ceil(i.n.bitLength()/8),c=l-2*f.digestLength-2,r.length>c){o=new Error("RSAES-OAEP input message length is too long.");throw o.length=r.length,o.maxLength=c,o;}s||(s="");f.update(s,"raw");var w=f.digest(),y="",b=c-r.length;for(a=0;a<b;a++)y+="\0";if(v=w.getBytes()+y+"\x01"+r,e){if(e.length!==f.digestLength){o=new Error("Invalid RSAES-OAEP seed. The seed length must match the digest length.");throw o.seedLength=e.length,o.digestLength=f.digestLength,o;}}else e=n.random.getBytes(f.digestLength);var k=t(e,l-f.digestLength-1,h),p=n.util.xorBytes(v,k,v.length),d=t(p,f.digestLength,h),g=n.util.xorBytes(e,d,e.length);return"\0"+g+p};i.decode_rsa_oaep=function(i,r,u){var o,f,s,h,e,l,a,v,y;if(typeof u=="string"?(o=u,f=arguments[3]||undefined):u&&(o=u.label||undefined,f=u.md||undefined,u.mgf1&&u.mgf1.md&&(s=u.mgf1.md)),h=Math.ceil(i.n.bitLength()/8),r.length!==h){e=new Error("RSAES-OAEP encoded message length is invalid.");throw e.length=r.length,e.expectedLength=h,e;}if(f===undefined?f=n.md.sha1.create():f.start(),s||(s=f),h<2*f.digestLength+2)throw new Error("RSAES-OAEP key is too short for the hash function.");o||(o="");f.update(o,"raw");var k=f.digest().getBytes(),d=r.charAt(0),w=r.substring(1,f.digestLength+1),p=r.substring(1+f.digestLength),g=t(p,f.digestLength,s),nt=n.util.xorBytes(w,g,w.length),tt=t(nt,h-f.digestLength-1,s),c=n.util.xorBytes(p,tt,p.length),it=c.substring(0,f.digestLength),e=d!=="\0";for(l=0;l<f.digestLength;++l)e|=k.charAt(l)!==it.charAt(l);for(a=1,v=f.digestLength,y=f.digestLength;y<c.length;y++){var b=c.charCodeAt(y),rt=b&1^1,ut=a?65534:0;e|=b&ut;a&=rt;v+=a}if(e||c.charCodeAt(v)!==1)throw new Error("Invalid RSAES-OAEP padding.");return c.substring(v+1)}}var i="pkcs1",f,e,o,r;if(typeof n!="function"){if(typeof module!="object"||!module.exports)return typeof forge=="undefined"&&(forge={}),u(forge);f=!0;n=function(n,i){i(t,module)}}o=function(n,t){t.exports=function(t){var f=e.map(function(t){return n(t)}).concat(u),r;if(t=t||{},t.defined=t.defined||{},t.defined[i])return t[i];for(t.defined[i]=!0,r=0;r<f.length;++r)f[r](t);return t[i]}};r=n;n=function(t,i){return e=typeof t=="string"?i.slice(2):t.slice(2),f?(delete n,r.apply(null,Array.prototype.slice.call(arguments,0))):(n=r,n.apply(null,Array.prototype.slice.call(arguments,0)))};n("js/pkcs1",["require","module","./util","./random","./sha1"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function u(n){function e(n,t,i,u){return"workers"in i?o(n,t,i,u):r(n,t,i,u)}function r(i,u,f,e){var o=t(i,u),v=0,l=s(o.bitLength()),h,a;"millerRabinTests"in f&&(l=f.millerRabinTests);h=10;"maxBlockTime"in f&&(h=f.maxBlockTime);a=+new Date;do{if(o.bitLength()>i&&(o=t(i,u)),o.isProbablePrime(l))return e(null,o);o.dAddOffset(c[v++%8],0)}while(h<0||+new Date-a<h);n.util.setImmediate(function(){r(i,u,f,e)})}function o(u,f,e,o){function c(){function y(n){var v,s,y;if(!e){if(--c,v=n.data,v.found){for(s=0;s<r.length;++s)r[s].terminate();return e=!0,o(null,new i(v.prime,16))}h.bitLength()>u&&(h=t(u,f));y=h.toString(16);n.target.postMessage({hex:y,workLoad:l});h.dAddOffset(a,0)}}var r,c,n,e;for(s=Math.max(1,s),r=[],n=0;n<s;++n)r[n]=new Worker(v);for(c=s,n=0;n<s;++n)r[n].addEventListener("message",y);e=!1}if(typeof Worker=="undefined")return r(u,f,e,o);var h=t(u,f),s=e.workers,l=e.workLoad||100,a=l*30/8,v=e.workerScript||"forge/prime.worker.js";if(s===-1)return n.util.estimateCores(function(n,t){n&&(t=2);s=t-1;c()});c()}function t(n,t){var r=new i(n,t),e=n-1;return r.testBit(e)||r.bitwiseTo(i.ONE.shiftLeft(e),f,r),r.dAddOffset(31-r.mod(u).byteValue(),0),r}function s(n){return n<=100?27:n<=150?18:n<=200?15:n<=250?12:n<=300?9:n<=350?8:n<=400?7:n<=500?6:n<=600?5:n<=800?4:n<=1250?3:2}var f;if(!n.prime){var h=n.prime=n.prime||{},i=n.jsbn.BigInteger,c=[6,4,2,4,2,4,6,2],u=new i(null);u.fromInt(30);f=function(n,t){return n|t};h.generateProbablePrime=function(t,i,r){var u,f,o;if(typeof i=="function"&&(r=i,i={}),i=i||{},u=i.algorithm||"PRIMEINC",typeof u=="string"&&(u={name:u}),u.options=u.options||{},f=i.prng||n.random,o={nextBytes:function(n){for(var i=f.getBytesSync(n.length),t=0;t<n.length;++t)n[t]=i.charCodeAt(t)}},u.name==="PRIMEINC")return e(t,o,u.options,r);throw new Error("Invalid prime generation algorithm: "+u.name);}}}var i="prime",f,e,o,r;if(typeof n!="function"){if(typeof module!="object"||!module.exports)return typeof forge=="undefined"&&(forge={}),u(forge);f=!0;n=function(n,i){i(t,module)}}o=function(n,t){t.exports=function(t){var f=e.map(function(t){return n(t)}).concat(u),r;if(t=t||{},t.defined=t.defined||{},t.defined[i])return t[i];for(t.defined[i]=!0,r=0;r<f.length;++r)f[r](t);return t[i]}};r=n;n=function(t,i){return e=typeof t=="string"?i.slice(2):t.slice(2),f?(delete n,r.apply(null,Array.prototype.slice.call(arguments,0))):(n=r,n.apply(null,Array.prototype.slice.call(arguments,0)))};n("js/prime",["require","module","./util","./jsbn","./random"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function u(n){function e(t,i,r){var u=n.util.createBuffer(),h=Math.ceil(i.n.bitLength()/8),s,e,o,c,l,f;if(t.length>h-11){s=new Error("Message is too long for PKCS#1 v1.5 padding.");throw s.length=t.length,s.max=h-11,s;}if(u.putByte(0),u.putByte(r),e=h-3-t.length,r===0||r===1)for(o=r===0?0:255,f=0;f<e;++f)u.putByte(o);else while(e>0){for(c=0,l=n.random.getBytes(e),f=0;f<e;++f)o=l.charCodeAt(f),o===0?++c:u.putByte(o);e=c}return u.putByte(0),u.putBytes(t),u}function f(t,i,r,u){var h=Math.ceil(i.n.bitLength()/8),f=n.util.createBuffer(t),l=f.getByte(),o=f.getByte(),e,s,c;if(l!==0||r&&o!==0&&o!==1||!r&&o!=2||r&&o===0&&typeof u=="undefined")throw new Error("Encryption block is invalid.");if(e=0,o===0){for(e=h-3-u,s=0;s<e;++s)if(f.getByte()!==0)throw new Error("Encryption block is invalid.");}else if(o===1)for(e=0;f.length()>1;){if(f.getByte()!==255){--f.read;break}++e}else if(o===2)for(e=0;f.length()>1;){if(f.getByte()===0){--f.read;break}++e}if(c=f.getByte(),c!==0||e!==h-3-f.length())throw new Error("Encryption block is invalid.");return f.getBytes()}function s(t,u,f){function s(){e(t.pBits,function(n,i){if(n)return f(n);if(t.p=i,t.q!==null)return o(n,t.q);e(t.qBits,o)})}function e(t,i){n.prime.generateProbablePrime(t,h,i)}function o(n,u){var c,h;if(n)return f(n);if(t.q=u,t.p.compareTo(t.q)<0&&(c=t.p,t.p=t.q,t.q=c),t.p.subtract(r.ONE).gcd(t.e).compareTo(r.ONE)!==0){t.p=null;s();return}if(t.q.subtract(r.ONE).gcd(t.e).compareTo(r.ONE)!==0){t.q=null;e(t.qBits,o);return}if(t.p1=t.p.subtract(r.ONE),t.q1=t.q.subtract(r.ONE),t.phi=t.p1.multiply(t.q1),t.phi.gcd(t.e).compareTo(r.ONE)!==0){t.p=t.q=null;s();return}if(t.n=t.p.multiply(t.q),t.n.bitLength()!==t.bits){t.q=null;e(t.qBits,o);return}h=t.e.modInverse(t.phi);t.keys={privateKey:i.rsa.setPrivateKey(t.n,t.e,h,t.p,t.q,h.mod(t.p1),h.mod(t.q1),t.q.modInverse(t.p)),publicKey:i.rsa.setPublicKey(t.n,t.e)};f(null,t.keys)}typeof u=="function"&&(f=u,u={});u=u||{};var h={algorithm:{name:u.algorithm||"PRIMEINC",options:{workers:u.workers||2,workLoad:u.workLoad||100,workerScript:u.workerScript}}};"prng"in u&&(h.prng=u.prng);s()}function u(t){var i=t.toString(16);return i[0]>="8"&&(i="00"+i),n.util.hexToBytes(i)}function h(n){return n<=100?27:n<=150?18:n<=200?15:n<=250?12:n<=300?9:n<=350?8:n<=400?7:n<=500?6:n<=600?5:n<=800?4:n<=1250?3:2}var r,t;typeof r=="undefined"&&(r=n.jsbn.BigInteger);t=n.asn1;n.pki=n.pki||{};n.pki.rsa=n.rsa=n.rsa||{};var i=n.pki,c=[6,4,2,4,2,4,6,2],l={name:"PrivateKeyInfo",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"PrivateKeyInfo.version",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"privateKeyVersion"},{name:"PrivateKeyInfo.privateKeyAlgorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"privateKeyOid"}]},{name:"PrivateKeyInfo",tagClass:t.Class.UNIVERSAL,type:t.Type.OCTETSTRING,constructed:!1,capture:"privateKey"}]},a={name:"RSAPrivateKey",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"RSAPrivateKey.version",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"privateKeyVersion"},{name:"RSAPrivateKey.modulus",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"privateKeyModulus"},{name:"RSAPrivateKey.publicExponent",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"privateKeyPublicExponent"},{name:"RSAPrivateKey.privateExponent",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"privateKeyPrivateExponent"},{name:"RSAPrivateKey.prime1",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"privateKeyPrime1"},{name:"RSAPrivateKey.prime2",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"privateKeyPrime2"},{name:"RSAPrivateKey.exponent1",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"privateKeyExponent1"},{name:"RSAPrivateKey.exponent2",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"privateKeyExponent2"},{name:"RSAPrivateKey.coefficient",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"privateKeyCoefficient"}]},v={name:"RSAPublicKey",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"RSAPublicKey.modulus",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"publicKeyModulus"},{name:"RSAPublicKey.exponent",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"publicKeyExponent"}]},y=n.pki.rsa.publicKeyValidator={name:"SubjectPublicKeyInfo",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,captureAsn1:"subjectPublicKeyInfo",value:[{name:"SubjectPublicKeyInfo.AlgorithmIdentifier",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"publicKeyOid"}]},{name:"SubjectPublicKeyInfo.subjectPublicKey",tagClass:t.Class.UNIVERSAL,type:t.Type.BITSTRING,constructed:!1,value:[{name:"SubjectPublicKeyInfo.subjectPublicKey.RSAPublicKey",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,optional:!0,captureAsn1:"rsaPublicKey"}]}]},p=function(n){var e,o,f;if(n.algorithm in i.oids){e=i.oids[n.algorithm];var s=t.oidToDer(e).getBytes(),r=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[]),u=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[]);return u.value.push(t.create(t.Class.UNIVERSAL,t.Type.OID,!1,s)),u.value.push(t.create(t.Class.UNIVERSAL,t.Type.NULL,!1,"")),o=t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,n.digest().getBytes()),r.value.push(u),r.value.push(o),t.toDer(r).getBytes()}f=new Error("Unknown message digest algorithm.");throw f.algorithm=n.algorithm,f;},o=function(t,i,u){var e,f,o,s;if(u)return t.modPow(i.e,i.n);if(!i.p||!i.q)return t.modPow(i.d,i.n);i.dP||(i.dP=i.d.mod(i.p.subtract(r.ONE)));i.dQ||(i.dQ=i.d.mod(i.q.subtract(r.ONE)));i.qInv||(i.qInv=i.q.modInverse(i.p));do e=new r(n.util.bytesToHex(n.random.getBytes(i.n.bitLength()/8)),16).mod(i.n);while(e.equals(r.ZERO));for(t=t.multiply(e.modPow(i.e,i.n)).mod(i.n),f=t.mod(i.p).modPow(i.dP,i.p),o=t.mod(i.q).modPow(i.dQ,i.q);f.compareTo(o)<0;)f=f.add(i.p);return s=f.subtract(o).multiply(i.qInv).mod(i.p).multiply(i.q).add(o),s=s.multiply(e.modInverse(i.n)).mod(i.n),s};i.rsa.encrypt=function(t,i,u){var h=u,f,a=Math.ceil(i.n.bitLength()/8);u!==!1&&u!==!0?(h=u===2,f=e(t,i,u)):(f=n.util.createBuffer(),f.putBytes(t));for(var v=new r(f.toHex(),16),y=o(v,i,h),c=y.toString(16),s=n.util.createBuffer(),l=a-Math.ceil(c.length/2);l>0;)s.putByte(0),--l;return s.putBytes(n.util.hexToBytes(c)),s.getBytes()};i.rsa.decrypt=function(t,i,u,e){var c=Math.ceil(i.n.bitLength()/8),s,l;if(t.length!==c){s=new Error("Encrypted message length is invalid.");throw s.length=t.length,s.expected=c,s;}if(l=new r(n.util.createBuffer(t).toHex(),16),l.compareTo(i.n)>=0)throw new Error("Encrypted message is invalid.");for(var y=o(l,i,u),a=y.toString(16),h=n.util.createBuffer(),v=c-Math.ceil(a.length/2);v>0;)h.putByte(0),--v;return h.putBytes(n.util.hexToBytes(a)),e!==!1?f(h.getBytes(),i,u):h.getBytes()};i.rsa.createKeyPairGenerationState=function(t,i,u){typeof t=="string"&&(t=parseInt(t,10));t=t||2048;u=u||{};var o=u.prng||n.random,s={nextBytes:function(n){for(var i=o.getBytesSync(n.length),t=0;t<n.length;++t)n[t]=i.charCodeAt(t)}},e=u.algorithm||"PRIMEINC",f;if(e!=="PRIMEINC")throw new Error("Invalid key generation algorithm: "+e);return f={algorithm:e,state:0,bits:t,rng:s,eInt:i||65537,e:new r(null),p:null,q:null,qBits:t>>1,pBits:t-(t>>1),pqState:0,num:null,keys:null},f.e.fromInt(f.eInt),f};i.rsa.stepKeyPairGenerationState=function(n,t){var e,u,s,f;"algorithm"in n||(n.algorithm="PRIMEINC");e=new r(null);e.fromInt(30);for(var l=0,y=function(n,t){return n|t},a=+new Date,o,v=0;n.keys===null&&(t<=0||v<t);)n.state===0?(u=n.p===null?n.pBits:n.qBits,s=u-1,n.pqState===0?(n.num=new r(u,n.rng),n.num.testBit(s)||n.num.bitwiseTo(r.ONE.shiftLeft(s),y,n.num),n.num.dAddOffset(31-n.num.mod(e).byteValue(),0),l=0,++n.pqState):n.pqState===1?n.num.bitLength()>u?n.pqState=0:n.num.isProbablePrime(h(n.num.bitLength()))?++n.pqState:n.num.dAddOffset(c[l++%8],0):n.pqState===2?n.pqState=n.num.subtract(r.ONE).gcd(n.e).compareTo(r.ONE)===0?3:0:n.pqState===3&&(n.pqState=0,n.p===null?n.p=n.num:n.q=n.num,n.p!==null&&n.q!==null&&++n.state,n.num=null)):n.state===1?(n.p.compareTo(n.q)<0&&(n.num=n.p,n.p=n.q,n.q=n.num),++n.state):n.state===2?(n.p1=n.p.subtract(r.ONE),n.q1=n.q.subtract(r.ONE),n.phi=n.p1.multiply(n.q1),++n.state):n.state===3?n.phi.gcd(n.e).compareTo(r.ONE)===0?++n.state:(n.p=null,n.q=null,n.state=0):n.state===4?(n.n=n.p.multiply(n.q),n.n.bitLength()===n.bits?++n.state:(n.q=null,n.state=0)):n.state===5&&(f=n.e.modInverse(n.phi),n.keys={privateKey:i.rsa.setPrivateKey(n.n,n.e,f,n.p,n.q,f.mod(n.p1),f.mod(n.q1),n.q.modInverse(n.p)),publicKey:i.rsa.setPublicKey(n.n,n.e)}),o=+new Date,v+=o-a,a=o;return n.keys!==null};i.rsa.generateKeyPair=function(n,t,r,u){arguments.length===1?typeof n=="object"?(r=n,n=undefined):typeof n=="function"&&(u=n,n=undefined):arguments.length===2?typeof n=="number"?typeof t=="function"?(u=t,t=undefined):typeof t!="number"&&(r=t,t=undefined):(r=n,u=t,n=undefined,t=undefined):arguments.length===3&&(typeof t=="number"?typeof r=="function"&&(u=r,r=undefined):(u=r,r=t,t=undefined));r=r||{};n===undefined&&(n=r.bits||2048);t===undefined&&(t=r.e||65537);var f=i.rsa.createKeyPairGenerationState(n,t,r);if(!u)return i.rsa.stepKeyPairGenerationState(f,0),f.keys;s(f,r,u)};i.setRsaPublicKey=i.rsa.setPublicKey=function(r,u){var o={n:r,e:u};return o.encrypt=function(t,r,u){if(typeof r=="string"?r=r.toUpperCase():r===undefined&&(r="RSAES-PKCS1-V1_5"),r==="RSAES-PKCS1-V1_5")r={encode:function(n,t){return e(n,t,2).getBytes()}};else if(r==="RSA-OAEP"||r==="RSAES-OAEP")r={encode:function(t,i){return n.pkcs1.encode_rsa_oaep(i,t,u)}};else if(["RAW","NONE","NULL",null].indexOf(r)!==-1)r={encode:function(n){return n}};else if(typeof r=="string")throw new Error('Unsupported encryption scheme: "'+r+'".');var f=r.encode(t,o,!0);return i.rsa.encrypt(f,o,!0)},o.verify=function(n,r,u){typeof u=="string"?u=u.toUpperCase():u===undefined&&(u="RSASSA-PKCS1-V1_5");u==="RSASSA-PKCS1-V1_5"?u={verify:function(n,i){i=f(i,o,!0);var r=t.fromDer(i);return n===r.value[1].value}}:(u==="NONE"||u==="NULL"||u===null)&&(u={verify:function(n,t){return t=f(t,o,!0),n===t}});var e=i.rsa.decrypt(r,o,!0,!1);return u.verify(n,e,o.n.bitLength())},o};i.setRsaPrivateKey=i.rsa.setPrivateKey=function(t,r,u,e,o,s,h,c){var l={n:t,e:r,d:u,p:e,q:o,dP:s,dQ:h,qInv:c};return l.decrypt=function(t,r,u){typeof r=="string"?r=r.toUpperCase():r===undefined&&(r="RSAES-PKCS1-V1_5");var e=i.rsa.decrypt(t,l,!1,!1);if(r==="RSAES-PKCS1-V1_5")r={decode:f};else if(r==="RSA-OAEP"||r==="RSAES-OAEP")r={decode:function(t,i){return n.pkcs1.decode_rsa_oaep(i,t,u)}};else{if(["RAW","NONE","NULL",null].indexOf(r)===-1)throw new Error('Unsupported encryption scheme: "'+r+'".');r={decode:function(n){return n}}}return r.decode(e,l,!1)},l.sign=function(n,t){var r=!1,u;return typeof t=="string"&&(t=t.toUpperCase()),t===undefined||t==="RSASSA-PKCS1-V1_5"?(t={encode:p},r=1):(t==="NONE"||t==="NULL"||t===null)&&(t={encode:function(){return n}},r=1),u=t.encode(n,l.n.bitLength()),i.rsa.encrypt(u,l,r)},l};i.wrapRsaPrivateKey=function(n){return t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,t.integerToDer(0).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(i.oids.rsaEncryption).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.NULL,!1,"")]),t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,t.toDer(n).getBytes())])};i.privateKeyFromAsn1=function(u){var f={},e=[],o,s,h,c,v,y,p,w,b;if(t.validate(u,l,f,e)&&(u=t.fromDer(n.util.createBuffer(f.privateKey))),f={},e=[],!t.validate(u,a,f,e)){o=new Error("Cannot read private key. ASN.1 object does not contain an RSAPrivateKey.");throw o.errors=e,o;}return s=n.util.createBuffer(f.privateKeyModulus).toHex(),h=n.util.createBuffer(f.privateKeyPublicExponent).toHex(),c=n.util.createBuffer(f.privateKeyPrivateExponent).toHex(),v=n.util.createBuffer(f.privateKeyPrime1).toHex(),y=n.util.createBuffer(f.privateKeyPrime2).toHex(),p=n.util.createBuffer(f.privateKeyExponent1).toHex(),w=n.util.createBuffer(f.privateKeyExponent2).toHex(),b=n.util.createBuffer(f.privateKeyCoefficient).toHex(),i.setRsaPrivateKey(new r(s,16),new r(h,16),new r(c,16),new r(v,16),new r(y,16),new r(p,16),new r(w,16),new r(b,16))};i.privateKeyToAsn1=i.privateKeyToRSAPrivateKey=function(n){return t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,t.integerToDer(0).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,u(n.n)),t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,u(n.e)),t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,u(n.d)),t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,u(n.p)),t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,u(n.q)),t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,u(n.dP)),t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,u(n.dQ)),t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,u(n.qInv))])};i.publicKeyFromAsn1=function(u){var f={},o=[],s,e,h,c;if(t.validate(u,y,f,o)){if(s=t.derToOid(f.publicKeyOid),s!==i.oids.rsaEncryption){e=new Error("Cannot read public key. Unknown OID.");throw e.oid=s,e;}u=f.rsaPublicKey}if(o=[],!t.validate(u,v,f,o)){e=new Error("Cannot read public key. ASN.1 object does not contain an RSAPublicKey.");throw e.errors=o,e;}return h=n.util.createBuffer(f.publicKeyModulus).toHex(),c=n.util.createBuffer(f.publicKeyExponent).toHex(),i.setRsaPublicKey(new r(h,16),new r(c,16))};i.publicKeyToAsn1=i.publicKeyToSubjectPublicKeyInfo=function(n){return t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(i.oids.rsaEncryption).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.NULL,!1,"")]),t.create(t.Class.UNIVERSAL,t.Type.BITSTRING,!1,[i.publicKeyToRSAPublicKey(n)])])};i.publicKeyToRSAPublicKey=function(n){return t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,u(n.n)),t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,u(n.e))])}}var i="rsa",f,e,o,r;if(typeof n!="function"){if(typeof module!="object"||!module.exports)return typeof forge=="undefined"&&(forge={}),u(forge);f=!0;n=function(n,i){i(t,module)}}o=function(n,t){t.exports=function(t){var f=e.map(function(t){return n(t)}).concat(u),r;if(t=t||{},t.defined=t.defined||{},t.defined[i])return t[i];for(t.defined[i]=!0,r=0;r<f.length;++r)f[r](t);return t[i]}};r=n;n=function(t,i){return e=typeof t=="string"?i.slice(2):t.slice(2),f?(delete n,r.apply(null,Array.prototype.slice.call(arguments,0))):(n=r,n.apply(null,Array.prototype.slice.call(arguments,0)))};n("js/rsa",["require","module","./asn1","./jsbn","./oids","./pkcs1","./prime","./random","./util"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function u(n){function u(n,t){return n.start().update(t).digest().getBytes()}var f,t,i;typeof f=="undefined"&&(f=n.jsbn.BigInteger);t=n.asn1;i=n.pki=n.pki||{};i.pbe=n.pbe=n.pbe||{};var r=i.oids,e={name:"EncryptedPrivateKeyInfo",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedPrivateKeyInfo.encryptionAlgorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"encryptionOid"},{name:"AlgorithmIdentifier.parameters",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,captureAsn1:"encryptionParams"}]},{name:"EncryptedPrivateKeyInfo.encryptedData",tagClass:t.Class.UNIVERSAL,type:t.Type.OCTETSTRING,constructed:!1,capture:"encryptedData"}]},o={name:"PBES2Algorithms",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.keyDerivationFunc",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.keyDerivationFunc.oid",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"kdfOid"},{name:"PBES2Algorithms.params",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.params.salt",tagClass:t.Class.UNIVERSAL,type:t.Type.OCTETSTRING,constructed:!1,capture:"kdfSalt"},{name:"PBES2Algorithms.params.iterationCount",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,onstructed:!0,capture:"kdfIterationCount"}]}]},{name:"PBES2Algorithms.encryptionScheme",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.encryptionScheme.oid",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"encOid"},{name:"PBES2Algorithms.encryptionScheme.iv",tagClass:t.Class.UNIVERSAL,type:t.Type.OCTETSTRING,constructed:!1,capture:"encIv"}]}]},s={name:"pkcs-12PbeParams",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"pkcs-12PbeParams.salt",tagClass:t.Class.UNIVERSAL,type:t.Type.OCTETSTRING,constructed:!1,capture:"salt"},{name:"pkcs-12PbeParams.iterations",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"iterations"}]};i.encryptPrivateKeyInfo=function(u,f,e){var c,l,a,h;e=e||{};e.saltSize=e.saltSize||8;e.count=e.count||2048;e.algorithm=e.algorithm||"aes128";var v=n.random.getBytesSync(e.saltSize),y=e.count,k=t.integerToDer(y),o,p,w;if(e.algorithm.indexOf("aes")===0||e.algorithm==="des"){switch(e.algorithm){case"aes128":o=16;c=16;l=r["aes128-CBC"];a=n.aes.createEncryptionCipher;break;case"aes192":o=24;c=16;l=r["aes192-CBC"];a=n.aes.createEncryptionCipher;break;case"aes256":o=32;c=16;l=r["aes256-CBC"];a=n.aes.createEncryptionCipher;break;case"des":o=8;c=8;l=r.desCBC;a=n.des.createEncryptionCipher;break;default:h=new Error("Cannot encrypt private key. Unknown encryption algorithm.");throw h.algorithm=e.algorithm,h;}var d=n.pkcs5.pbkdf2(f,v,y,o),b=n.random.getBytesSync(c),s=a(d);s.start(b);s.update(t.toDer(u));s.finish();w=s.output.getBytes();p=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(r.pkcs5PBES2).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(r.pkcs5PBKDF2).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,v),t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,k.getBytes())])]),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(l).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,b)])])])}else{if(e.algorithm!=="3des"){h=new Error("Cannot encrypt private key. Unknown encryption algorithm.");throw h.algorithm=e.algorithm,h;}o=24;var g=new n.util.ByteBuffer(v),d=i.pbe.generatePkcs12Key(f,g,1,y,o),b=i.pbe.generatePkcs12Key(f,g,2,y,o),s=n.des.createEncryptionCipher(d);s.start(b);s.update(t.toDer(u));s.finish();w=s.output.getBytes();p=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(r["pbeWithSHAAnd3-KeyTripleDES-CBC"]).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,v),t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,k.getBytes())])])}return t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[p,t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,w)])};i.decryptPrivateKeyInfo=function(r,u){var h=null,f={},c=[],o;if(!t.validate(r,e,f,c)){o=new Error("Cannot read encrypted private key. ASN.1 object is not a supported EncryptedPrivateKeyInfo.");throw o.errors=c,o;}var l=t.derToOid(f.encryptionOid),s=i.pbe.getCipher(l,f.encryptionParams,u),a=n.util.createBuffer(f.encryptedData);return s.update(a),s.finish()&&(h=t.fromDer(s.output)),h};i.encryptedPrivateKeyToPem=function(i,r){var u={type:"ENCRYPTED PRIVATE KEY",body:t.toDer(i).getBytes()};return n.pem.encode(u,{maxline:r})};i.encryptedPrivateKeyFromPem=function(i){var r=n.pem.decode(i)[0],u;if(r.type!=="ENCRYPTED PRIVATE KEY"){u=new Error('Could not convert encrypted private key from PEM; PEM header type is "ENCRYPTED PRIVATE KEY".');throw u.headerType=r.type,u;}if(r.procType&&r.procType.type==="ENCRYPTED")throw new Error("Could not convert encrypted private key from PEM; PEM is encrypted.");return t.fromDer(r.body)};i.encryptRsaPrivateKey=function(r,u,f){var l,o,e,s,h,a,v,c,y;if(f=f||{},!f.legacy)return l=i.wrapRsaPrivateKey(i.privateKeyToAsn1(r)),l=i.encryptPrivateKeyInfo(l,u,f),i.encryptedPrivateKeyToPem(l);switch(f.algorithm){case"aes128":o="AES-128-CBC";s=16;e=n.random.getBytesSync(16);h=n.aes.createEncryptionCipher;break;case"aes192":o="AES-192-CBC";s=24;e=n.random.getBytesSync(16);h=n.aes.createEncryptionCipher;break;case"aes256":o="AES-256-CBC";s=32;e=n.random.getBytesSync(16);h=n.aes.createEncryptionCipher;break;case"3des":o="DES-EDE3-CBC";s=24;e=n.random.getBytesSync(8);h=n.des.createEncryptionCipher;break;case"des":o="DES-CBC";s=8;e=n.random.getBytesSync(8);h=n.des.createEncryptionCipher;break;default:a=new Error('Could not encrypt RSA private key; unsupported encryption algorithm "'+f.algorithm+'".');throw a.algorithm=f.algorithm,a;}return v=n.pbe.opensslDeriveBytes(u,e.substr(0,8),s),c=h(v),c.start(e),c.update(t.toDer(i.privateKeyToAsn1(r))),c.finish(),y={type:"RSA PRIVATE KEY",procType:{version:"4",type:"ENCRYPTED"},dekInfo:{algorithm:o,parameters:n.util.bytesToHex(e).toUpperCase()},body:c.output.getBytes()},n.pem.encode(y)};i.decryptRsaPrivateKey=function(r,u){var e=null,f=n.pem.decode(r)[0],o,s,h;if(f.type!=="ENCRYPTED PRIVATE KEY"&&f.type!=="PRIVATE KEY"&&f.type!=="RSA PRIVATE KEY"){h=new Error('Could not convert private key from PEM; PEM header type is not "ENCRYPTED PRIVATE KEY", "PRIVATE KEY", or "RSA PRIVATE KEY".');throw h.headerType=h,h;}if(f.procType&&f.procType.type==="ENCRYPTED"){switch(f.dekInfo.algorithm){case"DES-CBC":o=8;s=n.des.createDecryptionCipher;break;case"DES-EDE3-CBC":o=24;s=n.des.createDecryptionCipher;break;case"AES-128-CBC":o=16;s=n.aes.createDecryptionCipher;break;case"AES-192-CBC":o=24;s=n.aes.createDecryptionCipher;break;case"AES-256-CBC":o=32;s=n.aes.createDecryptionCipher;break;case"RC2-40-CBC":o=5;s=function(t){return n.rc2.createDecryptionCipher(t,40)};break;case"RC2-64-CBC":o=8;s=function(t){return n.rc2.createDecryptionCipher(t,64)};break;case"RC2-128-CBC":o=16;s=function(t){return n.rc2.createDecryptionCipher(t,128)};break;default:h=new Error('Could not decrypt private key; unsupported encryption algorithm "'+f.dekInfo.algorithm+'".');throw h.algorithm=f.dekInfo.algorithm,h;}var l=n.util.hexToBytes(f.dekInfo.parameters),a=n.pbe.opensslDeriveBytes(u,l.substr(0,8),o),c=s(a);if(c.start(l),c.update(n.util.createBuffer(f.body)),!c.finish())return e;e=c.output.getBytes()}else e=f.body;return e=f.type==="ENCRYPTED PRIVATE KEY"?i.decryptPrivateKeyInfo(t.fromDer(e),u):t.fromDer(e),e!==null&&(e=i.privateKeyFromAsn1(e)),e};i.pbe.generatePkcs12Key=function(t,i,r,u,f,e){var w,o,ft,d,et,g,c,ot,nt,h,tt,v,st,it,y,p;(typeof e=="undefined"||e===null)&&(e=n.md.sha1.create());var rt=e.digestLength,s=e.blockLength,l=new n.util.ByteBuffer,a=new n.util.ByteBuffer;if(t!==null&&t!==undefined){for(o=0;o<t.length;o++)a.putInt16(t.charCodeAt(o));a.putInt16(0)}var b=a.length(),k=i.length(),ut=new n.util.ByteBuffer;for(ut.fillWithByte(r,s),ft=s*Math.ceil(k/s),d=new n.util.ByteBuffer,o=0;o<ft;o++)d.putByte(i.at(o%k));for(et=s*Math.ceil(b/s),g=new n.util.ByteBuffer,o=0;o<et;o++)g.putByte(a.at(o%b));for(c=d,c.putBuffer(g),ot=Math.ceil(f/rt),nt=1;nt<=ot;nt++){for(h=new n.util.ByteBuffer,h.putBytes(ut.bytes()),h.putBytes(c.bytes()),tt=0;tt<u;tt++)e.start(),e.update(h.getBytes()),h=e.digest();for(v=new n.util.ByteBuffer,o=0;o<s;o++)v.putByte(h.at(o%rt));for(st=Math.ceil(k/s)+Math.ceil(b/s),it=new n.util.ByteBuffer,w=0;w<st;w++){for(y=new n.util.ByteBuffer(c.getBytes(s)),p=511,o=v.length()-1;o>=0;o--)p>>=8,p+=v.at(o)+y.at(o),y.setAt(o,p&255);it.putBuffer(y)}c=it;l.putBuffer(h)}return l.truncate(l.length()-f),l};i.pbe.getCipher=function(n,t,r){switch(n){case i.oids.pkcs5PBES2:return i.pbe.getCipherForPBES2(n,t,r);case i.oids["pbeWithSHAAnd3-KeyTripleDES-CBC"]:case i.oids["pbewithSHAAnd40BitRC2-CBC"]:return i.pbe.getCipherForPKCS12PBE(n,t,r);default:var u=new Error("Cannot read encrypted PBE data block. Unsupported OID.");throw u.oid=n,u.supportedOids=["pkcs5PBES2","pbeWithSHAAnd3-KeyTripleDES-CBC","pbewithSHAAnd40BitRC2-CBC"],u;}};i.pbe.getCipherForPBES2=function(r,u,f){var s={},a=[],e,v,l,h,c;if(!t.validate(u,o,s,a)){e=new Error("Cannot read password-based-encryption algorithm parameters. ASN.1 object is not a supported EncryptedPrivateKeyInfo.");throw e.errors=a,e;}if(r=t.derToOid(s.kdfOid),r!==i.oids.pkcs5PBKDF2){e=new Error("Cannot read encrypted private key. Unsupported key derivation function OID.");throw e.oid=r,e.supportedOids=["pkcs5PBKDF2"],e;}if(r=t.derToOid(s.encOid),r!==i.oids["aes128-CBC"]&&r!==i.oids["aes192-CBC"]&&r!==i.oids["aes256-CBC"]&&r!==i.oids["des-EDE3-CBC"]&&r!==i.oids.desCBC){e=new Error("Cannot read encrypted private key. Unsupported encryption scheme OID.");throw e.oid=r,e.supportedOids=["aes128-CBC","aes192-CBC","aes256-CBC","des-EDE3-CBC","desCBC"],e;}v=s.kdfSalt;l=n.util.createBuffer(s.kdfIterationCount);l=l.getInt(l.length()<<3);switch(i.oids[r]){case"aes128-CBC":h=16;c=n.aes.createDecryptionCipher;break;case"aes192-CBC":h=24;c=n.aes.createDecryptionCipher;break;case"aes256-CBC":h=32;c=n.aes.createDecryptionCipher;break;case"des-EDE3-CBC":h=24;c=n.des.createDecryptionCipher;break;case"desCBC":h=8;c=n.des.createDecryptionCipher}var p=n.pkcs5.pbkdf2(f,v,l,h),w=s.encIv,y=c(p);return y.start(w),y};i.pbe.getCipherForPKCS12PBE=function(r,u,f){var h={},y=[],c,o,l,a,v,e,p,w;if(!t.validate(u,s,h,y)){e=new Error("Cannot read password-based-encryption algorithm parameters. ASN.1 object is not a supported EncryptedPrivateKeyInfo.");throw e.errors=y,e;}c=n.util.createBuffer(h.salt);o=n.util.createBuffer(h.iterations);o=o.getInt(o.length()<<3);switch(r){case i.oids["pbeWithSHAAnd3-KeyTripleDES-CBC"]:l=24;a=8;v=n.des.startDecrypting;break;case i.oids["pbewithSHAAnd40BitRC2-CBC"]:l=5;a=8;v=function(t,i){var r=n.rc2.createDecryptionCipher(t,40);return r.start(i,null),r};break;default:e=new Error("Cannot read PKCS #12 PBE data block. Unsupported OID.");throw e.oid=r,e;}return p=i.pbe.generatePkcs12Key(f,c,1,o,l),w=i.pbe.generatePkcs12Key(f,c,2,o,a),v(p,w)};i.pbe.opensslDeriveBytes=function(t,i,r,f){var e,o,s;for((typeof f=="undefined"||f===null)&&(f=n.md.md5.create()),i===null&&(i=""),e=[u(f,t+i)],o=16,s=1;o<r;++s,o+=16)e.push(u(f,e[s-1]+t+i));return e.join("").substr(0,r)}}var i="pbe",f,e,o,r;if(typeof n!="function"){if(typeof module!="object"||!module.exports)return typeof forge=="undefined"&&(forge={}),u(forge);f=!0;n=function(n,i){i(t,module)}}o=function(n,t){t.exports=function(t){var f=e.map(function(t){return n(t)}).concat(u),r;if(t=t||{},t.defined=t.defined||{},t.defined[i])return t[i];for(t.defined[i]=!0,r=0;r<f.length;++r)f[r](t);return t[i]}};r=n;n=function(t,i){return e=typeof t=="string"?i.slice(2):t.slice(2),f?(delete n,r.apply(null,Array.prototype.slice.call(arguments,0))):(n=r,n.apply(null,Array.prototype.slice.call(arguments,0)))};n("js/pbe",["require","module","./aes","./asn1","./des","./md","./oids","./pem","./pbkdf2","./random","./rc2","./rsa","./util"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function u(n){var t=n.asn1,i=n.pkcs7asn1=n.pkcs7asn1||{},r,u,f;n.pkcs7=n.pkcs7||{};n.pkcs7.asn1=i;r={name:"ContentInfo",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"ContentInfo.ContentType",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"contentType"},{name:"ContentInfo.content",tagClass:t.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,captureAsn1:"content"}]};i.contentInfoValidator=r;u={name:"EncryptedContentInfo",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedContentInfo.contentType",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"contentType"},{name:"EncryptedContentInfo.contentEncryptionAlgorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedContentInfo.contentEncryptionAlgorithm.algorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"encAlgorithm"},{name:"EncryptedContentInfo.contentEncryptionAlgorithm.parameter",tagClass:t.Class.UNIVERSAL,captureAsn1:"encParameter"}]},{name:"EncryptedContentInfo.encryptedContent",tagClass:t.Class.CONTEXT_SPECIFIC,type:0,capture:"encryptedContent",captureAsn1:"encryptedContentAsn1"}]};i.envelopedDataValidator={name:"EnvelopedData",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"EnvelopedData.Version",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"version"},{name:"EnvelopedData.RecipientInfos",tagClass:t.Class.UNIVERSAL,type:t.Type.SET,constructed:!0,captureAsn1:"recipientInfos"}].concat(u)};i.encryptedDataValidator={name:"EncryptedData",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedData.Version",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"version"}].concat(u)};f={name:"SignerInfo",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"SignerInfo.Version",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1},{name:"SignerInfo.IssuerAndSerialNumber",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0},{name:"SignerInfo.DigestAlgorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0},{name:"SignerInfo.AuthenticatedAttributes",tagClass:t.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,capture:"authenticatedAttributes"},{name:"SignerInfo.DigestEncryptionAlgorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0},{name:"SignerInfo.EncryptedDigest",tagClass:t.Class.UNIVERSAL,type:t.Type.OCTETSTRING,constructed:!1,capture:"signature"},{name:"SignerInfo.UnauthenticatedAttributes",tagClass:t.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,optional:!0}]};i.signedDataValidator={name:"SignedData",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"SignedData.Version",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"version"},{name:"SignedData.DigestAlgorithms",tagClass:t.Class.UNIVERSAL,type:t.Type.SET,constructed:!0,captureAsn1:"digestAlgorithms"},r,{name:"SignedData.Certificates",tagClass:t.Class.CONTEXT_SPECIFIC,type:0,optional:!0,captureAsn1:"certificates"},{name:"SignedData.CertificateRevocationLists",tagClass:t.Class.CONTEXT_SPECIFIC,type:1,optional:!0,captureAsn1:"crls"},{name:"SignedData.SignerInfos",tagClass:t.Class.UNIVERSAL,type:t.Type.SET,capture:"signerInfos",optional:!0,value:[f]}]};i.recipientInfoValidator={name:"RecipientInfo",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.version",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"version"},{name:"RecipientInfo.issuerAndSerial",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.issuerAndSerial.issuer",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,captureAsn1:"issuer"},{name:"RecipientInfo.issuerAndSerial.serialNumber",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"serial"}]},{name:"RecipientInfo.keyEncryptionAlgorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.keyEncryptionAlgorithm.algorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"encAlgorithm"},{name:"RecipientInfo.keyEncryptionAlgorithm.parameter",tagClass:t.Class.UNIVERSAL,constructed:!1,captureAsn1:"encParameter"}]},{name:"RecipientInfo.encryptedKey",tagClass:t.Class.UNIVERSAL,type:t.Type.OCTETSTRING,constructed:!1,capture:"encKey"}]}}var i="pkcs7asn1",f,e,o,r;if(typeof n!="function"){if(typeof module!="object"||!module.exports)return typeof forge=="undefined"&&(forge={}),u(forge);f=!0;n=function(n,i){i(t,module)}}o=function(n,t){t.exports=function(t){var f=e.map(function(t){return n(t)}).concat(u),r;if(t=t||{},t.defined=t.defined||{},t.defined[i])return t[i];for(t.defined[i]=!0,r=0;r<f.length;++r)f[r](t);return t[i]}};r=n;n=function(t,i){return e=typeof t=="string"?i.slice(2):t.slice(2),f?(delete n,r.apply(null,Array.prototype.slice.call(arguments,0))):(n=r,n.apply(null,Array.prototype.slice.call(arguments,0)))};n("js/pkcs7asn1",["require","module","./asn1","./util"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function u(n){n.mgf=n.mgf||{};var t=n.mgf.mgf1=n.mgf1=n.mgf1||{};t.create=function(t){return{generate:function(i,r){for(var e,u=new n.util.ByteBuffer,o=Math.ceil(r/t.digestLength),f=0;f<o;f++)e=new n.util.ByteBuffer,e.putInt32(f),t.start(),t.update(i+e.getBytes()),u.putBuffer(t.digest());return u.truncate(u.length()-r),u.getBytes()}}}}var i="mgf1",f,e,o,r;if(typeof n!="function"){if(typeof module!="object"||!module.exports)return typeof forge=="undefined"&&(forge={}),u(forge);f=!0;n=function(n,i){i(t,module)}}o=function(n,t){t.exports=function(t){var f=e.map(function(t){return n(t)}).concat(u),r;if(t=t||{},t.defined=t.defined||{},t.defined[i])return t[i];for(t.defined[i]=!0,r=0;r<f.length;++r)f[r](t);return t[i]}};r=n;n=function(t,i){return e=typeof t=="string"?i.slice(2):t.slice(2),f?(delete n,r.apply(null,Array.prototype.slice.call(arguments,0))):(n=r,n.apply(null,Array.prototype.slice.call(arguments,0)))};n("js/mgf1",["require","module","./util"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function u(n){n.mgf=n.mgf||{};n.mgf.mgf1=n.mgf1}var i="mgf",f,e,o,r;if(typeof n!="function"){if(typeof module!="object"||!module.exports)return typeof forge=="undefined"&&(forge={}),u(forge);f=!0;n=function(n,i){i(t,module)}}o=function(n,t){t.exports=function(t){var f=e.map(function(t){return n(t)}).concat(u),r;if(t=t||{},t.defined=t.defined||{},t.defined[i])return t[i];for(t.defined[i]=!0,r=0;r<f.length;++r)f[r](t);return t[i]}};r=n;n=function(t,i){return e=typeof t=="string"?i.slice(2):t.slice(2),f?(delete n,r.apply(null,Array.prototype.slice.call(arguments,0))):(n=r,n.apply(null,Array.prototype.slice.call(arguments,0)))};n("js/mgf",["require","module","./mgf1"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function u(n){var t=n.pss=n.pss||{};t.create=function(t){var r,s,e;arguments.length===3&&(t={md:arguments[0],mgf:arguments[1],saltLength:arguments[2]});var u=t.md,o=t.mgf,f=u.digestLength,i=t.salt||null;if(typeof i=="string"&&(i=n.util.createBuffer(i)),"saltLength"in t)r=t.saltLength;else{if(i===null)throw new Error("Salt length not specified or specific salt not given.");r=i.length()}if(i!==null&&i.length()!==r)throw new Error("Given salt length does not match length of given salt.");return s=t.prng||n.random,e={},e.encode=function(t,e){var h,w=e-1,v=Math.ceil(w/8),d=t.digest().getBytes(),y,c,p,l,k;if(v<f+r+2)throw new Error("Message is too long to encrypt.");y=i===null?s.getBytesSync(r):i.bytes();c=new n.util.ByteBuffer;c.fillWithByte(0,8);c.putBytes(d);c.putBytes(y);u.start();u.update(c.getBytes());p=u.digest().getBytes();l=new n.util.ByteBuffer;l.fillWithByte(0,v-r-f-2);l.putByte(1);l.putBytes(y);var g=l.getBytes(),b=v-f-1,nt=o.generate(p,b),a="";for(h=0;h<b;h++)a+=String.fromCharCode(g.charCodeAt(h)^nt.charCodeAt(h));return k=65280>>8*v-w&255,a=String.fromCharCode(a.charCodeAt(0)&~k)+a.substr(1),a+p+String.fromCharCode(188)},e.verify=function(t,i,e){var s,y=e-1,c=Math.ceil(y/8),k,h,v,d,l,g;if(i=i.substr(-c),c<f+r+2)throw new Error("Inconsistent parameters to PSS signature verification.");if(i.charCodeAt(c-1)!==188)throw new Error("Encoded message does not end in 0xBC.");var a=c-f-1,p=i.substr(0,a),w=i.substr(a,f),b=65280>>8*c-y&255;if((p.charCodeAt(0)&b)!=0)throw new Error("Bits beyond keysize not zero as expected.");for(k=o.generate(w,a),h="",s=0;s<a;s++)h+=String.fromCharCode(p.charCodeAt(s)^k.charCodeAt(s));for(h=String.fromCharCode(h.charCodeAt(0)&~b)+h.substr(1),v=c-f-r-2,s=0;s<v;s++)if(h.charCodeAt(s)!==0)throw new Error("Leftmost octets not zero as expected");if(h.charCodeAt(v)!==1)throw new Error("Inconsistent PSS signature, 0x01 marker not found");return d=h.substr(-r),l=new n.util.ByteBuffer,l.fillWithByte(0,8),l.putBytes(t),l.putBytes(d),u.start(),u.update(l.getBytes()),g=u.digest().getBytes(),w===g},e}}var i="pss",f,e,o,r;if(typeof n!="function"){if(typeof module!="object"||!module.exports)return typeof forge=="undefined"&&(forge={}),u(forge);f=!0;n=function(n,i){i(t,module)}}o=function(n,t){t.exports=function(t){var f=e.map(function(t){return n(t)}).concat(u),r;if(t=t||{},t.defined=t.defined||{},t.defined[i])return t[i];for(t.defined[i]=!0,r=0;r<f.length;++r)f[r](t);return t[i]}};r=n;n=function(t,i){return e=typeof t=="string"?i.slice(2):t.slice(2),f?(delete n,r.apply(null,Array.prototype.slice.call(arguments,0))):(n=r,n.apply(null,Array.prototype.slice.call(arguments,0)))};n("js/pss",["require","module","./random","./util"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function u(n){function e(n,t){var r,i,u;for(typeof t=="string"&&(t={shortName:t}),r=null,u=0;r===null&&u<n.attributes.length;++u)i=n.attributes[u],t.type&&t.type===i.type?r=i:t.name&&t.name===i.name?r=i:t.shortName&&t.shortName===i.shortName&&(r=i);return r}function o(i){for(var u,f,o=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[]),r,s,h=i.attributes,e=0;e<h.length;++e)r=h[e],u=r.value,f=t.Type.PRINTABLESTRING,"valueTagClass"in r&&(f=r.valueTagClass,f===t.Type.UTF8&&(u=n.util.encodeUtf8(u))),s=t.create(t.Class.UNIVERSAL,t.Type.SET,!0,[t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(r.type).getBytes()),t.create(t.Class.UNIVERSAL,f,!1,u)])]),o.value.push(s);return o}function f(n){for(var o,e,f,s=0;s<n.length;++s){if(f=n[s],typeof f.name=="undefined"&&(f.type&&f.type in i.oids?f.name=i.oids[f.type]:f.shortName&&f.shortName in u&&(f.name=i.oids[u[f.shortName]])),typeof f.type=="undefined"){if(!(f.name&&f.name in i.oids)){e=new Error("Attribute type not specified.");throw e.attribute=f,e;}f.type=i.oids[f.name]}if(typeof f.shortName=="undefined"&&f.name&&f.name in u&&(f.shortName=u[f.name]),f.type===r.extensionRequest&&(f.valueConstructed=!0,f.valueTagClass=t.Type.SEQUENCE,!f.value&&f.extensions))for(f.value=[],o=0;o<f.extensions.length;++o)f.value.push(i.certificateExtensionToAsn1(c(f.extensions[o])));if(typeof f.value=="undefined"){e=new Error("Attribute value not specified.");throw e.attribute=f,e;}}}function c(u,f){var y,l,o,e,c,a,s,p,h;if(f=f||{},typeof u.name=="undefined"&&u.id&&u.id in i.oids&&(u.name=i.oids[u.id]),typeof u.id=="undefined"){if(!(u.name&&u.name in i.oids)){h=new Error("Extension ID not specified.");throw h.extension=u,h;}u.id=i.oids[u.name]}if(typeof u.value=="undefined"){if(u.name==="keyUsage"){var o=0,e=0,v=0;u.digitalSignature&&(e|=128,o=7);u.nonRepudiation&&(e|=64,o=6);u.keyEncipherment&&(e|=32,o=5);u.dataEncipherment&&(e|=16,o=4);u.keyAgreement&&(e|=8,o=3);u.keyCertSign&&(e|=4,o=2);u.cRLSign&&(e|=2,o=1);u.encipherOnly&&(e|=1,o=0);u.decipherOnly&&(v|=128,o=7);s=String.fromCharCode(o);v!==0?s+=String.fromCharCode(e)+String.fromCharCode(v):e!==0&&(s+=String.fromCharCode(e));u.value=t.create(t.Class.UNIVERSAL,t.Type.BITSTRING,!1,s)}else if(u.name==="basicConstraints")u.value=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[]),u.cA&&u.value.value.push(t.create(t.Class.UNIVERSAL,t.Type.BOOLEAN,!1,String.fromCharCode(255))),"pathLenConstraint"in u&&u.value.value.push(t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,t.integerToDer(u.pathLenConstraint).getBytes()));else if(u.name==="extKeyUsage"){u.value=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[]);y=u.value.value;for(l in u)u[l]===!0&&(l in r?y.push(t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(r[l]).getBytes())):l.indexOf(".")!==-1&&y.push(t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(l).getBytes())))}else if(u.name==="nsCertType")o=0,e=0,u.client&&(e|=128,o=7),u.server&&(e|=64,o=6),u.email&&(e|=32,o=5),u.objsign&&(e|=16,o=4),u.reserved&&(e|=8,o=3),u.sslCA&&(e|=4,o=2),u.emailCA&&(e|=2,o=1),u.objCA&&(e|=1,o=0),s=String.fromCharCode(o),e!==0&&(s+=String.fromCharCode(e)),u.value=t.create(t.Class.UNIVERSAL,t.Type.BITSTRING,!1,s);else if(u.name==="subjectAltName"||u.name==="issuerAltName")for(u.value=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[]),a=0;a<u.altNames.length;++a){if(c=u.altNames[a],s=c.value,c.type===7&&c.ip){if(s=n.util.bytesFromIP(c.ip),s===null){h=new Error('Extension "ip" value is not a valid IPv4 or IPv6 address.');throw h.extension=u,h;}}else c.type===8&&(s=c.oid?t.oidToDer(t.oidToDer(c.oid)):t.oidToDer(s));u.value.value.push(t.create(t.Class.CONTEXT_SPECIFIC,c.type,!1,s))}else u.name==="subjectKeyIdentifier"&&f.cert&&(p=f.cert.generateSubjectKeyIdentifier(),u.subjectKeyIdentifier=p.toHex(),u.value=t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,p.getBytes()));if(typeof u.value=="undefined"){h=new Error("Extension value not specified.");throw h.extension=u,h;}return u}}function h(n,i){switch(n){case r["RSASSA-PSS"]:var u=[];return i.hash.algorithmOid!==undefined&&u.push(t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(i.hash.algorithmOid).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.NULL,!1,"")])])),i.mgf.algorithmOid!==undefined&&u.push(t.create(t.Class.CONTEXT_SPECIFIC,1,!0,[t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(i.mgf.algorithmOid).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(i.mgf.hash.algorithmOid).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.NULL,!1,"")])])])),i.saltLength!==undefined&&u.push(t.create(t.Class.CONTEXT_SPECIFIC,2,!0,[t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,t.integerToDer(i.saltLength).getBytes())])),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,u);default:return t.create(t.Class.UNIVERSAL,t.Type.NULL,!1,"")}}function a(i){var f=t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[]),e,u,h,c;if(i.attributes.length===0)return f;for(e=i.attributes,u=0;u<e.length;++u){var r=e[u],o=r.value,s=t.Type.UTF8;"valueTagClass"in r&&(s=r.valueTagClass);s===t.Type.UTF8&&(o=n.util.encodeUtf8(o));h=!1;"valueConstructed"in r&&(h=r.valueConstructed);c=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(r.type).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.SET,!0,[t.create(t.Class.UNIVERSAL,s,h,o)])]);f.value.push(c)}return f}var t=n.asn1,i=n.pki=n.pki||{},r=i.oids,u={},s;u.CN=r.commonName;u.commonName="CN";u.C=r.countryName;u.countryName="C";u.L=r.localityName;u.localityName="L";u.ST=r.stateOrProvinceName;u.stateOrProvinceName="ST";u.O=r.organizationName;u.organizationName="O";u.OU=r.organizationalUnitName;u.organizationalUnitName="OU";u.E=r.emailAddress;u.emailAddress="E";var l=n.pki.rsa.publicKeyValidator,v={name:"Certificate",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,captureAsn1:"tbsCertificate",value:[{name:"Certificate.TBSCertificate.version",tagClass:t.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.version.integer",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"certVersion"}]},{name:"Certificate.TBSCertificate.serialNumber",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"certSerialNumber"},{name:"Certificate.TBSCertificate.signature",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate.signature.algorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"certinfoSignatureOid"},{name:"Certificate.TBSCertificate.signature.parameters",tagClass:t.Class.UNIVERSAL,optional:!0,captureAsn1:"certinfoSignatureParams"}]},{name:"Certificate.TBSCertificate.issuer",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,captureAsn1:"certIssuer"},{name:"Certificate.TBSCertificate.validity",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate.validity.notBefore (utc)",tagClass:t.Class.UNIVERSAL,type:t.Type.UTCTIME,constructed:!1,optional:!0,capture:"certValidity1UTCTime"},{name:"Certificate.TBSCertificate.validity.notBefore (generalized)",tagClass:t.Class.UNIVERSAL,type:t.Type.GENERALIZEDTIME,constructed:!1,optional:!0,capture:"certValidity2GeneralizedTime"},{name:"Certificate.TBSCertificate.validity.notAfter (utc)",tagClass:t.Class.UNIVERSAL,type:t.Type.UTCTIME,constructed:!1,optional:!0,capture:"certValidity3UTCTime"},{name:"Certificate.TBSCertificate.validity.notAfter (generalized)",tagClass:t.Class.UNIVERSAL,type:t.Type.GENERALIZEDTIME,constructed:!1,optional:!0,capture:"certValidity4GeneralizedTime"}]},{name:"Certificate.TBSCertificate.subject",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,captureAsn1:"certSubject"},l,{name:"Certificate.TBSCertificate.issuerUniqueID",tagClass:t.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.issuerUniqueID.id",tagClass:t.Class.UNIVERSAL,type:t.Type.BITSTRING,constructed:!1,capture:"certIssuerUniqueId"}]},{name:"Certificate.TBSCertificate.subjectUniqueID",tagClass:t.Class.CONTEXT_SPECIFIC,type:2,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.subjectUniqueID.id",tagClass:t.Class.UNIVERSAL,type:t.Type.BITSTRING,constructed:!1,capture:"certSubjectUniqueId"}]},{name:"Certificate.TBSCertificate.extensions",tagClass:t.Class.CONTEXT_SPECIFIC,type:3,constructed:!0,captureAsn1:"certExtensions",optional:!0}]},{name:"Certificate.signatureAlgorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.signatureAlgorithm.algorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"certSignatureOid"},{name:"Certificate.TBSCertificate.signature.parameters",tagClass:t.Class.UNIVERSAL,optional:!0,captureAsn1:"certSignatureParams"}]},{name:"Certificate.signatureValue",tagClass:t.Class.UNIVERSAL,type:t.Type.BITSTRING,constructed:!1,capture:"certSignature"}]},y={name:"rsapss",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"rsapss.hashAlgorithm",tagClass:t.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,value:[{name:"rsapss.hashAlgorithm.AlgorithmIdentifier",tagClass:t.Class.UNIVERSAL,type:t.Class.SEQUENCE,constructed:!0,optional:!0,value:[{name:"rsapss.hashAlgorithm.AlgorithmIdentifier.algorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"hashOid"}]}]},{name:"rsapss.maskGenAlgorithm",tagClass:t.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier",tagClass:t.Class.UNIVERSAL,type:t.Class.SEQUENCE,constructed:!0,optional:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.algorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"maskGenOid"},{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.params",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.params.algorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"maskGenHashOid"}]}]}]},{name:"rsapss.saltLength",tagClass:t.Class.CONTEXT_SPECIFIC,type:2,optional:!0,value:[{name:"rsapss.saltLength.saltLength",tagClass:t.Class.UNIVERSAL,type:t.Class.INTEGER,constructed:!1,capture:"saltLength"}]},{name:"rsapss.trailerField",tagClass:t.Class.CONTEXT_SPECIFIC,type:3,optional:!0,value:[{name:"rsapss.trailer.trailer",tagClass:t.Class.UNIVERSAL,type:t.Class.INTEGER,constructed:!1,capture:"trailer"}]}]},p={name:"CertificationRequestInfo",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,captureAsn1:"certificationRequestInfo",value:[{name:"CertificationRequestInfo.integer",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"certificationRequestInfoVersion"},{name:"CertificationRequestInfo.subject",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,captureAsn1:"certificationRequestInfoSubject"},l,{name:"CertificationRequestInfo.attributes",tagClass:t.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,capture:"certificationRequestInfoAttributes",value:[{name:"CertificationRequestInfo.attributes",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"CertificationRequestInfo.attributes.type",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1},{name:"CertificationRequestInfo.attributes.value",tagClass:t.Class.UNIVERSAL,type:t.Type.SET,constructed:!0}]}]}]},w={name:"CertificationRequest",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,captureAsn1:"csr",value:[p,{name:"CertificationRequest.signatureAlgorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"CertificationRequest.signatureAlgorithm.algorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"csrSignatureOid"},{name:"CertificationRequest.signatureAlgorithm.parameters",tagClass:t.Class.UNIVERSAL,optional:!0,captureAsn1:"csrSignatureParams"}]},{name:"CertificationRequest.signature",tagClass:t.Class.UNIVERSAL,type:t.Type.BITSTRING,constructed:!1,capture:"csrSignature"}]};i.RDNAttributesAsArray=function(n,i){for(var o,c=[],s,e,f,h=0;h<n.value.length;++h)for(s=n.value[h],o=0;o<s.value.length;++o)f={},e=s.value[o],f.type=t.derToOid(e.value[0].value),f.value=e.value[1].value,f.valueTagClass=e.value[1].type,f.type in r&&(f.name=r[f.type],f.name in u&&(f.shortName=u[f.name])),i&&(i.update(f.type),i.update(f.value)),c.push(f);return c};i.CRIAttributesAsArray=function(n){for(var e,f,o,c=[],s=0;s<n.length;++s){var l=n[s],a=t.derToOid(l.value[0].value),h=l.value[1].value;for(e=0;e<h.length;++e){if(f={},f.type=a,f.value=h[e].value,f.valueTagClass=h[e].type,f.type in r&&(f.name=r[f.type],f.name in u&&(f.shortName=u[f.name])),f.type===r.extensionRequest)for(f.extensions=[],o=0;o<f.value.length;++o)f.extensions.push(i.certificateExtensionFromAsn1(f.value[o]));c.push(f)}}return c};s=function(n,i,u){var f={},e,o,s;if(n!==r["RSASSA-PSS"])return f;if(u&&(f={hash:{algorithmOid:r.sha1},mgf:{algorithmOid:r.mgf1,hash:{algorithmOid:r.sha1}},saltLength:20}),e={},o=[],!t.validate(i,y,e,o)){s=new Error("Cannot read RSASSA-PSS parameter block.");throw s.errors=o,s;}return e.hashOid!==undefined&&(f.hash=f.hash||{},f.hash.algorithmOid=t.derToOid(e.hashOid)),e.maskGenOid!==undefined&&(f.mgf=f.mgf||{},f.mgf.algorithmOid=t.derToOid(e.maskGenOid),f.mgf.hash=f.mgf.hash||{},f.mgf.hash.algorithmOid=t.derToOid(e.maskGenHashOid)),e.saltLength!==undefined&&(f.saltLength=e.saltLength.charCodeAt(0)),f};i.certificateFromPem=function(r,u,f){var e=n.pem.decode(r)[0],o,s;if(e.type!=="CERTIFICATE"&&e.type!=="X509 CERTIFICATE"&&e.type!=="TRUSTED CERTIFICATE"){o=new Error('Could not convert certificate from PEM; PEM header type is not "CERTIFICATE", "X509 CERTIFICATE", or "TRUSTED CERTIFICATE".');throw o.headerType=e.type,o;}if(e.procType&&e.procType.type==="ENCRYPTED")throw new Error("Could not convert certificate from PEM; PEM is encrypted.");return s=t.fromDer(e.body,f),i.certificateFromAsn1(s,u)};i.certificateToPem=function(r,u){var f={type:"CERTIFICATE",body:t.toDer(i.certificateToAsn1(r)).getBytes()};return n.pem.encode(f,{maxline:u})};i.publicKeyFromPem=function(r){var u=n.pem.decode(r)[0],f,e;if(u.type!=="PUBLIC KEY"&&u.type!=="RSA PUBLIC KEY"){f=new Error('Could not convert public key from PEM; PEM header type is not "PUBLIC KEY" or "RSA PUBLIC KEY".');throw f.headerType=u.type,f;}if(u.procType&&u.procType.type==="ENCRYPTED")throw new Error("Could not convert public key from PEM; PEM is encrypted.");return e=t.fromDer(u.body),i.publicKeyFromAsn1(e)};i.publicKeyToPem=function(r,u){var f={type:"PUBLIC KEY",body:t.toDer(i.publicKeyToAsn1(r)).getBytes()};return n.pem.encode(f,{maxline:u})};i.publicKeyToRSAPublicKeyPem=function(r,u){var f={type:"RSA PUBLIC KEY",body:t.toDer(i.publicKeyToRSAPublicKey(r)).getBytes()};return n.pem.encode(f,{maxline:u})};i.getPublicKeyFingerprint=function(r,u){var f,h,o,e,s;u=u||{};f=u.md||n.md.sha1.create();h=u.type||"RSAPublicKey";switch(h){case"RSAPublicKey":o=t.toDer(i.publicKeyToRSAPublicKey(r)).getBytes();break;case"SubjectPublicKeyInfo":o=t.toDer(i.publicKeyToAsn1(r)).getBytes();break;default:throw new Error('Unknown fingerprint type "'+u.type+'".');}if(f.start(),f.update(o),e=f.digest(),u.encoding==="hex")return s=e.toHex(),u.delimiter?s.match(/.{2}/g).join(u.delimiter):s;if(u.encoding==="binary")return e.getBytes();if(u.encoding)throw new Error('Unknown encoding "'+u.encoding+'".');return e};i.certificationRequestFromPem=function(r,u,f){var e=n.pem.decode(r)[0],o,s;if(e.type!=="CERTIFICATE REQUEST"){o=new Error('Could not convert certification request from PEM; PEM header type is not "CERTIFICATE REQUEST".');throw o.headerType=e.type,o;}if(e.procType&&e.procType.type==="ENCRYPTED")throw new Error("Could not convert certification request from PEM; PEM is encrypted.");return s=t.fromDer(e.body,f),i.certificationRequestFromAsn1(s,u)};i.certificationRequestToPem=function(r,u){var f={type:"CERTIFICATE REQUEST",body:t.toDer(i.certificationRequestToAsn1(r)).getBytes()};return n.pem.encode(f,{maxline:u})};i.createCertificate=function(){var u={};return u.version=2,u.serialNumber="00",u.signatureOid=null,u.signature=null,u.siginfo={},u.siginfo.algorithmOid=null,u.validity={},u.validity.notBefore=new Date,u.validity.notAfter=new Date,u.issuer={},u.issuer.getField=function(n){return e(u.issuer,n)},u.issuer.addField=function(n){f([n]);u.issuer.attributes.push(n)},u.issuer.attributes=[],u.issuer.hash=null,u.subject={},u.subject.getField=function(n){return e(u.subject,n)},u.subject.addField=function(n){f([n]);u.subject.attributes.push(n)},u.subject.attributes=[],u.subject.hash=null,u.extensions=[],u.publicKey=null,u.md=null,u.setSubject=function(n,t){f(n);u.subject.attributes=n;delete u.subject.uniqueId;t&&(u.subject.uniqueId=t);u.subject.hash=null},u.setIssuer=function(n,t){f(n);u.issuer.attributes=n;delete u.issuer.uniqueId;t&&(u.issuer.uniqueId=t);u.issuer.hash=null},u.setExtensions=function(n){for(var t=0;t<n.length;++t)c(n[t],{cert:u});u.extensions=n},u.getExtension=function(n){var t,i,r;for(typeof n=="string"&&(n={name:n}),t=null,r=0;t===null&&r<u.extensions.length;++r)i=u.extensions[r],n.id&&i.id===n.id?t=i:n.name&&i.name===n.name&&(t=i);return t},u.sign=function(f,e){var o,s,h;if(u.md=e||n.md.sha1.create(),o=r[u.md.algorithm+"WithRSAEncryption"],!o){s=new Error("Could not compute certificate digest. Unknown message digest algorithm OID.");throw s.algorithm=u.md.algorithm,s;}u.signatureOid=u.siginfo.algorithmOid=o;u.tbsCertificate=i.getTBSCertificate(u);h=t.toDer(u.tbsCertificate);u.md.update(h.getBytes());u.signature=f.sign(u.md)},u.verify=function(f){var l=!1,o,a,v,y,c,s,h,e;if(!u.issued(f)){var p=f.issuer,w=u.subject,e=new Error("The parent certificate did not issue the given child certificate; the child certificate's issuer does not match the parent's subject.");throw e.expectedIssuer=p.attributes,e.actualIssuer=w.attributes,e;}if(o=f.md,o===null){if(f.signatureOid in r){a=r[f.signatureOid];switch(a){case"sha1WithRSAEncryption":o=n.md.sha1.create();break;case"md5WithRSAEncryption":o=n.md.md5.create();break;case"sha256WithRSAEncryption":o=n.md.sha256.create();break;case"RSASSA-PSS":o=n.md.sha256.create()}}if(o===null){e=new Error("Could not compute certificate digest. Unknown signature OID.");throw e.signatureOid=f.signatureOid,e;}v=f.tbsCertificate||i.getTBSCertificate(f);y=t.toDer(v);o.update(y.getBytes())}if(o!==null){switch(f.signatureOid){case r.sha1WithRSAEncryption:c=undefined;break;case r["RSASSA-PSS"]:if(s=r[f.signatureParameters.mgf.hash.algorithmOid],s===undefined||n.md[s]===undefined){e=new Error("Unsupported MGF hash function.");throw e.oid=f.signatureParameters.mgf.hash.algorithmOid,e.name=s,e;}if(h=r[f.signatureParameters.mgf.algorithmOid],h===undefined||n.mgf[h]===undefined){e=new Error("Unsupported MGF function.");throw e.oid=f.signatureParameters.mgf.algorithmOid,e.name=h,e;}if(h=n.mgf[h].create(n.md[s].create()),s=r[f.signatureParameters.hash.algorithmOid],s===undefined||n.md[s]===undefined)throw{message:"Unsupported RSASSA-PSS hash function.",oid:f.signatureParameters.hash.algorithmOid,name:s};c=n.pss.create(n.md[s].create(),h,f.signatureParameters.saltLength)}l=u.publicKey.verify(o.digest().getBytes(),f.signature,c)}return l},u.isIssuer=function(n){var t=!1,i=u.issuer,f=n.subject,e,o,r;if(i.hash&&f.hash)t=i.hash===f.hash;else if(i.attributes.length===f.attributes.length)for(t=!0,r=0;t&&r<i.attributes.length;++r)e=i.attributes[r],o=f.attributes[r],(e.type!==o.type||e.value!==o.value)&&(t=!1);return t},u.issued=function(n){return n.isIssuer(u)},u.generateSubjectKeyIdentifier=function(){return i.getPublicKeyFingerprint(u.publicKey,{type:"RSAPublicKey"})},u.verifySubjectKeyIdentifier=function(){for(var i,f,e=r.subjectKeyIdentifier,t=0;t<u.extensions.length;++t)if(i=u.extensions[t],i.id===e)return f=u.generateSubjectKeyIdentifier().getBytes(),n.util.hexToBytes(i.subjectKeyIdentifier)===f;return!1},u};i.certificateFromAsn1=function(u,o){var c={},g=[],w,y,h,nt,b,l,p,a,tt,k,d;if(!t.validate(u,v,c,g)){a=new Error("Cannot read X.509 certificate. ASN.1 object is not an X509v3 Certificate.");throw a.errors=g,a;}if(typeof c.certSignature!="string"){for(w="\0",y=0;y<c.certSignature.length;++y)w+=t.toDer(c.certSignature[y]).getBytes();c.certSignature=w}if(p=t.derToOid(c.publicKeyOid),p!==i.oids.rsaEncryption)throw new Error("Cannot read public key. OID is not RSA.");if(h=i.createCertificate(),h.version=c.certVersion?c.certVersion.charCodeAt(0):0,nt=n.util.createBuffer(c.certSerialNumber),h.serialNumber=nt.toHex(),h.signatureOid=n.asn1.derToOid(c.certSignatureOid),h.signatureParameters=s(h.signatureOid,c.certSignatureParams,!0),h.siginfo.algorithmOid=n.asn1.derToOid(c.certinfoSignatureOid),h.siginfo.parameters=s(h.siginfo.algorithmOid,c.certinfoSignatureParams,!1),b=n.util.createBuffer(c.certSignature),++b.read,h.signature=b.getBytes(),l=[],c.certValidity1UTCTime!==undefined&&l.push(t.utcTimeToDate(c.certValidity1UTCTime)),c.certValidity2GeneralizedTime!==undefined&&l.push(t.generalizedTimeToDate(c.certValidity2GeneralizedTime)),c.certValidity3UTCTime!==undefined&&l.push(t.utcTimeToDate(c.certValidity3UTCTime)),c.certValidity4GeneralizedTime!==undefined&&l.push(t.generalizedTimeToDate(c.certValidity4GeneralizedTime)),l.length>2)throw new Error("Cannot read notBefore/notAfter validity times; more than two times were provided in the certificate.");if(l.length<2)throw new Error("Cannot read notBefore/notAfter validity times; they were not provided as either UTCTime or GeneralizedTime.");if(h.validity.notBefore=l[0],h.validity.notAfter=l[1],h.tbsCertificate=c.tbsCertificate,o){if(h.md=null,h.signatureOid in r){p=r[h.signatureOid];switch(p){case"sha1WithRSAEncryption":h.md=n.md.sha1.create();break;case"md5WithRSAEncryption":h.md=n.md.md5.create();break;case"sha256WithRSAEncryption":h.md=n.md.sha256.create();break;case"RSASSA-PSS":h.md=n.md.sha256.create()}}if(h.md===null){a=new Error("Could not compute certificate digest. Unknown signature OID.");throw a.signatureOid=h.signatureOid,a;}tt=t.toDer(h.tbsCertificate);h.md.update(tt.getBytes())}return k=n.md.sha1.create(),h.issuer.getField=function(n){return e(h.issuer,n)},h.issuer.addField=function(n){f([n]);h.issuer.attributes.push(n)},h.issuer.attributes=i.RDNAttributesAsArray(c.certIssuer,k),c.certIssuerUniqueId&&(h.issuer.uniqueId=c.certIssuerUniqueId),h.issuer.hash=k.digest().toHex(),d=n.md.sha1.create(),h.subject.getField=function(n){return e(h.subject,n)},h.subject.addField=function(n){f([n]);h.subject.attributes.push(n)},h.subject.attributes=i.RDNAttributesAsArray(c.certSubject,d),c.certSubjectUniqueId&&(h.subject.uniqueId=c.certSubjectUniqueId),h.subject.hash=d.digest().toHex(),h.extensions=c.certExtensions?i.certificateExtensionsFromAsn1(c.certExtensions):[],h.publicKey=i.publicKeyFromAsn1(c.subjectPublicKeyInfo),h};i.certificateExtensionsFromAsn1=function(n){for(var u,t,f=[],r=0;r<n.value.length;++r)for(u=n.value[r],t=0;t<u.value.length;++t)f.push(i.certificateExtensionFromAsn1(u.value[t]));return f};i.certificateExtensionFromAsn1=function(i){var u={},s,h,c,e,o,l,a,f;if(u.id=t.derToOid(i.value[0].value),u.critical=!1,i.value[1].type===t.Type.BOOLEAN?(u.critical=i.value[1].value.charCodeAt(0)!==0,u.value=i.value[2].value):u.value=i.value[1].value,u.id in r)if(u.name=r[u.id],u.name==="keyUsage"){var f=t.fromDer(u.value),e=0,v=0;f.value.length>1&&(e=f.value.charCodeAt(1),v=f.value.length>2?f.value.charCodeAt(2):0);u.digitalSignature=(e&128)==128;u.nonRepudiation=(e&64)==64;u.keyEncipherment=(e&32)==32;u.dataEncipherment=(e&16)==16;u.keyAgreement=(e&8)==8;u.keyCertSign=(e&4)==4;u.cRLSign=(e&2)==2;u.encipherOnly=(e&1)==1;u.decipherOnly=(v&128)==128}else if(u.name==="basicConstraints")f=t.fromDer(u.value),u.cA=f.value.length>0&&f.value[0].type===t.Type.BOOLEAN?f.value[0].value.charCodeAt(0)!==0:!1,s=null,f.value.length>0&&f.value[0].type===t.Type.INTEGER?s=f.value[0].value:f.value.length>1&&(s=f.value[1].value),s!==null&&(u.pathLenConstraint=t.derToInteger(s));else if(u.name==="extKeyUsage")for(f=t.fromDer(u.value),h=0;h<f.value.length;++h)c=t.derToOid(f.value[h].value),c in r?u[r[c]]=!0:u[c]=!0;else if(u.name==="nsCertType")f=t.fromDer(u.value),e=0,f.value.length>1&&(e=f.value.charCodeAt(1)),u.client=(e&128)==128,u.server=(e&64)==64,u.email=(e&32)==32,u.objsign=(e&16)==16,u.reserved=(e&8)==8,u.sslCA=(e&4)==4,u.emailCA=(e&2)==2,u.objCA=(e&1)==1;else if(u.name==="subjectAltName"||u.name==="issuerAltName")for(u.altNames=[],f=t.fromDer(u.value),l=0;l<f.value.length;++l){o=f.value[l];a={type:o.type,value:o.value};u.altNames.push(a);switch(o.type){case 7:a.ip=n.util.bytesToIP(o.value);break;case 8:a.oid=t.derToOid(o.value)}}else u.name==="subjectKeyIdentifier"&&(f=t.fromDer(u.value),u.subjectKeyIdentifier=n.util.bytesToHex(f.value));return u};i.certificationRequestFromAsn1=function(u,o){var c={},k=[],y,a,h,p,v,l,d,b;if(!t.validate(u,w,c,k)){l=new Error("Cannot read PKCS#10 certificate request. ASN.1 object is not a PKCS#10 CertificationRequest.");throw l.errors=k,l;}if(typeof c.csrSignature!="string"){for(y="\0",a=0;a<c.csrSignature.length;++a)y+=t.toDer(c.csrSignature[a]).getBytes();c.csrSignature=y}if(v=t.derToOid(c.publicKeyOid),v!==i.oids.rsaEncryption)throw new Error("Cannot read public key. OID is not RSA.");if(h=i.createCertificationRequest(),h.version=c.csrVersion?c.csrVersion.charCodeAt(0):0,h.signatureOid=n.asn1.derToOid(c.csrSignatureOid),h.signatureParameters=s(h.signatureOid,c.csrSignatureParams,!0),h.siginfo.algorithmOid=n.asn1.derToOid(c.csrSignatureOid),h.siginfo.parameters=s(h.siginfo.algorithmOid,c.csrSignatureParams,!1),p=n.util.createBuffer(c.csrSignature),++p.read,h.signature=p.getBytes(),h.certificationRequestInfo=c.certificationRequestInfo,o){if(h.md=null,h.signatureOid in r){v=r[h.signatureOid];switch(v){case"sha1WithRSAEncryption":h.md=n.md.sha1.create();break;case"md5WithRSAEncryption":h.md=n.md.md5.create();break;case"sha256WithRSAEncryption":h.md=n.md.sha256.create();break;case"RSASSA-PSS":h.md=n.md.sha256.create()}}if(h.md===null){l=new Error("Could not compute certification request digest. Unknown signature OID.");throw l.signatureOid=h.signatureOid,l;}d=t.toDer(h.certificationRequestInfo);h.md.update(d.getBytes())}return b=n.md.sha1.create(),h.subject.getField=function(n){return e(h.subject,n)},h.subject.addField=function(n){f([n]);h.subject.attributes.push(n)},h.subject.attributes=i.RDNAttributesAsArray(c.certificationRequestInfoSubject,b),h.subject.hash=b.digest().toHex(),h.publicKey=i.publicKeyFromAsn1(c.subjectPublicKeyInfo),h.getAttribute=function(n){return e(h,n)},h.addAttribute=function(n){f([n]);h.attributes.push(n)},h.attributes=i.CRIAttributesAsArray(c.certificationRequestInfoAttributes||[]),h};i.createCertificationRequest=function(){var u={};return u.version=0,u.signatureOid=null,u.signature=null,u.siginfo={},u.siginfo.algorithmOid=null,u.subject={},u.subject.getField=function(n){return e(u.subject,n)},u.subject.addField=function(n){f([n]);u.subject.attributes.push(n)},u.subject.attributes=[],u.subject.hash=null,u.publicKey=null,u.attributes=[],u.getAttribute=function(n){return e(u,n)},u.addAttribute=function(n){f([n]);u.attributes.push(n)},u.md=null,u.setSubject=function(n){f(n);u.subject.attributes=n;u.subject.hash=null},u.setAttributes=function(n){f(n);u.attributes=n},u.sign=function(f,e){var o,s,h;if(u.md=e||n.md.sha1.create(),o=r[u.md.algorithm+"WithRSAEncryption"],!o){s=new Error("Could not compute certification request digest. Unknown message digest algorithm OID.");throw s.algorithm=u.md.algorithm,s;}u.signatureOid=u.siginfo.algorithmOid=o;u.certificationRequestInfo=i.getCertificationRequestInfo(u);h=t.toDer(u.certificationRequestInfo);u.md.update(h.getBytes());u.signature=f.sign(u.md)},u.verify=function(){var h=!1,o=u.md,c,l,a,v,e,s,f;if(o===null){if(u.signatureOid in r){c=r[u.signatureOid];switch(c){case"sha1WithRSAEncryption":o=n.md.sha1.create();break;case"md5WithRSAEncryption":o=n.md.md5.create();break;case"sha256WithRSAEncryption":o=n.md.sha256.create();break;case"RSASSA-PSS":o=n.md.sha256.create()}}if(o===null){f=new Error("Could not compute certification request digest. Unknown signature OID.");throw f.signatureOid=u.signatureOid,f;}l=u.certificationRequestInfo||i.getCertificationRequestInfo(u);a=t.toDer(l);o.update(a.getBytes())}if(o!==null){switch(u.signatureOid){case r["RSASSA-PSS"]:if(e=r[u.signatureParameters.mgf.hash.algorithmOid],e===undefined||n.md[e]===undefined){f=new Error("Unsupported MGF hash function.");throw f.oid=u.signatureParameters.mgf.hash.algorithmOid,f.name=e,f;}if(s=r[u.signatureParameters.mgf.algorithmOid],s===undefined||n.mgf[s]===undefined){f=new Error("Unsupported MGF function.");throw f.oid=u.signatureParameters.mgf.algorithmOid,f.name=s,f;}if(s=n.mgf[s].create(n.md[e].create()),e=r[u.signatureParameters.hash.algorithmOid],e===undefined||n.md[e]===undefined){f=new Error("Unsupported RSASSA-PSS hash function.");throw f.oid=u.signatureParameters.hash.algorithmOid,f.name=e,f;}v=n.pss.create(n.md[e].create(),s,u.signatureParameters.saltLength)}h=u.publicKey.verify(o.digest().getBytes(),u.signature,v)}return h},u};i.getTBSCertificate=function(r){var u=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,t.integerToDer(r.version).getBytes())]),t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,n.util.hexToBytes(r.serialNumber)),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(r.siginfo.algorithmOid).getBytes()),h(r.siginfo.algorithmOid,r.siginfo.parameters)]),o(r.issuer),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.UTCTIME,!1,t.dateToUtcTime(r.validity.notBefore)),t.create(t.Class.UNIVERSAL,t.Type.UTCTIME,!1,t.dateToUtcTime(r.validity.notAfter))]),o(r.subject),i.publicKeyToAsn1(r.publicKey)]);return r.issuer.uniqueId&&u.value.push(t.create(t.Class.CONTEXT_SPECIFIC,1,!0,[t.create(t.Class.UNIVERSAL,t.Type.BITSTRING,!1,String.fromCharCode(0)+r.issuer.uniqueId)])),r.subject.uniqueId&&u.value.push(t.create(t.Class.CONTEXT_SPECIFIC,2,!0,[t.create(t.Class.UNIVERSAL,t.Type.BITSTRING,!1,String.fromCharCode(0)+r.subject.uniqueId)])),r.extensions.length>0&&u.value.push(i.certificateExtensionsToAsn1(r.extensions)),u};i.getCertificationRequestInfo=function(n){return t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,t.integerToDer(n.version).getBytes()),o(n.subject),i.publicKeyToAsn1(n.publicKey),a(n)])};i.distinguishedNameToAsn1=function(n){return o(n)};i.certificateToAsn1=function(n){var r=n.tbsCertificate||i.getTBSCertificate(n);return t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[r,t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(n.signatureOid).getBytes()),h(n.signatureOid,n.signatureParameters)]),t.create(t.Class.UNIVERSAL,t.Type.BITSTRING,!1,String.fromCharCode(0)+n.signature)])};i.certificateExtensionsToAsn1=function(n){var u=t.create(t.Class.CONTEXT_SPECIFIC,3,!0,[]),f=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[]),r;for(u.value.push(f),r=0;r<n.length;++r)f.value.push(i.certificateExtensionToAsn1(n[r]));return u};i.certificateExtensionToAsn1=function(n){var i=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[]),r;return i.value.push(t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(n.id).getBytes())),n.critical&&i.value.push(t.create(t.Class.UNIVERSAL,t.Type.BOOLEAN,!1,String.fromCharCode(255))),r=n.value,typeof n.value!="string"&&(r=t.toDer(r).getBytes()),i.value.push(t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,r)),i};i.certificationRequestToAsn1=function(n){var r=n.certificationRequestInfo||i.getCertificationRequestInfo(n);return t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[r,t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(n.signatureOid).getBytes()),h(n.signatureOid,n.signatureParameters)]),t.create(t.Class.UNIVERSAL,t.Type.BITSTRING,!1,String.fromCharCode(0)+n.signature)])};i.createCaStore=function(r){function e(t){if(!t.hash){var r=n.md.sha1.create();t.attributes=i.RDNAttributesAsArray(o(t),r);t.hash=r.digest().toHex()}return u.certs[t.hash]||null}var u={certs:{}},f,s;if(u.getIssuer=function(n){return e(n.issuer)},u.addCertificate=function(t){var f,r;typeof t=="string"&&(t=n.pki.certificateFromPem(t));t.subject.hash||(f=n.md.sha1.create(),t.subject.attributes=i.RDNAttributesAsArray(o(t.subject),f),t.subject.hash=f.digest().toHex());t.subject.hash in u.certs?(r=u.certs[t.subject.hash],n.util.isArray(r)||(r=[r]),r.push(t)):u.certs[t.subject.hash]=t},u.hasCertificate=function(r){var u=e(r.subject),o,f,s;if(!u)return!1;for(n.util.isArray(u)||(u=[u]),o=t.toDer(i.certificateToAsn1(r)).getBytes(),f=0;f<u.length;++f)if(s=t.toDer(i.certificateToAsn1(u[f])).getBytes(),o===s)return!0;return!1},r)for(f=0;f<r.length;++f)s=r[f],u.addCertificate(s);return u};i.certificateError={bad_certificate:"forge.pki.BadCertificate",unsupported_certificate:"forge.pki.UnsupportedCertificate",certificate_revoked:"forge.pki.CertificateRevoked",certificate_expired:"forge.pki.CertificateExpired",certificate_unknown:"forge.pki.CertificateUnknown",unknown_ca:"forge.pki.UnknownCertificateAuthority"};i.verifyCertificateChain=function(t,r,u){var h,l,g,a,k,c,v,nt,y,o;r=r.slice(0);var tt=r.slice(0),p=new Date,d=!0,f=null,w=0;do{var e=r.shift(),s=null,b=!1;if((p<e.validity.notBefore||p>e.validity.notAfter)&&(f={message:"Certificate is not valid yet or has expired.",error:i.certificateError.certificate_expired,notBefore:e.validity.notBefore,notAfter:e.validity.notAfter,now:p}),f===null){if(s=r[0]||t.getIssuer(e),s===null&&e.isIssuer(e)&&(b=!0,s=e),s){for(h=s,n.util.isArray(h)||(h=[h]),l=!1;!l&&h.length>0;){s=h.shift();try{l=s.verify(e)}catch(it){}}l||(f={message:"Certificate signature is invalid.",error:i.certificateError.bad_certificate})}f!==null||s&&!b||t.hasCertificate(e)||(f={message:"Certificate is not trusted.",error:i.certificateError.unknown_ca})}if(f===null&&s&&!e.isIssuer(s)&&(f={message:"Certificate issuer is invalid.",error:i.certificateError.bad_certificate}),f===null)for(g={keyUsage:!0,basicConstraints:!0},a=0;f===null&&a<e.extensions.length;++a)k=e.extensions[a],!k.critical||k.name in g||(f={message:"Certificate has an unsupported critical extension.",error:i.certificateError.unsupported_certificate});if(f!==null||d&&(r.length!==0||s&&!b)||(c=e.getExtension("basicConstraints"),v=e.getExtension("keyUsage"),v===null||v.keyCertSign&&c!==null||(f={message:"Certificate keyUsage or basicConstraints conflict or indicate that the certificate is not a CA. If the certificate is the only one in the chain or isn't the first then the certificate must be a valid CA.",error:i.certificateError.bad_certificate}),f!==null||c===null||c.cA||(f={message:"Certificate basicConstraints indicates the certificate is not a CA.",error:i.certificateError.bad_certificate}),f===null&&v!==null&&"pathLenConstraint"in c&&(nt=w-1,nt>c.pathLenConstraint&&(f={message:"Certificate basicConstraints pathLenConstraint violated.",error:i.certificateError.bad_certificate}))),y=f===null?!0:f.error,o=u?u(y,w,tt):y,o!==!0){y===!0&&(f={message:"The application rejected the certificate.",error:i.certificateError.bad_certificate});(o||o===0)&&(typeof o=="object"&&!n.util.isArray(o)?(o.message&&(f.message=o.message),o.error&&(f.error=o.error)):typeof o=="string"&&(f.error=o));throw f;}f=null;d=!1;++w}while(r.length>0);return!0}}var i="x509",f,e,o,r;if(typeof n!="function"){if(typeof module!="object"||!module.exports)return typeof forge=="undefined"&&(forge={}),u(forge);f=!0;n=function(n,i){i(t,module)}}o=function(n,t){t.exports=function(t){var f=e.map(function(t){return n(t)}).concat(u),r;if(t=t||{},t.defined=t.defined||{},t.defined[i])return t[i];for(t.defined[i]=!0,r=0;r<f.length;++r)f[r](t);return t.pki}};r=n;n=function(t,i){return e=typeof t=="string"?i.slice(2):t.slice(2),f?(delete n,r.apply(null,Array.prototype.slice.call(arguments,0))):(n=r,n.apply(null,Array.prototype.slice.call(arguments,0)))};n("js/x509",["require","module","./aes","./asn1","./des","./md","./mgf","./oids","./pem","./pss","./rsa","./util"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function u(n){function r(n,t,i,r){for(var e,u,o=[],f=0;f<n.length;f++)for(e=0;e<n[f].safeBags.length;e++)if(u=n[f].safeBags[e],r===undefined||u.type===r){if(t===null){o.push(u);continue}u.attributes[t]!==undefined&&u.attributes[t].indexOf(i)>=0&&o.push(u)}return o}function f(t){var r,i;if(t.composed||t.constructed){for(r=n.util.createBuffer(),i=0;i<t.value.length;++i)r.putBytes(t.value[i].value);t.composed=t.constructed=!1;t.value=r.getBytes()}return t}function o(n,r,u,o){var l,c;if(r=t.fromDer(r,u),r.tagClass!==t.Class.UNIVERSAL||r.type!==t.Type.SEQUENCE||r.constructed!==!0)throw new Error("PKCS#12 AuthenticatedSafe expected to be a SEQUENCE OF ContentInfo");for(l=0;l<r.value.length;l++){var b=r.value[l],a={},w=[];if(!t.validate(b,e,a,w)){c=new Error("Cannot read ContentInfo.");throw c.errors=w,c;}var y={encrypted:!1},p=null,v=a.content.value[0];switch(t.derToOid(a.contentType)){case i.oids.data:if(v.tagClass!==t.Class.UNIVERSAL||v.type!==t.Type.OCTETSTRING)throw new Error("PKCS#12 SafeContents Data is not an OCTET STRING.");p=f(v).value;break;case i.oids.encryptedData:p=s(v,o);y.encrypted=!0;break;default:c=new Error("Unsupported PKCS#12 contentType.");throw c.contentType=t.derToOid(a.contentType),c;}y.safeBags=h(p,u,o);n.safeContents.push(y)}}function s(r,u){var o={},c=[],s,e;if(!t.validate(r,n.pkcs7.asn1.encryptedDataValidator,o,c)){e=new Error("Cannot read EncryptedContentInfo.");throw e.errors=c,e;}if(s=t.derToOid(o.contentType),s!==i.oids.data){e=new Error("PKCS#12 EncryptedContentInfo ContentType is not Data.");throw e.oid=s,e;}s=t.derToOid(o.encAlgorithm);var h=i.pbe.getCipher(s,o.encParameter,u),l=f(o.encryptedContentAsn1),a=n.util.createBuffer(l.value);if(h.update(a),!h.finish())throw new Error("Failed to decrypt PKCS#12 SafeContents.");return h.output.getBytes()}function h(n,r,u){var p,h,o,v,w,s,f;if(!r&&n.length===0)return[];if(n=t.fromDer(n,r),n.tagClass!==t.Class.UNIVERSAL||n.type!==t.Type.SEQUENCE||n.constructed!==!0)throw new Error("PKCS#12 SafeContents expected to be a SEQUENCE OF SafeBag.");for(p=[],h=0;h<n.value.length;h++){var b=n.value[h],e={},l=[];if(!t.validate(b,a,e,l)){f=new Error("Cannot read SafeBag.");throw f.errors=l,f;}o={type:t.derToOid(e.bagId),attributes:c(e.bagAttributes)};p.push(o);s=e.bagValue.value[0];switch(o.type){case i.oids.pkcs8ShroudedKeyBag:if(s=i.decryptPrivateKeyInfo(s,u),s===null)throw new Error("Unable to decrypt PKCS#8 ShroudedKeyBag, wrong password?");case i.oids.keyBag:o.key=i.privateKeyFromAsn1(s);continue;case i.oids.certBag:v=y;w=function(){if(t.derToOid(e.certId)!==i.oids.x509Certificate){var n=new Error("Unsupported certificate type, only X.509 supported.");throw n.oid=t.derToOid(e.certId),n;}o.cert=i.certificateFromAsn1(t.fromDer(e.cert,r),!0)};break;default:f=new Error("Unsupported PKCS#12 SafeBag type.");throw f.oid=o.type,f;}if(v!==undefined&&!t.validate(s,v,e,l)){f=new Error("Cannot read PKCS#12 "+v.name);throw f.errors=l,f;}w()}return p}function c(n){var o={},u,r,s,h,f,e;if(n!==undefined)for(u=0;u<n.length;++u){if(r={},s=[],!t.validate(n[u],v,r,s)){h=new Error("Cannot read PKCS#12 BagAttribute.");throw h.errors=s,h;}if(f=t.derToOid(r.oid),i.oids[f]!==undefined)for(o[i.oids[f]]=[],e=0;e<r.values.length;++e)o[i.oids[f]].push(r.values[e].value)}return o}var t=n.asn1,i=n.pki,u=n.pkcs12=n.pkcs12||{},e={name:"ContentInfo",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"ContentInfo.contentType",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"contentType"},{name:"ContentInfo.content",tagClass:t.Class.CONTEXT_SPECIFIC,constructed:!0,captureAsn1:"content"}]},l={name:"PFX",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"PFX.version",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"version"},e,{name:"PFX.macData",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,optional:!0,captureAsn1:"mac",value:[{name:"PFX.macData.mac",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"PFX.macData.mac.digestAlgorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"PFX.macData.mac.digestAlgorithm.algorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"macAlgorithm"},{name:"PFX.macData.mac.digestAlgorithm.parameters",tagClass:t.Class.UNIVERSAL,captureAsn1:"macAlgorithmParameters"}]},{name:"PFX.macData.mac.digest",tagClass:t.Class.UNIVERSAL,type:t.Type.OCTETSTRING,constructed:!1,capture:"macDigest"}]},{name:"PFX.macData.macSalt",tagClass:t.Class.UNIVERSAL,type:t.Type.OCTETSTRING,constructed:!1,capture:"macSalt"},{name:"PFX.macData.iterations",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,optional:!0,capture:"macIterations"}]}]},a={name:"SafeBag",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"SafeBag.bagId",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"bagId"},{name:"SafeBag.bagValue",tagClass:t.Class.CONTEXT_SPECIFIC,constructed:!0,captureAsn1:"bagValue"},{name:"SafeBag.bagAttributes",tagClass:t.Class.UNIVERSAL,type:t.Type.SET,constructed:!0,optional:!0,capture:"bagAttributes"}]},v={name:"Attribute",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"Attribute.attrId",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"oid"},{name:"Attribute.attrValues",tagClass:t.Class.UNIVERSAL,type:t.Type.SET,constructed:!0,capture:"values"}]},y={name:"CertBag",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"CertBag.certId",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"certId"},{name:"CertBag.certValue",tagClass:t.Class.CONTEXT_SPECIFIC,constructed:!0,value:[{name:"CertBag.certValue[0]",tagClass:t.Class.UNIVERSAL,type:t.Class.OCTETSTRING,constructed:!1,capture:"cert"}]}]};u.pkcs12FromAsn1=function(e,s,h){var c,k,v,a,p,g;if(typeof s=="string"?(h=s,s=!0):s===undefined&&(s=!0),c={},k=[],!t.validate(e,l,c,k)){a=new Error("Cannot read PKCS#12 PFX. ASN.1 object is not an PKCS#12 PFX.");throw a.errors=a,a;}if(v={version:c.version.charCodeAt(0),safeContents:[],getBags:function(t){var u={},i;return"localKeyId"in t?i=t.localKeyId:"localKeyIdHex"in t&&(i=n.util.hexToBytes(t.localKeyIdHex)),i===undefined&&!("friendlyName"in t)&&"bagType"in t&&(u[t.bagType]=r(v.safeContents,null,null,t.bagType)),i!==undefined&&(u.localKeyId=r(v.safeContents,"localKeyId",i,t.bagType)),"friendlyName"in t&&(u.friendlyName=r(v.safeContents,"friendlyName",t.friendlyName,t.bagType)),u},getBagsByFriendlyName:function(n,t){return r(v.safeContents,"friendlyName",n,t)},getBagsByLocalKeyId:function(n,t){return r(v.safeContents,"localKeyId",n,t)}},c.version.charCodeAt(0)!==3){a=new Error("PKCS#12 PFX of version other than 3 not supported.");throw a.version=c.version.charCodeAt(0),a;}if(t.derToOid(c.contentType)!==i.oids.data){a=new Error("Only PKCS#12 PFX in password integrity mode supported.");throw a.oid=t.derToOid(c.contentType),a;}if(p=c.content.value[0],p.tagClass!==t.Class.UNIVERSAL||p.type!==t.Type.OCTETSTRING)throw new Error("PKCS#12 authSafe content data is not an OCTET STRING.");if(p=f(p),c.mac){var y=null,w=0,d=t.derToOid(c.macAlgorithm);switch(d){case i.oids.sha1:y=n.md.sha1.create();w=20;break;case i.oids.sha256:y=n.md.sha256.create();w=32;break;case i.oids.sha384:y=n.md.sha384.create();w=48;break;case i.oids.sha512:y=n.md.sha512.create();w=64;break;case i.oids.md5:y=n.md.md5.create();w=16}if(y===null)throw new Error("PKCS#12 uses unsupported MAC algorithm: "+d);var nt=new n.util.ByteBuffer(c.macSalt),tt="macIterations"in c?parseInt(n.util.bytesToHex(c.macIterations),16):1,it=u.generateKey(h,nt,3,tt,w,y),b=n.hmac.create();if(b.start(y,it),b.update(p.value),g=b.getMac(),g.getBytes()!==c.macDigest)throw new Error("PKCS#12 MAC could not be verified. Invalid password?");}return o(v,p.value,s,h),v};u.toPkcs12Asn1=function(r,f,e,o){var s,a,h,v,c,y,p,w,l,nt,tt,b,k,it,rt,d,ut,ot;for(o=o||{},o.saltSize=o.saltSize||8,o.count=o.count||2048,o.algorithm=o.algorithm||o.encAlgorithm||"aes128",("useMac"in o)||(o.useMac=!0),("localKeyId"in o)||(o.localKeyId=null),("generateLocalKeyId"in o)||(o.generateLocalKeyId=!0),s=o.localKeyId,s!==null?s=n.util.hexToBytes(s):o.generateLocalKeyId&&(f?(h=n.util.isArray(f)?f[0]:f,typeof h=="string"&&(h=i.certificateFromPem(h)),v=n.md.sha1.create(),v.update(t.toDer(i.certificateToAsn1(h)).getBytes()),s=v.digest().getBytes()):s=n.random.getBytes(20)),c=[],s!==null&&c.push(t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(i.oids.localKeyId).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.SET,!0,[t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,s)])])),("friendlyName"in o)&&c.push(t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(i.oids.friendlyName).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.SET,!0,[t.create(t.Class.UNIVERSAL,t.Type.BMPSTRING,!1,o.friendlyName)])])),c.length>0&&(a=t.create(t.Class.UNIVERSAL,t.Type.SET,!0,c)),y=[],p=[],f!==null&&(p=n.util.isArray(f)?f:[f]),w=[],l=0;l<p.length;++l){f=p[l];typeof f=="string"&&(f=i.certificateFromPem(f));var st=l===0?a:undefined,ht=i.certificateToAsn1(f),ct=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(i.oids.certBag).getBytes()),t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(i.oids.x509Certificate).getBytes()),t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,t.toDer(ht).getBytes())])])]),st]);w.push(ct)}if(w.length>0&&(nt=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,w),tt=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(i.oids.data).getBytes()),t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,t.toDer(nt).getBytes())])]),y.push(tt)),b=null,r!==null&&(k=i.wrapRsaPrivateKey(i.privateKeyToAsn1(r)),b=e===null?t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(i.oids.keyBag).getBytes()),t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[k]),a]):t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(i.oids.pkcs8ShroudedKeyBag).getBytes()),t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[i.encryptPrivateKeyInfo(k,e,o)]),a]),it=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[b]),rt=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(i.oids.data).getBytes()),t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,t.toDer(it).getBytes())])]),y.push(rt)),d=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,y),o.useMac){var v=n.md.sha1.create(),ft=new n.util.ByteBuffer(n.random.getBytes(o.saltSize)),et=o.count,r=u.generateKey(e,ft,3,et,20),g=n.hmac.create();g.start(v,r);g.update(t.toDer(d).getBytes());ot=g.getMac();ut=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(i.oids.sha1).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.NULL,!1,"")]),t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,ot.getBytes())]),t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,ft.getBytes()),t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,t.integerToDer(et).getBytes())])}return t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,t.integerToDer(3).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(i.oids.data).getBytes()),t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,t.toDer(d).getBytes())])]),ut])};u.generateKey=n.pbe.generatePkcs12Key}var i="pkcs12",f,e,o,r;if(typeof n!="function"){if(typeof module!="object"||!module.exports)return typeof forge=="undefined"&&(forge={}),u(forge);f=!0;n=function(n,i){i(t,module)}}o=function(n,t){t.exports=function(t){var f=e.map(function(t){return n(t)}).concat(u),r;if(t=t||{},t.defined=t.defined||{},t.defined[i])return t[i];for(t.defined[i]=!0,r=0;r<f.length;++r)f[r](t);return t[i]}};r=n;n=function(t,i){return e=typeof t=="string"?i.slice(2):t.slice(2),f?(delete n,r.apply(null,Array.prototype.slice.call(arguments,0))):(n=r,n.apply(null,Array.prototype.slice.call(arguments,0)))};n("js/pkcs12",["require","module","./asn1","./hmac","./oids","./pkcs7asn1","./pbe","./random","./rsa","./sha1","./util","./x509"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function u(n){var i=n.asn1,t=n.pki=n.pki||{};t.pemToDer=function(t){var i=n.pem.decode(t)[0];if(i.procType&&i.procType.type==="ENCRYPTED")throw new Error("Could not convert PEM to DER; PEM is encrypted.");return n.util.createBuffer(i.body)};t.privateKeyFromPem=function(r){var u=n.pem.decode(r)[0],f,e;if(u.type!=="PRIVATE KEY"&&u.type!=="RSA PRIVATE KEY"){f=new Error('Could not convert private key from PEM; PEM header type is not "PRIVATE KEY" or "RSA PRIVATE KEY".');throw f.headerType=u.type,f;}if(u.procType&&u.procType.type==="ENCRYPTED")throw new Error("Could not convert private key from PEM; PEM is encrypted.");return e=i.fromDer(u.body),t.privateKeyFromAsn1(e)};t.privateKeyToPem=function(r,u){var f={type:"RSA PRIVATE KEY",body:i.toDer(t.privateKeyToAsn1(r)).getBytes()};return n.pem.encode(f,{maxline:u})};t.privateKeyInfoToPem=function(t,r){var u={type:"PRIVATE KEY",body:i.toDer(t).getBytes()};return n.pem.encode(u,{maxline:r})}}var i="pki",f,e,o,r;if(typeof n!="function"){if(typeof module!="object"||!module.exports)return typeof forge=="undefined"&&(forge={}),u(forge);f=!0;n=function(n,i){i(t,module)}}o=function(n,t){t.exports=function(t){var f=e.map(function(t){return n(t)}).concat(u),r;if(t=t||{},t.defined=t.defined||{},t.defined[i])return t[i];for(t.defined[i]=!0,r=0;r<f.length;++r)f[r](t);return t[i]}};r=n;n=function(t,i){return e=typeof t=="string"?i.slice(2):t.slice(2),f?(delete n,r.apply(null,Array.prototype.slice.call(arguments,0))):(n=r,n.apply(null,Array.prototype.slice.call(arguments,0)))};n("js/pki",["require","module","./asn1","./oids","./pbe","./pem","./pbkdf2","./pkcs12","./pss","./rsa","./util","./x509"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function u(n){var h=function(t,i,r,u){var c=n.util.createBuffer(),l=t.length>>1,a=l+(t.length&1),p=t.substr(0,a),w=t.substr(l,a),e=n.util.createBuffer(),f=n.hmac.create(),v,y,s,h,o;for(r=i+r,v=Math.ceil(u/16),y=Math.ceil(u/20),f.start("MD5",p),s=n.util.createBuffer(),e.putBytes(r),o=0;o<v;++o)f.start(null,null),f.update(e.getBytes()),e.putBuffer(f.digest()),f.start(null,null),f.update(e.bytes()+r),s.putBuffer(f.digest());for(f.start("SHA1",w),h=n.util.createBuffer(),e.clear(),e.putBytes(r),o=0;o<y;++o)f.start(null,null),f.update(e.getBytes()),e.putBuffer(f.digest()),f.start(null,null),f.update(e.bytes()+r),h.putBuffer(f.digest());return c.putBytes(n.util.xorBytes(s.getBytes(),h.getBytes(),u)),c},ri=function(){},ft=function(t,i,r){var f=n.hmac.create(),u;return f.start("SHA1",t),u=n.util.createBuffer(),u.putInt32(i[0]),u.putInt32(i[1]),u.putByte(r.type),u.putByte(r.version.major),u.putByte(r.version.minor),u.putInt16(r.length),u.putBytes(r.fragment.bytes()),f.update(u.getBytes()),f.digest().getBytes()},et=function(t,i){var u=!1,r;try{r=t.deflate(i.fragment.getBytes());i.fragment=n.util.createBuffer(r);i.length=r.length;u=!0}catch(f){}return u},ot=function(t,i){var u=!1,r;try{r=t.inflate(i.fragment.getBytes());i.fragment=n.util.createBuffer(r);i.length=r.length;u=!0}catch(f){}return u},e=function(t,i){var r=0;switch(i){case 1:r=t.getByte();break;case 2:r=t.getInt16();break;case 3:r=t.getInt24();break;case 4:r=t.getInt32()}return n.util.createBuffer(t.getBytes(r))},o=function(n,t,i){n.putInt(i.length(),t<<3);n.putBuffer(i)},i={},a,ut,v;i.Versions={TLS_1_0:{major:3,minor:1},TLS_1_1:{major:3,minor:2},TLS_1_2:{major:3,minor:3}};i.SupportedVersions=[i.Versions.TLS_1_1,i.Versions.TLS_1_0];i.Version=i.SupportedVersions[0];i.MaxFragment=15360;i.ConnectionEnd={server:0,client:1};i.PRFAlgorithm={tls_prf_sha256:0};i.BulkCipherAlgorithm={none:null,rc4:0,des3:1,aes:2};i.CipherType={stream:0,block:1,aead:2};i.MACAlgorithm={none:null,hmac_md5:0,hmac_sha1:1,hmac_sha256:2,hmac_sha384:3,hmac_sha512:4};i.CompressionMethod={none:0,deflate:1};i.ContentType={change_cipher_spec:20,alert:21,handshake:22,application_data:23,heartbeat:24};i.HandshakeType={hello_request:0,client_hello:1,server_hello:2,certificate:11,server_key_exchange:12,certificate_request:13,server_hello_done:14,certificate_verify:15,client_key_exchange:16,finished:20};i.Alert={};i.Alert.Level={warning:1,fatal:2};i.Alert.Description={close_notify:0,unexpected_message:10,bad_record_mac:20,decryption_failed:21,record_overflow:22,decompression_failure:30,handshake_failure:40,bad_certificate:42,unsupported_certificate:43,certificate_revoked:44,certificate_expired:45,certificate_unknown:46,illegal_parameter:47,unknown_ca:48,access_denied:49,decode_error:50,decrypt_error:51,export_restriction:60,protocol_version:70,insufficient_security:71,internal_error:80,user_canceled:90,no_renegotiation:100};i.HeartbeatMessageType={heartbeat_request:1,heartbeat_response:2};i.CipherSuites={};i.getCipherSuite=function(n){var r=null,u,t;for(u in i.CipherSuites)if(t=i.CipherSuites[u],t.id[0]===n.charCodeAt(0)&&t.id[1]===n.charCodeAt(1)){r=t;break}return r};i.handleUnexpected=function(n){var t=!n.open&&n.entity===i.ConnectionEnd.client;t||n.error(n,{message:"Unexpected message. Received TLS record out of order.",send:!0,alert:{level:i.Alert.Level.fatal,description:i.Alert.Description.unexpected_message}})};i.handleHelloRequest=function(n){!n.handshaking&&n.handshakes>0&&(i.queue(n,i.createAlert(n,{level:i.Alert.Level.warning,description:i.Alert.Description.no_renegotiation})),i.flush(n));n.process()};i.parseHelloMessage=function(t,r,u){var f=null,s=t.entity===i.ConnectionEnd.client,o,c,h,l,a,v,p,y;if(u<38)t.error(t,{message:s?"Invalid ServerHello message. Message too short.":"Invalid ClientHello message. Message too short.",send:!0,alert:{level:i.Alert.Level.fatal,description:i.Alert.Description.illegal_parameter}});else{if(o=r.fragment,c=o.length(),f={version:{major:o.getByte(),minor:o.getByte()},random:n.util.createBuffer(o.getBytes(32)),session_id:e(o,1),extensions:[]},s?(f.cipher_suite=o.getBytes(2),f.compression_method=o.getByte()):(f.cipher_suites=e(o,2),f.compression_methods=e(o,1)),c=u-(c-o.length()),c>0){for(h=e(o,2);h.length()>0;)f.extensions.push({type:[h.getByte(),h.getByte()],data:e(h,2)});if(!s)for(l=0;l<f.extensions.length;++l)if(a=f.extensions[l],a.type[0]===0&&a.type[1]===0)for(v=e(a.data,2);v.length()>0;){if(p=v.getByte(),p!==0)break;t.session.extensions.server_name.serverNameList.push(e(v,2).getBytes())}}if(t.session.version&&(f.version.major!==t.session.version.major||f.version.minor!==t.session.version.minor))return t.error(t,{message:"TLS version change is disallowed during renegotiation.",send:!0,alert:{level:i.Alert.Level.fatal,description:i.Alert.Description.protocol_version}});if(s)t.session.cipherSuite=i.getCipherSuite(f.cipher_suite);else for(y=n.util.createBuffer(f.cipher_suites.bytes());y.length()>0;)if(t.session.cipherSuite=i.getCipherSuite(y.getBytes(2)),t.session.cipherSuite!==null)break;if(t.session.cipherSuite===null)return t.error(t,{message:"No cipher suites in common.",send:!0,alert:{level:i.Alert.Level.fatal,description:i.Alert.Description.handshake_failure},cipherSuite:n.util.bytesToHex(f.cipher_suite)});t.session.compressionMethod=s?f.compression_method:i.CompressionMethod.none}return f};i.createSecurityParameters=function(n,t){var r=n.entity===i.ConnectionEnd.client,u=t.random.bytes(),f=r?n.session.sp.client_random:u,e=r?u:i.createRandom().getBytes();n.session.sp={entity:n.entity,prf_algorithm:i.PRFAlgorithm.tls_prf_sha256,bulk_cipher_algorithm:null,cipher_type:null,enc_key_length:null,block_length:null,fixed_iv_length:null,record_iv_length:null,mac_algorithm:null,mac_length:null,mac_key_length:null,compression_algorithm:n.session.compressionMethod,pre_master_secret:null,master_secret:null,client_random:f,server_random:e}};i.handleServerHello=function(n,t,r){var u=i.parseHelloMessage(n,t,r),f;if(!n.fail){if(!(u.version.minor<=n.version.minor))return n.error(n,{message:"Incompatible TLS version.",send:!0,alert:{level:i.Alert.Level.fatal,description:i.Alert.Description.protocol_version}});n.version.minor=u.version.minor;n.session.version=n.version;f=u.session_id.bytes();f.length>0&&f===n.session.id?(n.expect=d,n.session.resuming=!0,n.session.sp.server_random=u.random.bytes()):(n.expect=ht,n.session.resuming=!1,i.createSecurityParameters(n,u));n.session.id=f;n.process()}};i.handleClientHello=function(t,r,u){var e=i.parseHelloMessage(t,r,u),o,f,s,h;if(!t.fail){if(o=e.session_id.bytes(),f=null,t.sessionCache&&(f=t.sessionCache.getSession(o),f===null?o="":(f.version.major!==e.version.major||f.version.minor>e.version.minor)&&(f=null,o="")),o.length===0&&(o=n.random.getBytes(32)),t.session.id=o,t.session.clientHelloVersion=e.version,t.session.sp={},f)t.version=t.session.version=f.version,t.session.sp=f.sp;else{for(h=1;h<i.SupportedVersions.length;++h)if(s=i.SupportedVersions[h],s.minor<=e.version.minor)break;t.version={major:s.major,minor:s.minor};t.session.version=t.version}f!==null?(t.expect=p,t.session.resuming=!0,t.session.sp.client_random=e.random.bytes()):(t.expect=t.verifyClient!==!1?wt:y,t.session.resuming=!1,i.createSecurityParameters(t,e));t.open=!0;i.queue(t,i.createRecord(t,{type:i.ContentType.handshake,data:i.createServerHello(t)}));t.session.resuming?(i.queue(t,i.createRecord(t,{type:i.ContentType.change_cipher_spec,data:i.createChangeCipherSpec()})),t.state.pending=i.createConnectionState(t),t.state.current.write=t.state.pending.write,i.queue(t,i.createRecord(t,{type:i.ContentType.handshake,data:i.createFinished(t)}))):(i.queue(t,i.createRecord(t,{type:i.ContentType.handshake,data:i.createCertificate(t)})),t.fail||(i.queue(t,i.createRecord(t,{type:i.ContentType.handshake,data:i.createServerKeyExchange(t)})),t.verifyClient!==!1&&i.queue(t,i.createRecord(t,{type:i.ContentType.handshake,data:i.createCertificateRequest(t)})),i.queue(t,i.createRecord(t,{type:i.ContentType.handshake,data:i.createServerHelloDone(t)}))));i.flush(t);t.process()}};i.handleCertificate=function(t,r,u){var o;if(u<3)return t.error(t,{message:"Invalid Certificate message. Message too short.",send:!0,alert:{level:i.Alert.Level.fatal,description:i.Alert.Description.illegal_parameter}});var l=r.fragment,h={certificate_list:e(l,3)},s,c,f=[];try{while(h.certificate_list.length()>0)s=e(h.certificate_list,3),c=n.asn1.fromDer(s),s=n.pki.certificateFromAsn1(c,!0),f.push(s)}catch(a){return t.error(t,{message:"Could not parse certificate list.",cause:a,send:!0,alert:{level:i.Alert.Level.fatal,description:i.Alert.Description.bad_certificate}})}o=t.entity===i.ConnectionEnd.client;!o&&t.verifyClient!==!0||f.length!==0?f.length===0?t.expect=o?k:y:(o?t.session.serverCertificate=f[0]:t.session.clientCertificate=f[0],i.verifyCertificateChain(t,f)&&(t.expect=o?k:y)):t.error(t,{message:o?"No server certificate provided.":"No client certificate provided.",send:!0,alert:{level:i.Alert.Level.fatal,description:i.Alert.Description.illegal_parameter}});t.process()};i.handleServerKeyExchange=function(n,t,r){if(r>0)return n.error(n,{message:"Invalid key parameters. Only RSA is supported.",send:!0,alert:{level:i.Alert.Level.fatal,description:i.Alert.Description.unsupported_certificate}});n.expect=ct;n.process()};i.handleClientKeyExchange=function(t,r,u){var o,s;if(u<48)return t.error(t,{message:"Invalid key parameters. Only RSA is supported.",send:!0,alert:{level:i.Alert.Level.fatal,description:i.Alert.Description.unsupported_certificate}});var h=r.fragment,c={enc_pre_master_secret:e(h,2).getBytes()},f=null;if(t.getPrivateKey)try{f=t.getPrivateKey(t,t.session.serverCertificate);f=n.pki.privateKeyFromPem(f)}catch(l){t.error(t,{message:"Could not get private key.",cause:l,send:!0,alert:{level:i.Alert.Level.fatal,description:i.Alert.Description.internal_error}})}if(f===null)return t.error(t,{message:"No private key set.",send:!0,alert:{level:i.Alert.Level.fatal,description:i.Alert.Description.internal_error}});try{if(o=t.session.sp,o.pre_master_secret=f.decrypt(c.enc_pre_master_secret),s=t.session.clientHelloVersion,s.major!==o.pre_master_secret.charCodeAt(0)||s.minor!==o.pre_master_secret.charCodeAt(1))throw new Error("TLS version rollback attack detected.");}catch(l){o.pre_master_secret=n.random.getBytes(48)}t.expect=p;t.session.clientCertificate!==null&&(t.expect=bt);t.process()};i.handleCertificateRequest=function(n,t,r){if(r<3)return n.error(n,{message:"Invalid CertificateRequest. Message too short.",send:!0,alert:{level:i.Alert.Level.fatal,description:i.Alert.Description.illegal_parameter}});var u=t.fragment,f={certificate_types:e(u,1),certificate_authorities:e(u,2)};n.session.certificateRequest=f;n.expect=lt;n.process()};i.handleCertificateVerify=function(t,r,u){var o,s,h,f,c;if(u<2)return t.error(t,{message:"Invalid CertificateVerify. Message too short.",send:!0,alert:{level:i.Alert.Level.fatal,description:i.Alert.Description.illegal_parameter}});o=r.fragment;o.read-=4;s=o.bytes();o.read+=4;h={signature:e(o,2).getBytes()};f=n.util.createBuffer();f.putBuffer(t.session.md5.digest());f.putBuffer(t.session.sha1.digest());f=f.getBytes();try{if(c=t.session.clientCertificate,!c.publicKey.verify(f,h.signature,"NONE"))throw new Error("CertificateVerify signature does not match.");t.session.md5.update(s);t.session.sha1.update(s)}catch(l){return t.error(t,{message:"Bad signature in CertificateVerify.",send:!0,alert:{level:i.Alert.Level.fatal,description:i.Alert.Description.handshake_failure}})}t.expect=p;t.process()};i.handleServerHelloDone=function(t,r,u){var o;if(u>0)return t.error(t,{message:"Invalid ServerHelloDone message. Invalid length.",send:!0,alert:{level:i.Alert.Level.fatal,description:i.Alert.Description.record_overflow}});if(t.serverCertificate===null){var e={message:"No server certificate provided. Not enough security.",send:!0,alert:{level:i.Alert.Level.fatal,description:i.Alert.Description.insufficient_security}},f=t.verify(t,e.alert.description,0,[]);if(f!==!0)return(f||f===0)&&(typeof f=="object"&&!n.util.isArray(f)?(f.message&&(e.message=f.message),f.alert&&(e.alert.description=f.alert)):typeof f=="number"&&(e.alert.description=f)),t.error(t,e)}if(t.session.certificateRequest!==null&&(r=i.createRecord(t,{type:i.ContentType.handshake,data:i.createCertificate(t)}),i.queue(t,r)),r=i.createRecord(t,{type:i.ContentType.handshake,data:i.createClientKeyExchange(t)}),i.queue(t,r),t.expect=yt,o=function(n,t){n.session.certificateRequest!==null&&n.session.clientCertificate!==null&&i.queue(n,i.createRecord(n,{type:i.ContentType.handshake,data:i.createCertificateVerify(n,t)}));i.queue(n,i.createRecord(n,{type:i.ContentType.change_cipher_spec,data:i.createChangeCipherSpec()}));n.state.pending=i.createConnectionState(n);n.state.current.write=n.state.pending.write;i.queue(n,i.createRecord(n,{type:i.ContentType.handshake,data:i.createFinished(n)}));n.expect=d;i.flush(n);n.process()},t.session.certificateRequest===null||t.session.clientCertificate===null)return o(t,null);i.getClientSignature(t,o)};i.handleChangeCipherSpec=function(n,t){if(t.fragment.getByte()!==1)return n.error(n,{message:"Invalid ChangeCipherSpec message received.",send:!0,alert:{level:i.Alert.Level.fatal,description:i.Alert.Description.illegal_parameter}});var r=n.entity===i.ConnectionEnd.client;(n.session.resuming&&r||!n.session.resuming&&!r)&&(n.state.pending=i.createConnectionState(n));n.state.current.read=n.state.pending.read;(!n.session.resuming&&r||n.session.resuming&&!r)&&(n.state.pending=null);n.expect=r?at:kt;n.process()};i.handleFinished=function(t,r){var u=r.fragment,e,o;u.read-=4;e=u.bytes();u.read+=4;o=r.fragment.getBytes();u=n.util.createBuffer();u.putBuffer(t.session.md5.digest());u.putBuffer(t.session.sha1.digest());var f=t.entity===i.ConnectionEnd.client,s=f?"server finished":"client finished",c=t.session.sp,l=h;if(u=l(c.master_secret,s,u.getBytes(),12),u.getBytes()!==o)return t.error(t,{message:"Invalid verify_data in Finished message.",send:!0,alert:{level:i.Alert.Level.fatal,description:i.Alert.Description.decrypt_error}});t.session.md5.update(e);t.session.sha1.update(e);(t.session.resuming&&f||!t.session.resuming&&!f)&&(i.queue(t,i.createRecord(t,{type:i.ContentType.change_cipher_spec,data:i.createChangeCipherSpec()})),t.state.current.write=t.state.pending.write,t.state.pending=null,i.queue(t,i.createRecord(t,{type:i.ContentType.handshake,data:i.createFinished(t)})));t.expect=f?vt:dt;t.handshaking=!1;++t.handshakes;t.peerCertificate=f?t.session.serverCertificate:t.session.clientCertificate;i.flush(t);t.isConnected=!0;t.connected(t);t.process()};i.handleAlert=function(n,t){var f=t.fragment,u={level:f.getByte(),description:f.getByte()},r;switch(u.description){case i.Alert.Description.close_notify:r="Connection closed.";break;case i.Alert.Description.unexpected_message:r="Unexpected message.";break;case i.Alert.Description.bad_record_mac:r="Bad record MAC.";break;case i.Alert.Description.decryption_failed:r="Decryption failed.";break;case i.Alert.Description.record_overflow:r="Record overflow.";break;case i.Alert.Description.decompression_failure:r="Decompression failed.";break;case i.Alert.Description.handshake_failure:r="Handshake failure.";break;case i.Alert.Description.bad_certificate:r="Bad certificate.";break;case i.Alert.Description.unsupported_certificate:r="Unsupported certificate.";break;case i.Alert.Description.certificate_revoked:r="Certificate revoked.";break;case i.Alert.Description.certificate_expired:r="Certificate expired.";break;case i.Alert.Description.certificate_unknown:r="Certificate unknown.";break;case i.Alert.Description.illegal_parameter:r="Illegal parameter.";break;case i.Alert.Description.unknown_ca:r="Unknown certificate authority.";break;case i.Alert.Description.access_denied:r="Access denied.";break;case i.Alert.Description.decode_error:r="Decode error.";break;case i.Alert.Description.decrypt_error:r="Decrypt error.";break;case i.Alert.Description.export_restriction:r="Export restriction.";break;case i.Alert.Description.protocol_version:r="Unsupported protocol version.";break;case i.Alert.Description.insufficient_security:r="Insufficient security.";break;case i.Alert.Description.internal_error:r="Internal error.";break;case i.Alert.Description.user_canceled:r="User canceled.";break;case i.Alert.Description.no_renegotiation:r="Renegotiation not supported.";break;default:r="Unknown error."}if(u.description===i.Alert.Description.close_notify)return n.close();n.error(n,{message:r,send:!1,origin:n.entity===i.ConnectionEnd.client?"server":"client",alert:u});n.process()};i.handleHandshake=function(t,r){var u=r.fragment,f=u.getByte(),e=u.getInt24(),o;if(e>u.length())return t.fragmented=r,r.fragment=n.util.createBuffer(),u.read-=4,t.process();t.fragmented=null;u.read-=4;o=u.bytes(e+4);u.read+=4;f in l[t.entity][t.expect]?(t.entity===i.ConnectionEnd.server&&!t.open&&!t.fail&&(t.handshaking=!0,t.session={version:null,extensions:{server_name:{serverNameList:[]}},cipherSuite:null,compressionMethod:null,serverCertificate:null,clientCertificate:null,md5:n.md.md5.create(),sha1:n.md.sha1.create()}),f!==i.HandshakeType.hello_request&&f!==i.HandshakeType.certificate_verify&&f!==i.HandshakeType.finished&&(t.session.md5.update(o),t.session.sha1.update(o)),l[t.entity][t.expect][f](t,r,e)):i.handleUnexpected(t,r)};i.handleApplicationData=function(n,t){n.data.putBuffer(t.fragment);n.dataReady(n);n.process()};i.handleHeartbeat=function(t,r){var f=r.fragment,e=f.getByte(),o=f.getInt16(),u=f.getBytes(o);if(e===i.HeartbeatMessageType.heartbeat_request){if(t.handshaking||o>u.length)return t.process();i.queue(t,i.createRecord(t,{type:i.ContentType.heartbeat,data:i.createHeartbeat(i.HeartbeatMessageType.heartbeat_response,u)}));i.flush(t)}else if(e===i.HeartbeatMessageType.heartbeat_response){if(u!==t.expectedHeartbeatPayload)return t.process();t.heartbeatReceived&&t.heartbeatReceived(t,n.util.createBuffer(u))}t.process()};var st=0,ht=1,k=2,ct=3,lt=4,d=5,at=6,vt=7,yt=8,pt=0,wt=1,y=2,bt=3,p=4,kt=5,dt=6,t=i.handleUnexpected,g=i.handleChangeCipherSpec,r=i.handleAlert,f=i.handleHandshake,nt=i.handleApplicationData,u=i.handleHeartbeat,w=[];w[i.ConnectionEnd.client]=[[t,r,f,t,u],[t,r,f,t,u],[t,r,f,t,u],[t,r,f,t,u],[t,r,f,t,u],[g,r,t,t,u],[t,r,f,t,u],[t,r,f,nt,u],[t,r,f,t,u]];w[i.ConnectionEnd.server]=[[t,r,f,t,u],[t,r,f,t,u],[t,r,f,t,u],[t,r,f,t,u],[g,r,t,t,u],[t,r,f,t,u],[t,r,f,nt,u],[t,r,f,t,u]];var s=i.handleHelloRequest,gt=i.handleServerHello,tt=i.handleCertificate,it=i.handleServerKeyExchange,b=i.handleCertificateRequest,c=i.handleServerHelloDone,rt=i.handleFinished,l=[];l[i.ConnectionEnd.client]=[[t,t,gt,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t],[s,t,t,t,t,t,t,t,t,t,t,tt,it,b,c,t,t,t,t,t,t],[s,t,t,t,t,t,t,t,t,t,t,t,it,b,c,t,t,t,t,t,t],[s,t,t,t,t,t,t,t,t,t,t,t,t,b,c,t,t,t,t,t,t],[s,t,t,t,t,t,t,t,t,t,t,t,t,t,c,t,t,t,t,t,t],[s,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t],[s,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,rt],[s,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t],[s,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t]];var ni=i.handleClientHello,ti=i.handleClientKeyExchange,ii=i.handleCertificateVerify;l[i.ConnectionEnd.server]=[[t,ni,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t],[t,t,t,t,t,t,t,t,t,t,t,tt,t,t,t,t,t,t,t,t,t],[t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,ti,t,t,t,t],[t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,ii,t,t,t,t,t],[t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t],[t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,rt],[t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t],[t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t]];i.generateKeys=function(n,t){var s=h,f=t.client_random+t.server_random,e,o,r,u;return n.session.resuming||(t.master_secret=s(t.pre_master_secret,"master secret",f,48).bytes(),t.pre_master_secret=null),f=t.server_random+t.client_random,e=2*t.mac_key_length+2*t.enc_key_length,o=n.version.major===i.Versions.TLS_1_0.major&&n.version.minor===i.Versions.TLS_1_0.minor,o&&(e+=2*t.fixed_iv_length),r=s(t.master_secret,"key expansion",f,e),u={client_write_MAC_key:r.getBytes(t.mac_key_length),server_write_MAC_key:r.getBytes(t.mac_key_length),client_write_key:r.getBytes(t.enc_key_length),server_write_key:r.getBytes(t.enc_key_length)},o&&(u.client_write_IV=r.getBytes(t.fixed_iv_length),u.server_write_IV=r.getBytes(t.fixed_iv_length)),u};i.createConnectionState=function(n){var u=n.entity===i.ConnectionEnd.client,f=function(){var n={sequenceNumber:[0,0],macKey:null,macLength:0,macFunction:null,cipherState:null,cipherFunction:function(){return!0},compressionState:null,compressFunction:function(){return!0},updateSequenceNumber:function(){n.sequenceNumber[1]===4294967295?(n.sequenceNumber[1]=0,++n.sequenceNumber[0]):++n.sequenceNumber[1]}};return n},t={read:f(),write:f()},r;if(t.read.update=function(n,r){return t.read.cipherFunction(r,t.read)?t.read.compressFunction(n,r,t.read)||n.error(n,{message:"Could not decompress record.",send:!0,alert:{level:i.Alert.Level.fatal,description:i.Alert.Description.decompression_failure}}):n.error(n,{message:"Could not decrypt record or bad MAC.",send:!0,alert:{level:i.Alert.Level.fatal,description:i.Alert.Description.bad_record_mac}}),!n.fail},t.write.update=function(n,r){return t.write.compressFunction(n,r,t.write)?t.write.cipherFunction(r,t.write)||n.error(n,{message:"Could not encrypt record.",send:!1,alert:{level:i.Alert.Level.fatal,description:i.Alert.Description.internal_error}}):n.error(n,{message:"Could not compress record.",send:!1,alert:{level:i.Alert.Level.fatal,description:i.Alert.Description.internal_error}}),!n.fail},n.session){r=n.session.sp;n.session.cipherSuite.initSecurityParameters(r);r.keys=i.generateKeys(n,r);t.read.macKey=u?r.keys.server_write_MAC_key:r.keys.client_write_MAC_key;t.write.macKey=u?r.keys.client_write_MAC_key:r.keys.server_write_MAC_key;n.session.cipherSuite.initConnectionState(t,n,r);switch(r.compression_algorithm){case i.CompressionMethod.none:break;case i.CompressionMethod.deflate:t.read.compressFunction=ot;t.write.compressFunction=et;break;default:throw new Error("Unsupported compression algorithm.");}}return t};i.createRandom=function(){var i=new Date,r=+i+i.getTimezoneOffset()*6e4,t=n.util.createBuffer();return t.putInt32(r),t.putBytes(n.random.getBytes(28)),t};i.createRecord=function(n,t){if(!t.data)return null;return{type:t.type,version:{major:n.version.major,minor:n.version.minor},length:t.data.length(),fragment:t.data}};i.createAlert=function(t,r){var u=n.util.createBuffer();return u.putByte(r.level),u.putByte(r.description),i.createRecord(t,{type:i.ContentType.alert,data:u})};i.createClientHello=function(t){var u,s,a,y,h,p,c,f,l,v,e;for(t.session.clientHelloVersion={major:t.version.major,minor:t.version.minor},u=n.util.createBuffer(),s=0;s<t.cipherSuites.length;++s)a=t.cipherSuites[s],u.putByte(a.id[0]),u.putByte(a.id[1]);y=u.length();h=n.util.createBuffer();h.putByte(i.CompressionMethod.none);p=h.length();c=n.util.createBuffer();t.virtualHost&&(f=n.util.createBuffer(),f.putByte(0),f.putByte(0),l=n.util.createBuffer(),l.putByte(0),o(l,2,n.util.createBuffer(t.virtualHost)),v=n.util.createBuffer(),o(v,2,l),o(f,2,v),c.putBuffer(f));e=c.length();e>0&&(e+=2);var w=t.session.id,b=w.length+1+2+4+28+2+y+1+p+e,r=n.util.createBuffer();return r.putByte(i.HandshakeType.client_hello),r.putInt24(b),r.putByte(t.version.major),r.putByte(t.version.minor),r.putBytes(t.session.sp.client_random),o(r,1,n.util.createBuffer(w)),o(r,2,u),o(r,1,h),e>0&&o(r,2,c),r};i.createServerHello=function(t){var u=t.session.id,f=u.length+1+2+4+28+2+1,r=n.util.createBuffer();return r.putByte(i.HandshakeType.server_hello),r.putInt24(f),r.putByte(t.version.major),r.putByte(t.version.minor),r.putBytes(t.session.sp.server_random),o(r,1,n.util.createBuffer(u)),r.putByte(t.session.cipherSuite.id[0]),r.putByte(t.session.cipherSuite.id[1]),r.putByte(t.session.compressionMethod),r};i.createCertificate=function(t){var v=t.entity===i.ConnectionEnd.client,r=null,y,e,s,h,u,c,l,a,p,f;if(t.getCertificate&&(y=v?t.session.certificateRequest:t.session.extensions.server_name.serverNameList,r=t.getCertificate(t,y)),e=n.util.createBuffer(),r!==null)try{for(n.util.isArray(r)||(r=[r]),s=null,h=0;h<r.length;++h){if(u=n.pem.decode(r[h])[0],u.type!=="CERTIFICATE"&&u.type!=="X509 CERTIFICATE"&&u.type!=="TRUSTED CERTIFICATE"){c=new Error('Could not convert certificate from PEM; PEM header type is not "CERTIFICATE", "X509 CERTIFICATE", or "TRUSTED CERTIFICATE".');throw c.headerType=u.type,c;}if(u.procType&&u.procType.type==="ENCRYPTED")throw new Error("Could not convert certificate from PEM; PEM is encrypted.");l=n.util.createBuffer(u.body);s===null&&(s=n.asn1.fromDer(l.bytes(),!1));a=n.util.createBuffer();o(a,3,l);e.putBuffer(a)}r=n.pki.certificateFromAsn1(s);v?t.session.clientCertificate=r:t.session.serverCertificate=r}catch(w){return t.error(t,{message:"Could not send certificate list.",cause:w,send:!0,alert:{level:i.Alert.Level.fatal,description:i.Alert.Description.bad_certificate}})}return p=3+e.length(),f=n.util.createBuffer(),f.putByte(i.HandshakeType.certificate),f.putInt24(p),o(f,3,e),f};i.createClientKeyExchange=function(t){var r=n.util.createBuffer(),f,e,o,u;return r.putByte(t.session.clientHelloVersion.major),r.putByte(t.session.clientHelloVersion.minor),r.putBytes(n.random.getBytes(46)),f=t.session.sp,f.pre_master_secret=r.getBytes(),e=t.session.serverCertificate.publicKey,r=e.encrypt(f.pre_master_secret),o=r.length+2,u=n.util.createBuffer(),u.putByte(i.HandshakeType.client_key_exchange),u.putInt24(o),u.putInt16(r.length),u.putBytes(r),u};i.createServerKeyExchange=function(){var r=0,t=n.util.createBuffer();return r>0&&(t.putByte(i.HandshakeType.server_key_exchange),t.putInt24(r)),t};i.getClientSignature=function(t,r){var u=n.util.createBuffer();u.putBuffer(t.session.md5.digest());u.putBuffer(t.session.sha1.digest());u=u.getBytes();t.getSignature=t.getSignature||function(t,r,u){var f=null;if(t.getPrivateKey)try{f=t.getPrivateKey(t,t.session.clientCertificate);f=n.pki.privateKeyFromPem(f)}catch(e){t.error(t,{message:"Could not get private key.",cause:e,send:!0,alert:{level:i.Alert.Level.fatal,description:i.Alert.Description.internal_error}})}f===null?t.error(t,{message:"No private key set.",send:!0,alert:{level:i.Alert.Level.fatal,description:i.Alert.Description.internal_error}}):r=f.sign(r,null);u(t,r)};t.getSignature(t,u,r)};i.createCertificateVerify=function(t,r){var f=r.length+2,u=n.util.createBuffer();return u.putByte(i.HandshakeType.certificate_verify),u.putInt24(f),u.putInt16(r.length),u.putBytes(r),u};i.createCertificateRequest=function(t){var f=n.util.createBuffer(),u,e,s,h,c,r;f.putByte(1);u=n.util.createBuffer();for(e in t.caStore.certs)s=t.caStore.certs[e],h=n.pki.distinguishedNameToAsn1(s.subject),u.putBuffer(n.asn1.toDer(h));return c=1+f.length()+2+u.length(),r=n.util.createBuffer(),r.putByte(i.HandshakeType.certificate_request),r.putInt24(c),o(r,1,f),o(r,2,u),r};i.createServerHelloDone=function(){var t=n.util.createBuffer();return t.putByte(i.HandshakeType.server_hello_done),t.putInt24(0),t};i.createChangeCipherSpec=function(){var t=n.util.createBuffer();return t.putByte(1),t};i.createFinished=function(t){var r=n.util.createBuffer(),u;r.putBuffer(t.session.md5.digest());r.putBuffer(t.session.sha1.digest());var f=t.entity===i.ConnectionEnd.client,e=t.session.sp,o=h,s=f?"client finished":"server finished";return r=o(e.master_secret,s,r.getBytes(),12),u=n.util.createBuffer(),u.putByte(i.HandshakeType.finished),u.putInt24(r.length()),u.putBuffer(r),u};i.createHeartbeat=function(t,i,r){var u,f,e;return typeof r=="undefined"&&(r=i.length),u=n.util.createBuffer(),u.putByte(t),u.putInt16(r),u.putBytes(i),f=u.length(),e=Math.max(16,f-r-3),u.putBytes(n.random.getBytes(e)),u};i.queue=function(t,r){var e,f,u,o,s,h;if(r){if(r.type===i.ContentType.handshake&&(e=r.fragment.bytes(),t.session.md5.update(e),t.session.sha1.update(e),e=null),r.fragment.length()<=i.MaxFragment)f=[r];else{for(f=[],u=r.fragment.bytes();u.length>i.MaxFragment;)f.push(i.createRecord(t,{type:r.type,data:n.util.createBuffer(u.slice(0,i.MaxFragment))})),u=u.slice(i.MaxFragment);u.length>0&&f.push(i.createRecord(t,{type:r.type,data:n.util.createBuffer(u)}))}for(o=0;o<f.length&&!t.fail;++o)s=f[o],h=t.state.current.write,h.update(t,s)&&t.records.push(s)}};i.flush=function(n){for(var i,t=0;t<n.records.length;++t)i=n.records[t],n.tlsData.putByte(i.type),n.tlsData.putByte(i.version.major),n.tlsData.putByte(i.version.minor),n.tlsData.putInt16(i.fragment.length()),n.tlsData.putBuffer(n.records[t].fragment);return n.records=[],n.tlsDataReady(n)};a=function(t){switch(t){case!0:return!0;case n.pki.certificateError.bad_certificate:return i.Alert.Description.bad_certificate;case n.pki.certificateError.unsupported_certificate:return i.Alert.Description.unsupported_certificate;case n.pki.certificateError.certificate_revoked:return i.Alert.Description.certificate_revoked;case n.pki.certificateError.certificate_expired:return i.Alert.Description.certificate_expired;case n.pki.certificateError.certificate_unknown:return i.Alert.Description.certificate_unknown;case n.pki.certificateError.unknown_ca:return i.Alert.Description.unknown_ca;default:return i.Alert.Description.bad_certificate}};ut=function(t){switch(t){case!0:return!0;case i.Alert.Description.bad_certificate:return n.pki.certificateError.bad_certificate;case i.Alert.Description.unsupported_certificate:return n.pki.certificateError.unsupported_certificate;case i.Alert.Description.certificate_revoked:return n.pki.certificateError.certificate_revoked;case i.Alert.Description.certificate_expired:return n.pki.certificateError.certificate_expired;case i.Alert.Description.certificate_unknown:return n.pki.certificateError.certificate_unknown;case i.Alert.Description.unknown_ca:return n.pki.certificateError.unknown_ca;default:return n.pki.certificateError.bad_certificate}};i.verifyCertificateChain=function(t,r){try{n.pki.verifyCertificateChain(t.caStore,r,function(r,u,f){var s=a(r),e=t.verify(t,r,u,f),o;if(e!==!0){if(typeof e=="object"&&!n.util.isArray(e)){o=new Error("The application rejected the certificate.");throw o.send=!0,o.alert={level:i.Alert.Level.fatal,description:i.Alert.Description.bad_certificate},e.message&&(o.message=e.message),e.alert&&(o.alert.description=e.alert),o;}e!==r&&(e=ut(e))}return e})}catch(f){var u=f;(typeof u!="object"||n.util.isArray(u))&&(u={send:!0,alert:{level:i.Alert.Level.fatal,description:a(f)}});"send"in u||(u.send=!0);"alert"in u||(u.alert={level:i.Alert.Level.fatal,description:a(u.error)});t.error(t,u)}return!t.fail};i.createSessionCache=function(t,i){var r=null,u;if(t&&t.getSession&&t.setSession&&t.order)r=t;else{r={};r.cache=t||{};r.capacity=Math.max(i||100,1);r.order=[];for(u in t)r.order.length<=i?r.order.push(u):delete t[u];r.getSession=function(t){var f=null,i=null,u;if(t?i=n.util.bytesToHex(t):r.order.length>0&&(i=r.order[0]),i!==null&&i in r.cache){f=r.cache[i];delete r.cache[i];for(u in r.order)if(r.order[u]===i){r.order.splice(u,1);break}}return f};r.setSession=function(t,i){var u;r.order.length===r.capacity&&(u=r.order.shift(),delete r.cache[u]);u=n.util.bytesToHex(t);r.order.push(u);r.cache[u]=i}}return r};i.createConnection=function(t){var f=null,u,e;if(f=t.caStore?n.util.isArray(t.caStore)?n.pki.createCaStore(t.caStore):t.caStore:n.pki.createCaStore(),u=t.cipherSuites||null,u===null){u=[];for(e in i.CipherSuites)u.push(i.CipherSuites[e])}var o=t.server||!1?i.ConnectionEnd.server:i.ConnectionEnd.client,s=t.sessionCache?i.createSessionCache(t.sessionCache):null,r={version:{major:i.Version.major,minor:i.Version.minor},entity:o,sessionId:t.sessionId,caStore:f,sessionCache:s,cipherSuites:u,connected:t.connected,virtualHost:t.virtualHost||null,verifyClient:t.verifyClient||!1,verify:t.verify||function(n,t){return t},getCertificate:t.getCertificate||null,getPrivateKey:t.getPrivateKey||null,getSignature:t.getSignature||null,input:n.util.createBuffer(),tlsData:n.util.createBuffer(),data:n.util.createBuffer(),tlsDataReady:t.tlsDataReady,dataReady:t.dataReady,heartbeatReceived:t.heartbeatReceived,closed:t.closed,error:function(n,r){r.origin=r.origin||(n.entity===i.ConnectionEnd.client?"client":"server");r.send&&(i.queue(n,i.createAlert(n,r.alert)),i.flush(n));var u=r.fatal!==!1;u&&(n.fail=!0);t.error(n,r);u&&n.close(!1)},deflate:t.deflate||null,inflate:t.inflate||null};r.reset=function(n){r.version={major:i.Version.major,minor:i.Version.minor};r.record=null;r.session=null;r.peerCertificate=null;r.state={pending:null,current:null};r.expect=r.entity===i.ConnectionEnd.client?st:pt;r.fragmented=null;r.records=[];r.open=!1;r.handshakes=0;r.handshaking=!1;r.isConnected=!1;r.fail=!n&&typeof n!="undefined";r.input.clear();r.tlsData.clear();r.data.clear();r.state.current=i.createConnectionState(r)};r.reset();var h=function(n,t){var r=t.type-i.ContentType.change_cipher_spec,u=w[n.entity][n.expect];r in u?u[r](n,t):i.handleUnexpected(n,t)},c=function(t){var f=0,r=t.input,e=r.length(),u;return e<5?f=5-e:(t.record={type:r.getByte(),version:{major:r.getByte(),minor:r.getByte()},length:r.getInt16(),fragment:n.util.createBuffer(),ready:!1},u=t.record.version.major===t.version.major,u&&t.session&&t.session.version&&(u=t.record.version.minor===t.version.minor),u||t.error(t,{message:"Incompatible TLS version.",send:!0,alert:{level:i.Alert.Level.fatal,description:i.Alert.Description.protocol_version}})),f},l=function(n){var r=0,t=n.input,u=t.length(),f;return u<n.record.length?r=n.record.length-u:(n.record.fragment.putBytes(t.getBytes(n.record.length)),t.compact(),f=n.state.current.read,f.update(n,n.record)&&(n.fragmented!==null&&(n.fragmented.type===n.record.type?(n.fragmented.fragment.putBuffer(n.record.fragment),n.record=n.fragmented):n.error(n,{message:"Invalid fragmented record.",send:!0,alert:{level:i.Alert.Level.fatal,description:i.Alert.Description.unexpected_message}})),n.record.ready=!0)),r};return r.handshake=function(t){if(r.entity!==i.ConnectionEnd.client)r.error(r,{message:"Cannot initiate handshake as a server.",fatal:!1});else if(r.handshaking)r.error(r,{message:"Handshake already in progress.",fatal:!1});else{r.fail&&!r.open&&r.handshakes===0&&(r.fail=!1);r.handshaking=!0;t=t||"";var u=null;t.length>0&&(r.sessionCache&&(u=r.sessionCache.getSession(t)),u===null&&(t=""));t.length===0&&r.sessionCache&&(u=r.sessionCache.getSession(),u!==null&&(t=u.id));r.session={id:t,version:null,cipherSuite:null,compressionMethod:null,serverCertificate:null,certificateRequest:null,clientCertificate:null,sp:{},md5:n.md.md5.create(),sha1:n.md.sha1.create()};u&&(r.version=u.version,r.session.sp=u.sp);r.session.sp.client_random=i.createRandom().getBytes();r.open=!0;i.queue(r,i.createRecord(r,{type:i.ContentType.handshake,data:i.createClientHello(r)}));i.flush(r)}},r.process=function(n){var t=0;return n&&r.input.putBytes(n),r.fail||(r.record!==null&&r.record.ready&&r.record.fragment.isEmpty()&&(r.record=null),r.record===null&&(t=c(r)),!r.fail&&r.record!==null&&!r.record.ready&&(t=l(r)),!r.fail&&r.record!==null&&r.record.ready&&h(r,r.record)),t},r.prepare=function(t){return i.queue(r,i.createRecord(r,{type:i.ContentType.application_data,data:n.util.createBuffer(t)})),i.flush(r)},r.prepareHeartbeatRequest=function(t,u){return t instanceof n.util.ByteBuffer&&(t=t.bytes()),typeof u=="undefined"&&(u=t.length),r.expectedHeartbeatPayload=t,i.queue(r,i.createRecord(r,{type:i.ContentType.heartbeat,data:i.createHeartbeat(i.HeartbeatMessageType.heartbeat_request,t,u)})),i.flush(r)},r.close=function(n){if(!r.fail&&r.sessionCache&&r.session){var t={id:r.session.id,version:r.session.version,sp:r.session.sp};t.sp.keys=null;r.sessionCache.setSession(t.id,t)}r.open&&(r.open=!1,r.input.clear(),(r.isConnected||r.handshaking)&&(r.isConnected=r.handshaking=!1,i.queue(r,i.createAlert(r,{level:i.Alert.Level.warning,description:i.Alert.Description.close_notify})),i.flush(r)),r.closed(r));r.reset(n)},r};n.tls=n.tls||{};for(v in i)typeof i[v]!="function"&&(n.tls[v]=i[v]);n.tls.prf_tls1=h;n.tls.hmac_sha1=ft;n.tls.createSessionCache=i.createSessionCache;n.tls.createConnection=i.createConnection}var i="tls",f,e,o,r;if(typeof n!="function"){if(typeof module!="object"||!module.exports)return typeof forge=="undefined"&&(forge={}),u(forge);f=!0;n=function(n,i){i(t,module)}}o=function(n,t){t.exports=function(t){var f=e.map(function(t){return n(t)}).concat(u),r;if(t=t||{},t.defined=t.defined||{},t.defined[i])return t[i];for(t.defined[i]=!0,r=0;r<f.length;++r)f[r](t);return t[i]}};r=n;n=function(t,i){return e=typeof t=="string"?i.slice(2):t.slice(2),f?(delete n,r.apply(null,Array.prototype.slice.call(arguments,0))):(n=r,n.apply(null,Array.prototype.slice.call(arguments,0)))};n("js/tls",["require","module","./asn1","./hmac","./md","./pem","./pki","./random","./util"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function u(n){function i(i,r,f){var e=r.entity===n.tls.ConnectionEnd.client;i.read.cipherState={init:!1,cipher:n.cipher.createDecipher("AES-CBC",e?f.keys.server_write_key:f.keys.client_write_key),iv:e?f.keys.server_write_IV:f.keys.client_write_IV};i.write.cipherState={init:!1,cipher:n.cipher.createCipher("AES-CBC",e?f.keys.client_write_key:f.keys.server_write_key),iv:e?f.keys.client_write_IV:f.keys.server_write_IV};i.read.cipherFunction=o;i.write.cipherFunction=u;i.read.macLength=i.write.macLength=f.mac_length;i.read.macFunction=i.write.macFunction=t.hmac_sha1}function u(i,r){var o=!1,s=r.macFunction(r.macKey,r.sequenceNumber,i),e,u;return i.fragment.putBytes(s),r.updateSequenceNumber(),e=i.version.minor===t.Versions.TLS_1_0.minor?r.cipherState.init?null:r.cipherState.iv:n.random.getBytesSync(16),r.cipherState.init=!0,u=r.cipherState.cipher,u.start({iv:e}),i.version.minor>=t.Versions.TLS_1_1.minor&&u.output.putBytes(e),u.update(i.fragment),u.finish(f)&&(i.fragment=u.output,i.length=i.fragment.length(),o=!0),o}function f(n,t,i){if(!i){var r=n-t.length()%n;t.fillWithByte(r-1,r)}return!0}function e(n,t,i){var r=!0,e,u,f;if(i){for(e=t.length(),u=t.last(),f=e-1-u;f<e-1;++f)r=r&&t.at(f)==u;r&&t.truncate(u+1)}return r}function o(i,u){var s=!1,a,f,o,h,c,l,v;for(++r,a=i.version.minor===t.Versions.TLS_1_0.minor?u.cipherState.init?null:u.cipherState.iv:i.fragment.getBytes(16),u.cipherState.init=!0,f=u.cipherState.cipher,f.start({iv:a}),f.update(i.fragment),s=f.finish(e),o=u.macLength,h="",c=0;c<o;++c)h+=String.fromCharCode(0);return l=f.output.length(),l>=o?(i.fragment=f.output.getBytes(l-o),h=f.output.getBytes(o)):i.fragment=f.output.getBytes(),i.fragment=n.util.createBuffer(i.fragment),i.length=i.fragment.length(),v=u.macFunction(u.macKey,u.sequenceNumber,i),u.updateSequenceNumber(),s=v===h&&s,s}var t=n.tls,r;t.CipherSuites.TLS_RSA_WITH_AES_128_CBC_SHA={id:[0,47],name:"TLS_RSA_WITH_AES_128_CBC_SHA",initSecurityParameters:function(n){n.bulk_cipher_algorithm=t.BulkCipherAlgorithm.aes;n.cipher_type=t.CipherType.block;n.enc_key_length=16;n.block_length=16;n.fixed_iv_length=16;n.record_iv_length=16;n.mac_algorithm=t.MACAlgorithm.hmac_sha1;n.mac_length=20;n.mac_key_length=20},initConnectionState:i};t.CipherSuites.TLS_RSA_WITH_AES_256_CBC_SHA={id:[0,53],name:"TLS_RSA_WITH_AES_256_CBC_SHA",initSecurityParameters:function(n){n.bulk_cipher_algorithm=t.BulkCipherAlgorithm.aes;n.cipher_type=t.CipherType.block;n.enc_key_length=32;n.block_length=16;n.fixed_iv_length=16;n.record_iv_length=16;n.mac_algorithm=t.MACAlgorithm.hmac_sha1;n.mac_length=20;n.mac_key_length=20},initConnectionState:i};r=0}var i="aesCipherSuites",f,e,o,r;if(typeof n!="function"){if(typeof module!="object"||!module.exports)return typeof forge=="undefined"&&(forge={}),u(forge);f=!0;n=function(n,i){i(t,module)}}o=function(n,t){t.exports=function(t){var f=e.map(function(t){return n(t)}).concat(u),r;if(t=t||{},t.defined=t.defined||{},t.defined[i])return t[i];for(t.defined[i]=!0,r=0;r<f.length;++r)f[r](t);return t[i]}};r=n;n=function(t,i){return e=typeof t=="string"?i.slice(2):t.slice(2),f?(delete n,r.apply(null,Array.prototype.slice.call(arguments,0))):(n=r,n.apply(null,Array.prototype.slice.call(arguments,0)))};n("js/aesCipherSuites",["require","module","./aes","./tls"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function u(n){n.debug=n.debug||{};n.debug.storage={};n.debug.get=function(t,i){var r;return typeof t=="undefined"?r=n.debug.storage:t in n.debug.storage&&(r=typeof i=="undefined"?n.debug.storage[t]:n.debug.storage[t][i]),r};n.debug.set=function(t,i,r){t in n.debug.storage||(n.debug.storage[t]={});n.debug.storage[t][i]=r};n.debug.clear=function(t,i){typeof t=="undefined"?n.debug.storage={}:t in n.debug.storage&&(typeof i=="undefined"?delete n.debug.storage[t]:delete n.debug.storage[t][i])}}var i="debug",f,e,o,r;if(typeof n!="function"){if(typeof module!="object"||!module.exports)return typeof forge=="undefined"&&(forge={}),u(forge);f=!0;n=function(n,i){i(t,module)}}o=function(n,t){t.exports=function(t){var f=e.map(function(t){return n(t)}).concat(u),r;if(t=t||{},t.defined=t.defined||{},t.defined[i])return t[i];for(t.defined[i]=!0,r=0;r<f.length;++r)f[r](t);return t[i]}};r=n;n=function(t,i){return e=typeof t=="string"?i.slice(2):t.slice(2),f?(delete n,r.apply(null,Array.prototype.slice.call(arguments,0))):(n=r,n.apply(null,Array.prototype.slice.call(arguments,0)))};n("js/debug",["require","module"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function u(n){function t(t,i,r,u){t.generate=function(t,f){for(var h,e=new n.util.ByteBuffer,c=Math.ceil(f/u)+r,s=new n.util.ByteBuffer,o=r;o<c;++o)s.putInt32(o),i.start(),i.update(t+s.getBytes()),h=i.digest(),e.putBytes(h.getBytes(u));return e.truncate(e.length()-f),e.getBytes()}}n.kem=n.kem||{};var i=n.jsbn.BigInteger;n.kem.rsa={};n.kem.rsa.create=function(t,r){r=r||{};var f=r.prng||n.random,u={};return u.encrypt=function(r,u){var s=Math.ceil(r.n.bitLength()/8),e,o,h,c;do e=new i(n.util.bytesToHex(f.getBytesSync(s)),16).mod(r.n);while(e.equals(i.ZERO));return e=n.util.hexToBytes(e.toString(16)),o=s-e.length,o>0&&(e=n.util.fillString(String.fromCharCode(0),o)+e),h=r.encrypt(e,"NONE"),c=t.generate(e,u),{encapsulation:h,key:c}},u.decrypt=function(n,i,r){var u=n.decrypt(i,"NONE");return t.generate(u,r)},u};n.kem.kdf1=function(n,i){t(this,n,0,i||n.digestLength)};n.kem.kdf2=function(n,i){t(this,n,1,i||n.digestLength)}}var i="kem",f,e,o,r;if(typeof n!="function"){if(typeof module!="object"||!module.exports)return typeof forge=="undefined"&&(forge={}),u(forge);f=!0;n=function(n,i){i(t,module)}}o=function(n,t){t.exports=function(t){var f=e.map(function(t){return n(t)}).concat(u),r;if(t=t||{},t.defined=t.defined||{},t.defined[i])return t[i];for(t.defined[i]=!0,r=0;r<f.length;++r)f[r](t);return t[i]}};r=n;n=function(t,i){return e=typeof t=="string"?i.slice(2):t.slice(2),f?(delete n,r.apply(null,Array.prototype.slice.call(arguments,0))):(n=r,n.apply(null,Array.prototype.slice.call(arguments,0)))};n("js/kem",["require","module","./util","./random","./jsbn"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function u(n){var s,h,t,r,c,e,u,l;n.log=n.log||{};n.log.levels=["none","error","warning","info","debug","verbose","max"];var f={},o=[],i=null;for(n.log.LEVEL_LOCKED=2,n.log.NO_LEVEL_CHECK=4,n.log.INTERPOLATE=8,t=0;t<n.log.levels.length;++t)s=n.log.levels[t],f[s]={index:t,name:s.toUpperCase()};for(n.log.logMessage=function(t){for(var i,u,e=f[t.level].index,r=0;r<o.length;++r)i=o[r],i.flags&n.log.NO_LEVEL_CHECK?i.f(t):(u=f[i.level].index,e<=u&&i.f(i,t))},n.log.prepareStandard=function(n){"standard"in n||(n.standard=f[n.level].name+" ["+n.category+"] "+n.message)},n.log.prepareFull=function(t){if(!("full"in t)){var i=[t.message];i=i.concat([]||t.arguments);t.full=n.util.format.apply(this,i)}},n.log.prepareStandardFull=function(t){"standardFull"in t||(n.log.prepareStandard(t),t.standardFull=t.standard)},h=["error","warning","info","debug","verbose"],t=0;t<h.length;++t)(function(t){n.log[t]=function(i,r){var u=Array.prototype.slice.call(arguments).slice(2),f={timestamp:new Date,level:t,category:i,message:r,arguments:u};n.log.logMessage(f)}})(h[t]);n.log.makeLogger=function(t){var i={flags:0,f:t};return n.log.setLevel(i,"none"),i};n.log.setLevel=function(t,i){var u=!1,r,f;if(t&&!(t.flags&n.log.LEVEL_LOCKED))for(r=0;r<n.log.levels.length;++r)if(f=n.log.levels[r],i==f){t.level=i;u=!0;break}return u};n.log.lock=function(t,i){typeof i=="undefined"||i?t.flags|=n.log.LEVEL_LOCKED:t.flags&=~n.log.LEVEL_LOCKED};n.log.addLogger=function(n){o.push(n)};typeof console!="undefined"&&"log"in console?(console.error&&console.warn&&console.info&&console.debug?(c={error:console.error,warning:console.warn,info:console.info,debug:console.debug,verbose:console.debug},e=function(t,i){n.log.prepareStandard(i);var u=c[i.level],r=[i.standard];r=r.concat(i.arguments.slice());u.apply(console,r)},r=n.log.makeLogger(e)):(e=function(t,i){n.log.prepareStandardFull(i);console.log(i.standardFull)},r=n.log.makeLogger(e)),n.log.setLevel(r,"debug"),n.log.addLogger(r),i=r):console={log:function(){}};i!==null&&(u=n.util.getQueryVariables(),"console.level"in u&&n.log.setLevel(i,u["console.level"].slice(-1)[0]),"console.lock"in u&&(l=u["console.lock"].slice(-1)[0],l=="true"&&n.log.lock(i)));n.log.consoleLogger=i}var i="log",f,e,o,r;if(typeof n!="function"){if(typeof module!="object"||!module.exports)return typeof forge=="undefined"&&(forge={}),u(forge);f=!0;n=function(n,i){i(t,module)}}o=function(n,t){t.exports=function(t){var f=e.map(function(t){return n(t)}).concat(u),r;if(t=t||{},t.defined=t.defined||{},t.defined[i])return t[i];for(t.defined[i]=!0,r=0;r<f.length;++r)f[r](t);return t[i]}};r=n;n=function(t,i){return e=typeof t=="string"?i.slice(2):t.slice(2),f?(delete n,r.apply(null,Array.prototype.slice.call(arguments,0))):(n=r,n.apply(null,Array.prototype.slice.call(arguments,0)))};n("js/log",["require","module","./util"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function u(n){var t=n.asn1,i=n.pkcs7=n.pkcs7||{};i.messageFromPem=function(r){var u=n.pem.decode(r)[0],f,e;if(u.type!=="PKCS7"){f=new Error('Could not convert PKCS#7 message from PEM; PEM header type is not "PKCS#7".');throw f.headerType=u.type,f;}if(u.procType&&u.procType.type==="ENCRYPTED")throw new Error("Could not convert PKCS#7 message from PEM; PEM is encrypted.");return e=t.fromDer(u.body),i.messageFromAsn1(e)};i.messageToPem=function(i,r){var u={type:"PKCS7",body:t.toDer(i.toAsn1()).getBytes()};return n.pem.encode(u,{maxline:r})};i.messageFromAsn1=function(r){var f={},s=[],e,o,u;if(!t.validate(r,i.asn1.contentInfoValidator,f,s)){e=new Error("Cannot read PKCS#7 message. ASN.1 object is not an PKCS#7 ContentInfo.");throw e.errors=s,e;}o=t.derToOid(f.contentType);switch(o){case n.pki.oids.envelopedData:u=i.createEnvelopedData();break;case n.pki.oids.encryptedData:u=i.createEncryptedData();break;case n.pki.oids.signedData:u=i.createSignedData();break;default:throw new Error("Cannot read PKCS#7 message. ContentType with OID "+o+" is not (yet) supported.");}return u.fromAsn1(f.content.value[0]),u};var f=function(r){var u={},e=[],f;if(!t.validate(r,i.asn1.recipientInfoValidator,u,e)){f=new Error("Cannot read PKCS#7 message. ASN.1 object is not an PKCS#7 EnvelopedData.");throw f.errors=e,f;}return{version:u.version.charCodeAt(0),issuer:n.pki.RDNAttributesAsArray(u.issuer),serialNumber:n.util.createBuffer(u.serial).toHex(),encryptedContent:{algorithm:t.derToOid(u.encAlgorithm),parameter:u.encParameter.value,content:u.encKey}}},e=function(i){return t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,t.integerToDer(i.version).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[n.pki.distinguishedNameToAsn1({attributes:i.issuer}),t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,n.util.hexToBytes(i.serialNumber))]),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(i.encryptedContent.algorithm).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.NULL,!1,"")]),t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,i.encryptedContent.content)])},o=function(n){for(var i=[],t=0;t<n.length;t++)i.push(f(n[t]));return i},s=function(n){for(var i=[],t=0;t<n.length;t++)i.push(e(n[t]));return i},h=function(i){return[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(n.pki.oids.data).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(i.algorithm).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,i.parameter.getBytes())]),t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,i.content.getBytes())])]},r=function(i,r,u){var f={},s,h,o,e;if(!t.validate(r,u,f,[])){s=new Error("Cannot read PKCS#7 message. ASN.1 object is not a supported PKCS#7 message.");throw s.errors=s,s;}if(h=t.derToOid(f.contentType),h!==n.pki.oids.data)throw new Error("Unsupported PKCS#7 message. Only wrapped ContentType Data supported.");if(f.encryptedContent){if(o="",n.util.isArray(f.encryptedContent))for(e=0;e<f.encryptedContent.length;++e){if(f.encryptedContent[e].type!==t.Type.OCTETSTRING)throw new Error("Malformed PKCS#7 message, expecting encrypted content constructed of only OCTET STRING objects.");o+=f.encryptedContent[e].value}else o=f.encryptedContent;i.encryptedContent={algorithm:t.derToOid(f.encAlgorithm),parameter:n.util.createBuffer(f.encParameter.value),content:n.util.createBuffer(o)}}if(f.content){if(o="",n.util.isArray(f.content))for(e=0;e<f.content.length;++e){if(f.content[e].type!==t.Type.OCTETSTRING)throw new Error("Malformed PKCS#7 message, expecting content constructed of only OCTET STRING objects.");o+=f.content[e].value}else o=f.content;i.content=n.util.createBuffer(o)}return i.version=f.version.charCodeAt(0),i.rawCapture=f,f},u=function(t){if(t.encryptedContent.key===undefined)throw new Error("Symmetric key not available.");if(t.content===undefined){var i;switch(t.encryptedContent.algorithm){case n.pki.oids["aes128-CBC"]:case n.pki.oids["aes192-CBC"]:case n.pki.oids["aes256-CBC"]:i=n.aes.createDecryptionCipher(t.encryptedContent.key);break;case n.pki.oids.desCBC:case n.pki.oids["des-EDE3-CBC"]:i=n.des.createDecryptionCipher(t.encryptedContent.key);break;default:throw new Error("Unsupported symmetric cipher, OID "+t.encryptedContent.algorithm);}if(i.start(t.encryptedContent.parameter),i.update(t.encryptedContent.content),!i.finish())throw new Error("Symmetric decryption failed.");t.content=i.output}};i.createSignedData=function(){var u=null;return u={type:n.pki.oids.signedData,version:1,certificates:[],crls:[],digestAlgorithmIdentifiers:[],contentInfo:null,signerInfos:[],fromAsn1:function(t){var e,f;for(r(u,t,i.asn1.signedDataValidator),u.certificates=[],u.crls=[],u.digestAlgorithmIdentifiers=[],u.contentInfo=null,u.signerInfos=[],e=u.rawCapture.certificates.value,f=0;f<e.length;++f)u.certificates.push(n.pki.certificateFromAsn1(e[f]))},toAsn1:function(){var i,r,f;if("content"in u)throw new Error("Signing PKCS#7 content not yet implemented.");for(u.contentInfo||u.sign(),i=[],r=0;r<u.certificates.length;++r)i.push(n.pki.certificateToAsn1(u.certificates[0]));return f=[],t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(u.type).getBytes()),t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,t.integerToDer(u.version).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.SET,!0,u.digestAlgorithmIdentifiers),u.contentInfo,t.create(t.Class.CONTEXT_SPECIFIC,0,!0,i),t.create(t.Class.CONTEXT_SPECIFIC,1,!0,f),t.create(t.Class.UNIVERSAL,t.Type.SET,!0,u.signerInfos)])])])},sign:function(){if("content"in u)throw new Error("PKCS#7 signing not yet implemented.");typeof u.content!="object"&&(u.contentInfo=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(n.pki.oids.data).getBytes())]),"content"in u&&u.contentInfo.value.push(t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,u.content)])))},verify:function(){throw new Error("PKCS#7 signature verification not yet implemented.");},addCertificate:function(t){typeof t=="string"&&(t=n.pki.certificateFromPem(t));u.certificates.push(t)},addCertificateRevokationList:function(){throw new Error("PKCS#7 CRL support not yet implemented.");}},u};i.createEncryptedData=function(){var t=null;return t={type:n.pki.oids.encryptedData,version:0,encryptedContent:{algorithm:n.pki.oids["aes256-CBC"]},fromAsn1:function(n){r(t,n,i.asn1.encryptedDataValidator)},decrypt:function(n){n!==undefined&&(t.encryptedContent.key=n);u(t)}},t};i.createEnvelopedData=function(){var f=null;return f={type:n.pki.oids.envelopedData,version:0,recipients:[],encryptedContent:{algorithm:n.pki.oids["aes256-CBC"]},fromAsn1:function(n){var t=r(f,n,i.asn1.envelopedDataValidator);f.recipients=o(t.recipientInfos.value)},toAsn1:function(){return t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(f.type).getBytes()),t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,t.integerToDer(f.version).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.SET,!0,s(f.recipients)),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,h(f.encryptedContent))])])])},findRecipient:function(n){for(var r,u,o,t,i=n.issuer.attributes,e=0;e<f.recipients.length;++e)if((r=f.recipients[e],u=r.issuer,r.serialNumber===n.serialNumber)&&u.length===i.length){for(o=!0,t=0;t<i.length;++t)if(u[t].type!==i[t].type||u[t].value!==i[t].value){o=!1;break}if(o)return r}return null},decrypt:function(t,i){if(f.encryptedContent.key===undefined&&t!==undefined&&i!==undefined)switch(t.encryptedContent.algorithm){case n.pki.oids.rsaEncryption:case n.pki.oids.desCBC:var r=i.decrypt(t.encryptedContent.content);f.encryptedContent.key=n.util.createBuffer(r);break;default:throw new Error("Unsupported asymmetric cipher, OID "+t.encryptedContent.algorithm);}u(f)},addRecipient:function(t){f.recipients.push({version:0,issuer:t.issuer.attributes,serialNumber:t.serialNumber,encryptedContent:{algorithm:n.pki.oids.rsaEncryption,key:t.publicKey}})},encrypt:function(t,i){var r,e,o,s,h,u;if(f.encryptedContent.content===undefined){i=i||f.encryptedContent.algorithm;t=t||f.encryptedContent.key;switch(i){case n.pki.oids["aes128-CBC"]:r=16;e=16;o=n.aes.createEncryptionCipher;break;case n.pki.oids["aes192-CBC"]:r=24;e=16;o=n.aes.createEncryptionCipher;break;case n.pki.oids["aes256-CBC"]:r=32;e=16;o=n.aes.createEncryptionCipher;break;case n.pki.oids["des-EDE3-CBC"]:r=24;e=8;o=n.des.createEncryptionCipher;break;default:throw new Error("Unsupported symmetric cipher, OID "+i);}if(t===undefined)t=n.util.createBuffer(n.random.getBytes(r));else if(t.length()!=r)throw new Error("Symmetric key has wrong length; got "+t.length()+" bytes, expected "+r+".");if(f.encryptedContent.algorithm=i,f.encryptedContent.key=t,f.encryptedContent.parameter=n.util.createBuffer(n.random.getBytes(e)),s=o(t),s.start(f.encryptedContent.parameter.copy()),s.update(f.content),!s.finish())throw new Error("Symmetric encryption failed.");f.encryptedContent.content=s.output}for(h=0;h<f.recipients.length;h++)if(u=f.recipients[h],u.encryptedContent.content===undefined)switch(u.encryptedContent.algorithm){case n.pki.oids.rsaEncryption:u.encryptedContent.content=u.encryptedContent.key.encrypt(f.encryptedContent.key.data);break;default:throw new Error("Unsupported asymmetric cipher, OID "+u.encryptedContent.algorithm);}}},f}}var i="pkcs7",f,e,o,r;if(typeof n!="function"){if(typeof module!="object"||!module.exports)return typeof forge=="undefined"&&(forge={}),u(forge);f=!0;n=function(n,i){i(t,module)}}o=function(n,t){t.exports=function(t){var f=e.map(function(t){return n(t)}).concat(u),r;if(t=t||{},t.defined=t.defined||{},t.defined[i])return t[i];for(t.defined[i]=!0,r=0;r<f.length;++r)f[r](t);return t[i]}};r=n;n=function(t,i){return e=typeof t=="string"?i.slice(2):t.slice(2),f?(delete n,r.apply(null,Array.prototype.slice.call(arguments,0))):(n=r,n.apply(null,Array.prototype.slice.call(arguments,0)))};n("js/pkcs7",["require","module","./aes","./asn1","./des","./oids","./pem","./pkcs7asn1","./random","./util","./x509"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function u(n){function t(t,i){var r=i.toString(16),u;r[0]>="8"&&(r="00"+r);u=n.util.hexToBytes(r);t.putInt32(u.length);t.putBytes(u)}function i(n,t){n.putInt32(t.length);n.putString(t)}function r(){for(var i=n.md.sha1.create(),r=arguments.length,t=0;t<r;++t)i.update(arguments[t]);return i.digest()}var u=n.ssh=n.ssh||{};u.privateKeyToPutty=function(u,f,e){var c,d,a,o,v,y,p,w,l,g,tt,s,b;e=e||"";f=f||"";var k="ssh-rsa",nt=f===""?"none":"aes256-cbc",h="PuTTY-User-Key-File-2: "+k+"\r\n";return h+="Encryption: "+nt+"\r\n",h+="Comment: "+e+"\r\n",c=n.util.createBuffer(),i(c,k),t(c,u.e),t(c,u.n),d=n.util.encode64(c.bytes(),64),a=Math.floor(d.length/66)+1,h+="Public-Lines: "+a+"\r\n",h+=d,o=n.util.createBuffer(),t(o,u.d),t(o,u.p),t(o,u.q),t(o,u.qInv),f?(y=o.length()+16-1,y-=y%16,p=r(o.bytes()),p.truncate(p.length()-y+o.length()),o.putBuffer(p),w=n.util.createBuffer(),w.putBuffer(r("\0\0\0\0",f)),w.putBuffer(r("\0\0\0",f)),l=n.aes.createEncryptionCipher(w.truncate(8),"CBC"),l.start(n.util.createBuffer().fillWithByte(0,16)),l.update(o.copy()),l.finish(),g=l.output,g.truncate(16),v=n.util.encode64(g.bytes(),64)):v=n.util.encode64(o.bytes(),64),a=Math.floor(v.length/66)+1,h+="\r\nPrivate-Lines: "+a+"\r\n",h+=v,tt=r("putty-private-key-file-mac-key",f),s=n.util.createBuffer(),i(s,k),i(s,nt),i(s,e),s.putInt32(c.length()),s.putBuffer(c),s.putInt32(o.length()),s.putBuffer(o),b=n.hmac.create(),b.start("sha1",tt),b.update(s.bytes()),h+="\r\nPrivate-MAC: "+b.digest().toHex()+"\r\n",h};u.publicKeyToOpenSSH=function(r,u){var e="ssh-rsa",f;return u=u||"",f=n.util.createBuffer(),i(f,e),t(f,r.e),t(f,r.n),e+" "+n.util.encode64(f.bytes())+" "+u};u.privateKeyToOpenSSH=function(t,i){return i?n.pki.encryptRsaPrivateKey(t,i,{legacy:!0,algorithm:"aes128"}):n.pki.privateKeyToPem(t)};u.getPublicKeyFingerprint=function(r,u){var e,s;u=u||{};var o=u.md||n.md.md5.create(),f=n.util.createBuffer();if(i(f,"ssh-rsa"),t(f,r.e),t(f,r.n),o.start(),o.update(f.getBytes()),e=o.digest(),u.encoding==="hex")return s=e.toHex(),u.delimiter?s.match(/.{2}/g).join(u.delimiter):s;if(u.encoding==="binary")return e.getBytes();if(u.encoding)throw new Error('Unknown encoding "'+u.encoding+'".');return e}}var i="ssh",f,e,o,r;if(typeof n!="function"){if(typeof module!="object"||!module.exports)return typeof forge=="undefined"&&(forge={}),u(forge);f=!0;n=function(n,i){i(t,module)}}o=function(n,t){t.exports=function(t){var f=e.map(function(t){return n(t)}).concat(u),r;if(t=t||{},t.defined=t.defined||{},t.defined[i])return t[i];for(t.defined[i]=!0,r=0;r<f.length;++r)f[r](t);return t[i]}};r=n;n=function(t,i){return e=typeof t=="string"?i.slice(2):t.slice(2),f?(delete n,r.apply(null,Array.prototype.slice.call(arguments,0))):(n=r,n.apply(null,Array.prototype.slice.call(arguments,0)))};n("js/ssh",["require","module","./aes","./hmac","./md5","./sha1","./util"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function u(n){var h="forge.task",k=0,nt={},rt=0,f,s;n.debug.set(h,"tasks",nt);f={};n.debug.set(h,"queues",f);var it="?",ut=30,ft=20,c="ready",u="running",o="blocked",e="sleeping",i="done",r="error",v="stop",l="start",p="block",d="unblock",w="sleep",g="wakeup",y="cancel",b="fail",t={};t[c]={};t[c][v]=c;t[c][l]=u;t[c][y]=i;t[c][b]=r;t[u]={};t[u][v]=c;t[u][l]=u;t[u][p]=o;t[u][d]=u;t[u][w]=e;t[u][g]=u;t[u][y]=i;t[u][b]=r;t[o]={};t[o][v]=o;t[o][l]=o;t[o][p]=o;t[o][d]=o;t[o][w]=o;t[o][g]=o;t[o][y]=i;t[o][b]=r;t[e]={};t[e][v]=e;t[e][l]=e;t[e][p]=e;t[e][d]=e;t[e][w]=e;t[e][g]=e;t[e][y]=i;t[e][b]=r;t[i]={};t[i][v]=i;t[i][l]=i;t[i][p]=i;t[i][d]=i;t[i][w]=i;t[i][g]=i;t[i][y]=i;t[i][b]=r;t[r]={};t[r][v]=r;t[r][l]=r;t[r][p]=r;t[r][d]=r;t[r][w]=r;t[r][g]=r;t[r][y]=r;t[r][b]=r;s=function(t){this.id=-1;this.name=t.name||it;this.parent=t.parent||null;this.run=t.run;this.subtasks=[];this.error=!1;this.state=c;this.blocks=0;this.timeoutId=null;this.swapTime=null;this.userData=null;this.id=rt++;nt[this.id]=this;k>=1&&n.log.verbose(h,"[%s][%s] init",this.id,this.name,this)};s.prototype.debug=function(t){t=t||"";n.log.debug(h,t,"[%s][%s] task:",this.id,this.name,this,"subtasks:",this.subtasks.length,"queue:",f)};s.prototype.next=function(n,t){typeof n=="function"&&(t=n,n=this.name);var i=new s({run:t,name:n,parent:this});return i.state=u,i.type=this.type,i.successCallback=this.successCallback||null,i.failureCallback=this.failureCallback||null,this.subtasks.push(i),this};s.prototype.parallel=function(t,i){return n.util.isArray(t)&&(i=t,t=this.name),this.next(t,function(r){var f=r,e,u,o,s;for(f.block(i.length),e=function(t,r){n.task.start({type:t,run:function(n){i[r](n)},success:function(){f.unblock()},failure:function(){f.unblock()}})},u=0;u<i.length;u++)o=t+"__parallel-"+r.id+"-"+u,s=u,e(o,s)})};s.prototype.stop=function(){this.state=t[this.state][v]};s.prototype.start=function(){this.error=!1;this.state=t[this.state][l];this.state===u&&(this.start=new Date,this.run(this),a(this,0))};s.prototype.block=function(n){n=typeof n=="undefined"?1:n;this.blocks+=n;this.blocks>0&&(this.state=t[this.state][p])};s.prototype.unblock=function(n){return n=typeof n=="undefined"?1:n,this.blocks-=n,this.blocks===0&&this.state!==i&&(this.state=u,a(this,0)),this.blocks};s.prototype.sleep=function(n){n=typeof n=="undefined"?0:n;this.state=t[this.state][w];var i=this;this.timeoutId=setTimeout(function(){i.timeoutId=null;i.state=u;a(i,0)},n)};s.prototype.wait=function(n){n.wait(this)};s.prototype.wakeup=function(){this.state===e&&(cancelTimeout(this.timeoutId),this.timeoutId=null,this.state=u,a(this,0))};s.prototype.cancel=function(){this.state=t[this.state][y];this.permitsNeeded=0;this.timeoutId!==null&&(cancelTimeout(this.timeoutId),this.timeoutId=null);this.subtasks=[]};s.prototype.fail=function(n){if(this.error=!0,tt(this,!0),n)n.error=this.error,n.swapTime=this.swapTime,n.userData=this.userData,a(n,0);else{if(this.parent!==null){for(var t=this.parent;t.parent!==null;)t.error=this.error,t.swapTime=this.swapTime,t.userData=this.userData,t=t.parent;tt(t,!0)}this.failureCallback&&this.failureCallback(this)}};var et=function(n){n.error=!1;n.state=t[n.state][l];setTimeout(function(){n.state===u&&(n.swapTime=+new Date,n.run(n),a(n,0))},0)},a=function(n,t){var i=t>ut||+new Date-n.swapTime>ft,r=function(t){if(t++,n.state===u)if(i&&(n.swapTime=+new Date),n.subtasks.length>0){var r=n.subtasks.shift();r.error=n.error;r.swapTime=n.swapTime;r.userData=n.userData;r.run(r);r.error||a(r,t)}else tt(n),n.error||n.parent!==null&&(n.parent.error=n.error,n.parent.swapTime=n.swapTime,n.parent.userData=n.userData,a(n.parent,t))};i?setTimeout(r,0):r(t)},tt=function(t,r){t.state=i;delete nt[t.id];k>=1&&n.log.verbose(h,"[%s][%s] finish",t.id,t.name,t);t.parent===null&&(t.type in f?f[t.type].length===0?n.log.error(h,"[%s][%s] task queue empty [%s]",t.id,t.name,t.type):f[t.type][0]!==t?n.log.error(h,"[%s][%s] task not first in queue [%s]",t.id,t.name,t.type):(f[t.type].shift(),f[t.type].length===0?(k>=1&&n.log.verbose(h,"[%s][%s] delete queue [%s]",t.id,t.name,t.type),delete f[t.type]):(k>=1&&n.log.verbose(h,"[%s][%s] queue start next [%s] remain:%s",t.id,t.name,t.type,f[t.type].length),f[t.type][0].start())):n.log.error(h,"[%s][%s] task queue missing [%s]",t.id,t.name,t.type),r||(t.error&&t.failureCallback?t.failureCallback(t):!t.error&&t.successCallback&&t.successCallback(t)))};n.task=n.task||{};n.task.start=function(t){var i=new s({run:t.run,name:t.name||it});i.type=t.type;i.successCallback=t.success||null;i.failureCallback=t.failure||null;i.type in f?f[t.type].push(i):(k>=1&&n.log.verbose(h,"[%s][%s] create queue [%s]",i.id,i.name,i.type),f[i.type]=[i],et(i))};n.task.cancel=function(n){n in f&&(f[n]=[f[n][0]])};n.task.createCondition=function(){var n={tasks:{}};return n.wait=function(t){t.id in n.tasks||(t.block(),n.tasks[t.id]=t)},n.notify=function(){var t=n.tasks,i;n.tasks={};for(i in t)t[i].unblock()},n}}var i="task",f,e,o,r;if(typeof n!="function"){if(typeof module!="object"||!module.exports)return typeof forge=="undefined"&&(forge={}),u(forge);f=!0;n=function(n,i){i(t,module)}}o=function(n,t){t.exports=function(t){var f=e.map(function(t){return n(t)}).concat(u),r;if(t=t||{},t.defined=t.defined||{},t.defined[i])return t[i];for(t.defined[i]=!0,r=0;r<f.length;++r)f[r](t);return t[i]}};r=n;n=function(t,i){return e=typeof t=="string"?i.slice(2):t.slice(2),f?(delete n,r.apply(null,Array.prototype.slice.call(arguments,0))):(n=r,n.apply(null,Array.prototype.slice.call(arguments,0)))};n("js/task",["require","module","./debug","./log","./util"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){var i="forge",u,f,e,r;if(typeof n!="function"){if(typeof module!="object"||!module.exports){typeof forge=="undefined"&&(forge={disableNativeCode:!1});return}u=!0;n=function(n,i){i(t,module)}}e=function(n,t){t.exports=function(t){var u=f.map(function(t){return n(t)}),r;if(t=t||{},t.defined=t.defined||{},t.defined[i])return t[i];for(t.defined[i]=!0,r=0;r<u.length;++r)u[r](t);return t};t.exports.disableNativeCode=!1;t.exports(t.exports)};r=n;n=function(t,i){return f=typeof t=="string"?i.slice(2):t.slice(2),u?(delete n,r.apply(null,Array.prototype.slice.call(arguments,0))):(n=r,n.apply(null,Array.prototype.slice.call(arguments,0)))};n("js/forge",["require","module","./aes","./aesCipherSuites","./asn1","./cipher","./cipherModes","./debug","./des","./hmac","./kem","./log","./md","./mgf1","./pbkdf2","./pem","./pkcs7","./pkcs1","./pkcs12","./pki","./prime","./prng","./pss","./random","./rc2","./ssh","./task","./tls","./util"],function(){e.apply(null,Array.prototype.slice.call(arguments,0))})}(),t("js/forge")}),function(n){(function(t){"use strict";var r=function(){function t(t){this._bandwidthSettings=t;this._averageCalc=new n.Util.AverageCalculator(this._bandwidthSettings.maxBandwidthHistoryCount)}return Object.defineProperty(t.prototype,"averageBandwidthInKbps",{get:function(){return this._averageCalc.average},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"latestInKbps",{get:function(){return this._averageCalc.latest},enumerable:!0,configurable:!0}),t.prototype.updateBandwidthInfo=function(t){if(t.responseLengthInBytes<this._bandwidthSettings.bandwidthDataSizeThresholdInBytes){n.Log.verbose(5,"Ignoring Bandwidth data as data size :"+t.responseLengthInBytes+" which is less that the limit :"+this._bandwidthSettings.bandwidthDataSizeThresholdInBytes);return}var i=t.responseEndTimeInMS-t.requestStartTimeInMS,r=t.responseLengthInBytes*8/i;this._averageCalc.addValue(r);n.Log.verbose(5,"updateBandWidthInfo -  currentBw: "+this._averageCalc.latest+" averageBw: "+this._averageCalc.average+" size: "+t.responseLengthInBytes+" time Took:"+i)},t.prototype.reportHeuristicsData=function(t,i){var e=this._averageCalc.average*1e3,u=e*this._bandwidthSettings.bandwidthUsabilityPercent,r,f;for(n.Log.verbose(5,"averageBW reporting is : "+u),r=0;r<t.tracksData.length;r++)t.tracksData[r].selectable&&(f=t.tracksData[r].trackInfo.bitrate*i,t.tracksData[r].dataRetrieverEstimationInSec=u?f/u:Infinity)},t}(),i;t.BandwidthTracker=r;i=function(){function n(){this.requestStartTimeInMS=(new Date).getTime();this.responseStartTimeInMS=null;this.responseEndTimeInMS=null;this.responseLengthInBytes=0}return n}();t.BandwidthInfo=i})(n.Heuristics||(n.Heuristics={}));var t=n.Heuristics}(AzureHtml5JS||(AzureHtml5JS={})),function(n){(function(t){"use strict";var r=function(){function t(){this._moduleId="DashMediaSegmentParser"}return t.prototype.dispose=function(){},t.prototype.init=function(n){var t=n.workflows[1];t.addHandler(t.stepEvents.dataRetrieved,this.onGetData,this)},t.prototype.onGetData=function(t){function r(){var l,s,f,h,c,o,e,r,a;if(r=t.requestedStream.streamingInfo.currentSegment,!t.urlsToRetrieve[0].mediaData)throw new Error(t.urlsToRetrieve[0].url+": no media segment data found");if(l=new DataView(t.urlsToRetrieve[0].mediaData),s=n.Mp4Util.GetBoxByType(l,"moof"),!s)return new i(2164261633,"moof not found");if(f=n.Mp4Util.GetBoxByType(s.data,"traf"),!f)return new i(2164261633,"traf not found");if(h=n.Mp4Util.GetTfhdBox(f.data),!h)return new i(2164261633,"tfhd not found");if(c=n.Mp4Util.GetTrunBox(f.data),!c)return new i(2164261633,"trun not found");if(o=n.Mp4Util.GetTfdtBox(f.data),!o)return new i(2164261633,"tfdt not found");if(n.Common.diffTimes(o.baseMediaDecodeTime,r.segmentInfo.mediaTimestamp))throw new Error("Segment mismatch, requested: "+r.segmentInfo.mediaTimestamp+" got: "+o.baseMediaDecodeTime);return(e=u(h,c),0===e)?new i(2164261637,"failed to derive segment duration"):(n.Log.verbose(10,"Segment duration: "+e),a=t.requestedStream.segments.updateSegmentDuration(r.segmentInfo.index,e),!a)?new i(2164261637,"failed to update segment duration in container"):(r.segmentInfo.mediaDuration=e,t.urlsToRetrieve[0].durationInSec=r.segmentInfo.durationInSec,null)}function u(t,i){var r=0;return i.flags&n.Mp4Util.TrunBox.flags_sampleDurationPresent?i.sampleInfoArray.forEach(function(n){r+=n.sampleDuration}):t.defaultSampleDuration?r=t.defaultSampleDuration*i.sampleCount:n.Log.warning(10,"Cannot calculate segment duration from 'tfhd' and 'trun'"),r}function f(){var i=t.requestedStream,r=i.streamingInfo.currentSegment,n=r.segmentInfo,u=i.segments;u.addMediaSegmentInfo(n.index+1,n.mediaTimestamp+n.mediaDuration,NaN,n.presentationOffset,n.timescale)}return t.currentModuleId=this._moduleId,new Promise(function(i,u){var o,e;if(o=t.requestedStream.streamingInfo.currentSegment,!t.sessionContext.commonPresentation.isLive||t.sessionContext.commonPresentation.minimumUpdatePeriodInSec||o.next){i();return}if(!o.segmentInfo.mediaDuration&&(e=r(),e)){n.Failure.attachFailureToRequest(t,t.currentModuleId,e.errorCode,e.message);u();return}f();i()})},t}(),i;t.Parser=r;i=function(){function n(n,t){this.errorCode=n;this.message=t}return n}()})(n.DashMediaSegment||(n.DashMediaSegment={}));var t=n.DashMediaSegment}(AzureHtml5JS||(AzureHtml5JS={}));__extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r},function(n){(function(t){"use strict";function l(n){var t;if("schemeIdUri"in n)t=n.schemeIdUri;else throw new Error("ContentProtection missing @schemeIdUri");return t.toLowerCase()===r.schemeIdUri?new r(n):t.toLowerCase()===u.schemeIdUri?new u(n):new h(n)}var c=function(){function t(){this._moduleId="DashPresentationParser"}return t.prototype.dispose=function(){},t.prototype.init=function(n){var t=n.workflows[0];t.addHandler(t.stepEvents.dataRetrieved,this.onParse,this)},t.prototype.onParse=function(i){return i.currentModuleId=this._moduleId,new Promise(function(r,u){var e,o,c,l,s,h;if(!i.urlsToRetrieve[0].presentationData)throw new Error(i.urlsToRetrieve[0].url+": no presentation data found");if(e=i.sessionContext,h=t._getPublishTime(i.urlsToRetrieve[0].presentationData),h&&e.commonPresentation&&e.commonPresentation.publishTime&&e.commonPresentation.publishTime.getTime()===Date.parse(h)){n.Log.verbose(4,"skipping MPD parse, same publish time as previous");r();return}if(o=e.presentationUrl,c=o.lastIndexOf("/"),l=o.slice(0,c+1),s=new f(i.urlsToRetrieve[0].presentationData,l),!s){n.Failure.attachFailureToRequest(i,i.currentModuleId,2164261632,i.urlsToRetrieve[0].url+": failed to generate DASH presentation");u("failed to generate DASH presentation");return}e.updatePresentation(s);n.Log.verbose(4,"MPD updated");r()})},t._getPublishTime=function(n){var t,i,r="";return n&&(t=n.match(/<MPD[^>]*>/i),t&&t.length>0&&(i=t[0].match(/publishTime="[^"]*/i),i&&i.length>0&&(r=i[0].slice(13)))),r},t}(),f,e,o,s,i,r,u,h;t.Parser=c;f=function(){function t(n,t){var u=this,i,r=[];if(this._lastRetrievalTime=new Date,i=Dash.dependencies.DashParser(),i.debug=new v,i.errHandler=new y,this._manifest=i.parse(n,t),"Period_asArray"in this._manifest&&this._manifest.Period_asArray.length>0&&this._manifest.Period_asArray.forEach(function(n){r.push(new e(n,u.publishTime))}),this._periods=r,r.length>1)throw new Error("Error parsing MPD: multiple periods not supported");"dynamic"===this._manifest.type&&0===this._manifest.minimumUpdatePeriod&&(this._timeShiftTracker=new a(r,this._manifest.timeShiftBufferDepth))}return t.prototype.dispose=function(){this._periods&&(this._periods.forEach(function(n){n.dispose()}),this._periods=[]);this._manifest=null;this._lastRetrievalTime=null},Object.defineProperty(t.prototype,"startTime",{get:function(){var n=null;return"availabilityStartTime"in this._manifest&&(n=new Date(this._manifest.availabilityStartTime)),n},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"publishTime",{get:function(){return"publishTime"in this._manifest?new Date(this._manifest.publishTime):this._lastRetrievalTime},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isLive",{get:function(){return this._manifest.type==="dynamic"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"minimumUpdatePeriodInSec",{get:function(){return this._manifest.minimumUpdatePeriod},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"durationInSec",{get:function(){var n=0;return"mediaPresentationDuration"in this._manifest&&(n=this._manifest.mediaPresentationDuration),n},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"playableWindow",{get:function(){return new n.Common.TimeRange(this._playWindowLeftEdge(),this._playWindowLiveEdge())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"periods",{get:function(){return this._periods},enumerable:!0,configurable:!0}),t.prototype.toJson=function(){return this._manifest},t.prototype.transferPresentationState=function(t){var e=t,i=[],r=[],f,u;for(this._manifest=e._manifest,this._lastRetrievalTime=e._lastRetrievalTime,this._timeShiftTracker=e._timeShiftTracker,this.periods.forEach(function(n){i.push(n)}),e.periods.forEach(function(n){r.push(n)}),f=0;f<r.length;f++)for(u=0;u<i.length;u++)if(i[u]&&r[f].startInSec===i[u].startInSec){i[u].transferPeriodState(r[f]);r[f]=null;i[u]=null;break}i=i.filter(function(n){return!!n});r=r.filter(function(n){return!!n});i.length>0&&n.Log.verbose(4,"Periods removed from MPD: "+i.length);r.length>0&&n.Log.verbose(4,"Periods added to MPD: "+r.length)},t.prototype._playWindowLeftEdge=function(){var t=0,n;return this._timeShiftTracker?this._timeShiftTracker.leftEdge:!this._periods||!this._periods.length?0:(n=this._periods[0].streams,!n||!n.length)?0:(n.forEach(function(n){n.type!==2&&n.segments&&n.segments.first&&(t=Math.max(t,n.segments.first.segmentInfo.presTimeInSec))}),t)},t.prototype._playWindowLiveEdge=function(){var t=Infinity,n;return this._timeShiftTracker?this._timeShiftTracker.liveEdge:!this._periods||!this._periods.length?0:(n=this._periods[0].streams,!n||!n.length)?0:(n.forEach(function(n){if(n.type!==2&&n.segments&&n.segments.last){var i=n.segments.last.segmentInfo;t=Math.min(t,i.presTimeInSec+(i.durationInSec||0))}}),t)},t}();t.Mpd=f;e=function(){function t(n,t){var r=this,i=[];this.startInSec="start"in n?n.start:0;"AdaptationSet_asArray"in n&&n.AdaptationSet_asArray.length>0&&n.AdaptationSet_asArray.forEach(function(n){i.push(new o(n,t,r.startInSec))});this._streams=i}return Object.defineProperty(t.prototype,"streams",{get:function(){return this._streams},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){this._streams&&(this._streams.forEach(function(n){n.dispose()}),this._streams=[])},t.prototype.transferPeriodState=function(t){var i=[],r=[],f,u;for(this.streams.forEach(function(n){i.push(n)}),t.streams.forEach(function(n){r.push(n)}),f=0;f<r.length;f++)for(u=0;u<i.length;u++)if(i[u]&&r[f].id===i[u].id){i[u].transferStreamState(r[f]);r[f]=null;i[u]=null;break}i=i.filter(function(n){return!!n});r=r.filter(function(n){return!!n});i.length>0&&n.Log.verbose(4,"Adaptation Sets removed from period: "+i.length);r.length>0&&n.Log.verbose(4,"Adaptation Sets added to period: "+r.length)},t}();t.Period=e;o=function(){function t(t,i,r){var w=[],b=[],o,f,e,a,v,y,h,u,p,c,k;if(this._adaptationSet=t,this.streamingInfo=new n.Presentation.MediaStreamStreamingInfo,"SegmentTemplate"in t&&(this._segmentTemplate=t.SegmentTemplate,"SegmentTimeline"in this._segmentTemplate&&(o=this._segmentTemplate.SegmentTimeline,f=this._segmentTemplate.timescale?this._segmentTemplate.timescale:1,e=r*f,e-=this._segmentTemplate.presentationTimeOffset?this._segmentTemplate.presentationTimeOffset:0,this._normalizedPtoInSec=e/f,a=new n.Presentation.MediaSegmentInfoContainer(f,e,i),"S_asArray"in o))){for(v=0,y=this._segmentTemplate.startNumber?this._segmentTemplate.startNumber:0,h=0;h<o.S_asArray.length;h++)u=o.S_asArray[h],p="t"in u?u.t:v,c="r"in u?u.r:0,k=new n.Presentation.SegmentRunEntry(y,p,u.d,e,f,c),a.addMediaSegmentRun(k),y+=c+1,v=p+u.d*(c+1);this.segments=a}"Representation"in t&&t.Representation_asArray.forEach(function(n){w.push(new s(n))});this._tracks=w.sort(function(n,t){return n.bitrate-t.bitrate});"ContentProtection"in t&&t.ContentProtection_asArray.forEach(function(n){b.push(l(n))});this._contentProtections=b}return t.prototype.dispose=function(){this._tracks&&(this._tracks.forEach(function(n){n.dispose()}),this._tracks=[]);this._contentProtections&&(this._contentProtections.forEach(function(n){n.dispose()}),this._contentProtections=[]);this.segments&&(this.segments.dispose(),this.segments=null);this.streamingInfo&&(this.streamingInfo.dispose(),this.streamingInfo=null);this._adaptationSet=null;this._segmentTemplate=null},Object.defineProperty(t.prototype,"codec",{get:function(){var n=this._adaptationSet;return n.mimeType+';codecs="'+n.codecs+'"'},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"type",{get:function(){var t;switch(this._adaptationSet.contentType){case"video":t=0;break;case"audio":t=1;break;default:n.Log.error(4,"Stream type not supported: "+this._adaptationSet.contentType)}return t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){var n=null;return"id"in this._adaptationSet?n=this._adaptationSet.id.toString():(n=this._adaptationSet.codecs,"lang"in this._adaptationSet&&(n+=this._adaptationSet.lang)),n},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"language",{get:function(){var n=null;return"lang"in this._adaptationSet&&(n=this._adaptationSet.lang),n},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"initUrlTemplate",{get:function(){var n=null;return"initialization"in this._segmentTemplate&&(n=this._adaptationSet.BaseURL+this._segmentTemplate.initialization),n},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"mediaUrlTemplate",{get:function(){var n=null;return"media"in this._segmentTemplate&&(n=this._adaptationSet.BaseURL+this._segmentTemplate.media),n},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"presentationTimeOffsetInSec",{get:function(){return this._normalizedPtoInSec},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"tracks",{get:function(){return this._tracks},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"contentProtections",{get:function(){return this._contentProtections},enumerable:!0,configurable:!0}),t.prototype.transferStreamState=function(t){var i=[],r=[],f,u;for(this.tracks.forEach(function(n){i.push(n)}),t.tracks.forEach(function(n){r.push(n)}),f=0;f<r.length;f++)for(u=0;u<i.length;u++)if(i[u]&&r[f].id===i[u].id){r[f]=null;i[u]=null;break}i=i.filter(function(n){return!!n});r=r.filter(function(n){return!!n});i.length>0&&n.Log.verbose(4,"Representations removed from MPD: "+i.length);r.length>0&&n.Log.verbose(4,"Representations added to MPD: "+r.length);this.segments.update(t.segments)},t}();t.AdaptationSet=o;s=function(){function t(t){if("id"in t)this._id=t.id;else throw new Error("Representation missing @id");if("bandwidth"in t)this._bitrate=t.bandwidth;else throw new Error("Representation missing @bandwidth");this._height=t.height;this._width=t.width;this.streamingInfo=new n.Presentation.MediaTrackStreamingInfo}return Object.defineProperty(t.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bitrate",{get:function(){return this._bitrate},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){},t}();t.Representation=s;i=function(){function n(n){if("schemeIdUri"in n)this.schemeIdUri=n.schemeIdUri;else throw new Error("ContentProtection missing @schemeIdUri");"value"in n&&(this._value=n.value);"id"in n&&(this._id=n.id)}return Object.defineProperty(n.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),n.prototype.dispose=function(){},n}();t.BaseContentProtection=i;r=function(n){function t(t){n.call(this,t);"pro"in t&&(this._specificData=t.pro.__text)}return __extends(t,n),t.prototype.data=function(n){return 0===n?this._specificData:null},t.prototype.dispose=function(){},t.schemeIdUri="urn:uuid:9a04f079-9840-4286-ab92-e65be0885f95",t}(i);t.PlayReadyContentProtection=r;u=function(n){function t(t){if(n.call(this,t),"SegmentEncryption"in t&&(this._seaEncryptionSystemId=t.SegmentEncryption.schemeIdUri,"CryptoPeriod"in t)){var i=t.CryptoPeriod;"keyUriTemplate"in i&&(this._keyUri=i.keyUriTemplate);"IV"in i&&(this._iv=i.IV)}}return __extends(t,n),t.prototype.data=function(n){switch(n){case 1:return this._seaEncryptionSystemId;case 2:return this._keyUri;case 3:return this._iv;default:return null}},t.prototype.dispose=function(){},t.schemeIdUri="urn:mpeg:dash:sea:2012",t}(i);t.SegmentEncryptionContentProtection=u;h=function(n){function t(t){n.call(this,t)}return __extends(t,n),t.prototype.data=function(){return null},t.prototype.dispose=function(){},t}(i);t.GenericContentProtection=h;var a=function(){function n(n,t){var i,r=0,u=Infinity;n.length&&(i=n[0].streams,i&&i.length)&&(i.forEach(function(n){n.type!==2&&n.segments&&n.segments.first&&n.segments.last&&(r=Math.max(r,n.segments.first.segmentInfo.presTimeInSec),u=Math.min(u,n.segments.last.segmentInfo.presTimeInSec))}),this._dvrWindowLenInSec=t,this._leftEdgeReferenceInPresentation=r,this._liveEdgeReferenceInPresentation=u,this._liveEdgeReferenceLocalTime=Date.now())}return Object.defineProperty(n.prototype,"liveEdge",{get:function(){var n=(Date.now()-this._liveEdgeReferenceLocalTime)/1e3;return this._liveEdgeReferenceInPresentation+n},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"leftEdge",{get:function(){var t=(Date.now()-this._liveEdgeReferenceLocalTime)/1e3,n=this._liveEdgeReferenceInPresentation+t;return n-this._leftEdgeReferenceInPresentation<this._dvrWindowLenInSec?this._leftEdgeReferenceInPresentation:n-this._dvrWindowLenInSec},enumerable:!0,configurable:!0}),n}(),v=function(){function t(){this.log=function(t){n.Log.verbose(4,t)}}return t}(),y=function(){function t(){this.manifestError=function(t){n.Log.error(4,t)}}return t}()})(n.DashPresentation||(n.DashPresentation={}));var t=n.DashPresentation}(AzureHtml5JS||(AzureHtml5JS={})),function(n){(function(t){"use strict";var i=function(){function t(){this._moduleId="DashUrlFormatter"}return t.prototype.init=function(n){var t=n.workflows[1];t.addHandler(t.stepEvents.requestSend,this.onUrlFormat,this)},t.prototype.dispose=function(){},t.prototype.onUrlFormat=function(t){return t.currentModuleId=this._moduleId,new Promise(function(i){var r,u,e,f,o,s;if(!t.selectedTrack)throw new Error("Selected Track not set");if(r=t.selectedTrack.bitrate,r===null||r===undefined)throw new Error("incorrect bitrate");if(t.requestedStream.streamingInfo.fetchInitSegment){if(u=t.requestedStream.initUrlTemplate,!u)throw new Error("no initial url template for the stream");e=n.Util.UrlFormatter.FormatDashInitUrl(u,r.toString());t.requestedStream.streamingInfo.fetchInitSegment=!1;t.urlsToRetrieve.push(new n.Context.UrlRequest(e))}if(f=t.requestedStream.mediaUrlTemplate,!f)throw new Error("media url template is not set for the stream");if(!t.requestedStream.streamingInfo.currentSegment)throw new Error("current segment not selected.");o=t.requestedStream.streamingInfo.currentSegment.segmentInfo.mediaTimestamp;s=n.Util.UrlFormatter.FormatDashMediaUrl(f,r.toString(),o.toString());t.urlsToRetrieve.push(new n.Context.UrlRequest(s,0,t.requestedStream.streamingInfo.currentSegment.segmentInfo.presTimeInSec,t.requestedStream.streamingInfo.currentSegment.segmentInfo.durationInSec));i()})},t}();t.DashUrlFormatter=i})(n.UrlBuilder||(n.UrlBuilder={}));var t=n.UrlBuilder}(AzureHtml5JS||(AzureHtml5JS={})),function(n){(function(t){"use strict";var i=function(){function t(){this._moduleId="heuristics.Engine";this._disposed=!1}return t.prototype.dispose=function(){this._disposed=!0},t.prototype.init=function(n){var t=n.workflows[1];t.addHandler(t.stepEvents.requestSend,this.onGetIndex,this)},t.prototype.onGetIndex=function(t){function u(){t.selectedTrack!==t.requestedStream.streamingInfo.lastDownloadedTrack&&(t.requestedStream.streamingInfo.fetchInitSegment=!0)}function f(n){for(var i=t.heuristicData.tracksData.length-1;i>=0;i--)if(t.heuristicData.tracksData[i].selectable&&t.heuristicData.tracksData[i].dataRetrieverEstimationInSec<n)return t.heuristicData.tracksData[i].trackInfo;return null}var i=this,r;return n.Log.verbose(8,"OnGetIndex"),t.currentModuleId=this._moduleId,r=this,new Promise(function(r,e){function s(){u();r()}var c,l,h,o;if(i._disposed){n.Failure.attachFailureToRequest(t,t.currentModuleId,2164260864);e("object is already disposed.");return}if(t.selectedTrack){s();return}if(t.requestedStream.type!==0){t.selectedTrack=t.requestedStream.tracks[0];s();return}if(c=t.heuristicData.tracksData.findFirst(function(n){return n.selectable===!0}),c)t.selectedTrack=c.trackInfo;else{t.selectedTrack=t.heuristicData.tracksData[0].trackInfo;s();return}if(l=t.requestedStream.streamingInfo.sourceBuffer.getBufferedAheadOfCurrentTimeInSec(),h=5,!t.requestedStream.streamingInfo.currentSegment){s();return}if(h=t.requestedStream.streamingInfo.currentSegment.segmentInfo.durationInSec,!t.requestedStream.streamingInfo.currentSegment)throw new Error("current segment not selected.");var h=t.requestedStream.streamingInfo.currentSegment.segmentInfo.durationInSec,a=t.sessionContext.maxBufferInSec()*t.sessionContext.heuristicSettings.vodStableBufferLevelPercent,v=t.sessionContext.maxBufferInSec()*t.sessionContext.heuristicSettings.vodDowngradeBufferLevelPercent;l<v&&(h*=t.sessionContext.heuristicSettings.belowDowngradeBufferLevelDownloadTimeFactor);o=f(h);(!o||l>a&&o.bitrate<t.requestedStream.streamingInfo.lastDownloadedTrack.bitrate)&&t.heuristicData.tracksData.findFirst(function(n){return n.trackInfo===t.requestedStream.streamingInfo.lastDownloadedTrack&&n.selectable})&&(o=t.requestedStream.streamingInfo.lastDownloadedTrack);o&&(t.selectedTrack=o);s()})},t}();t.Engine=i})(n.Heuristics||(n.Heuristics={}));var t=n.Heuristics}(AzureHtml5JS||(AzureHtml5JS={})),function(n){(function(t){"use strict";var i=function(){function t(){this._moduleId="stepRule";this._disposed=!1;this._currentTrackSegmentCount=0;this._previousTrackSelected=null;this._currentSelectedVideoStream=null}return t.prototype.dispose=function(){this._disposed=!0;this._previousTrackSelected=null;this._currentSelectedVideoStream=null},t.prototype.init=function(n){var t=n.workflows[1];t.addHandler(t.stepEvents.requestBegin,this.onRunStepRule,this)},t.prototype.onRunStepRule=function(t){var r=this,i;return n.Log.verbose(8,"onRunStepRule"),t.currentModuleId=this._moduleId,i=this,new Promise(function(u,f){var e;if(i._disposed){n.Failure.attachFailureToRequest(t,t.currentModuleId,2164260864);f("object is already disposed.");return}if(t.selectedTrack||t.requestedStream.streamingInfo.lastDownloadedTrack===null||t.requestedStream.type!==0){u();return}t.requestedStream!==r._currentSelectedVideoStream&&(i._currentSelectedVideoStream=t.requestedStream,i._previousTrackSelected=null);t.requestedStream.streamingInfo.lastDownloadedTrack===i._previousTrackSelected?i._currentTrackSegmentCount++:(i._previousTrackSelected=t.requestedStream.streamingInfo.lastDownloadedTrack,i._currentTrackSegmentCount=1);var c=i._currentTrackSegmentCount>=t.sessionContext.heuristicSettings.stepRule.minSegmentsBeforeDowngrade,l=i._currentTrackSegmentCount>=t.sessionContext.heuristicSettings.stepRule.minSegmentsBeforeUpgrade,o=t.requestedStream.tracks.indexOf(i._previousTrackSelected),s=o,h=o;for(c&&t.sessionContext.heuristicSettings.stepRule.maxStepDownInQuality>0&&(s=Math.max(0,o-t.sessionContext.heuristicSettings.stepRule.maxStepDownInQuality)),l&&t.sessionContext.heuristicSettings.stepRule.maxStepUpInQuality>0&&(h=Math.min(t.heuristicData.tracksData.length-1,o+t.sessionContext.heuristicSettings.stepRule.maxStepUpInQuality)),e=0;e<t.heuristicData.tracksData.length;e++)(e>h||e<s)&&(t.heuristicData.tracksData[e].selectable=!1);u()})},t}();t.StepRule=i})(n.Heuristics||(n.Heuristics={}));var t=n.Heuristics}(AzureHtml5JS||(AzureHtml5JS={})),function(n){(function(t){"use strict";var i=function(){function t(){this._moduleId="windowSizeRule";this._disposed=!1;this._windowHeight=0;this._windowWidth=0;this._highestTrackIndexAllowed=-1;this._currentSelectedVideoStream=null}return t.prototype.dispose=function(){this._disposed=!0;this._currentSelectedVideoStream=null},t.prototype.init=function(n){var t=n.workflows[1];t.addHandler(t.stepEvents.requestBegin,this.onRunWindowSizeRule,this)},t.prototype.onRunWindowSizeRule=function(t){var r=this,i;return n.Log.verbose(8,"onRunWindowSizeRule"),t.currentModuleId=this._moduleId,i=this,new Promise(function(u,f){var s,h,o,e;if(i._disposed){n.Failure.attachFailureToRequest(t,t.currentModuleId,2164260864);f("object is already disposed.");return}if(t.selectedTrack||!t.sessionContext.heuristicSettings.windowSizeHeuristicsEnabled||t.requestedStream.type!==0){u();return}if(t.requestedStream!==r._currentSelectedVideoStream&&(i._currentSelectedVideoStream=t.requestedStream,i._highestTrackIndexAllowed=-1),s=Math.max(t.sessionContext.videoTag.scrollWidth,t.sessionContext.videoTag.width),h=Math.max(t.sessionContext.videoTag.scrollHeight,t.sessionContext.videoTag.height),h===0||s===0){n.Log.warning(8,"Ignoring window size heuristic rule, as one of the window dimensions is 0.");u();return}for((i._windowWidth!==s||i._windowHeight!==h)&&(i._windowWidth=s,i._windowHeight=h,i._highestTrackIndexAllowed=-1),o=t.heuristicData.tracksData,e=o.length-1;e>i._highestTrackIndexAllowed;e--)if(o[e].selectable)if(o[e].trackInfo.width>s||o[e].trackInfo.height>h)o[e].selectable=!1;else{i._highestTrackIndexAllowed=e;break}u()})},t}();t.WindowSizeRule=i})(n.Heuristics||(n.Heuristics={}));var t=n.Heuristics}(AzureHtml5JS||(AzureHtml5JS={})),function(n){(function(t){"use strict";var i,r,u;(function(n){n[n.success=200]="success";n[n.notFound=404]="notFound";n[n.badGateway=502]="badGateway"})(i||(i={}));r=function(){function t(t){this._moduleId="httpDataRetriever";this._requestList=[];this._disposed=!1;this._bandwidthData=new n.Heuristics.BandwidthTracker(t.heuristicSettings.bandwidth)}return t.prototype.dispose=function(){while(this._requestList.length>0){var n=this._requestList.pop();n.request=null;n=null}this._disposed=!0},t.prototype.init=function(n){var t=n.workflows[0],i=n.workflows[1];t.addHandler(t.stepEvents.requestBegin,this.onGetData,this);t.addHandler(t.stepEvents.requestEnd,this.onGetData,this);i.addHandler(i.stepEvents.requestBegin,this.onReportHeuristicData,this);i.addHandler(i.stepEvents.requestSend,this.onGetData,this)},t.prototype.onReportHeuristicData=function(t){n.Log.verbose(5,"onReportHeuristicData");t.currentModuleId=this._moduleId;var i=this;return new Promise(function(r,u){if(i._disposed){n.Failure.attachFailureToRequest(t,t.currentModuleId,2164260864);u("object is already disposed.");return}if(t.requestedStream.type!==0){r();return}i._bandwidthData.reportHeuristicsData(t.heuristicData,t.requestedStream.streamingInfo.currentSegment.segmentInfo.durationInSec);r()})},t.prototype.onGetData=function(t){n.Log.verbose(5,"onGetData");t.currentModuleId=this._moduleId;var i=this;return new Promise(function(r,f){function o(){var f,s;if(!t.urlsToRetrieve[e])throw new Error("Failed to start the download as urlToRetrieve at index "+e+" is null");if(!t.urlsToRetrieve[e].url)throw new Error("Failed to start the download as urlToRetrieve at index "+e+" is empty");t.urlsToRetrieve[e].responseType===0&&t.urlsToRetrieve[e].mediaData!=null||t.urlsToRetrieve[e].responseType===4&&t.urlsToRetrieve[e].presentationData!=null?(e++,e>=t.urlsToRetrieve.length?r():o()):(f=new XMLHttpRequest,f.open("GET",t.urlsToRetrieve[e].url),f.onprogress=h,f.onload=c,f.onerror=l,f.ontimeout=a,t.urlsToRetrieve[e].responseType===0&&(f.responseType=n.Context.ResponseType[0]),f.msCaching&&(f.msCaching="disabled"),f.timeout=t.sessionContext.httpDataRetrieverSettings.timeoutInMSec,s=new u(t.urlsToRetrieve[e],f),t.requestedStream&&t.requestedStream.type==0&&t.selectedTrack&&n.Log.verbose(5,"HeuristicInfo: SuggestedBr: "+t.selectedTrack.bitrate+" CurrentBw: "+i._bandwidthData.latestInKbps+" AverageBw: "+i._bandwidthData.averageBandwidthInKbps+" BufferSize: "+t.requestedStream.streamingInfo.sourceBuffer.getBufferedAheadOfCurrentTimeInSec()+" StreamType: "+n.Presentation.StreamType[t.requestedStream.type]+" StreamName: "+t.requestedStream.language+" Index: "+t.requestedStream.streamingInfo.currentSegment.segmentInfo.index+" Time: "+t.requestedStream.streamingInfo.currentSegment.segmentInfo.presTimeInSec+" Duration: "+(t.requestedStream.streamingInfo.currentSegment.segmentInfo.durationInSec||0)+" Url: "+t.urlsToRetrieve[e].url),i._requestList.push(s),f.send())}function h(n){var u=this,r,t;if(!i._disposed){if(r=(new Date).getTime(),t=i._requestList.findFirst(function(n){return n.request===u}),!t)throw new Error("cannot find the request in the request queue");t.bandwidthInfo.responseStartTimeInMS||(!n.lengthComputable||n.lengthComputable&&n.total!=n.loaded)&&(t.bandwidthInfo.responseStartTimeInMS=r)}}function c(){var h=this,u,f;if(!i._disposed){if(u=i._requestList.removeFirst(function(n){return n.request===h}),!u)throw new Error("cannot find the request in the request queue");if(u.bandwidthInfo.responseEndTimeInMS=(new Date).getTime(),f=t.urlsToRetrieve.indexOf(u.urlRequest),t.urlsToRetrieve[f].httpResposeContentType=this.getResponseHeader("Content-Type"),t.urlsToRetrieve[f].httpResponseCode=this.status,200===this.status){switch(u.urlRequest.responseType){case 0:t.urlsToRetrieve[f].mediaData=this.response;u.bandwidthInfo.responseLengthInBytes=t.urlsToRetrieve[f].mediaData.byteLength;break;case 4:t.urlsToRetrieve[f].presentationData=this.response;u.bandwidthInfo.responseLengthInBytes=t.urlsToRetrieve[f].presentationData.length;break;default:throw new Error("Unexpected response Type in the request Context");}if(n.Log.verbose(5,"Download Finished for :"+u.urlRequest.url),t.requestedStream&&(i._bandwidthData&&t.requestedStream.type===0&&i._bandwidthData.updateBandwidthInfo(u.bandwidthInfo),t.requestedStream.streamingInfo.lastDownloadedTrack=t.selectedTrack),e++,e>=t.urlsToRetrieve.length){r();return}o()}else n.Log.error(5,u.urlRequest+" failed, httpStatus: "+this.status),s(n.Failure.translateHttpStatusToCode(this.status),u.urlRequest.url)}}function l(t){var u=this,r;if(!i._disposed){if(r=i._requestList.removeFirst(function(n){return n.request===u}),!r)throw new Error("cannot find the request in the request queue");n.Log.error(5,r.urlRequest+" failed, error: "+n.Failure.errorEventToString(t));s(2164262090,r.urlRequest.url)}}function a(){var r=this,t;if(!i._disposed){if(t=i._requestList.removeFirst(function(n){return n.request===r}),!t)throw new Error("cannot find the request in the request queue");n.Log.error(5,t.urlRequest+" failed, timed out");s(2164262089,t.urlRequest.url)}}function s(i,u){var e=new n.Failure.Record(t.currentModuleId,i,u);t.requestedStream?2164261891===i&&t.sessionContext.commonPresentation.isLive&&!t.requestedStream.streamingInfo.currentSegment.next?(t.requestedStream.streamingInfo.currentSegment=t.requestedStream.streamingInfo.currentSegment.prev,n.Log.verbose(5,"hit past live edge with 404: "+u),t.externalFailure=e,f()):2164261892===i&&t.sessionContext.commonPresentation.isLive&&!t.requestedStream.streamingInfo.currentSegment.next?(t.state=2,t.retryWaitTimeMSec=t.sessionContext.httpRetryPolicySettings.retryMediaInMSec,t.requestedStream.streamingInfo.currentSegment=t.requestedStream.streamingInfo.currentSegment.prev,n.Log.verbose(5,"hit past live edge with 412: "+u),r()):(t.state=2,t.retryWaitTimeMSec=0,t.failTracker.log(e,t.selectedTrack),n.Log.warning(5,"failed to download: "+u),r()):0===t.workflowType&&(2164261891===i||2164262089===i)?(t.state=2,t.retryWaitTimeMSec=2164261891===i?t.sessionContext.httpRetryPolicySettings.retryPresentationInMSec:0,t.failTracker.log(e),n.Log.warning(5,"failed to download: "+u),r()):(t.externalFailure=e,f())}if(i._disposed){n.Failure.attachFailureToRequest(t,t.currentModuleId,2164260864);f("object is already disposed.");return}if(t.urlsToRetrieve.length===0)throw new Error("Failed to start the download as urlsToRetrieve is empty.");var e=0;o()})},t}();t.HttpDataRetriever=r;u=function(){function t(t,i){this.urlRequest=t;this.request=i;this.bandwidthInfo=new n.Heuristics.BandwidthInfo}return t}()})(n.DataRetriever||(n.DataRetriever={}));var t=n.DataRetriever}(AzureHtml5JS||(AzureHtml5JS={})),function(n){(function(t){"use strict";var i,r;(function(n){n[n.noRetry=0]="noRetry";n[n.nextTrack=1]="nextTrack";n[n.nextSegment=2]="nextSegment";n[n.same=3]="same"})(i||(i={}));r=function(){function t(){this._moduleId="httpRetryPolicy";this._disposed=!1}return t.prototype.dispose=function(){this._disposed||(this._disposed=!0)},t.prototype.init=function(n){var i=n.workflows[0],t=n.workflows[1];i.addHandler(t.stepEvents.requestBegin,this.onPresentationRetry,this);t.addHandler(t.stepEvents.requestBegin,this.onMediaRetry,this)},t.prototype.onPresentationRetry=function(t){var r=this;return n.Log.verbose(5,"onPresentationRetry"),t.currentModuleId=this._moduleId,new Promise(function(u,f){var e,s,o;if(r._disposed){n.Failure.attachFailureToRequest(t,t.currentModuleId,2164260864);f("object is already disposed.");return}if(e=t.failTracker,s=t.sessionContext.httpRetryPolicySettings,e.isNone()){u();return}o=r._getAction(0,s,t.failTracker);switch(o){case 0:t.externalFailure=e.lastFailure;n.Log.verbose(5,"onPresentationRetry: noRetry, "+t.urlsToRetrieve[0].url);f();return;case 3:e.sameRequestRetried++;break;default:throw new Error("unexpected retry action: "+o);}e.totalRetried++;n.Log.verbose(5,"onPresentationRetry: "+i[o]+" URL: "+t.urlsToRetrieve[0].url);u()})},t.prototype.onMediaRetry=function(t){var r=this;return n.Log.verbose(5,"onMediaRetry"),t.currentModuleId=this._moduleId,new Promise(function(u,f){var s;if(r._disposed){n.Failure.attachFailureToRequest(t,t.currentModuleId,2164260864);f("object is already disposed.");return}if(!t.requestedStream){u();return}var e=t.failTracker,o=t.requestedStream.streamingInfo,h=t.sessionContext.httpRetryPolicySettings;if(e.isNone()||null!==o.pendingSeekPositionInSec){u();return}0===e.totalRetried&&(e.tracksToTry=r._createTrackToTry(h,t.requestedStream,e.lastTrack));s=r._getAction(1,h,t.failTracker);switch(s){case 0:t.externalFailure=e.lastFailure;n.Log.verbose(5,"onMediaRetry: noRetry,mediaTimestamp: "+o.currentSegment.segmentInfo.mediaTimestamp);f();return;case 1:e.sameRequestRetried++;t.selectedSegment=o.currentSegment;t.selectedTrack=e.tracksToTry[++e.trackToTryIdx];break;case 2:if(o.currentSegment.next)o.currentSegment=o.currentSegment.next,e.segmentsSkipped++,e.resetForSegment(),t.selectedSegment=o.currentSegment,t.selectedTrack=e.tracksToTry[0];else{t.externalFailure=e.lastFailure;n.Log.verbose(5,"onRetry: noRetry, EOS mediaTimestamp: "+o.currentSegment.segmentInfo.mediaTimestamp);f();return}break;case 3:e.sameRequestRetried++;t.selectedSegment=o.currentSegment;t.selectedTrack=e.tracksToTry[0];break;default:throw new Error("unexpected retry action: "+s);}e.totalRetried++;n.Log.verbose(5,"onRetry: "+i[s]+" bitrate: "+t.selectedTrack.bitrate+" mediaTimestamp: "+t.selectedSegment.segmentInfo.mediaTimestamp);u()})},t.prototype._getAction=function(n,t,i){if(i.totalRetried+1>t.maxTotalRetries)return 0;if(0===n)return i.sameRequestRetried+1>t.maxRetryPresentation?0:3;var r;return r=i.isLastNetworkFail()?3:i.trackToTryIdx+1<i.tracksToTry.length?1:2,(3===r||1===r)&&i.sameRequestRetried+1>t.maxRetryPerSegment&&(r=2),2==r&&i.segmentsSkipped+1>t.maxSkipSegments&&(r=0),r},t.prototype._createTrackToTry=function(n,t,i){var u=[],f=t.tracks.indexOf(i),e=t.tracks.length,r;for(u.push(t.tracks[f]),r=f-1;r>=0;r--)t.tracks[r].streamingInfo.selectable&&u.push(t.tracks[r]);if(!n.retryLowerBitrateOnly)for(r=f+1;r<e;r++)t.tracks[r].streamingInfo.selectable&&u.push(t.tracks[r]);return u},t}();t.HttpRetryPolicy=r})(n.DataRetriever||(n.DataRetriever={}));var t=n.DataRetriever}(AzureHtml5JS||(AzureHtml5JS={})),function(n){(function(t){"use strict";var i,r;(function(n){n[n.success=200]="success";n[n.notFound=404]="notFound";n[n.badGateway=502]="badGateway"})(i||(i={}));r=function(){function t(){this._moduleId="InitialBandwidthDataUrlFormatter";this._disposed=!1}return t.prototype.dispose=function(){this._disposed=!0},t.prototype.init=function(n){var t=n.workflows[0];t.addHandler(t.stepEvents.requestEnd,this.onPreFetchUrlFormat,this)},t.prototype.onPreFetchUrlFormat=function(t){n.Log.verbose(6,"OnPreFetchUrlFormat");t.currentModuleId=this._moduleId;var i=this;return new Promise(function(r,u){var s,f,e,o;if(i._disposed){n.Failure.attachFailureToRequest(t,t.currentModuleId,2164260864);u("object is already disposed.");return}if(!t.sessionContext.heuristicSettings.preFetchDataEnabled){r();return}if(s=t.sessionContext.commonPresentation.periods[0].streams,f=s.findFirst(function(n){return n.type===0}),t.requestedStream=f,e=f.tracks[0].bitrate,e===null||e===undefined)throw new Error("bitrate of first video track not set in presentation");if(o=t.requestedStream.mediaUrlTemplate,!o)throw new Error("media url template is not set for the video stream");var h=f.segments,c=h.first.segmentInfo,l=n.Util.UrlFormatter.FormatDashMediaUrl(o,e.toString(),c.mediaTimestamp.toString());t.urlsToRetrieve.push(new n.Context.UrlRequest(l));t.sessionContext.heuristicSettings.preFetchDataEnabled=!1;r()})},t}();t.InitialBandwidthDataUrlFormatter=r})(n.Heuristics||(n.Heuristics={}));var t=n.Heuristics}(AzureHtml5JS||(AzureHtml5JS={})),function(n){(function(t){"use strict";var i=function(){function t(){this._moduleId="streamSelector";this._disposed=!1;this._initial=!0}return t.prototype.dispose=function(){this._disposed=!0},t.prototype.init=function(n){var t=n.workflows[0];t.addHandler(t.stepEvents.requestEnd,this.onSelectStreams,this)},t.prototype.onSelectStreams=function(t){var i=this;return t.currentModuleId=this._moduleId,new Promise(function(r,u){var o=!1,s=!1,f=t.sessionContext.commonPresentation,e;if(i._disposed){n.Failure.attachFailureToRequest(t,t.currentModuleId,2164260864);u("Disposed");return}if(!i._initial){r();return}if(!f)throw new Error("CommonPresentation is empty");for(f.periods[0].streams.forEach(function(n){n.streamingInfo.selected=!1}),e=0;e<f.periods[0].streams.length;e++)0!==f.periods[0].streams[e].type||o?1!==f.periods[0].streams[e].type||s||(s=!0,f.periods[0].streams[e].streamingInfo.selected=!0):(o=!0,f.periods[0].streams[e].streamingInfo.selected=!0);if(!o||!s){n.Failure.attachFailureToRequest(t,t.currentModuleId,2164261634);u("Video or audio streams not found");return}i._initial=!1;r()})},t}();t.InitialStreamSelector=i})(n.Presentation||(n.Presentation={}));var t=n.Presentation}(AzureHtml5JS||(AzureHtml5JS={})),function(n){(function(t){"use strict";var r=function(){function n(n,t,i,r,u){this.index=n;this._timescale=u;this._presentationOffset=r;this._mediaTimestamp=t;this._presTimeInSec=(this._mediaTimestamp+r)/u;i&&(this._mediaDuration=i,this._durationInSec=i/u)}return Object.defineProperty(n.prototype,"timescale",{get:function(){return this._timescale},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"presentationOffset",{get:function(){return this._presentationOffset},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"mediaTimestamp",{get:function(){return this._mediaTimestamp},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"mediaDuration",{get:function(){return this._mediaDuration},set:function(n){this._mediaDuration=n;this._durationInSec=n/this._timescale},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"presTimeInSec",{get:function(){return this._presTimeInSec},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"durationInSec",{get:function(){return this._durationInSec},enumerable:!0,configurable:!0}),n}(),f,i,e,h,u,o,s;t.MediaSegmentInfo=r;f=function(){function n(n,t,i,u,f,e){this.firstSegment=new r(n,t,i,u,f);this.repeat=e;this.containerIndex=NaN}return n}();t.SegmentRunEntry=f;i=function(){function t(n,t,i){this._container=n;this._pubTime=n.pubTime;this._runEntry=t;this._runEntryRepeatPosition=i;var u=t.firstSegment.mediaTimestamp;i&&(u+=i*t.firstSegment.mediaDuration);this.segmentInfo=new r(t.firstSegment.index+i,u,t.firstSegment.mediaDuration,n.presentationTimeOffset,n.timescale)}return Object.defineProperty(t.prototype,"next",{get:function(){var i,r,u;if(this._updateIterator(),i=this._runEntry,r=0,this._runEntryRepeatPosition+1>this._runEntry.repeat)if(u=this._runEntry.containerIndex+1,u<this._container.segmentTable.length)i=this._container.segmentTable[u];else return n.Log.warning(4,"Cannot get next iterator"),null;else r=this._runEntryRepeatPosition+1;return new t(this._container,i,r)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"prev",{get:function(){var i,u,r;if(this._updateIterator(),i=this._runEntry,this._runEntryRepeatPosition===0)if(r=this._runEntry.containerIndex-1,r>=0&&r<this._container.segmentTable.length)i=this._container.segmentTable[r],u=i.repeat;else return n.Log.warning(4,"Cannot get previous iterator"),null;else u=this._runEntryRepeatPosition-1;return new t(this._container,i,u)},enumerable:!0,configurable:!0}),t.prototype._updateIterator=function(){var i,t,r,u;if(this._container.pubTime.getTime()>this._pubTime.getTime()){for(this._pubTime=this._container.pubTime,i=this._runEntry.containerIndex,t=this._container.segmentTable[i];!t&&i>0;)i--,t=this._container.segmentTable[i];if(t){if(t.firstSegment.index<=this.segmentInfo.index&&this.segmentInfo.index<=t.firstSegment.index+t.repeat){this._runEntry=t;this._runEntryRepeatPosition=this.segmentInfo.index-t.firstSegment.index;return}if(this.segmentInfo.index>t.firstSegment.index+t.repeat&&this._container.segmentTable.length>i+1&&(r=this._container.segmentTable[i+1],this.segmentInfo.index<=r.firstSegment.index+r.repeat)){this._runEntry=r;this._runEntryRepeatPosition=this.segmentInfo.index-r.firstSegment.index;return}}if(u=this._container.getByIndex(this.segmentInfo.index),!u){n.Log.warning(4,"Referenced segment not found in presentation");return}this._runEntry=u._runEntry;this._runEntryRepeatPosition=u._runEntryRepeatPosition}},t}();t.MediaSegmentInfoIterator=i;e=function(){function r(n,t,i){this.timescale=n;this.presentationTimeOffset=t;this.pubTime=i;this.segmentTable=[]}return r.prototype.dispose=function(){this.segmentTable.length=0},Object.defineProperty(r.prototype,"first",{get:function(){var n=null;return this.segmentTable.length>0&&(n=new i(this,this.segmentTable[0],0)),n},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"last",{get:function(){var n,t=null;return this.segmentTable.length>0&&(n=this.segmentTable[this.segmentTable.length-1],t=new i(this,n,n.repeat)),t},enumerable:!0,configurable:!0}),r.prototype.addMediaSegmentRun=function(t){var i=null,r=0;this.segmentTable.length>0&&(i=this.segmentTable[this.segmentTable.length-1],r=i.firstSegment.mediaTimestamp+i.firstSegment.mediaDuration*(i.repeat+1),r>t.firstSegment.mediaTimestamp&&(n.Log.error(4,"Cannot add segment with timestamp "+t.firstSegment.mediaTimestamp+" to middle of table ["+this.segmentTable[0].firstSegment.mediaTimestamp+","+r+"]"),t=null));t&&(t.containerIndex=this.segmentTable.length,this.segmentTable.push(t),n.Log.verbose(4,"Added segment with t="+t.firstSegment.mediaTimestamp+" r="+t.repeat))},r.prototype.addMediaSegmentInfo=function(n,i,r,u,f){var e;e=new t.SegmentRunEntry(n,i,r,u,f,0);this.addMediaSegmentRun(e)},r.prototype.updateSegmentDuration=function(t,i){var r,u;if(0===this.segmentTable.length)return!1;if(u=n.Common.binarySearch(t,this.segmentTable,this._compareIndex),u===-1)return n.Log.verbose(4,"Entry with index "+t+" not found"),!1;if(r=this.segmentTable[u],r.firstSegment.mediaDuration!==i){if(0!==r.repeat)throw new Error("Update of a single segment in a run entry with multiple segments not implemented");r.firstSegment.mediaDuration=i}return!0},r.prototype.getByIndex=function(t){var r=null,u,f,e;return 0===this.segmentTable.length?null:(u=n.Common.binarySearch(t,this.segmentTable,this._compareIndex),u!==-1&&(f=this.segmentTable[u],e=t-f.firstSegment.index,r=new i(this,f,e)),r||n.Log.verbose(4,"Entry with index "+t+" not found"),r)},r.prototype.getBySegmentStartTime=function(t,r){var o=null,f,u,e,s;if(0===this.segmentTable.length)return null;if(r||(r=n.Common.timestampDeltaThreshold),Math.abs(t-this.segmentTable[0].firstSegment.presTimeInSec)<r)return this.first;if(f=n.Common.binarySearch(t,this.segmentTable,this._compareTimestampInSec),f!==-1){if(u=this.segmentTable[f],e=Math.round((t-u.firstSegment.presTimeInSec)/u.firstSegment.durationInSec),e>u.repeat)if(f+1<this.segmentTable.length)u=this.segmentTable[f+1],e=0;else return n.Log.verbose(4,"Cannot find match for "+t),null;if(s=u.firstSegment.presTimeInSec+e*u.firstSegment.durationInSec,Math.abs(t-s)>r)return n.Log.verbose(4,"Cannot find match within error range for "+t),null;o=new i(this,u,e)}return o},r.prototype.getByInSegmentTimestamp=function(t){var u=null,f,r,e;return 0===this.segmentTable.length?null:(f=n.Common.binarySearch(t,this.segmentTable,this._compareTimestampInSec),f!==-1&&(r=this.segmentTable[f],e=Math.floor((t-r.firstSegment.presTimeInSec)/r.firstSegment.durationInSec),u=new i(this,r,e)),u||n.Log.verbose(4,"Entry including timestamp "+t+" not found"),u)},r.prototype.update=function(t){var f=this,i=t,r=null,u=0;if(!(i.pubTime.getTime()<=this.pubTime.getTime())){if(this.pubTime=i.pubTime,r=this.getBySegmentStartTime(i.first.segmentInfo.presTimeInSec),r&&r.segmentInfo.index!==i.first.segmentInfo.index&&(u=r.segmentInfo.index,n.Common.diffTimes(i.first.segmentInfo.presTimeInSec,r.segmentInfo.presTimeInSec)))throw new Error("Segment mismatch during container update");this.segmentTable.length=0;i.segmentTable.forEach(function(n){n.firstSegment.index+=u;f.segmentTable.push(n)})}},r.prototype._compareTimestampInSec=function(n,t){var i=0;return n<t.firstSegment.presTimeInSec?i=-1:n>=t.firstSegment.presTimeInSec+(t.repeat+1)*(t.firstSegment.durationInSec||0)&&(i=1),i},r.prototype._compareIndex=function(n,t){var i=0;return n<t.firstSegment.index?i=-1:n>=t.firstSegment.index+(t.repeat+1)&&(i=1),i},r}();t.MediaSegmentInfoContainer=e,function(n){n[n.needsToBeScheduled=0]="needsToBeScheduled";n[n.inProgress=1]="inProgress";n[n.endOfStream=2]="endOfStream"}(t.WorkflowState||(t.WorkflowState={}));h=t.WorkflowState;u=function(){function n(){this.forge=null;this.webCrypto=null}return n.prototype.dispose=function(){this.forge=null;this.webCrypto=null},n}();t.AesInfo=u;o=function(){function n(){this.selected=!1;this.fetchInitSegment=!0;this.currentSegment=null;this.pendingSeekPositionInSec=null;this.workflowState=0;this.sourceBuffer=null;this.lastDownloadedTrack=null;this.aes=new u}return n.prototype.dispose=function(){this.currentSegment=null;this.sourceBuffer&&(this.sourceBuffer.dispose(),this.sourceBuffer=null);this.lastDownloadedTrack=null;this.aes&&(this.aes.dispose(),this.aes=null)},n}();t.MediaStreamStreamingInfo=o;s=function(){function n(){this.selectable=!0}return n}();t.MediaTrackStreamingInfo=s})(n.Presentation||(n.Presentation={}));var t=n.Presentation}(AzureHtml5JS||(AzureHtml5JS={})),function(n){(function(t){"use strict";var i=function(){function t(){this._moduleId="SegmentLocator.Dash";this._disposed=!1}return t.prototype.init=function(n){var t=n.workflows[1];t.addHandler(t.stepEvents.requestBegin,this.onFindSegment,this)},t.prototype.dispose=function(){this._disposed=!0},t.prototype.onFindSegment=function(i){n.Log.verbose(9,"onFindSegment");i.currentModuleId=this._moduleId;var r=this;return new Promise(function(u,f){var h;if(r._disposed){n.Failure.attachFailureToRequest(i,i.currentModuleId,2164260864);f("object is already disposed.");return}var e=i.requestedStream,o=e.streamingInfo.currentSegment,s=e.segments;if(i.selectedSegment){u();return}if(null!==e.streamingInfo.pendingSeekPositionInSec?(e.streamingInfo.currentSegment=s.getByInSegmentTimestamp(e.streamingInfo.pendingSeekPositionInSec),e.streamingInfo.currentSegment&&(e.streamingInfo.pendingSeekPositionInSec=null)):o?e.streamingInfo.currentSegment=o.next:(h=i.sessionContext,e.streamingInfo.currentSegment=isNaN(h.startPositionInSec)?s.first:s.getByInSegmentTimestamp(h.startPositionInSec)),null===e.streamingInfo.currentSegment)if(i.sessionContext.commonPresentation.isLive&&o&&(o.segmentInfo.mediaTimestamp>=s.last.segmentInfo.mediaTimestamp||e.streamingInfo.pendingSeekPositionInSec))if(e.streamingInfo.currentSegment=o,i.sessionContext.commonPresentation.minimumUpdatePeriodInSec)i.state=2,i.retryWaitTimeMSec=t._retryWaitTimeMSec;else{n.Failure.attachFailureToRequest(i,i.currentModuleId,2164260865);f();return}else i.state=1;u()})},t._retryWaitTimeMSec=2e3,t}();t.Dash=i})(n.SegmentLocator||(n.SegmentLocator={}));var t=n.SegmentLocator}(AzureHtml5JS||(AzureHtml5JS={})),function(n){(function(t){"use strict";var i=function(){function t(){this._moduleId="playReady";this._disposed=!1;this._initial=!0}return t.prototype.dispose=function(){this._disposed=!0},t.prototype.init=function(n){var t=n.workflows[0];t.addHandler(t.stepEvents.requestEnd,this.onContentProtected,this)},t.prototype.onContentProtected=function(i){var r=this;return i.currentModuleId=this._moduleId,new Promise(function(u,f){var e=[],o=i.sessionContext.commonPresentation;if(r._disposed){n.Failure.attachFailureToRequest(i,i.currentModuleId,2164260864);f("Disposed");return}if(!r._initial){u();return}if(!o)throw new Error("CommonPresentation is empty");o.periods[0].streams.forEach(function(i){for(var f,u,r=0;r<i.contentProtections.length;r++)f=i.contentProtections[r].data(0),f&&(u=new n.Mp4Util.PsshBox,u.systemId=t.systemId,u.specificData=BASE64.decodeArray(f),e.push(u))});e.length>0&&i.sessionContext.emeManager.addPsshBoxes(e);r._initial=!1;u()})},t.systemId=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]),t}();t.PlayReady=i})(n.ContentProtection||(n.ContentProtection={}));var t=n.ContentProtection}(AzureHtml5JS||(AzureHtml5JS={})),function(n){(function(t){"use strict";var i=function(){function t(){this._moduleId="AesHandler";this._disposed=!1;this._decryptor=new n.WebCryptoUtil.Decryptor}return t.prototype.dispose=function(){this._disposed||(this._disposed=!0,this._decryptor&&(this._decryptor.dispose(),this._decryptor=null))},t.prototype.init=function(n){var t=n.workflows[0],i=n.workflows[1];t.addHandler(t.stepEvents.requestEnd,this.onDownloadKey,this);i.addHandler(i.stepEvents.dataRetrieved,this.onDecrypt,this)},t.prototype.onDownloadKey=function(i){var r=this;return i.currentModuleId=this._moduleId,new Promise(function(u,f){function e(){h<s.length?setTimeout(c,0,s[h++]):u()}function c(r){var c,a,h,v;if(o._disposed){n.Failure.attachFailureToRequest(i,i.currentModuleId,2164260864);f();return}if(o._decryptor.isInitialized(r.streamingInfo.aes)){e();return}if(c=t._getAesContentProtectionIndex(r),isNaN(c)){e();return}var y=r.contentProtections[c],u=y.data(2),l=y.data(3);if(!u||!l){n.Failure.attachFailureToRequest(i,i.currentModuleId,2164261385,"Missing IV or keyUrl");f();return}if(a=o._findExistingAesInfo(s,r,u,l),a){r.streamingInfo.aes=a;e();return}if(h=i.sessionContext.authenticationToken,!n.AesUtil.verifyKeyUrlWithToken(u,h)){n.Failure.attachFailureToRequest(i,i.currentModuleId,2164261385,"AMS hostname failed to match with keyUrl");f();return}v=[];h&&h.length>0&&(v[0]={name:n.HttpUtil.authorizationHeader,value:h});n.HttpUtil.httpRequest(u,"POST","arraybuffer",v).then(function(t){o._decryptor.initialize(r.streamingInfo.aes,t,n.Common.hexStringToUint8Array(l)).then(function(){e();return},function(t){n.Log.error(12,"Failed to initialize decryptor: ");n.Failure.attachFailureToRequest(i,i.currentModuleId,2164261385,t);f()})},function(t){n.Log.error(12,"Failed to download AES key url: "+u+", 0x"+t.toString(16));n.Failure.attachFailureToRequest(i,i.currentModuleId,2164261384,"0x"+t.toString(16));f();return})}var o=r,s=i.sessionContext.commonPresentation.periods[0].streams,h=0;e()})},t.prototype.onDecrypt=function(t){var i=this;return t.currentModuleId=this._moduleId,new Promise(function(r,u){function e(){o<t.urlsToRetrieve.length?setTimeout(h,0,t.urlsToRetrieve[o++]):r()}function h(i){if(f._disposed){n.Failure.attachFailureToRequest(t,t.currentModuleId,2164260864);u();return}if(!i.mediaData){e();return}var r=Date.now();f._decryptor.decrypt(s,i.mediaData).then(function(t){n.Log.verbose(12,"AES decrypt data in "+(Date.now()-r)+" ms, bytes: "+i.mediaData.byteLength+" url: "+i.url);i.mediaData=t;e();return},function(){n.Log.error(12,"Failed to AES decrypt url: "+i.url);n.Failure.attachFailureToRequest(t,t.currentModuleId,2164261387);u();return})}var f=i,o=0,s=t.requestedStream.streamingInfo.aes;if(!f._decryptor.isInitialized(s)){r();return}e()})},t._getAesContentProtectionIndex=function(n){for(var u,r=n.contentProtections,i=0;i<r.length;i++)if(u=r[i].data(1),u===t._aesCbc128SystemId)return i;return NaN},t.prototype._findExistingAesInfo=function(n,t,i,r){for(var e,f,o,s,u=0;u<n.length;u++)if(n[u]!==t)for(e=n[u].contentProtections,f=0;f<e.length;f++)if(o=e[f].data(2),s=e[f].data(3),o===i&&s===r&&this._decryptor.isInitialized(n[u].streamingInfo.aes))return n[u].streamingInfo.aes;return null},t._aesCbc128SystemId="urn:mpeg:dash:sea:aes128-cbc:2013",t}();t.AesHandler=i})(n.ContentProtection||(n.ContentProtection={}));var t=n.ContentProtection}(AzureHtml5JS||(AzureHtml5JS={}));Array.prototype.findFirst=function(n){for(var i,t=0;t<this.length;t++)if(i=this[t],n.call(this,i,t,Object(this)))return i;return null};Array.prototype.findLast=function(n){for(var i,t=this.length-1;t>=0;t--)if(i=this[t],n.call(this,i,t,Object(this)))return i;return null};Array.prototype.findIndexOf=function(n){for(var i,t=0;t<this.length;t++)if(i=this[t],n.call(this,i,t,Object(this)))return t;return-1};Array.prototype.removeFirst=function(n){var t=this.findIndexOf(n),i=null;return t!==-1&&(i=this.splice(t,1)[0]),i};Uint8Array.prototype.isEqual=function(n){if(this.length===n.length){for(var t=0;t<this.length;t++)if(this[t]!==n[t])return!1;return!0}return!1},function(n){(function(n){"use strict";var t=function(){function n(n){if(this._slidingWindow=[],this._sum=0,this._maxWindowLength=n,n<1)throw new Error("window length for average class should be greater than 0");}return n.prototype.dispose=function(){this._slidingWindow=null},Object.defineProperty(n.prototype,"average",{get:function(){return this._slidingWindow.length===0?0:this._sum/this._slidingWindow.length},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"latest",{get:function(){return this._slidingWindow.length===0?0:this._slidingWindow[this._slidingWindow.length-1]},enumerable:!0,configurable:!0}),n.prototype.addValue=function(n){if(this._slidingWindow.length>=this._maxWindowLength){var t=this._slidingWindow.splice(0,1);this._sum-=t[0]}this._slidingWindow.push(n);this._sum+=n},n}();n.AverageCalculator=t})(n.Util||(n.Util={}));var t=n.Util}(AzureHtml5JS||(AzureHtml5JS={})),function(n){(function(n){"use strict";function u(t,i,r){typeof r=="undefined"&&(r=n.timestampDeltaThreshold);var u=i-t;return Math.abs(u)<r&&(u=0),u}function f(n,t,i){for(var u=0,f=t.length-1,r=0,e;u<=f;)if(r=Math.floor((u+f)/2),e=i(n,t[r]),e<0)f=r-1;else if(e>0)u=r+1;else return r;return-1}function e(n){for(var t,r="",i=0;i<n.length;i++)t=n[i].toString(16),r+=t.length<2?"0"+t:t;return r}function o(n){var t,r,i,u;if(n.length<=2||n.substr(0,2).toLowerCase()!="0x")throw new Error("Invalid hexString");for(t=n.substr(2),n.length%2!=0&&(t="0"+t),r=new Uint8Array(t.length/2),i=0;i<t.length;i+=2){if(u=parseInt(t.substr(i,2),16),isNaN(u))throw new Error("Invalid hexString");r[i/2]=u}return r}function s(n){return n<0&&(n=4294967295+n+1),"0x"+("00000000"+n.toString(16).toUpperCase()).substr(-8)}function h(n){for(var i="",t=0;t<n.byteLength;t++)i+=String.fromCharCode(n[t]);return i}function c(n){for(var i=new Uint8Array(n.length),t=0;t<i.byteLength;t++)i[t]=n.charCodeAt(t);return i}var t,i,r;n.timestampDeltaThreshold=1e-6;n.diffTimes=u;t=function(){function n(n,t){this.startInSec=n;this.endInSec=t}return n}();n.TimeRange=t;i=function(){function n(){this._timeRanges=[]}return n.prototype.dispose=function(){this._timeRanges=null},Object.defineProperty(n.prototype,"length",{get:function(){return this._timeRanges.length},enumerable:!0,configurable:!0}),n.prototype.start=function(n){return this._timeRanges[n].startInSec},n.prototype.end=function(n){return this._timeRanges[n].endInSec},n.prototype.duration=function(n){return this._timeRanges[n].endInSec-this._timeRanges[n].startInSec},n.prototype.extendLast=function(n){this._timeRanges[this._timeRanges.length-1].endInSec=n},n.prototype.addRange=function(n){this._timeRanges.push(n)},n.prototype.addRanges=function(n){if(n)for(var i=0;i<n.length;i++)this.addRange(new t(n.start(i),n.end(i)))},n.prototype.rebase=function(n){this._timeRanges.forEach(function(t){t.startInSec-=n;t.endInSec-=n})},n.prototype.removeGaps=function(n){for(var t=0;t+1<this._timeRanges.length;)this._timeRanges[t+1].startInSec-this._timeRanges[t].endInSec<n?(this._timeRanges[t].endInSec=this._timeRanges[t+1].endInSec,this._timeRanges.splice(t+1,1)):t++},n}();n.TimeRangeSet=i;r=function(){function n(n,t,i){this.presTimeInSec=t;this.durationInSec=i;this.data=n}return Object.defineProperty(n.prototype,"endTimestampInSec",{get:function(){return this.presTimeInSec+this.durationInSec},enumerable:!0,configurable:!0}),n}();n.SegmentData=r;n.binarySearch=f;n.uint8ArrayToHexString=e;n.hexStringToUint8Array=o;n.toHexString=s;n.uint8ArrayToString=h;n.stringToUint8Array=c})(n.Common||(n.Common={}));var t=n.Common}(AzureHtml5JS||(AzureHtml5JS={})),function(n){(function(n){"use strict";var i=function(){function n(n,t){typeof t=="undefined"&&(t=0);this.data=n;this.readPos=t}return n.prototype.getUint8=function(){return this.data.getUint8(this.readPos++)},n.prototype.getUint32=function(){var n=this.data.getUint32(this.readPos);return this.readPos+=4,n},n.prototype.getInt32=function(){var n=this.data.getInt32(this.readPos);return this.readPos+=4,n},n.prototype.getBytes=function(n){for(var i=new Uint8Array(n),t=0;t<n;t++)i[t]=this.getUint8();return i},n.prototype.readString=function(n){for(var t="",i=0;i<n;i++)t+=String.fromCharCode(this.getUint8());return t},n}(),t;n.Reader=i;t=function(){function n(n,t){typeof t=="undefined"&&(t=0);this.data=n;this.writePos=t}return n.prototype.setUint8=function(n){this.data.setUint8(this.writePos++,n)},n.prototype.setUint32=function(n){this.data.setUint32(this.writePos,n);this.writePos+=4},n.prototype.setInt32=function(n){this.data.setInt32(this.writePos,n);this.writePos+=4},n.prototype.setString=function(n){for(var t=0;t<n.length;t++)this.setUint8(n.charCodeAt(t))},n.prototype.setBytes=function(n){for(var t=0;t<n.length;t++)this.setUint8(n[t])},n}();n.Writer=t})(n.DataViewReaderWriter||(n.DataViewReaderWriter={}));var t=n.DataViewReaderWriter}(AzureHtml5JS||(AzureHtml5JS={})),function(n){(function(n){"use strict";var r=function(){function n(n,t){typeof n=="undefined"&&(n=null);typeof t=="undefined"&&(t=!0);this._azureHtml5=n;this._allowDuplicateHandlers=t;this._registrations={}}return n.prototype.dispose=function(){this._registrations=null},n.prototype.getHandlers=function(n){return n in this._registrations||(this._registrations[n]=[]),this._registrations[n]},n.prototype.addHandler=function(n,t,r){var u=this.getHandlers(n),f;(this._allowDuplicateHandlers||-1===this._findHandlerByFunction(u,t))&&(f=new i(r,t),u[u.length]=f)},n.prototype.removeHandler=function(n,t){for(var i=this.getHandlers(n),r=this._findHandlerByFunction(i,t);r!==-1;)i.splice(r,1),r=this._findHandlerByFunction(i,t)},n.prototype.dispatchEvent=function(n,i){function f(){var o=new t(n,e._azureHtml5,i);r[u].functionHandler.call(r[u].callerInstance,o);++u<r.length&&setTimeout(f,0)}var e=this,u=0,r=this.getHandlers(n).slice();r.length>0&&setTimeout(f,0)},n.prototype._findHandlerByFunction=function(n,t){for(var r=-1,i=0;i<n.length;i++)if(n[i].functionHandler===t){r=i;break}return r},n}(),t,i;n.Manager=r;t=function(){function n(n,t,i){this.type=n;this.currentDate=new Date;this.azureHtml5=t;this.presentationTimeInSec=t?t.currentTime:0;this.message=i}return n}();n.EventInfo=t;i=function(){function n(n,t){this.callerInstance=n;this.functionHandler=t}return n}();n.Handler=i})(n.Events||(n.Events={}));var t=n.Events}(AzureHtml5JS||(AzureHtml5JS={})),function(n){(function(t){"use strict";function f(n){switch(n){case 400:return 2164261888;case 401:return 2164261889;case 403:return 2164261890;case 404:return 2164261891;case 412:return 2164261892;case 500:return 2164261893;case 502:return 2164261894;case 503:return 2164261895;case 504:return 2164261896;default:return 2164262088}}function e(n){var t;return n.filename&&(t+=" file: "+n.filename),n.lineno&&(t+=" line: "+n.lineno),n.colno&&(t+=" colno: "+n.colno),n.error&&(t+="error: "+n.error),n.message&&(t+="msg: "+n.message),t}function o(t){if(undefined===t||null===t)return"undefined";var i=r(t.code);return t.msExtendedCode&&(i+=", extendedCode: "+n.Common.toHexString(t.msExtendedCode)),i}function s(n,t,r,u){var f=new i(t,r,u);null!=n&&(n.externalFailure=f)}function r(n){switch(n){case MediaError.MEDIA_ERR_ABORTED:return"MEDIA_ERR_ABORTED";case MediaError.MEDIA_ERR_NETWORK:return"MEDIA_ERR_NETWORK";case MediaError.MEDIA_ERR_DECODE:return"MEDIA_ERR_DECODE";case MediaError.MEDIA_ERR_SRC_NOT_SUPPORTED:return"MEDIA_ERR_SRC_NOT_SUPPORTED";default:return n.toString()}}function h(n){return n>2164261119}var i=function(){function t(n,t,i){this.originModuleId=n;this.code=t;this.message=i}return t.prototype.dispose=function(){this.originModuleId=null;this.code=null;this.message=null},t.prototype.toString=function(){var t;return t="Module = "+this.originModuleId+" FailureCode = "+n.Common.toHexString(this.code),this.message&&(t+=" "+this.message),t},t}(),u;t.Record=i;t.translateHttpStatusToCode=f;t.errorEventToString=e;t.mediaErrorToString=o;t.attachFailureToRequest=s;t.isExternalError=h;u=function(){function t(n,t){n?(this.code=this._mapExtendedCodeToCode(n),this.extendedCode=n,this.message=t):(this.code=0,this.extendedCode=null,this.message=null)}return t.prototype.translateMediaError=function(n){this.code=n.code;n.msExtendedCode&&(this.extendedCode=n.msExtendedCode)},t.prototype.toString=function(){var t="code: "+r(this.code);return this.extendedCode&&(t+=", extendedCode: "+n.Common.toHexString(this.extendedCode)),this.message&&(t+=", msg: "+this.message),t},t.prototype._mapExtendedCodeToCode=function(n){return 2164261120<=n&&n<=2164261375?MediaError.MEDIA_ERR_ABORTED:2164261376<=n&&n<=2164261631?MediaError.MEDIA_ERR_DECODE:2164261632<=n&&n<=2164261887?MediaError.MEDIA_ERR_SRC_NOT_SUPPORTED:2164261888<=n&&n<=2164262143?MediaError.MEDIA_ERR_NETWORK:Number.MAX_VALUE},t}();t.External=u})(n.Failure||(n.Failure={}));var t=n.Failure}(AzureHtml5JS||(AzureHtml5JS={})),function(n){(function(n){"use strict";function h(n,t){r(n,3,t)}function c(n,t){r(n,2,t)}function l(n,t){r(n,1,t)}function a(n){u=n}function v(n){undefined===n||null===n?t.forEach(function(n,t,i){i[t]=!0}):t[n]=!0}function y(n){undefined===n||null===n?t.forEach(function(n,t,i){i[t]=!1}):t[n]=!1}function p(n){typeof n=="undefined"&&(n=!0);e=n}function w(n){typeof n=="undefined"&&(n=!0);var t=i;return n&&(i=""),t}function r(n,r,f){var h=new Date(Date.now()),c;r<=u&&t[n]&&(c="["+h.getHours()+":"+h.getMinutes()+":"+(h.getSeconds()+h.getMilliseconds()/1e3).toFixed(3)+"] "+o[r]+": "+s[n]+": "+f,e&&(i+="\n"+c),console.log(c))}var o,s,u,t,f,e,i;for(function(n){n[n.none=0]="none";n[n.error=1]="error";n[n.warning=2]="warning";n[n.verbose=3]="verbose"}(n.Level||(n.Level={})),o=n.Level,function(n){n[n.workflowSequencer=0]="workflowSequencer";n[n.workflowCoordinator=1]="workflowCoordinator";n[n.htmlAdapter=2]="htmlAdapter";n[n.videoElementAdapter=3]="videoElementAdapter";n[n.manifestParser=4]="manifestParser";n[n.httpDataRetriever=5]="httpDataRetriever";n[n.dashUrlFormatter=6]="dashUrlFormatter";n[n.azureHTML5=7]="azureHTML5";n[n.heuristics=8]="heuristics";n[n.segmentLocator=9]="segmentLocator";n[n.mediaParser=10]="mediaParser";n[n.mp4Parser=11]="mp4Parser";n[n.encrypted=12]="encrypted";n[n.common=13]="common";n[n.functionalTest=14]="functionalTest";n[n.max=15]="max"}(n.Area||(n.Area={})),s=n.Area,n.verbose=h,n.warning=c,n.error=l,n.setConsoleOutputByLevel=a,n.enableConsoleOutputByArea=v,n.disableConsoleOutputByArea=y,n.enableMemoryLog=p,n.getMemoryLog=w,u=0,t=[],f=0;f<15;f++)t.push(!1);e=!1;i="";n.enableConsoleOutputByArea();n.setConsoleOutputByLevel(1)})(n.Log||(n.Log={}));var t=n.Log}(AzureHtml5JS||(AzureHtml5JS={}));__extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r},function(n){(function(t){"use strict";function r(t,i,r){typeof r=="undefined"&&(r=0);var u,f=r;if(!i||i.length!==4)return n.Log.error(11,"Parameter error, box type must have four characters"),null;if(!t||t.byteLength<8)return n.Log.error(11,"Parameter error, not enough data"),null;while(f<t.byteLength){if(u=c(t,f),!u)break;if(u.type===i)return u;f+=u.size}return null}function c(t,i){if(!t||t.byteLength-i<8)return n.Log.error(11,"MP4 box parsing error, not enough data for box header"),null;var r=new f(t,i);if(r.size=r.getUint32(),r.type=r.readString(4),r.size===1){if(t.byteLength-i<16)return n.Log.error(11,"MP4 box parsing error, not enough data for largesize"),null;if(r.size=r.getUint32()<<32,r.size+=r.getUint32(),r.size>9007199254740991)return n.Log.error(11,"Box size too big for precise representation as Javascript number"),null}else r.size===0&&(r.size=t.byteLength);if(r.size>t.byteLength-i)return null;if(r.type==="uuid"){if(t.byteLength-r.readPosition<16)return n.Log.error(11,"MP4 box parsing error, not enough data for usertype"),null;r.usertype=r.readString(16)}return r.data=new DataView(t.buffer,t.byteOffset+r.readPosition,t.byteLength-r.readPosition),r}function l(t){var i,u=null;return(i=r(t,"tfhd"),!i)?(n.Log.warning(11,"tfhd not found"),null):(u=e.parse(i),u||n.Log.warning(11,"Parsing of tfhd failed"),u)}function a(t){var i,u=null;return(i=r(t,"trun"),!i)?(n.Log.warning(11,"trun not found"),null):(u=o.parse(i),u||n.Log.warning(11,"Parsing of trun failed"),u)}function v(t){var i,u=null;return(i=r(t,"tfdt"),!i)?(n.Log.warning(11,"tfdt not found"),null):(u=h.parse(i),u||n.Log.warning(11,"Parsing of tfdt failed"),u)}function y(t){for(var i,f=[],e=0,o;e<t.byteLength;){if(i=r(t,u.typeStr,e),!i)return n.Log.warning(11,"pssh not found"),f;o=u.parse(i);o?f.push(o):n.Log.warning(11,"Parsing of pssh failed");e+=i.size}return f}var f=function(){function t(t,i){t&&typeof i!="undefined"&&(this.data=t,this.reader=new n.DataViewReaderWriter.Reader(t,i))}return t.prototype.getUint32=function(){return this.reader.getUint32()},t.prototype.getInt32=function(){return this.reader.getInt32()},t.prototype.getUint8=function(){return this.reader.getUint8()},t.prototype.getBytes=function(n){return this.reader.getBytes(n)},t.prototype.readString=function(n){return this.reader.readString(n)},Object.defineProperty(t.prototype,"readPosition",{get:function(){return this.reader.readPos},enumerable:!0,configurable:!0}),t}(),i,e,o,s,h,u;t.Mp4Box=f;i=function(t){function i(i){t.call(this);i&&(this.size=i.size,this.type=i.type,this.usertype=i.usertype,this.data=i.data,this.reader=new n.DataViewReaderWriter.Reader(this.data),this._versionFlags=i._versionFlags)}return __extends(i,t),i.parse=function(t){var r=null;return t.data.byteLength<4?(n.Log.error(11,"Full box parsing error, not enough bytes"),null):(r=new i,r.size=t.size,r.type=t.type,r.usertype=t.usertype,r._versionFlags=t.data.getUint32(0),r.data=new DataView(t.data.buffer,t.data.byteOffset+4,t.data.byteLength-4),r.reader=new n.DataViewReaderWriter.Reader(r.data),r)},i.serialize=function(t,i){var f=(t.type==="uuid"?16:0)+12,u=i+f,e=new ArrayBuffer(u),o=new DataView(e),r=new n.DataViewReaderWriter.Writer(o);if(u>4294967295)throw new Error("Mp4FullBox::serialize, large size is not supported");if(r.setUint32(u),r.setString(t.type),t.type==="uuid"&&r.setString(t.usertype),r.setUint32(t._versionFlags),r.writePos!==f)throw new Error("Mp4FullBox::serialize, inconsistent bytes written");return r},Object.defineProperty(i.prototype,"version",{get:function(){return this._versionFlags>>24},set:function(n){this._versionFlags&=16777215;this._versionFlags|=n<<24},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"flags",{get:function(){return this._versionFlags&16777215},set:function(n){this._versionFlags&=4278190080;this._versionFlags|=n&16777215},enumerable:!0,configurable:!0}),i.prototype.getUint32Cond=function(n){var t;return n&this.flags&&(t=this.reader.getUint32()),t},i}(f);t.Mp4FullBox=i;e=function(t){function r(n){t.call(this,n)}return __extends(r,t),r.parse=function(t){var u=null,f=null;return(f=i.parse(t),!f)?null:(u=new r(f),f.data.byteLength<u._calculatedSize())?(n.Log.error(11,"tfhd box parsing error, not enough data"),null):(u.trackId=u.getUint32(),u.baseDataOffsetHi=u.getUint32Cond(r.flags_baseDataOffsetPresent),u.baseDataOffsetLo=u.getUint32Cond(r.flags_baseDataOffsetPresent),u.sampleDescriptionIndex=u.getUint32Cond(r.flags_sampleDescriptionIndexPresent),u.defaultSampleDuration=u.getUint32Cond(r.flags_defaultSampleDurationPresent),u.defaultSampleSize=u.getUint32Cond(r.flags_defaultSampleSizePresent),u.defaultSampleFlags=u.getUint32Cond(r.flags_defaultSampleFlagsPresent),u)},r.prototype._calculatedSize=function(){var n=4;return n+=this.flags&r.flags_baseDataOffsetPresent?8:0,n+=this.flags&r.flags_sampleDescriptionIndexPresent?4:0,n+=this.flags&r.flags_defaultSampleDurationPresent?4:0,n+=this.flags&r.flags_defaultSampleSizePresent?4:0,n+(this.flags&r.flags_defaultSampleFlagsPresent?4:0)},r.typeStr="tfhd",r.flags_baseDataOffsetPresent=1,r.flags_sampleDescriptionIndexPresent=2,r.flags_defaultSampleDurationPresent=8,r.flags_defaultSampleSizePresent=16,r.flags_defaultSampleFlagsPresent=32,r.flags_durationIsEmpty=65536,r.flags_defaultBaseIsMoof=131072,r}(i);t.TfhdBox=e;o=function(t){function r(n){t.call(this,n)}return __extends(r,t),r.parse=function(t){var u=null,e=null,o,f;if(e=i.parse(t),!e)return null;if((u=new r(e),e.data.byteLength<4)||(u.sampleCount=u.getUint32(),e.data.byteLength<u._calculatedSize()))return n.Log.error(11,"trun box parsing error, not enough data"),null;for(u.dataOffset=u.getUint32Cond(r.flags_dataOffsetPresent),u.firstSampleFlags=u.getUint32Cond(r.flags_firstSampleFlagsPresent),u.sampleInfoArray=[],o=0;o<u.sampleCount;o++)f=new s,f.sampleDuration=u.getUint32Cond(r.flags_sampleDurationPresent),f.sampleSize=u.getUint32Cond(r.flags_sampleSizePresent),f.sampleFlags=u.getUint32Cond(r.flags_sampleFlagsPresent),u.flags&r.flags_sampleCompositionTimeOffsetsPresent&&(f.sampleCompositionTimeOffset=u.version===0?u.getUint32():u.getInt32()),u.sampleInfoArray.push(f);return u},r.prototype._calculatedSize=function(){var t=4,n;return t+=this.flags&r.flags_dataOffsetPresent?4:0,t+=this.flags&r.flags_firstSampleFlagsPresent?4:0,n=this.flags&r.flags_sampleDurationPresent?4:0,n+=this.flags&r.flags_sampleSizePresent?4:0,n+=this.flags&r.flags_sampleFlagsPresent?4:0,n+=this.flags&r.flags_sampleCompositionTimeOffsetsPresent?4:0,t+this.sampleCount*n},r.typeStr="trun",r.flags_dataOffsetPresent=1,r.flags_firstSampleFlagsPresent=4,r.flags_sampleDurationPresent=256,r.flags_sampleSizePresent=512,r.flags_sampleFlagsPresent=1024,r.flags_sampleCompositionTimeOffsetsPresent=2048,r}(i);t.TrunBox=o;s=function(){function n(){}return n}();t.TrunSampleInfo=s;h=function(t){function r(n){t.call(this,n);this.baseMediaDecodeTime=0}return __extends(r,t),r.parse=function(t){var u=null,f=null;return(f=i.parse(t),!f)?null:(u=new r(f),f.data.byteLength<u._calculatedSize())?(n.Log.error(11,"tfdt box parsing error, not enough data"),null):(u.version===1&&(u.baseMediaDecodeTime=u.getUint32()*4294967296),u.baseMediaDecodeTime+=u.getUint32(),u.baseMediaDecodeTime>=9007199254740992&&n.Log.warning(11,"tfdt timestamp greater than 53 bits, possible precision loss"),u)},r.prototype._calculatedSize=function(){return this.version===1?8:4},r.typeStr="tfdt",r}(i);t.TfdtBox=h;u=function(t){function r(n){n?t.call(this,n):this.type=r.typeStr;this._keyIds=[]}return __extends(r,t),r.parse=function(t){var u=null,f=null,e,o,h,s;if(f=i.parse(t),!f)return null;if(u=new r(f),f.data.byteLength<u._calculatedSize())return n.Log.error(11,"pssh box parsing error, not enough data"),null;if(u.systemId=u.getBytes(16),e=0,u.version>0){if(e=u.getUint32(),u._keyIds.length=e,f.data.byteLength<u._calculatedSize())return n.Log.error(11,"pssh box parsing error, not enough data"),null;for(o=0;o<e;o++)h=u.getBytes(16),u._keyIds[o]=h}return(s=u.getUint32(),f.data.byteLength<u._calculatedSize(s))?(n.Log.error(11,"pssh box parsing error, not enough data"),null):(u.specificData=u.getBytes(s),u)},r.prototype.addKeyId=function(n){if(n.length!==16)throw new Error("keyId must be 16 bytes");this.version=1;this._keyIds.push(n)},Object.defineProperty(r.prototype,"keyIds",{get:function(){return this._keyIds},enumerable:!0,configurable:!0}),r.prototype._calculatedSize=function(n){typeof n=="undefined"&&(n=0);var t=20+n;return this.version>0&&(t+=4+this._keyIds.length*16),t},r.prototype.serialize=function(){var n=i.serialize(this,this._calculatedSize(this.specificData.byteLength));if(!this.systemId)throw new Error("systemId is not set");if(n.setBytes(this.systemId),this.version>0&&(n.setUint32(this._keyIds.length),this._keyIds.forEach(function(t){n.setBytes(t)})),!this.specificData)throw new Error("specificData is not set");if(n.setUint32(this.specificData.byteLength),n.setBytes(this.specificData),n.writePos!=n.data.buffer.byteLength)throw new Error("Failed to write to end of buffer");return n.data.buffer},r.typeStr="pssh",r}(i);t.PsshBox=u;t.GetBoxByType=r;t.GetTfhdBox=l;t.GetTrunBox=a;t.GetTfdtBox=v;t.GetPsshBoxes=y})(n.Mp4Util||(n.Mp4Util={}));var t=n.Mp4Util}(AzureHtml5JS||(AzureHtml5JS={})),function(n){(function(t){"use strict";function i(){return n.VideoElementAdapter.supported('video/mp4; codecs="avc1.4d404f"')}function r(n){var i=!1,t;return n&&n.canPlayType&&(t=n.canPlayType("application/vnd.apple.mpegurl"),(t==="maybe"||t==="probably")&&(i=!0)),i}function u(n){var i=!1,t;return n&&n.canPlayType&&(t=n.canPlayType("video/mp4"),(t==="maybe"||t==="probably")&&(i=!0)),i}(function(n){n[n.type1=1]="type1";n[n.type2=2]="type2";n[n.type3=3]="type3"})(t.Type||(t.Type={}));var f=t.Type;t.MseSupported=i;t.HlsType1Supported=r;t.Mp4Type1Supported=u})(n.PlayerDetector||(n.PlayerDetector={}));var t=n.PlayerDetector}(AzureHtml5JS||(AzureHtml5JS={})),function(n){(function(t){"use strict";function s(n,t){var r;if(n&&n.length>0&&(r=n.trim().toLowerCase(),f[r]))return i(f[r],t)}function h(n,t){var f=n.trim().toLowerCase(),s,h;return f.lastIndexOf(".ism/")>-1&&(s=o(f),r[s])?i(r[s],t):(h=e(f),u[h])?i(u[h],t):null}function e(n){var i=null,t=n.lastIndexOf("."),r=n.indexOf("/",t);return t>-1&&(i=n.substring(t+1,r!==-1?r:n.length)),i}function o(n){var t=null,i=n,e="(format=",o=n.lastIndexOf("?"),r,u,f;return o>-1&&(i=n.substring(0,o)),r=i.lastIndexOf(e),r>-1&&(u=i.lastIndexOf(")"),u>r&&(t=i.substring(r+e.length,u),f=t.indexOf(","),f>-1&&(t=t.substring(0,f)))),t}function i(t,i){var r=null;switch(t){case 1:n.PlayerDetector.HlsType1Supported(i)&&(r=1);break;case 2:n.PlayerDetector.Mp4Type1Supported(i)&&(r=1);break;case 3:n.PlayerDetector.MseSupported(i)&&(r=3)}return r}(function(n){n[n.hls=1]="hls";n[n.mp4=2]="mp4";n[n.dash=3]="dash"})(t.Format||(t.Format={}));var c=t.Format,r={"m3u8-aapl-v3":1,"m3u8-aapl-v4":1,"mpd-time-csf":3},u={mp4:2,m3u8:1},f={"video/mp4":2,"application/dash+xml":3,"application/vnd.apple.mpegurl":1};t.getByPresentationType=s;t.getByUrl=h;t._getFileExtension=e;t._getAzureMediaFormatTag=o;t._getPlayerTypeByFormat=i})(n.PlayerType||(n.PlayerType={}));var t=n.PlayerType}(AzureHtml5JS||(AzureHtml5JS={})),function(n){(function(n){"use strict";var t=function(){function t(){}return t.FormatDashMediaUrl=function(n,t,i){if(!n)throw new Error("url Template is not set");var r=n;return t!==null&&t!==undefined&&t!==""&&(r=r.replace("$Bandwidth$",t)),i!==null&&i!==undefined&&i!==""&&(r=r.replace("$Time$",i)),r},t.FormatDashInitUrl=function(t,i){return n.UrlFormatter.FormatDashMediaUrl(t,i,null)},t}();n.UrlFormatter=t})(n.Util||(n.Util={}));var t=n.Util}(AzureHtml5JS||(AzureHtml5JS={})),function(n){(function(n){"use strict";function t(n,t){var i="WebKitMediaKeys"in window,r="MSMediaKeys"in window,u="MediaKeys"in window;return u?window.MediaKeys.isTypeSupported(n,t):i?window.WebKitMediaKeys.isTypeSupported(n,t):r?window.MSMediaKeys.isTypeSupported(n,t):!1}function i(n){var t="WebKitMediaKeys"in window,i="MSMediaKeys"in window,r="MediaKeys"in window;if(r)return new window.MediaKeys(n);if(t)return new window.WebKitMediaKeys(n);if(i)return new window.MSMediaKeys(n);throw new Error("create MediaKeys not supported");}function r(n,t){var i="WebKitSetMediaKeys"in n,r="msSetMediaKeys"in n,u="SetMediaKeys"in n;if(u)n.SetMediaKeys(t);else if(i)n.WebKitSetMediaKeys(t);else if(r)n.msSetMediaKeys(t);else throw new Error("SetMediaKeys not supported");}function u(n,t){n.addEventListener("webkitneedkey",t);n.addEventListener("msneedkey",t);n.addEventListener("needKey",t)}function f(n,t){n.addEventListener("webkitkeymessage",t);n.addEventListener("mskeymessage",t);n.addEventListener("keymessage",t)}function e(n,t){n.addEventListener("webkitkeyadded",t);n.addEventListener("mskeyadded",t);n.addEventListener("keyadded",t)}function o(n,t){n.addEventListener("webkitkeyerror",t);n.addEventListener("mskeyerror",t);n.addEventListener("keyerror",t)}function s(n,t){n.removeEventListener("webkitneedkey",t);n.removeEventListener("msneedkey",t);n.removeEventListener("needKey",t)}function h(n,t){n.removeEventListener("webkitkeymessage",t);n.removeEventListener("mskeymessage",t);n.removeEventListener("keymessage",t)}function c(n,t){n.removeEventListener("webkitkeyadded",t);n.removeEventListener("mskeyadded",t);n.removeEventListener("keyadded",t)}function l(n,t){n.removeEventListener("webkitkeyerror",t);n.removeEventListener("mskeyerror",t);n.removeEventListener("keyerror",t)}n.isTypeSupported=t;n.createMediaKeys=i;n.setMediaKeys=r;n.listenToNeedKey=u;n.listenToKeyMessage=f;n.listenToKeyAdded=e;n.listenKeyError=o;n.unlistenToNeedKey=s;n.unlistenToKeyMessage=h;n.unlistenToKeyAdded=c;n.unlistenKeyError=l})(n.EmeUtil||(n.EmeUtil={}));var t=n.EmeUtil}(AzureHtml5JS||(AzureHtml5JS={})),function(n){(function(t){"use strict";var i=function(){function t(){var t="msCrypto"in window,n=t?window.msCrypto:window.crypto;this._webCryptor=n.subtle||n.webkitSubtle}return t.prototype.dispose=function(){this._webCryptor=null},t.prototype.initialize=function(t,i,r){var f=this,u={name:"aes-cbc",iv:r};return new Promise(function(e,o){f._webCryptoImportKey(i,u).then(function(n){t.webCrypto={importedkey:n,algorithm:u};e()},function(u){var f=forge.cipher.createDecipher("AES-CBC",n.Common.uint8ArrayToString(new Uint8Array(i)));if(!f){o(u);return}t.forge={decipher:f,ivStr:n.Common.uint8ArrayToString(new Uint8Array(r))};e()})})},t.prototype.isInitialized=function(n){return null!=n.forge||null!=n.webCrypto},t.prototype.decrypt=function(n,t){var i=this;return new Promise(function(r,u){n.webCrypto?i._webCryptoDecrypt(n.webCrypto.algorithm,n.webCrypto.importedkey,t).then(function(n){r(n)},function(n){u(n)}):i._forgeDecrypt(n.forge,t).then(function(n){r(n)},function(n){u(n)})})},t.prototype._webCryptoImportKey=function(n,t){var i=this;return new Promise(function(r,u){function e(n){var t=f.result?f.result:n;r(t)}function o(n){u(n)}if(!i._webCryptor){u("Platform doesn't support webCrypto");return}var f=i._webCryptor.importKey("raw",new Uint8Array(n),t,!0,["decrypt"]);"oncomplete"in f?(f.oncomplete=e,f.onerror=o):f.then(function(n){e(n)},function(n){o(n)})})},t.prototype._forgeDecrypt=function(t,i){return new Promise(function(r,u){if(t.decipher.start({iv:t.ivStr}),t.decipher.update(new forge.util.ByteBuffer(i)),t.decipher.finish()){var f=n.Common.stringToUint8Array(t.decipher.output.bytes());r(f.buffer)}else u()})},t.prototype._webCryptoDecrypt=function(n,t,i){var r=this;return new Promise(function(u,f){function s(n){var t=e.result?e.result:n;u(t)}function o(n){f(n)}var e=r._webCryptor.decrypt(n,t,new Uint8Array(i));"oncomplete"in e?(e.oncomplete=s,e.onerror=o,e.onabort=o):e.then(function(n){s(n)},function(n){o(n)})})},t}();t.Decryptor=i})(n.WebCryptoUtil||(n.WebCryptoUtil={}));var t=n.WebCryptoUtil}(AzureHtml5JS||(AzureHtml5JS={})),function(n){(function(t){"use strict";function i(t,i,r,u,f){return new Promise(function(e,o){function h(){if(s.status==200){e(s.response);return}n.Log.error(13,"XHR load failed status:"+s.statusText+"("+s.status+"), expected to be 200, readyState:"+s.readyState);o(n.Failure.translateHttpStatusToCode(s.status));return}function c(){n.Log.error(13,"XHR failed status: "+s.statusText+" ("+s.status+"), readyState: "+s.readyState);o(2164262090);return}var s=new XMLHttpRequest;s.onload=h;s.onerror=c;s.open(i,t);s.responseType=r;u&&u.forEach(function(n){s.setRequestHeader(n.name,n.value)});s.send(f)})}t.authorizationHeader="Authorization";t.httpRequest=i})(n.HttpUtil||(n.HttpUtil={}));var t=n.HttpUtil}(AzureHtml5JS||(AzureHtml5JS={})),function(n){(function(t){function i(t,i){var u,s,f,e;if(!i||0===i.length)return!0;var r=decodeURIComponent(i),o=r.indexOf("urn:microsoft:azure:mediaservices:keyacquisitionhostname");return-1===o?!0:(u=r.indexOf("&",o),-1===u&&(u=r.length),s=r.substring(o,u),f=s.split("="),f.length!=2)?(n.Log.error(12,"AMS hostname token is malformed: "+s),!1):(e=document.createElement("a"),e.href=t,f[1].toLowerCase()!=e.hostname.toLowerCase())?(n.Log.error(12,"AMS hostname mismatch: "+f[1].toLowerCase()+", "+e.hostname.toLowerCase()),!1):!0}t.verifyKeyUrlWithToken=i})(n.AesUtil||(n.AesUtil={}));var t=n.AesUtil}(AzureHtml5JS||(AzureHtml5JS={}));amp=videojs;amp.Player.prototype.enterFullscreen=amp.Player.prototype.requestFullScreen;amp.Player.prototype.addEventListener=amp.Player.prototype.on;amp.Player.prototype.removeEventListener=amp.Player.prototype.off;amp.Player.prototype.currentTechName=function(){return this.techName};amp.Player.prototype.videoWidth=function(){return this.techGet("videoWidth")};amp.Player.prototype.videoHeight=function(){return this.techGet("videoHeight")};amp.MediaError.prototype.extendedCode=0;amp.MediaError.prototype.extendedMessage="";amp.ErrorDisplay.prototype.update=function(){var n=this.player().error(),t;n&&(t=this.localize(n.message),n.extendedMessage&&(t+=" ExtendedMessage: "+n.extendedMessage),this.contentEl_.innerHTML=t)};amp.Player.prototype.currentProtectionInfo=function(){return this.options_.playbackOptions.protectionInfo};amp.Player.prototype.src=function(n){if(n===undefined)throw new Error("Get on src is not supported, please use currentSrc to get the current source.");if(amp.obj.isArray(n))this.sourceList_(UrlRewriter.expandSources(n));else if(n instanceof Object)n.type&&!n.selected?this.sourceList_(UrlRewriter.expandSources([n])):(this.clearPlaybackOptions(),this.cache_.src=n.src,this.currentType_=n.type||"",this.ready(function(){n.protectionInfo&&(this.options_.playbackOptions.protectionInfo=n.protectionInfo);this.techCall("src",n.src);this.options_.preload=="auto"&&this.load();this.options_.autoplay&&this.play()}));else throw new Error("src is expecting a Source object or array of source Objects");return this};vjs.Player.prototype.sourceList_=function(n){var t=this.selectSource(n);t?t.tech===this.techName?t.tech==="FlashSS"&&this.options_.playbackOptions.protectionInfo!==t.source.protectionInfo?(this.clearPlaybackOptions(),this.loadTech(t.tech,t.source)):(t.source.selected=!0,this.src(t.source)):(this.clearPlaybackOptions(),this.loadTech(t.tech,t.source)):(this.error({code:4,message:this.localize(this.options().notSupportedMessage)}),this.triggerReady())};amp.options.playbackOptions={};amp.Player.prototype.clearPlaybackOptions=function(){this.options_.playbackOptions={}};amp.protectionType={PlayReady:"PlayReady",AES:"AES"};amp.eventName={canplaythrough:"canplaythrough",durationchange:"durationchange",ended:"ended",error:"error",fullscreenchange:"fullscreenchange",loadstart:"loadstart",loadeddata:"loadeddata",pause:"pause",play:"play",playing:"playing",seeked:"seeked",seeking:"seeking",timeupdate:"timeupdate",volumechange:"volumechange",waiting:"waiting"};amp.Player.canSupportFormats=function(n,t){var r=t[n.type],i;if(r){if(!n.protectionInfo)return"maybe";for(i=0;i<n.protectionInfo.length;i++)if(r.indexOf(n.protectionInfo[i].type)!==-1)return"maybe"}return""};window.Silverlight||(window.Silverlight={});Silverlight._silverlightCount=0;Silverlight.__onSilverlightInstalledCalled=!1;Silverlight.fwlinkRoot="http://go2.microsoft.com/fwlink/?LinkID=";Silverlight.__installationEventFired=!1;Silverlight.onGetSilverlight=null;Silverlight.onSilverlightInstalled=function(){window.location.reload(!1)};Silverlight.isInstalled=function(n){var t,l,f,e,h,o,i,r,s,c,u;n==undefined&&(n=null);t=!1;l=null;try{if(f=null,e=!1,window.ActiveXObject)try{f=new ActiveXObject("AgControl.AgControl");n===null?t=!0:f.IsVersionSupported(n)&&(t=!0);f=null}catch(a){e=!0}else e=!0;if(e&&(h=navigator.plugins["Silverlight Plug-In"],h))if(n===null)t=!0;else{for(o=h.description,o==="1.0.30226.2"&&(o="2.0.30226.2"),i=o.split(".");i.length>3;)i.pop();while(i.length<4)i.push(0);for(r=n.split(".");r.length>4;)r.pop();u=0;do s=parseInt(r[u]),c=parseInt(i[u]),u++;while(u<r.length&&s===c);s<=c&&!isNaN(s)&&(t=!0)}}catch(a){t=!1}return t};Silverlight.WaitForInstallCompletion=function(){if(!Silverlight.isBrowserRestartRequired&&Silverlight.onSilverlightInstalled){try{navigator.plugins.refresh()}catch(n){}Silverlight.isInstalled(null)&&!Silverlight.__onSilverlightInstalledCalled?(Silverlight.onSilverlightInstalled(),Silverlight.__onSilverlightInstalledCalled=!0):setTimeout(Silverlight.WaitForInstallCompletion,3e3)}};Silverlight.__startup=function(){if(navigator.plugins.refresh(),Silverlight.isBrowserRestartRequired=Silverlight.isInstalled(null),Silverlight.isBrowserRestartRequired){if(window.navigator.mimeTypes){var n=navigator.mimeTypes["application/x-silverlight-2"],i=navigator.mimeTypes["application/x-silverlight-2-b2"],r=navigator.mimeTypes["application/x-silverlight-2-b1"],t=r;i&&(t=i);!n&&(r||i)?Silverlight.__installationEventFired||(Silverlight.onUpgradeRequired(),Silverlight.__installationEventFired=!0):n&&t&&n.enabledPlugin&&t.enabledPlugin&&n.enabledPlugin.description!=t.enabledPlugin.description&&(Silverlight.__installationEventFired||(Silverlight.onRestartRequired(),Silverlight.__installationEventFired=!0))}}else Silverlight.WaitForInstallCompletion(),Silverlight.__installationEventFired||(Silverlight.onInstallRequired(),Silverlight.__installationEventFired=!0);Silverlight.disableAutoStartup||(window.removeEventListener?window.removeEventListener("load",Silverlight.__startup,!1):window.detachEvent("onload",Silverlight.__startup))};Silverlight.disableAutoStartup||(window.addEventListener?window.addEventListener("load",Silverlight.__startup,!1):window.attachEvent("onload",Silverlight.__startup));Silverlight.createObject=function(n,t,i,r,u,f,e){var c={},o=r,h=u,s,a,l;if(c.version=o.version,o.source=n,c.alt=o.alt,f&&(o.initParams=f),o.isWindowless&&!o.windowless&&(o.windowless=o.isWindowless),o.framerate&&!o.maxFramerate&&(o.maxFramerate=o.framerate),i&&!o.id&&(o.id=i),delete o.ignoreBrowserVer,delete o.inplaceInstallPrompt,delete o.version,delete o.isWindowless,delete o.framerate,delete o.data,delete o.src,delete o.alt,Silverlight.isInstalled(c.version)){for(s in h)if(h[s])if(s=="onLoad"&&typeof h[s]=="function"&&h[s].length!=1&&(a=h[s],h[s]=function(n){return a(document.getElementById(i),e,n)}),l=Silverlight.__getHandlerName(h[s]),l!=null)o[s]=l,h[s]=null;else throw"typeof events."+s+" must be 'function' or 'string'";slPluginHTML=Silverlight.buildHTML(o)}else slPluginHTML=Silverlight.buildPromptHTML(c);if(t)t.innerHTML=slPluginHTML;else return slPluginHTML};Silverlight.buildHTML=function(n){var t=[],i;t.push('<object type="application/x-silverlight" data="data:application/x-silverlight,"');n.id!=null&&t.push(' id="'+Silverlight.HtmlAttributeEncode(n.id)+'"');n.width!=null&&t.push(' width="'+n.width+'"');n.height!=null&&t.push(' height="'+n.height+'"');t.push(" >");delete n.id;delete n.width;delete n.height;for(i in n)n[i]&&t.push('<param name="'+Silverlight.HtmlAttributeEncode(i)+'" value="'+Silverlight.HtmlAttributeEncode(n[i])+'" />');return t.push("<\/object>"),t.join("")};Silverlight.createObjectEx=function(n){var t=n,i=Silverlight.createObject(t.source,t.parentElement,t.id,t.properties,t.events,t.initParams,t.context);if(t.parentElement==null)return i};Silverlight.buildPromptHTML=function(n){var t="",r=Silverlight.fwlinkRoot,i=n.version;return n.alt?t=n.alt:(i||(i=""),t="<a href='javascript:Silverlight.getSilverlight(\"{1}\");' style='text-decoration: none;'><img src='{2}' alt='Get Microsoft Silverlight' style='border-style: none'/><\/a>",t=t.replace("{1}",i),t=t.replace("{2}",r+"108181")),t};Silverlight.getSilverlight=function(n){var i,t,r,u;Silverlight.onGetSilverlight&&Silverlight.onGetSilverlight();i="";t=String(n).split(".");t.length>1&&(r=parseInt(t[0]),i=isNaN(r)||r<2?"1.0":t[0]+"."+t[1]);u="";i.match(/^\d+\056\d+$/)&&(u="&v="+i);Silverlight.followFWLink("149156"+u)};Silverlight.followFWLink=function(n){top.location=Silverlight.fwlinkRoot+String(n)};Silverlight.HtmlAttributeEncode=function(n){var t,i="",r;if(n==null)return null;for(r=0;r<n.length;r++)t=n.charCodeAt(r),i=t>96&&t<123||t>64&&t<91||t>43&&t<58&&t!=47||t==95?i+String.fromCharCode(t):i+"&#"+t+";";return i};Silverlight.default_error_handler=function(n,t){var u,r=t.ErrorType,i;u=t.ErrorCode;i="\nSilverlight error message     \n";i+="ErrorCode: "+u+"\n";i+="ErrorType: "+r+"       \n";i+="Message: "+t.ErrorMessage+"     \n";r=="ParserError"?(i+="XamlFile: "+t.xamlFile+"     \n",i+="Line: "+t.lineNumber+"     \n",i+="Position: "+t.charPosition+"     \n"):r=="RuntimeError"&&(t.lineNumber!=0&&(i+="Line: "+t.lineNumber+"     \n",i+="Position: "+t.charPosition+"     \n"),i+="MethodName: "+t.methodName+"     \n");alert(i)};Silverlight.__cleanup=function(){for(var n=Silverlight._silverlightCount-1;n>=0;n--)window["__slEvent"+n]=null;Silverlight._silverlightCount=0;window.removeEventListener?window.removeEventListener("unload",Silverlight.__cleanup,!1):window.detachEvent("onunload",Silverlight.__cleanup)};Silverlight.__getHandlerName=function(n){var t="",i;return typeof n=="string"?t=n:typeof n=="function"?(Silverlight._silverlightCount==0&&(window.addEventListener?window.addEventListener("onunload",Silverlight.__cleanup,!1):window.attachEvent("onunload",Silverlight.__cleanup)),i=Silverlight._silverlightCount++,t="__slEvent"+i,window[t]=n):t=null,t};Silverlight.onRequiredVersionAvailable=function(){};Silverlight.onRestartRequired=function(){};Silverlight.onUpgradeRequired=function(){};Silverlight.onInstallRequired=function(){};Silverlight.IsVersionAvailableOnError=function(n,t){var i=!1;try{t.ErrorCode!=8001||Silverlight.__installationEventFired?t.ErrorCode!=8002||Silverlight.__installationEventFired?t.ErrorCode==5014||t.ErrorCode==2106?Silverlight.__verifySilverlight2UpgradeSuccess(t.getHost())&&(i=!0):i=!0:(Silverlight.onRestartRequired(),Silverlight.__installationEventFired=!0):(Silverlight.onUpgradeRequired(),Silverlight.__installationEventFired=!0)}catch(r){}return i};Silverlight.IsVersionAvailableOnLoad=function(n){var t=!1;try{Silverlight.__verifySilverlight2UpgradeSuccess(n.getHost())&&(t=!0)}catch(i){}return t};Silverlight.__verifySilverlight2UpgradeSuccess=function(n){var i=!1,r="2.0.31005",t=null;try{n.IsVersionSupported(r+".99")?(t=Silverlight.onRequiredVersionAvailable,i=!0):t=n.IsVersionSupported(r+".0")?Silverlight.onRestartRequired:Silverlight.onUpgradeRequired;t&&!Silverlight.__installationEventFired&&(t(),Silverlight.__installationEventFired=!0)}catch(u){}return i};amp.SilverlightSS=amp.MediaTechController.extend({init:function(n,t,i){var u=this,o=[],f=[],s=[],e,r;n.mediaPlayer=null;amp.MediaTechController.call(this,n,t,i);parentEl=t.parentEl;placeHolder=this.el_=amp.createEl("div",{id:n.id()+"_temp_silverlightSS"});objId=n.id()+"_silverlightSS_api";e=n.options_.autoplay;e!==undefined&&f.push("Autoplay="+e);o=amp.obj.merge({id:objId,name:objId,"class":"vjs-tech"},t.attributes);s=amp.obj.merge({source:n.options_.silverlightSS.xap,onError:"onSilverlightError",minRuntimeVersion:"5.0.61118.0",onload:"silverlightSSLoaded",width:"100%",height:"100%",windowless:"true",wmode:"opaque",bgcolor:"#000000"},t.params);f.push("ScriptableName=mainPlayer");f.push("IsControlStripVisible=false");r=t.source;amp.insertFirst(placeHolder,parentEl);this.el_=amp.SilverlightSS.embed(placeHolder,o,s,f);silverlightSSLoaded=function(t){var i=document.getElementById(n.id()+"_silverlightSS_api");n.mediaPlayer=i.content.mainPlayer;r&&(r.protectionInfo&&(n.options_.playbackOptions.protectionInfo=r.protectionInfo),u.setSrc(r.src));u.triggerReady();u.setTriggers(t)};onSilverlightError=function(n,t){var f="";n!=null&&n!=0&&(f=n.getHost().Source);var r=t.ErrorType,e=t.ErrorCode,i="Unhandled Error in Silverlight Application "+f+"\n";i+="Code: "+e+"    \n";i+="Category: "+r+"       \n";i+="Message: "+t.ErrorMessage+"     \n";r=="ParserError"?(i+="File: "+t.xamlFile+"     \n",i+="Line: "+t.lineNumber+"     \n",i+="Position: "+t.charPosition+"     \n"):r=="RuntimeError"&&(t.lineNumber!=0&&(i+="Line: "+t.lineNumber+"     \n",i+="Position: "+t.charPosition+"     \n"),i+="MethodName: "+t.methodName+"     \n");u.player().error(new amp.MediaError(i))}}});amp.SilverlightSS.embed=function(n,t,i,r){var f=amp.SilverlightSS.getEmbedCode(t,i,r),u;return obj=amp.createEl("div",{innerHTML:f}).childNodes[0],par=n.parentNode,n.parentNode.replaceChild(obj,n),u=par.childNodes[0],setTimeout(function(){u.style.display="block"},1e3),obj};amp.SilverlightSS.getEmbedCode=function(n,t,i){var r='<object  data="data:application/x-silverlight-2," type="application/x-silverlight-2" ';return amp.obj.each(n,function(n,t){r+=n+'="'+t+'" '}),r+=">",t=amp.obj.merge({InitParams:i.join(",")},t),amp.obj.each(t,function(n,t){r+='<param name="'+n+'" value="'+t+'" />'}),r+="<\/object>"};amp.SilverlightSS.isSupported=function(){return Silverlight.isInstalled("5.0")};amp.SilverlightSS.canPlaySource=function(n){return amp.Player.canSupportFormats(n,this.supportedFormats)};amp.SilverlightSS.supportedFormats={"application/vnd.ms-sstr+xml":[amp.protectionType.PlayReady]};amp.SilverlightSS._seeking=!1;amp.SilverlightSS._ended=!1;amp.SilverlightSS._adaptiveStreamingError=null;amp.SilverlightSS.prototype.autoplay=function(){return this.player().mediaPlayer.AutoPlay};amp.SilverlightSS.prototype.setAutoplay=function(n){this.player().mediaPlayer.AutoPlay=n};amp.SilverlightSS.prototype.buffered=function(){return amp.createTimeRange(this.currentTime(),this.currentTime())};amp.SilverlightSS.prototype.currentSrc=function(){return this.player().mediaPlayer.MediaSource};amp.SilverlightSS.prototype.setCurrentTime=function(n){amp.SilverlightSS._seeking=!0;this.player().trigger("seeking");this.player().mediaPlayer.SeekToPosition(n)};amp.SilverlightSS.prototype.currentTime=function(){return this.player().mediaPlayer.PlaybackPositionSeconds};amp.SilverlightSS.prototype.duration=function(){return this.player().mediaPlayer.EndPositionSeconds-this.player().mediaPlayer.StartPositionSeconds};amp.SilverlightSS.prototype.ended=function(){return amp.SilverlightSS._ended};amp.SilverlightSS.prototype.error=function(){return this.player().error()};amp.SilverlightSS.prototype.isFullscreen=function(){return this.player().mediaPlayer.isFullscreen};amp.SilverlightSS.prototype.muted=function(){return this.player().mediaPlayer.IsMuted};amp.SilverlightSS.prototype.setMuted=function(){this.volume(0)};amp.SilverlightSS.prototype.paused=function(){return this.player().mediaPlayer.PlayState===this.SilverlightSSMediaState.Paused};amp.SilverlightSS.prototype.seeking=function(){return amp.SilverlightSS._seeking};amp.SilverlightSS.prototype.src=function(n){if(n===undefined)return this.currentSrc();this.setSrc(n)};amp.SilverlightSS.prototype.volume=function(){return this.player().mediaPlayer.GetVolume()};amp.SilverlightSS.prototype.setVolume=function(n){this.player().mediaPlayer.SetVolume(n)};amp.SilverlightSS.prototype.height=function(n){if(n===undefined)return this.player().mediaPlayer.height;this.player().mediaPlayer.height=n};amp.SilverlightSS.prototype.width=function(n){if(n===undefined)return this.player().mediaPlayer.width;this.player().mediaPlayer.width=n};amp.SilverlightSS.prototype.videoHeight=function(){return this.player().mediaPlayer.VideoHeight};amp.SilverlightSS.prototype.videoWidth=function(){return this.player().mediaPlayer.VideoWidth};amp.SilverlightSS.prototype.play=function(){this.player().mediaPlayer.Play()};amp.SilverlightSS.prototype.pause=function(){this.player().mediaPlayer.Pause()};amp.SilverlightSS.prototype.setSrc=function(n){var u,r,t,i;if(this.reset(),this.player().options_.autoplay&&(this.player().mediaPlayer.AutoPlay=this.player().options_.autoplay),u=this.player().mediaPlayer.CreatePlaylist(),r=this.player().mediaPlayer.CreatePlaylistItem(n,"","",""),r.DeliveryMethod="AdaptiveStreaming",t=this.player().options_.playbackOptions.protectionInfo,t)for(i=0;i<t.length;i++)t[i].type===amp.protectionType.PlayReady&&t[i].authenticationToken&&(r.BearerToken=t[i].authenticationToken);u.AddPlaylistItem(r);this.player().mediaPlayer.SetPlaylist(u)};amp.SilverlightSS.prototype.load=function(){};amp.SilverlightSS.prototype.supportsFullscreen=function(){return!1};amp.SilverlightSS.prototype.enterFullscreen=function(){};amp.SilverlightSS.prototype.exitFullscreen=function(){};amp.SilverlightSS.prototype.dispose=function(){vjs.MediaTechController.prototype.dispose.call(this)};amp.SilverlightSS.prototype.setTriggers=function(){this.player().mediaPlayer.addEventListener("PlayStateChanged",amp.bind(this,this.playStateChangedHandler));this.player().mediaPlayer.addEventListener("MediaOpened",amp.bind(this,this.onMediaOpened));this.player().mediaPlayer.addEventListener("SeekCompleted",amp.bind(this,this.onSeekCompleted));this.player().mediaPlayer.addEventListener("MediaEnded",amp.bind(this,this.onMediaEnded));this.player().mediaPlayer.addEventListener("PlaybackPositionChanged",amp.bind(this,this.onTimeUpdate));this.player().mediaPlayer.addEventListener("VolumeLevelChanged",amp.bind(this,this.onVolumeChanged));this.player().mediaPlayer.addEventListener("MediaFailed",amp.bind(this,this.onMediaFailed));this.player().mediaPlayer.addEventListener("AdaptiveStreamingErrorOccurred",amp.bind(this,this.onAdaptiveStreamingErrorOccurred));this.player().mediaPlayer.addEventListener("FullScreenChanged",amp.bind(this,this.onFullScreenChanged));var n;this.player().mediaPlayer.addEventListener("timeupdate",amp.bind(this,function(){this.duration()!==n&&(n=this.duration(),this.player().trigger("durationchange"))}))};amp.SilverlightSS.prototype.playStateChangedHandler=function(){switch(this.player().mediaPlayer.PlayState){case this.SilverlightSSMediaState.Playing:this.player().trigger("play");this.player().trigger("playing");break;case this.SilverlightSSMediaState.Paused:this.player().trigger("pause");break;case this.SilverlightSSMediaState.Buffering:this.player().trigger("waiting");break;default:this.player().trigger(this.player().mediaPlayer.PlayState.toString())}};amp.SilverlightSS.prototype.onMediaOpened=function(){this.player().trigger("loadstart");this.player().trigger("loadeddata");this.player().trigger("canplaythrough")};amp.SilverlightSS.prototype.onMediaFailed=function(n,t){var i=new amp.MediaError;i.extendedMessage=t.Result.Message;amp.SilverlightSS._adaptiveStreamingError&&(i.extendedMessage=amp.SilverlightSS._adaptiveStreamingError.Message);this.player().error(i)};amp.SilverlightSS.prototype.onAdaptiveStreamingErrorOccurred=function(n,t){amp.SilverlightSS._adaptiveStreamingError=t.Result};amp.SilverlightSS.prototype.onSeekCompleted=function(){amp.SilverlightSS._seeking=!1;this.player().trigger("seeked")};amp.SilverlightSS.prototype.onMediaEnded=function(){amp.SilverlightSS._ended=!0;this.player().trigger("ended")};amp.SilverlightSS.prototype.onTimeUpdate=function(){this.player().trigger("timeupdate")};amp.SilverlightSS.prototype.onFullScreenChanged=function(){this.player().trigger("fullscreenchange")};amp.SilverlightSS.prototype.onVolumeChanged=function(){this.player().trigger("volumechange")};amp.SilverlightSS.prototype.reset=function(){amp.SilverlightSS._seeking=!1;amp.SilverlightSS._ended=!1;amp.SilverlightSS._adaptiveStreamingError=null};amp.SilverlightSS.prototype.SilverlightSSMediaState={Closed:0,Opening:1,Buffering:2,Playing:3,Paused:4,Stopped:5,Individualizing:6,AcquiringLicense:7};amp.options.techOrder.unshift("silverlightSS");amp.options.silverlightSS={};amp.FlashSS=amp.MediaTechController.extend({init:function(n,t,i){var f;amp.MediaTechController.call(this,n,t,i);var r=t.source,h=t.parentEl,o=this.el_=amp.createEl("div",{id:n.id()+"_temp_flash"}),s=n.id()+"_flashSS_api",u=n.options_,e=amp.obj.merge({playerId:n.id(),controlBarMode:"none",playButtonOverlay:"false",plugin_AdaptiveStreamingPlugin:u.flashSS.plugin,AdaptiveStreamingPlugin_retryLive:"true",javascriptCallbackFunction:"amp.FlashSS.onEvent",autoPlay:u.autoplay,preload:u.preload,loop:u.loop,muted:u.muted},t.flashVars),c=amp.obj.merge({wmode:"opaque",bgcolor:"#000000"},t.params),l=amp.obj.merge({id:s,name:s,"class":"vjs-tech"},t.attributes);if(t.swf=u.flashSS.swf,n.flashSS=this,n.flashSS.lastSeekTarget_=NaN,r&&(e.src=encodeURIComponent(amp.getAbsoluteURL(r.src)),r.protectionInfo)){for(f=0;f<r.protectionInfo.length;f++)r.protectionInfo[f].type===amp.protectionType.AES&&r.protectionInfo[f].authenticationToken&&(e.AdaptiveStreamingPlugin_encryptionKeyToken=encodeURIComponent(r.protectionInfo[f].authenticationToken.replace(/'/g,"%27").replace(/"/g,"%22")));u.playbackOptions.protectionInfo=r.protectionInfo}amp.insertFirst(o,h);t.startTime&&this.ready(function(){this.load();this.play();this.currentTime(t.startTime)});amp.IS_FIREFOX&&this.ready(function(){amp.on(this.el(),"mousemove",amp.bind(this,function(){this.player().trigger({type:"mousemove",bubbles:!1})}))});n.on("stageclick",n.reportUserActivity);this.el_=amp.Flash.embed(t.swf,o,e,c,l)}});amp.FlashSS.isSupported=function(){return amp.Flash.isSupported()};amp.FlashSS.canPlaySource=function(n){return amp.Player.canSupportFormats(n,this.supportedFormats)};amp.FlashSS.supportedFormats={"application/vnd.ms-sstr+xml":[amp.protectionType.AES]};amp.FlashSS.prototype.dispose=function(){amp.MediaTechController.prototype.dispose.call(this)};amp.FlashSS.prototype.networkState=function(){return 1};amp.FlashSS.prototype.autoplay=function(n){if(this.el_){if(n===undefined)return this.el_.getAutoPlay();this.el_.setAutoPlay(n)}};amp.FlashSS.prototype.buffered=function(){return amp.createTimeRange(0,this.el_.getBufferTime())};amp.FlashSS.prototype.setCurrentTime=function(n){this.lastSeekTarget_=n;this.el_.setCurrentTime(n)};amp.FlashSS.prototype.currentTime=function(){return this.seeking()?this.lastSeekTarget_||0:this.el_.getCurrentTime()};amp.FlashSS.prototype.ended=function(){return amp.FlashSS._ended};amp.FlashSS.prototype.isFullscreen=function(){return this.player().isFullscreen()};amp.FlashSS.prototype.src=function(n){if(n===undefined)return this.currentSrc();this.reset();this.player().options_.autoplay!==undefined&&this.autoplay(this.player().options_.autoplay);this.el_.setSrc(amp.getAbsoluteURL(n))},function(){function f(n){var t=n.charAt(0).toUpperCase()+n.slice(1);i["set"+t]=function(n){return this.el_["set"+t](n)}}function u(n){i[n]=function(){var t=n.charAt(0).toUpperCase()+n.slice(1);return this.el_["get"+t]()}}for(var i=amp.FlashSS.prototype,t="controls,muted,volume".split(","),r="currentSrc,duration,paused,seeking,videoHeight,videoWidth".split(","),n=0;n<t.length;n++)u(t[n]),f(t[n]);for(n=0;n<r.length;n++)u(r[n])}();amp.FlashSS.prototype.load=function(){this.el_.load()};amp.FlashSS.prototype.play=function(){this.el_.play2()};amp.FlashSS.prototype.pause=function(){this.el_.pause()};amp.FlashSS.prototype.supportsFullScreen=function(){return!1};amp.FlashSS.prototype.enterFullScreen=function(){return!1};amp.FlashSS.onReady=function(n){amp.log(n,"Ready");var t,i;t=amp.el(n);this.el_=t;i=t&&t.parentNode&&t.parentNode.player;i&&(t.player=i,amp.FlashSS.checkReady(i.flashSS))};amp.FlashSS.checkReady=function(n){return n.el()?n.el().getBufferTime?(n.triggerReady(),!0):(setTimeout(function(){amp.FlashSS.checkReady(n)},50),!1):!1};amp.FlashSS._firstReady=!0;amp.FlashSS._passThroughEvents=["play","pause","seeked","seeking","durationchange","loadstart","timeupdate","waiting","volumechange"];amp.FlashSS.onEvent=function(n,t,i){var r,u;try{r=amp.el(n).player;amp.FlashSS._passThroughEvents.indexOf(t)!==-1&&r.trigger(t);switch(t){case"onJavaScriptBridgeCreated":amp.FlashSS.onReady(n);break;case"complete":amp.FlashSS._ended=!0;r.trigger("ended");break;case"emptied":amp.FlashSS._firstReady&&(r.trigger("loadeddata"),r.trigger("canplaythrough"),amp.FlashSS._firstReady=!1);break;case"play":amp.log(n,"Event: playing");r.trigger("playing");break;case"error":r.currentSrc()&&(u=new amp.MediaError(amp.FlashSS.getMediaErrorCode(i.code)),u.extendedCode=i.code,u.extendedMessage=i.message,r.error(u))}"timeupdate"!==t&&"progress"!==t&&amp.log(n,"Event:",t)}catch(f){amp.log(n,"Event:",t,f);throw f;}};amp.FlashSS.getMediaErrorCode=function(n){switch(n){case amp.FlashSS.errorCodes.ENCRYPTIONKEY_DOWNLOAD_ERROR:case amp.FlashSS.errorCodes.ENCRYPTIONKEY_DOWNLOAD_AUTH_ERROR:case amp.FlashSS.errorCodes.ENCRYPTIONKEY_DOWNLOAD_TIMEOUT:case amp.FlashSS.errorCodes.ENCRYPTIONKEYURL_TOKEN_VERIFICATION_ERROR:case amp.FlashSS.errorCodes.FRAGMENT_DECRYPT_ERROR:return MediaError.MEDIA_ERR_DECODE;case amp.FlashSS.errorCodes.OSMF_HTTP_GET_FAILED:case amp.FlashSS.errorCodes.OSMF_NETCONNECTION_REJECTED:case amp.FlashSS.errorCodes.OSMF_NETCONNECTION_APPLICATION_INVALID:case amp.FlashSS.errorCodes.OSMF_NETCONNECTION_FAILED:case amp.FlashSS.errorCodes.OSMF_NETCONNECTION_TIMEOUT:case amp.FlashSS.errorCodes.MANIFEST_DOWNLOAD_TIMEOUT:case amp.FlashSS.errorCodes.MANIFEST_DOWNLOAD_ERROR:case amp.FlashSS.errorCodes.FRAGMENT_DOWNLOAD_TIMEOUT:case amp.FlashSS.errorCodes.FRAGMENT_DOWNLOAD_ERROR:return MediaError.MEDIA_ERR_NETWORK;case amp.FlashSS.errorCodes.OSMF_NETSTREAM_PLAY_FAILED:case amp.FlashSS.errorCodes.OSMF_NETSTREAM_FILE_STRUCTURE_INVALID:case amp.FlashSS.errorCodes.OSMF_IO_ERROR:case amp.FlashSS.errorCodes.OSMF_SECURITY_ERROR:case amp.FlashSS.errorCodes.OSMF_ASYNC_ERROR:case amp.FlashSS.errorCodes.OSMF_ARGUMENT_ERROR:case amp.FlashSS.errorCodes.OSMF_URL_SCHEME_INVALID:case amp.FlashSS.errorCodes.OSMF_MEDIA_LOAD_FAILED:case amp.FlashSS.errorCodes.OSMF_PLUGIN_VERSION_INVALID:case amp.FlashSS.errorCodes.OSMF_PLUGIN_IMPLEMENTATION_INVALID:case amp.FlashSS.errorCodes.OSMF_SOUND_PLAY_FAILED:case amp.FlashSS.errorCodes.OSMF_NETSTREAM_STREAM_NOT_FOUND:case amp.FlashSS.errorCodes.OSMF_DVRCAST_SUBSCRIBE_FAILED:case amp.FlashSS.errorCodes.OSMF_DVRCAST_CONTENT_OFFLINE:case amp.FlashSS.errorCodes.OSMF_DVRCAST_STREAM_INFO_RETRIEVAL_FAILED:case amp.FlashSS.errorCodes.OSMF_F4M_FILE_INVALID:case amp.FlashSS.errorCodes.MANIFEST_PARSE_TIMEOUT:case amp.FlashSS.errorCodes.MANIFEST_MAJOR_VERSION_MISSING:case amp.FlashSS.errorCodes.MANIFEST_MINOR_VERSION_MISSING:case amp.FlashSS.errorCodes.MANIFEST_STREAMINDEX_MISSING:case amp.FlashSS.errorCodes.MANIFEST_UNEXPECTED_ROOT_ELEMENT:case amp.FlashSS.errorCodes.MANIFEST_UNEXPECTED_ROOT_ATTRIBUTE:case amp.FlashSS.errorCodes.MANIFEST_STREAMINFO_TYPE_MISSING:case amp.FlashSS.errorCodes.MANIFEST_STREAMINFO_URL_MISSING:case amp.FlashSS.errorCodes.MANIFEST_CHUNK_ATTRIBUTE_MISSING:case amp.FlashSS.errorCodes.MANIFEST_NOT_SUPPORTED_ELEMENT:case amp.FlashSS.errorCodes.MANIFEST_NOT_SUPPORTED_AUDIO_TRACK:case amp.FlashSS.errorCodes.MANIFEST_NOT_SUPPORTED_VIDEO_TRACK:case amp.FlashSS.errorCodes.MANIFEST_INVALID_ATTRIBUTE_VALUE:case amp.FlashSS.errorCodes.INVALID_SMOOTH_DYNAMIC_RESOURCE:case amp.FlashSS.errorCodes.MANIFEST_AUDIO_QUALITYLEVEL_BITRATE_MISSING:case amp.FlashSS.errorCodes.MANIFEST_AUDIO_QUALITYLEVEL_AUDIOTAG_MISSING:case amp.FlashSS.errorCodes.MANIFEST_VIDEO_QUALITYLEVEL_BITRATE_MISSING:case amp.FlashSS.errorCodes.MANIFEST_VIDEO_QUALITYLEVEL_FOURCC_MISSING:case amp.FlashSS.errorCodes.MANIFEST_VIDEO_QUALITYLEVEL_MAXWIDTH_MISSING:case amp.FlashSS.errorCodes.MANIFEST_VIDEO_QUALITYLEVEL_MAXHEIGHT_MISSING:case amp.FlashSS.errorCodes.MANIFEST_UNEXPECTED_PROTECTION_HEADER:case amp.FlashSS.errorCodes.VIDEO_STREAM_MISSING:case amp.FlashSS.errorCodes.MANIFEST_LIVE_DVRWINDOWLENGTH_TOO_SMALL:case amp.FlashSS.errorCodes.TOO_EARLY_TO_JOIN_LIVE_EVENT:case amp.FlashSS.errorCodes.CANNOT_SET_AUDIO_STREAM_INDEX:case amp.FlashSS.errorCodes.MANIFEST_LIVE_LOOKAHEADFRAGMENTCOUNT_MISSING:case amp.FlashSS.errorCodes.PLUGIN_INVALID_PARAM:case amp.FlashSS.errorCodes.PLUGIN_NULL_PARAM:return MediaError.MEDIA_ERR_SRC_NOT_SUPPORTED;default:return 0}};amp.FlashSS.errorCodes={OSMF_IO_ERROR:1,OSMF_SECURITY_ERROR:2,OSMF_ASYNC_ERROR:3,OSMF_ARGUMENT_ERROR:4,OSMF_URL_SCHEME_INVALID:5,OSMF_HTTP_GET_FAILED:6,OSMF_MEDIA_LOAD_FAILED:7,OSMF_PLUGIN_VERSION_INVALID:8,OSMF_PLUGIN_IMPLEMENTATION_INVALID:9,OSMF_SOUND_PLAY_FAILED:10,OSMF_NETCONNECTION_REJECTED:11,OSMF_NETCONNECTION_APPLICATION_INVALID:12,OSMF_NETCONNECTION_FAILED:13,OSMF_NETCONNECTION_TIMEOUT:14,OSMF_NETSTREAM_PLAY_FAILED:15,OSMF_NETSTREAM_STREAM_NOT_FOUND:16,OSMF_NETSTREAM_FILE_STRUCTURE_INVALID:17,OSMF_NETSTREAM_NO_SUPPORTED_TRACK_FOUND:18,OSMF_DRM_SYSTEM_UPDATE_ERROR:19,OSMF_DVRCAST_SUBSCRIBE_FAILED:20,OSMF_DVRCAST_CONTENT_OFFLINE:21,OSMF_DVRCAST_STREAM_INFO_RETRIEVAL_FAILED:22,OSMF_F4M_FILE_INVALID:23,MANIFEST_DOWNLOAD_TIMEOUT:1e3,MANIFEST_PARSE_TIMEOUT:1001,MANIFEST_DOWNLOAD_ERROR:1002,MANIFEST_MAJOR_VERSION_MISSING:1003,MANIFEST_MINOR_VERSION_MISSING:1004,MANIFEST_STREAMINDEX_MISSING:1005,MANIFEST_UNEXPECTED_ROOT_ELEMENT:1006,MANIFEST_UNEXPECTED_ROOT_ATTRIBUTE:1007,MANIFEST_STREAMINFO_TYPE_MISSING:1008,MANIFEST_STREAMINFO_URL_MISSING:1009,MANIFEST_AUDIO_QUALITYLEVEL_BITRATE_MISSING:1010,MANIFEST_AUDIO_QUALITYLEVEL_AUDIOTAG_MISSING:1011,MANIFEST_VIDEO_QUALITYLEVEL_BITRATE_MISSING:1012,MANIFEST_VIDEO_QUALITYLEVEL_FOURCC_MISSING:1013,MANIFEST_VIDEO_QUALITYLEVEL_MAXWIDTH_MISSING:1014,MANIFEST_VIDEO_QUALITYLEVEL_MAXHEIGHT_MISSING:1015,MANIFEST_CHUNK_ATTRIBUTE_MISSING:1016,MANIFEST_NOT_SUPPORTED_ELEMENT:1017,MANIFEST_NOT_SUPPORTED_AUDIO_TRACK:1018,MANIFEST_NOT_SUPPORTED_VIDEO_TRACK:1019,MANIFEST_INVALID_ATTRIBUTE_VALUE:1020,INVALID_SMOOTH_DYNAMIC_RESOURCE:1021,FRAGMENT_DOWNLOAD_TIMEOUT:1022,FRAGMENT_DOWNLOAD_ERROR:1023,CANNOT_SET_AUDIO_STREAM_INDEX:1024,VIDEO_STREAM_MISSING:1025,MANIFEST_LIVE_LOOKAHEADFRAGMENTCOUNT_MISSING:1026,PLUGIN_INVALID_PARAM:1027,PLUGIN_NULL_PARAM:1028,MANIFEST_LIVE_DVRWINDOWLENGTH_TOO_SMALL:1029,TOO_EARLY_TO_JOIN_LIVE_EVENT:1030,MANIFEST_UNEXPECTED_PROTECTION_HEADER:1048,ENCRYPTIONKEY_DOWNLOAD_ERROR:1049,ENCRYPTIONKEY_DOWNLOAD_AUTH_ERROR:1050,ENCRYPTIONKEY_DOWNLOAD_TIMEOUT:1051,ENCRYPTIONKEYURL_TOKEN_VERIFICATION_ERROR:1052,FRAGMENT_DECRYPT_ERROR:1053};amp.FlashSS.prototype.reset=function(){amp.FlashSS._firstReady=!0;amp.FlashSS._ended=!1};amp.options.techOrder.unshift("flashSS");amp.options.flashSS={};amp.AzureHtml5JS=amp.MediaTechController.extend({init:function(n,t,i){var r,u;this.movingMediaElementInDOM=!amp.IS_IOS;this.playbackRate=!1;this.fullscreenResize=!0;this.progressEvents=!1;this.volumeControl=!0;r=t.source;amp.MediaTechController.call(this,n,t,i);this.el().controls=!1;u=AzureHtml5JS.CreateAzureHtml5(this.el());n.mediaPlayer=u;this.setupTriggers(u);r&&this.src!==r.src&&(r.protectionInfo&&(n.options_.playbackOptions.protectionInfo=r.protectionInfo),this.setSrc(r.src));amp.TOUCH_ENABLED&&n.options().nativeControlsForTouch!==!1&&this.useNativeControls();this.triggerReady()}});amp.AzureHtml5JS.prototype.createEl=function(){var t=this.player_,n=t.tag,e,u,i,r,f;for(n&&this.features.movingMediaElementInDOM!==!1||(n?(e=n.cloneNode(!1),amp.Html5.disposeMediaElement(n),n=e,t.tag=null):(n=amp.createEl("video"),amp.setElementAttributes(n,amp.obj.merge(t.tagAttributes||{},{id:t.id()+"_html5_api","class":"vjs-tech"}))),n.player=t,t.tag=n,amp.insertFirst(n,t.el())),u=["autoplay","preload","loop","muted"],i=u.length-1;i>=0;i--)r=u[i],f={},typeof t.options_[r]!="undefined"&&(f[r]=t.options_[r]),amp.setElementAttributes(n,f);return n};amp.AzureHtml5JS.isSupported=function(){return!!window.MediaSource};amp.AzureHtml5JS.canPlaySource=function(n){return amp.Player.canSupportFormats(n,this.supportedFormats)};amp.AzureHtml5JS.supportedFormats={"application/dash+xml":[amp.protectionType.PlayReady,amp.protectionType.AES]};amp.AzureHtml5JS.prototype.useNativeControls=function(){var t,n,i,r,u;t=this;n=this.player();t.setControls(n.controls());i=function(){t.setControls(!0)};r=function(){t.setControls(!1)};n.on("controlsenabled",i);n.on("controlsdisabled",r);u=function(){n.off("controlsenabled",i);n.off("controlsdisabled",r)};t.on("dispose",u);n.on("usingcustomcontrols",u);n.usingNativeControls(!0)};amp.AzureHtml5JS.prototype.autoplay=function(){return this.player().mediaPlayer.autoplay};amp.AzureHtml5JS.prototype.setAutoplay=function(n){this.player().options_.autoplay=n};amp.AzureHtml5JS.prototype.buffered=function(){return this.player().mediaPlayer.buffered};amp.AzureHtml5JS.prototype.currentSrc=function(){return this.src()};amp.AzureHtml5JS.prototype.setCurrentTime=function(n){this.player().mediaPlayer.currentTime=n};amp.AzureHtml5JS.prototype.currentTime=function(){return this.player().mediaPlayer.currentTime};amp.AzureHtml5JS.prototype.currentType=function(){return this.player().mediaPlayer.type};amp.AzureHtml5JS.prototype.duration=function(){return this.player().mediaPlayer.duration};amp.AzureHtml5JS.prototype.ended=function(){return this.player().mediaPlayer.ended};amp.AzureHtml5JS.prototype.error=function(){return this.player().error()};amp.AzureHtml5JS.prototype.isFullScreen=function(){return this.player().mediaPlayer.isFullScreen};amp.AzureHtml5JS.prototype.muted=function(){return this.player().mediaPlayer.volume===0};amp.AzureHtml5JS.prototype.setMuted=function(){this.player().mediaPlayer.volume=0};amp.AzureHtml5JS.prototype.paused=function(){return this.player().mediaPlayer.paused};amp.AzureHtml5JS.prototype.seeking=function(){return this.player().mediaPlayer.seeking};amp.AzureHtml5JS.prototype.src=function(n){if(n===undefined)return this.player().mediaPlayer.src;this.setSrc(n)};amp.AzureHtml5JS.prototype.volume=function(){return this.player().mediaPlayer.volume};amp.AzureHtml5JS.prototype.setVolume=function(n){this.player().mediaPlayer.volume=n};amp.AzureHtml5JS.prototype.height=function(n){if(n===undefined)return this.player().mediaPlayer.height;this.player().mediaPlayer.height=n};amp.AzureHtml5JS.prototype.width=function(n){if(n===undefined)return this.player().mediaPlayer.width;this.player().mediaPlayer.width=n};amp.AzureHtml5JS.prototype.videoHeight=function(){return this.player().mediaPlayer.videoHeight};amp.AzureHtml5JS.prototype.videoWidth=function(){return this.player().mediaPlayer.videoWidth};amp.AzureHtml5JS.prototype.play=function(){this.player().mediaPlayer.play()};amp.AzureHtml5JS.prototype.pause=function(){this.player().mediaPlayer.pause()};amp.AzureHtml5JS.prototype.setSrc=function(n){var r={type:this.player().currentType()},t,i;if(this.player().options_.autoplay!==undefined&&(r=amp.obj.merge({autoPlay:this.player().options_.autoplay},r)),t=this.player().options_.playbackOptions.protectionInfo,t)for(i=0;i<t.length;i++)if((t[i].type===amp.protectionType.PlayReady||t[i].type===amp.protectionType.AES)&&t[i].authenticationToken){r=amp.obj.merge({authenticationToken:t[i].authenticationToken},r);break}this.player().mediaPlayer.setSrc(n,r)};amp.AzureHtml5JS.prototype.load=function(){};amp.AzureHtml5JS.prototype.supportsFullScreen=function(){return!0};amp.AzureHtml5JS.prototype.enterFullScreen=function(){this.player().mediaPlayer.requestFullScreen()};amp.AzureHtml5JS.prototype.exitFullScreen=function(){this.player().mediaPlayer.exitFullscreen()};amp.AzureHtml5JS.prototype.dispose=function(){vjs.Html5.disposeMediaElement(this.el_);vjs.MediaTechController.prototype.dispose.call(this);this.player().mediaPlayer.dispose()};amp.AzureHtml5JS.prototype.setupTriggers=function(n){n.addEventListener(AzureHtml5JS.EventName.volumechange,amp.bind(this,amp.AzureHtml5JS.onPassthroughHandler));n.addEventListener(AzureHtml5JS.EventName.ended,amp.bind(this,amp.AzureHtml5JS.onPassthroughHandler));n.addEventListener(AzureHtml5JS.EventName.timeupdate,amp.bind(this,amp.AzureHtml5JS.onPassthroughHandler));n.addEventListener(AzureHtml5JS.EventName.pause,amp.bind(this,amp.AzureHtml5JS.onPassthroughHandler));n.addEventListener(AzureHtml5JS.EventName.play,amp.bind(this,amp.AzureHtml5JS.onPassthroughHandler));n.addEventListener(AzureHtml5JS.EventName.playing,amp.bind(this,amp.AzureHtml5JS.onPassthroughHandler));n.addEventListener(AzureHtml5JS.EventName.seeking,amp.bind(this,amp.AzureHtml5JS.onPassthroughHandler));n.addEventListener(AzureHtml5JS.EventName.seeked,amp.bind(this,amp.AzureHtml5JS.onPassthroughHandler));n.addEventListener(AzureHtml5JS.EventName.loadstart,amp.bind(this,amp.AzureHtml5JS.onPassthroughHandler));n.addEventListener(AzureHtml5JS.EventName.loadeddata,amp.bind(this,amp.AzureHtml5JS.onPassthroughHandler));n.addEventListener(AzureHtml5JS.EventName.fullscreenchange,amp.bind(this,amp.AzureHtml5JS.onPassthroughHandler));n.addEventListener(AzureHtml5JS.EventName.waiting,amp.bind(this,amp.AzureHtml5JS.onPassthroughHandler));n.addEventListener(AzureHtml5JS.EventName.canplaythrough,amp.bind(this,amp.AzureHtml5JS.onPassthroughHandler));n.addEventListener(AzureHtml5JS.EventName.error,amp.bind(this,amp.AzureHtml5JS.onError));var t;n.addEventListener(AzureHtml5JS.EventName.timeupdate,amp.bind(this,function(){this.duration()!==t&&(t=this.duration(),this.player().trigger("durationchange"))}))};amp.AzureHtml5JS.onPassthroughHandler=function(n){this.player().trigger(n)};amp.AzureHtml5JS.onError=function(){var n=this.player().mediaPlayer.error,t=new amp.MediaError(n.code);t.extendedCode=n.extendedCode;t.extendedMessage=n.message;this.player().error(t)};amp.options.techOrder.unshift("azureHtml5JS"),function(n){"use strict";function l(n){o(n)&&(i=n)}function a(){i=t}function o(n){if(n&&n.length>0){for(var i=0;i<n.length;i++)if(-1===t.indexOf(n[i]))throw new Error('Format "'+n[i]+'" not supported');return!0}return!1}function v(n){for(var i=[],r,u,f=[],t=0;n&&t<n.length;t++)y(n[t].src)!=="ism"||n[t].disableUrlRewriter?i.push(n[t]):(u=s(n[t].src),f.indexOf(u)===-1&&(f.push(u),r=p(n[t]),r&&(i=i.concat(r))));return i.length>0?i:null}function y(n){var t=null,i=n.lastIndexOf("."),r=n.indexOf("/",i);return i>-1&&(t=n.substring(i+1,r!==-1?r:n.length),t=t.toLowerCase()),t}function s(n){var t=n.trim(),i=t.search(/\.ism\/manifest/i);return t.substr(0,i+f.length)}function p(n){var t=n.src.trim(),d=t.search(/format=/i),w=[],a,e="",v,y,p,l,b,k;for(d>-1&&(t=t.replace(/format=[^,)]*[ ,]*/i,""),t=t.replace(/\(\s*\)/,"")),a=t.match(/\.ism\/manifest\([^)]*\)/i),a&&a.length>0&&(e=a[0].substr(f.length+1).trim()),t=s(n.src.trim()),v=i,n.streamingFormats&&o(n.streamingFormats)&&(v=n.streamingFormats),y=0;y<v.length;y++)l="",p=v[y],b=c[p],p!==u?l="(format="+h[p]+(e?","+e:")"):e&&(l="("+e),k=n.protectionInfo?new r(t+l,b,n.protectionInfo):new r(t+l,b),w.push(k);return w.length>0?w:null}var u="SMOOTH",t=[u,"DASH","HLS-V3","HLS-V4"],h={DASH:"mpd-time-csf","HLS-V3":"m3u8-aapl-v3","HLS-V4":"m3u8-aapl-v4"},c={SMOOTH:"application/vnd.ms-sstr+xml",DASH:"application/dash+xml","HLS-V3":"application/vnd.apple.mpegurl","HLS-V4":"application/vnd.apple.mpegurl"},f=".ism/manifest",i=t,r=function(){function n(n,t,i){this.src=n;this.type=t;this.protectionInfo=i}return n}(),e;n.streamSrc=r;e=function(){function n(){}return n}();n.protectionInfo=e;n.setStreamingFormats=l;n.resetStreamingFormats=a;n.expandSources=v}(UrlRewriter||(UrlRewriter={}))