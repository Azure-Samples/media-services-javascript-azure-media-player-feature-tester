<!DOCTYPE html>
<html>
<head>
    <title>Azure Media Player</title>
    <script src="js/vendor/jquery-1.11.0.min.js"></script>
    <script>
        var config = {
            url: "",
            format: "",
            tech: "",
        };

        // put function into jQuery namespace
        jQuery.redirect = function (url, params) {

            url = url || window.location.href || '';
            url = url.match(/\?/) ? url : url + '?';

            for (var key in params) {
                var re = RegExp(';?' + key + '=?[^&;]*', 'g');
                url = url.replace(re, '');
                url += ';' + key + '=' + params[key];
            }
            // cleanup url 
            url = url.replace(/[;&]$/, '');
            url = url.replace(/\?[;&]/, '?');
            url = url.replace(/[;&]{2}/g, ';');
            // $(location).attr('href', url);
            window.location.replace(url);
        };

        var queryString = function () {
            // This function is anonymous, is executed immediately and 
            // the return value is assigned to QueryString!
            var query_string = {};
            var query = window.location.search.substring(1);
            var vars = query.split("&");
            for (var i = 0; i < vars.length; i++) {
                var pair = vars[i].split(/=(.*)/);
                // If first entry with this name
                if (typeof query_string[pair[0]] === "undefined") {
                    query_string[pair[0]] = pair[1];
                    // If second entry with this name
                } else if (typeof query_string[pair[0]] === "string") {
                    var arr = [query_string[pair[0]], pair[1]];
                    query_string[pair[0]] = arr;
                    // If third or later entry with this name
                } else {
                    query_string[pair[0]].push(pair[1]);
                }
            }
            return query_string;
        }();

        var initialize = function() {
            if (queryString.url) {
                if (queryString.url.toLowerCase().match(".ism/manifest")) {
                    var splitURL = queryString.url.split(/.ism/);
                    config.url = splitURL[0] + ".ism/manifest";
                } else {
                    config.url = queryString.url;
                }
            }
            if(queryString.player) {
                config.tech = queryString.player;
            }
            if (queryString.format) {
                if(queryString.format == "mpeg-dash"){
                    config.format = "dash";
                    config.tech = "";
                    config.url += "(format=mpd-time-csf)";
                }else{
                    config.format = queryString.format;
                }
            }
            if (queryString.mp4url && queryString.format =="mp4") {
                config.url = queryString.mp4url;
                config.tech = "html5";
            }
        };

    </script>
</head>
<body>
    <script>
        initialize();
        var params = "";
        if (config.url != "") {
            params += "url=" + config.url + "&";
        }
        //if (config.tech != "") {
        //    params += "tech=" + config.tech + "&";
        //}
        if (config.format == "mp4") {
            params += "format=mp4";
        }
        window.location.replace("//aka.ms/azuremediaplayer?" + params);
    </script>
</body>
</html>